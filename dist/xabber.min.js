/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.3.6 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, https://github.com/requirejs/requirejs/blob/master/LICENSE
 */var requirejs,require,define;(function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var a;for(a=0;a<e.length&&!(e[a]&&t(e[a],a,e));a+=1);}}function eachReverse(e,t){if(e){var a;for(a=e.length-1;-1<a&&!(e[a]&&t(e[a],a,e));a-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){for(var a in e)if(hasProp(e,a)&&t(e[a],a))break}function mixin(e,t,a,i){return t&&eachProp(t,function(t,n){(a||!hasProp(e,n))&&(!i||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[n]=t:(!e[n]&&(e[n]={}),mixin(e[n],t,a,i)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(t,a,i,n){var s=new Error(a+"\nhttps://requirejs.org/docs/errors.html#"+t);return s.requireType=t,s.requireModules=n,i&&(s.originalError=i),s}function newContext(e){function t(e){var t,a;for(t=0;t<e.length;t++)if(a=e[t],"."===a)e.splice(t,1),t-=1;else if(".."===a)if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;else 0<t&&(e.splice(t-1,2),t-=2)}function a(e,a,n){var s=a&&a.split("/"),o=b.map,d=o&&o["*"],r,c,l,p,u,m,g,h,v,f,x,w;if(e&&(e=e.split("/"),g=e.length-1,b.nodeIdCompat&&jsSuffixRegExp.test(e[g])&&(e[g]=e[g].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&s&&(w=s.slice(0,s.length-1),e=w.concat(e)),t(e),e=e.join("/")),n&&o&&(s||d)){l=e.split("/");outerLoop:for(p=l.length;0<p;p-=1){if(m=l.slice(0,p).join("/"),s)for(u=s.length;0<u;u-=1)if(c=getOwn(o,s.slice(0,u).join("/")),c&&(c=getOwn(c,m),c)){h=c,v=p;break outerLoop}!f&&d&&getOwn(d,m)&&(f=getOwn(d,m),x=p)}!h&&f&&(h=f,v=x),h&&(l.splice(0,v,h),e=l.join("/"))}return r=getOwn(b.pkgs,e),r?r:e}function i(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===R.contextName)return t.parentNode.removeChild(t),!0})}function n(e){var t=getOwn(b.paths,e);if(t&&isArray(t)&&1<t.length)return t.shift(),R.require.undef(e),R.makeRequire(null,{skipMap:!0})([e]),!0}function s(e){var t=e?e.indexOf("!"):-1,a;return-1<t&&(a=e.substring(0,t),e=e.substring(t+1,e.length)),[a,e]}function o(e,t,i,n){var o=null,d=t?t.name:null,r=e,c=!0,l="",p,u,m,g;return e||(c=!1,e="_@r"+(E+=1)),g=s(e),o=g[0],e=g[1],o&&(o=a(o,d,n),u=getOwn(k,o)),e&&(o?i?l=e:u&&u.normalize?l=u.normalize(e,function(e){return a(e,d,n)}):l=-1===e.indexOf("!")?a(e,d,n):e:(l=a(e,d,n),g=s(l),o=g[0],l=g[1],i=!0,p=R.nameToUrl(l))),m=!o||u||i?"":"_unnormalized"+(M+=1),{prefix:o,name:l,parentMap:t,unnormalized:!!m,url:p,originalName:r,isDefine:c,id:(o?o+"!"+l:l)+m}}function d(e){var t=e.id,a=getOwn(x,t);return a||(a=x[t]=new R.Module(e)),a}function r(e,t,a){var i=e.id,n=getOwn(x,i);hasProp(k,i)&&(!n||n.defineEmitComplete)?"defined"===t&&a(k[i]):(n=d(e),n.error&&"error"===t?a(n.error):n.on(t,a))}function c(e,t){var a=e.requireModules,i=!1;t?t(e):(each(a,function(t){var a=getOwn(x,t);a&&(a.error=e,a.events.error&&(i=!0,a.emit("error",e)))}),!i&&req.onError(e))}function l(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(R.defQueueMap[t]=!0),S.push(e)}),globalDefQueue=[])}function p(e){delete x[e],delete w[e]}function u(e,t,a){var i=e.map.id;e.error?e.emit("error",e.error):(t[i]=!0,each(e.depMaps,function(n,s){var i=n.id,o=getOwn(x,i);!o||e.depMatched[s]||a[i]||(getOwn(t,i)?(e.defineDep(s,k[i]),e.check()):u(o,t,a))}),a[i]=!0)}function m(){var e=1e3*b.waitSeconds,t=e&&R.startTime+e<new Date().getTime(),a=[],s=[],o=!1,d=!0,r,l;if(!I)return I=!0,eachProp(w,function(e){var r=e.map,c=r.id;if(e.enabled&&(r.isDefine||s.push(e),!e.error))if(!e.inited&&t)n(c)?(l=!0,o=!0):(a.push(c),i(c));else if(!e.inited&&e.fetched&&r.isDefine&&(o=!0,!r.prefix))return d=!1}),t&&a.length?(r=makeError("timeout","Load timeout for modules: ",null,a),r.contextName=R.contextName,c(r)):void(d&&each(s,function(e){u(e,{},{})}),(!t||l)&&o&&(isBrowser||isWebWorker)&&!P&&(P=setTimeout(function(){P=0,m()},50)),I=!1)}function g(e){hasProp(k,e[0])||d(o(e[0],null,!0)).init(e[1],e[2])}function h(e,t,a,i){e.detachEvent&&!isOpera?i&&e.detachEvent(i,t):e.removeEventListener(a,t,!1)}function v(e){var t=e.currentTarget||e.srcElement;return h(t,R.onScriptLoad,"load","onreadystatechange"),h(t,R.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function f(){var e;for(l();S.length;){if(e=S.shift(),null===e[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));g(e)}R.defQueueMap={}}var b={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},x={},w={},C={},S=[],k={},A={},T={},E=1,M=1,I,N,R,O,P;return O={require:function(e){return e.require?e.require:e.require=R.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?k[e.map.id]=e.exports:e.exports=k[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(b.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},N=function(e){this.events=getOwn(C,e.id)||{},this.map=e,this.shim=getOwn(b.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},N.prototype={init:function(e,t,a,i){i=i||{},this.inited||(this.factory=t,a?this.on("error",a):this.events.error&&(a=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=a,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,R.startTime=new Date().getTime();var e=this.map;return this.shim?void R.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;A[e]||(A[e]=!0,R.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e=this.map.id,t=this.depExports,a=this.exports,i=this.factory,n,s;if(!this.inited)hasProp(R.defQueueMap,e)||this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,1>this.depCount&&!this.defined){if(isFunction(i)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{a=R.execCb(e,i,t,a)}catch(t){n=t}else a=R.execCb(e,i,t,a);if(this.map.isDefine&&void 0===a&&(s=this.module,s?a=s.exports:this.usingExports&&(a=this.exports)),n)return n.requireMap=this.map,n.requireModules=this.map.isDefine?[this.map.id]:null,n.requireType=this.map.isDefine?"define":"require",c(this.error=n)}else a=i;if(this.exports=a,this.map.isDefine&&!this.ignore&&(k[e]=a,req.onResourceLoad)){var o=[];each(this.depMaps,function(e){o.push(e.normalizedMap||e)}),req.onResourceLoad(R,this.map,o)}p(e),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}},callPlugin:function(){var e=this.map,t=e.id,i=o(e.prefix);this.depMaps.push(i),r(i,"defined",bind(this,function(i){var n=getOwn(T,this.map.id),s=this.map.name,l=this.map.parentMap?this.map.parentMap.name:null,u=R.makeRequire(e.parentMap,{enableBuildCallback:!0}),m,g,h;return this.map.unnormalized?(i.normalize&&(s=i.normalize(s,function(e){return a(e,l,!0)})||""),g=o(e.prefix+"!"+s,this.map.parentMap,!0),r(g,"defined",bind(this,function(e){this.map.normalizedMap=g,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),h=getOwn(x,g.id),void(h&&(this.depMaps.push(g),this.events.error&&h.on("error",bind(this,function(e){this.emit("error",e)})),h.enable()))):n?(this.map.url=R.nameToUrl(n),void this.load()):void(m=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),m.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(x,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&p(e.map.id)}),c(e)}),m.fromText=bind(this,function(a,i){var n=e.name,s=o(n),r=useInteractive;i&&(a=i),r&&(useInteractive=!1),d(s),hasProp(b.config,t)&&(b.config[n]=b.config[t]);try{req.exec(a)}catch(a){return c(makeError("fromtexteval","fromText eval for "+t+" failed: "+a,a,[t]))}r&&(useInteractive=!0),this.depMaps.push(s),R.completeLoad(n),u([n],m)}),i.load(e.name,u,m,b))})),R.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){w[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var a,i,n;if("string"==typeof e){if(e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,n=getOwn(O,e.id),n)return void(this.depExports[t]=n(this));this.depCount+=1,r(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?r(e,"error",bind(this,this.errback)):this.events.error&&r(e,"error",bind(this,function(e){this.emit("error",e)}))}a=e.id,i=x[a],hasProp(O,a)||!i||i.enabled||R.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(x,e.id);t&&!t.enabled&&R.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var a=this.events[e];a||(a=this.events[e]=[]),a.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},R={config:b,contextName:e,registry:x,defined:k,urlFetched:A,defQueue:S,defQueueMap:{},Module:N,makeModuleMap:o,nextTick:req.nextTick,onError:c,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,a){return(-1===a.indexOf("?")?"?":"&")+t}}var a=b.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(!b[t]&&(b[t]={}),mixin(b[t],e,!0,!0)):b[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(T[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=R.makeShimExports(e)),a[t]=e}),b.shim=a),e.packages&&each(e.packages,function(e){var t,a;e="string"==typeof e?{name:e}:e,a=e.name,t=e.location,t&&(b.paths[a]=e.location),b.pkgs[a]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(x,function(e,t){e.inited||e.map.unnormalized||(e.map=o(t,null,!0))}),(e.deps||e.callback)&&R.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(t,n){function s(a,i,r){var l,p,u;return(n.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof a)?isFunction(i)?c(makeError("requireargs","Invalid require call"),r):t&&hasProp(O,a)?O[a](x[t.id]):req.get?req.get(R,a,t,s):(p=o(a,t,!1,!0),l=p.id,hasProp(k,l)?k[l]:c(makeError("notloaded","Module name \""+l+"\" has not been loaded yet for context: "+e+(t?"":". Use require([])")))):(f(),R.nextTick(function(){f(),u=d(o(null,t)),u.skipMap=n.skipMap,u.init(a,i,r,{enabled:!0}),m()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var i=e.lastIndexOf("."),n=e.split("/")[0],s;return-1!==i&&(!("."===n||".."===n)||1<i)&&(s=e.substring(i,e.length),e=e.substring(0,i)),R.nameToUrl(a(e,t&&t.id,!0),s,!0)},defined:function(e){return hasProp(k,o(e,t,!1,!0).id)},specified:function(e){return e=o(e,t,!1,!0).id,hasProp(k,e)||hasProp(x,e)}}),t||(s.undef=function(e){l();var a=o(e,t,!0),n=getOwn(x,e);n.undefed=!0,i(e),delete k[e],delete A[a.url],delete C[e],eachReverse(S,function(t,a){t[0]===e&&S.splice(a,1)}),delete R.defQueueMap[e],n&&(n.events.defined&&(C[e]=n.events),p(e))}),s},enable:function(e){var t=getOwn(x,e.id);t&&d(e).enable()},completeLoad:function(e){var t=getOwn(b.shim,e)||{},a=t.exports,i,s,o;for(l();S.length;){if(s=S.shift(),null===s[0]){if(s[0]=e,i)break;i=!0}else s[0]===e&&(i=!0);g(s)}if(R.defQueueMap={},o=getOwn(x,e),!i&&!hasProp(k,e)&&o&&!o.inited){if(b.enforceDefine&&(!a||!getGlobal(a)))return n(e)?void 0:c(makeError("nodefine","No define call for "+e,null,[e]));g([e,t.deps||[],t.exportsFn])}m()},nameToUrl:function(e,t,a){var n=getOwn(b.pkgs,e),s,o,d,r,c,l,p;if(n&&(e=n),p=getOwn(T,e),p)return R.nameToUrl(p,t,a);if(req.jsExtRegExp.test(e))c=e+(t||"");else{for(s=b.paths,o=e.split("/"),d=o.length;0<d;d-=1)if(r=o.slice(0,d).join("/"),l=getOwn(s,r),l){isArray(l)&&(l=l[0]),o.splice(0,d,l);break}c=o.join("/"),c+=t||(/^data\:|^blob\:|\?/.test(c)||a?"":".js"),c=("/"===c.charAt(0)||c.match(/^[\w\+\.\-]+:/)?"":b.baseUrl)+c}return b.urlArgs&&!/^blob\:/.test(c)?c+b.urlArgs(e,c):c},load:function(e,t){req.load(R,e,t)},execCb:function(e,t,a,i){return t.apply(i,a)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=v(e);R.completeLoad(t.id)}},onScriptError:function(e){var t=v(e);if(!n(t.id)){var a=[];return eachProp(x,function(e,i){0!==i.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===t.id)return a.push(i),!0})}),c(makeError("scripterror","Script error for \""+t.id+(a.length?"\", needed by: "+a.join(", "):"\""),e,[t.id]))}}},R.require=R.makeRequire(),R}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var version="2.3.6",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!!("undefined"!=typeof window&&"undefined"!=typeof navigator&&window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1,req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,a,i){var n="_",s,o;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=a,a=i):e=[]),o&&o.context&&(n=o.context),s=getOwn(contexts,n),s||(s=contexts[n]=req.s.newContext(n)),o&&s.configure(o),s.require(e,t,a)},req.config=function(e){return req(e)},req.nextTick="undefined"==typeof setTimeout?function(e){e()}:function(e){setTimeout(e,4)},require||(require=req),req.version="2.3.6",req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts._;return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e){var t=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return t.type=e.scriptType||"text/javascript",t.charset="utf-8",t.async=!0,t},req.load=function(t,a,i){var n=t&&t.config||{},s;if(isBrowser)return s=req.createNode(n,a,i),s.setAttribute("data-requirecontext",t.contextName),s.setAttribute("data-requiremodule",a),!s.attachEvent||s.attachEvent.toString&&0>s.attachEvent.toString().indexOf("[native code")||isOpera?(s.addEventListener("load",t.onScriptLoad,!1),s.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,s.attachEvent("onreadystatechange",t.onScriptLoad)),s.src=i,n.onNodeCreated&&n.onNodeCreated(s,n,a,i),currentlyAddingScript=s,baseElement?head.insertBefore(s,baseElement):head.appendChild(s),currentlyAddingScript=null,s;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),t.completeLoad(a)}catch(n){t.onError(makeError("importscripts","importScripts failed for "+a+" at "+i,n,[a]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain)return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,a){var i,n;"string"!=typeof e&&(a=t,t=e,e=null),isArray(t)||(a=t,t=null),!t&&isFunction(a)&&(t=[],a.length&&(a.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,a){t.push(a)}),t=(1===a.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript(),i&&(!e&&(e=i.getAttribute("data-requiremodule")),n=contexts[i.getAttribute("data-requirecontext")])),n?(n.defQueue.push([e,t,a]),n.defQueueMap[e]=!0):globalDefQueue.push([e,t,a])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}})(this,"undefined"==typeof setTimeout?void 0:setTimeout),define("node_modules/requirejs/require.js",function(){}),function(){var n=Math.floor,s=Math.min,o=Math.max;function e(e){function t(t,a,i,n,s,o){for(;0<=s&&s<o;s+=e){var d=n?n[s]:s;i=a(i,t[d],d,t)}return i}return function(a,i,n,s){i=S(i,s,4);var o=!N(a)&&C.keys(a),d=(o||a).length,r=0<e?0:d-1;return 3>arguments.length&&(n=a[o?o[r]:r],r+=e),t(a,i,n,o,r,d)}}function t(e){return function(t,a,i){a=k(a,i);for(var n=I(t),s=0<e?0:n-1;0<=s&&s<n;s+=e)if(a(t[s],s,t))return s;return-1}}function a(e,t,a){return function(n,d,r){var c=0,l=I(n);if("number"==typeof r)0<e?c=0<=r?r:o(r+l,c):l=0<=r?s(r+1,l):r+l+1;else if(a&&r&&l)return r=a(n,d),n[r]===d?r:-1;if(d!==d)return r=t(m.call(n,c,l),C.isNaN),0<=r?r+c:-1;for(r=0<e?c:l-1;0<=r&&r<l;r+=e)if(n[r]===d)return r;return-1}}function i(e,t){var a=D.length,i=e.constructor,n=C.isFunction(i)&&i.prototype||l,s="constructor";for(C.has(e,s)&&!C.contains(t,s)&&t.push(s);a--;)s=D[a],s in e&&e[s]!==n[s]&&!C.contains(t,s)&&t.push(s)}var d=this,r=d._,c=Array.prototype,l=Object.prototype,p=Function.prototype,u=c.push,m=c.slice,g=l.toString,h=l.hasOwnProperty,v=Array.isArray,f=Object.keys,b=p.bind,x=Object.create,w=function(){},C=function(e){return e instanceof C?e:this instanceof C?void(this._wrapped=e):new C(e)};"undefined"==typeof exports?d._=C:("undefined"!=typeof module&&module.exports&&(exports=module.exports=C),exports._=C),C.VERSION="1.8.3";var S=function(e,t,a){if(void 0===t)return e;switch(null==a?3:a){case 1:return function(a){return e.call(t,a)};case 2:return function(a,i){return e.call(t,a,i)};case 3:return function(a,i,n){return e.call(t,a,i,n)};case 4:return function(a,i,n,s){return e.call(t,a,i,n,s)};}return function(){return e.apply(t,arguments)}},k=function(e,t,a){return null==e?C.identity:C.isFunction(e)?S(e,t,a):C.isObject(e)?C.matcher(e):C.property(e)};C.iteratee=function(e,t){return k(e,t,1/0)};var A=function(e,t){return function(a){var n=arguments.length;if(2>n||null==a)return a;for(var s=1;s<n;s++)for(var o=arguments[s],d=e(o),r=d.length,c=0,l;c<r;c++)l=d[c],t&&void 0!==a[l]||(a[l]=o[l]);return a}},T=function(e){if(!C.isObject(e))return{};if(x)return x(e);w.prototype=e;var t=new w;return w.prototype=null,t},E=function(e){return function(t){return null==t?void 0:t[e]}},M=Math.pow(2,53)-1,I=E("length"),N=function(e){var t=I(e);return"number"==typeof t&&0<=t&&t<=M};C.each=C.forEach=function(e,t,a){t=S(t,a);var n,s;if(N(e))for(n=0,s=e.length;n<s;n++)t(e[n],n,e);else{var o=C.keys(e);for(n=0,s=o.length;n<s;n++)t(e[o[n]],o[n],e)}return e},C.map=C.collect=function(e,t,a){t=k(t,a);for(var i=!N(e)&&C.keys(e),n=(i||e).length,s=Array(n),o=0,d;o<n;o++)d=i?i[o]:o,s[o]=t(e[d],d,e);return s},C.reduce=C.foldl=C.inject=e(1),C.reduceRight=C.foldr=e(-1),C.find=C.detect=function(e,t,a){var i;if(i=N(e)?C.findIndex(e,t,a):C.findKey(e,t,a),void 0!==i&&-1!==i)return e[i]},C.filter=C.select=function(e,t,a){var i=[];return t=k(t,a),C.each(e,function(e,a,n){t(e,a,n)&&i.push(e)}),i},C.reject=function(e,t,a){return C.filter(e,C.negate(k(t)),a)},C.every=C.all=function(e,t,a){t=k(t,a);for(var i=!N(e)&&C.keys(e),n=(i||e).length,s=0,o;s<n;s++)if(o=i?i[s]:s,!t(e[o],o,e))return!1;return!0},C.some=C.any=function(e,t,a){t=k(t,a);for(var i=!N(e)&&C.keys(e),n=(i||e).length,s=0,o;s<n;s++)if(o=i?i[s]:s,t(e[o],o,e))return!0;return!1},C.contains=C.includes=C.include=function(e,t,a,i){return N(e)||(e=C.values(e)),("number"!=typeof a||i)&&(a=0),0<=C.indexOf(e,t,a)},C.invoke=function(e,t){var a=m.call(arguments,2),i=C.isFunction(t);return C.map(e,function(e){var n=i?t:e[t];return null==n?n:n.apply(e,a)})},C.pluck=function(e,t){return C.map(e,C.property(t))},C.where=function(e,t){return C.filter(e,C.matcher(t))},C.findWhere=function(e,t){return C.find(e,C.matcher(t))},C.max=function(e,t,a){var n=-Infinity,s=-Infinity,o,d;if(null==t&&null!=e){e=N(e)?e:C.values(e);for(var r=0,c=e.length;r<c;r++)o=e[r],o>n&&(n=o)}else t=k(t,a),C.each(e,function(e,a,i){d=t(e,a,i),(d>s||d===-Infinity&&n===-Infinity)&&(n=e,s=d)});return n},C.min=function(e,t,a){var n=1/0,s=1/0,o,d;if(null==t&&null!=e){e=N(e)?e:C.values(e);for(var r=0,c=e.length;r<c;r++)o=e[r],o<n&&(n=o)}else t=k(t,a),C.each(e,function(e,a,i){d=t(e,a,i),(d<s||d===1/0&&n===1/0)&&(n=e,s=d)});return n},C.shuffle=function(e){for(var t=N(e)?e:C.values(e),a=t.length,i=Array(a),n=0,s;n<a;n++)s=C.random(0,n),s!==n&&(i[n]=i[s]),i[s]=t[n];return i},C.sample=function(e,t,a){return null==t||a?(N(e)||(e=C.values(e)),e[C.random(e.length-1)]):C.shuffle(e).slice(0,o(0,t))},C.sortBy=function(e,t,a){return t=k(t,a),C.pluck(C.map(e,function(e,a,i){return{value:e,index:a,criteria:t(e,a,i)}}).sort(function(e,t){var i=e.criteria,a=t.criteria;if(i!==a){if(i>a||void 0===i)return 1;if(i<a||void 0===a)return-1}return e.index-t.index}),"value")};var R=function(e){return function(t,a,i){var n={};return a=k(a,i),C.each(t,function(i,s){var o=a(i,s,t);e(n,i,o)}),n}};C.groupBy=R(function(e,t,a){C.has(e,a)?e[a].push(t):e[a]=[t]}),C.indexBy=R(function(e,t,a){e[a]=t}),C.countBy=R(function(e,t,a){C.has(e,a)?e[a]++:e[a]=1}),C.toArray=function(e){return e?C.isArray(e)?m.call(e):N(e)?C.map(e,C.identity):C.values(e):[]},C.size=function(e){return null==e?0:N(e)?e.length:C.keys(e).length},C.partition=function(e,t,a){t=k(t,a);var i=[],n=[];return C.each(e,function(e,a,s){(t(e,a,s)?i:n).push(e)}),[i,n]},C.first=C.head=C.take=function(e,t,a){return null==e?void 0:null==t||a?e[0]:C.initial(e,e.length-t)},C.initial=function(e,t,a){return m.call(e,0,o(0,e.length-(null==t||a?1:t)))},C.last=function(e,t,a){return null==e?void 0:null==t||a?e[e.length-1]:C.rest(e,o(0,e.length-t))},C.rest=C.tail=C.drop=function(e,t,a){return m.call(e,null==t||a?1:t)},C.compact=function(e){return C.filter(e,C.identity)};var O=function(e,t,a,n){for(var s=[],o=0,d=n||0,r=I(e),c;d<r;d++)if(c=e[d],N(c)&&(C.isArray(c)||C.isArguments(c))){t||(c=O(c,t,a));var l=0,p=c.length;for(s.length+=p;l<p;)s[o++]=c[l++]}else a||(s[o++]=c);return s};C.flatten=function(e,t){return O(e,t,!1)},C.without=function(e){return C.difference(e,m.call(arguments,1))},C.uniq=C.unique=function(e,t,a,n){C.isBoolean(t)||(n=a,a=t,t=!1),null!=a&&(a=k(a,n));for(var s=[],o=[],d=0,r=I(e);d<r;d++){var c=e[d],l=a?a(c,d,e):c;t?((!d||o!==l)&&s.push(c),o=l):a?!C.contains(o,l)&&(o.push(l),s.push(c)):!C.contains(s,c)&&s.push(c)}return s},C.union=function(){return C.uniq(O(arguments,!0,!0))},C.intersection=function(e){for(var t=[],a=arguments.length,n=0,s=I(e),o;n<s;n++)if(o=e[n],!C.contains(t,o)){for(var d=1;d<a&&!!C.contains(arguments[d],o);d++);d===a&&t.push(o)}return t},C.difference=function(e){var t=O(arguments,!0,!0,1);return C.filter(e,function(e){return!C.contains(t,e)})},C.zip=function(){return C.unzip(arguments)},C.unzip=function(e){for(var t=e&&C.max(e,I).length||0,a=Array(t),i=0;i<t;i++)a[i]=C.pluck(e,i);return a},C.object=function(e,t){for(var a={},n=0,s=I(e);n<s;n++)t?a[e[n]]=t[n]:a[e[n][0]]=e[n][1];return a},C.findIndex=t(1),C.findLastIndex=t(-1),C.sortedIndex=function(e,t,a,i){a=k(a,i,1);for(var s=a(t),o=0,d=I(e);o<d;){var r=n((o+d)/2);a(e[r])<s?o=r+1:d=r}return o},C.indexOf=a(1,C.findIndex,C.sortedIndex),C.lastIndexOf=a(-1,C.findLastIndex),C.range=function(e,t,a){null==t&&(t=e||0,e=0),a=a||1;for(var i=o(Math.ceil((t-e)/a),0),n=Array(i),s=0;s<i;s++,e+=a)n[s]=e;return n};var P=function(e,t,a,i,n){if(!(i instanceof t))return e.apply(a,n);var s=T(e.prototype),o=e.apply(s,n);return C.isObject(o)?o:s};C.bind=function(e,t){if(b&&e.bind===b)return b.apply(e,m.call(arguments,1));if(!C.isFunction(e))throw new TypeError("Bind must be called on a function");var a=m.call(arguments,2),i=function(){return P(e,i,t,this,a.concat(m.call(arguments)))};return i},C.partial=function(e){var t=m.call(arguments,1),a=function(){for(var n=0,s=t.length,o=Array(s),d=0;d<s;d++)o[d]=t[d]===C?arguments[n++]:t[d];for(;n<arguments.length;)o.push(arguments[n++]);return P(e,a,this,this,o)};return a},C.bindAll=function(e){var t=arguments.length,a,n;if(1>=t)throw new Error("bindAll must be passed function names");for(a=1;a<t;a++)n=arguments[a],e[n]=C.bind(e[n],e);return e},C.memoize=function(e,t){var a=function(i){var n=a.cache,s=""+(t?t.apply(this,arguments):i);return C.has(n,s)||(n[s]=e.apply(this,arguments)),n[s]};return a.cache={},a},C.delay=function(e,t){var a=m.call(arguments,2);return setTimeout(function(){return e.apply(null,a)},t)},C.defer=C.partial(C.delay,C,1),C.throttle=function(e,t,a){var i=null,n=0,s,o,d;a||(a={});var r=function(){n=!1===a.leading?0:C.now(),i=null,d=e.apply(s,o),i||(s=o=null)};return function(){var c=C.now();n||!1!==a.leading||(n=c);var l=t-(c-n);return s=this,o=arguments,0>=l||l>t?(i&&(clearTimeout(i),i=null),n=c,d=e.apply(s,o),!i&&(s=o=null)):!i&&!1!==a.trailing&&(i=setTimeout(r,l)),d}},C.debounce=function(e,t,a){var i=function(){var c=C.now()-d;c<t&&0<=c?n=setTimeout(i,t-c):(n=null,!a&&(r=e.apply(o,s),!n&&(o=s=null)))},n,s,o,d,r;return function(){o=this,s=arguments,d=C.now();var c=a&&!n;return n||(n=setTimeout(i,t)),c&&(r=e.apply(o,s),o=s=null),r}},C.wrap=function(e,t){return C.partial(t,e)},C.negate=function(e){return function(){return!e.apply(this,arguments)}},C.compose=function(){var e=arguments,t=e.length-1;return function(){for(var a=t,n=e[t].apply(this,arguments);a--;)n=e[a].call(this,n);return n}},C.after=function(e,t){return function(){if(1>--e)return t.apply(this,arguments)}},C.before=function(e,t){var a;return function(){return 0<--e&&(a=t.apply(this,arguments)),1>=e&&(t=null),a}},C.once=C.partial(C.before,2);var j=!{toString:null}.propertyIsEnumerable("toString"),D=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];C.keys=function(e){if(!C.isObject(e))return[];if(f)return f(e);var t=[];for(var a in e)C.has(e,a)&&t.push(a);return j&&i(e,t),t},C.allKeys=function(e){if(!C.isObject(e))return[];var t=[];for(var a in e)t.push(a);return j&&i(e,t),t},C.values=function(e){for(var t=C.keys(e),a=t.length,n=Array(a),s=0;s<a;s++)n[s]=e[t[s]];return n},C.mapObject=function(e,t,a){t=k(t,a);for(var i=C.keys(e),n=i.length,s={},o=0,d;o<n;o++)d=i[o],s[d]=t(e[d],d,e);return s},C.pairs=function(e){for(var t=C.keys(e),a=t.length,n=Array(a),s=0;s<a;s++)n[s]=[t[s],e[t[s]]];return n},C.invert=function(e){for(var t={},a=C.keys(e),n=0,s=a.length;n<s;n++)t[e[a[n]]]=a[n];return t},C.functions=C.methods=function(e){var t=[];for(var a in e)C.isFunction(e[a])&&t.push(a);return t.sort()},C.extend=A(C.allKeys),C.extendOwn=C.assign=A(C.keys),C.findKey=function(e,t,a){t=k(t,a);for(var n=C.keys(e),s=0,o=n.length,d;s<o;s++)if(d=n[s],t(e[d],d,e))return d},C.pick=function(e,t,a){var n={},s=e,o,d;if(null==s)return n;C.isFunction(t)?(d=C.allKeys(s),o=S(t,a)):(d=O(arguments,!1,!1,1),o=function(e,t,a){return t in a},s=Object(s));for(var r=0,c=d.length;r<c;r++){var l=d[r],p=s[l];o(p,l,s)&&(n[l]=p)}return n},C.omit=function(e,t,a){if(C.isFunction(t))t=C.negate(t);else{var i=C.map(O(arguments,!1,!1,1),String);t=function(e,t){return!C.contains(i,t)}}return C.pick(e,t,a)},C.defaults=A(C.allKeys,!0),C.create=function(e,t){var a=T(e);return t&&C.extendOwn(a,t),a},C.clone=function(e){return C.isObject(e)?C.isArray(e)?e.slice():C.extend({},e):e},C.tap=function(e,t){return t(e),e},C.isMatch=function(e,t){var a=C.keys(t),n=a.length;if(null==e)return!n;for(var s=Object(e),o=0,d;o<n;o++)if(d=a[o],t[d]!==s[d]||!(d in s))return!1;return!0};var L=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof C&&(e=e._wrapped),t instanceof C&&(t=t._wrapped);var s=g.call(e);if(s!==g.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e==+e?0==+e?1/+e==1/t:+e==+t:+t!=+t;case"[object Date]":case"[object Boolean]":return+e==+t;}var o="[object Array]"===s;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var d=e.constructor,r=t.constructor;if(d!==r&&!(C.isFunction(d)&&d instanceof d&&C.isFunction(r)&&r instanceof r)&&"constructor"in e&&"constructor"in t)return!1}i=i||[],n=n||[];for(var c=i.length;c--;)if(i[c]===e)return n[c]===t;if(i.push(e),n.push(t),o){if(c=e.length,c!==t.length)return!1;for(;c--;)if(!L(e[c],t[c],i,n))return!1}else{var l=C.keys(e),p;if(c=l.length,C.keys(t).length!==c)return!1;for(;c--;)if(p=l[c],!(C.has(t,p)&&L(e[p],t[p],i,n)))return!1}return i.pop(),n.pop(),!0};C.isEqual=function(e,t){return L(e,t)},C.isEmpty=function(e){return!(null!=e)||(N(e)&&(C.isArray(e)||C.isString(e)||C.isArguments(e))?0===e.length:0===C.keys(e).length)},C.isElement=function(e){return!!(e&&1===e.nodeType)},C.isArray=v||function(e){return"[object Array]"===g.call(e)},C.isObject=function(e){var t=typeof e;return"function"==t||"object"===t&&!!e},C.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){C["is"+e]=function(t){return g.call(t)==="[object "+e+"]"}}),C.isArguments(arguments)||(C.isArguments=function(e){return C.has(e,"callee")}),"function"!=typeof /./&&"object"!=typeof Int8Array&&(C.isFunction=function(e){return"function"==typeof e||!1}),C.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},C.isNaN=function(e){return C.isNumber(e)&&e!==+e},C.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===g.call(e)},C.isNull=function(e){return null===e},C.isUndefined=function(e){return void 0===e},C.has=function(e,t){return null!=e&&h.call(e,t)},C.noConflict=function(){return d._=r,this},C.identity=function(e){return e},C.constant=function(e){return function(){return e}},C.noop=function(){},C.property=E,C.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},C.matcher=C.matches=function(e){return e=C.extendOwn({},e),function(t){return C.isMatch(t,e)}},C.times=function(e,t,a){var n=Array(o(0,e));t=S(t,a,1);for(var s=0;s<e;s++)n[s]=t(s);return n},C.random=function(e,t){return null==t&&(t=e,e=0),e+n(Math.random()*(t-e+1))},C.now=Date.now||function(){return new Date().getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},B=C.invert(H),V=function(e){var t=function(t){return e[t]},a="(?:"+C.keys(e).join("|")+")",i=RegExp(a),n=RegExp(a,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(n,t):e}};C.escape=V(H),C.unescape=V(B),C.result=function(e,t,a){var i=null==e?void 0:e[t];return void 0===i&&(i=a),C.isFunction(i)?i.call(e):i};var q=0;C.uniqueId=function(e){var t=++q+"";return e?e+t:t},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},z=/\\|'|\r|\n|\u2028|\u2029/g,G=function(e){return"\\"+F[e]};C.template=function(e,t,a){!t&&a&&(t=a),t=C.defaults({},t,C.templateSettings);var i=RegExp([(t.escape||U).source,(t.interpolate||U).source,(t.evaluate||U).source].join("|")+"|$","g"),n=0,s="__p+='";e.replace(i,function(t,a,i,o,d){return s+=e.slice(n,d).replace(z,G),n=d+t.length,a?s+="'+\n((__t=("+a+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(t){throw t.source=s,t}var d=function(e){return o.call(this,e,C)},r=t.variable||"obj";return d.source="function("+r+"){\n"+s+"}",d},C.chain=function(e){var t=C(e);return t._chain=!0,t};var W=function(e,t){return e._chain?C(t).chain():t};C.mixin=function(e){C.each(C.functions(e),function(t){var a=C[t]=e[t];C.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),W(this,a.apply(C,e))}})},C.mixin(C),C.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=c[e];C.prototype[e]=function(){var a=this._wrapped;return t.apply(a,arguments),("shift"===e||"splice"===e)&&0===a.length&&delete a[0],W(this,a)}}),C.each(["concat","join","slice"],function(e){var t=c[e];C.prototype[e]=function(){return W(this,t.apply(this._wrapped,arguments))}}),C.prototype.value=function(){return this._wrapped},C.prototype.valueOf=C.prototype.toJSON=C.prototype.value,C.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return C})}.call(this),function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"==typeof window?this:window,function(e,t){var le=Math.cos,pe=Math.PI,ue=Math.round,me=String.fromCharCode,ge=Math.ceil,he=Math.max;function a(e,t,a){a=a||fe;var n=a.createElement("script"),s,o;if(n.text=e,t)for(s in Ne)o=t[s]||t.getAttribute&&t.getAttribute(s),o&&n.setAttribute(s,o);a.head.appendChild(n).parentNode.removeChild(n)}function n(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Ce[Se.call(e)]||"object":typeof e}function s(e){var t=!!e&&"length"in e&&e.length,a=n(e);return!(Me(e)||Ie(e))&&("array"===a||0===t||"number"==typeof t&&0<t&&t-1 in e)}function o(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}function d(e,t,a){return Me(t)?Oe.grep(e,function(e,n){return!!t.call(e,n,e)!==a}):t.nodeType?Oe.grep(e,function(e){return e===t!==a}):"string"==typeof t?Oe.filter(t,e,a):Oe.grep(e,function(e){return-1<we.call(t,e)!==a})}function r(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function c(e){var t={};return Oe.each(e.match(ze)||[],function(e,a){t[a]=!0}),t}function l(e){return e}function p(e){throw e}function u(e,t,a,i){var n;try{e&&Me(n=e.promise)?n.call(e).done(t).fail(a):e&&Me(n=e.then)?n.call(e,t,a):t.apply(void 0,[e].slice(i))}catch(e){a.apply(void 0,[e])}}function m(){fe.removeEventListener("DOMContentLoaded",m),e.removeEventListener("load",m),Oe.ready()}function g(e,t){return t.toUpperCase()}function h(e){return e.replace(Xe,"ms-").replace(Qe,g)}function v(){this.expando=Oe.expando+v.uid++}function f(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:et.test(e)?JSON.parse(e):e)}function b(e,t,a){var i;if(void 0===a&&1===e.nodeType)if(i="data-"+t.replace(tt,"-$&").toLowerCase(),a=e.getAttribute(i),"string"==typeof a){try{a=f(a)}catch(t){}Ze.set(e,t,a)}else a=void 0;return a}function x(e,t,a,i){var n=20,s=i?function(){return i.cur()}:function(){return Oe.css(e,t,"")},o=s(),d=a&&a[3]||(Oe.cssNumber[t]?"":"px"),r=e.nodeType&&(Oe.cssNumber[t]||"px"!==d&&+o)&&it.exec(Oe.css(e,t)),c,l;if(r&&r[3]!==d){for(o/=2,d=d||r[3],r=+o||1;n--;)Oe.style(e,t,r+d),0>=(1-l)*(1-(l=s()/o||.5))&&(n=0),r/=l;r*=2,Oe.style(e,t,r+d),a=a||[]}return a&&(r=+r||+o||0,c=a[1]?r+(a[1]+1)*a[2]:+a[2],i&&(i.unit=d,i.start=r,i.end=c)),c}function w(e){var t=e.ownerDocument,a=e.nodeName,i=lt[a],n;return i?i:(n=t.body.appendChild(t.createElement(a)),i=Oe.css(n,"display"),n.parentNode.removeChild(n),"none"===i&&(i="block"),lt[a]=i,i)}function C(e,t){for(var a=[],i=0,n=e.length,s,o;i<n;i++)(o=e[i],!!o.style)&&(s=o.style.display,t?("none"===s&&(a[i]=Ke.get(o,"display")||null,!a[i]&&(o.style.display="")),""===o.style.display&&rt(o)&&(a[i]=w(o))):"none"!==s&&(a[i]="none",Ke.set(o,"display",s)));for(i=0;i<n;i++)null!=a[i]&&(e[i].style.display=a[i]);return e}function S(e,t){var a;return a="undefined"==typeof e.getElementsByTagName?"undefined"==typeof e.querySelectorAll?[]:e.querySelectorAll(t||"*"):e.getElementsByTagName(t||"*"),void 0===t||t&&o(e,t)?Oe.merge([e],a):a}function k(e,t){for(var a=0,n=e.length;a<n;a++)Ke.set(e[a],"globalEval",!t||Ke.get(t[a],"globalEval"))}function A(e,t,a,s,o){for(var d=t.createDocumentFragment(),r=[],c=0,p=e.length,l,u,m,g,h,v;c<p;c++)if(l=e[c],l||0===l)if("object"===n(l))Oe.merge(r,l.nodeType?[l]:l);else if(!ht.test(l))r.push(t.createTextNode(l));else{for(u=u||d.appendChild(t.createElement("div")),m=(ut.exec(l)||["",""])[1].toLowerCase(),g=gt[m]||gt._default,u.innerHTML=g[1]+Oe.htmlPrefilter(l)+g[2],v=g[0];v--;)u=u.lastChild;Oe.merge(r,u.childNodes),u=d.firstChild,u.textContent=""}for(d.textContent="",c=0;l=r[c++];){if(s&&-1<Oe.inArray(l,s)){o&&o.push(l);continue}if(h=ot(l),u=S(d.appendChild(l),"script"),h&&k(u),a)for(v=0;l=u[v++];)mt.test(l.type||"")&&a.push(l)}return d}function T(){return!0}function E(){return!1}function M(e,t){return e===I()==("focus"===t)}function I(){try{return fe.activeElement}catch(e){}}function N(e,t,a,i,n,s){var o,d;if("object"==typeof t){for(d in"string"!=typeof a&&(i=i||a,a=void 0),t)N(e,d,a,i,t[d],s);return e}if(null==i&&null==n?(n=a,i=a=void 0):null==n&&("string"==typeof a?(n=i,i=void 0):(n=i,i=a,a=void 0)),!1===n)n=E;else if(!n)return e;return 1===s&&(o=n,n=function(e){return Oe().off(e),o.apply(this,arguments)},n.guid=o.guid||(o.guid=Oe.guid++)),e.each(function(){Oe.event.add(this,t,n,i,a)})}function i(e,t,a){return a?void(Ke.set(e,t,!1),Oe.event.add(e,t,{namespace:!1,handler:function(e){var i=Ke.get(this,t),n,s;if(!(1&e.isTrigger&&this[t]))i.length&&(Ke.set(this,t,{value:Oe.event.trigger(Oe.extend(i[0],Oe.Event.prototype),i.slice(1),this)}),e.stopImmediatePropagation());else if(!!i.length)(Oe.event.special[t]||{}).delegateType&&e.stopPropagation();else if(i=be.call(arguments),Ke.set(this,t,i),n=a(this,t),this[t](),s=Ke.get(this,t),i!==s||n?Ke.set(this,t,!1):s={},i!==s)return e.stopImmediatePropagation(),e.preventDefault(),s.value}})):void(void 0===Ke.get(e,t)&&Oe.event.add(e,t,T))}function R(e,t){return o(e,"table")&&o(11===t.nodeType?t.firstChild:t,"tr")?Oe(e).children("tbody")[0]||e:e}function O(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function P(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function j(e,t){var a,n,s,o,d,r,c,p;if(1===t.nodeType){if(Ke.hasData(e)&&(o=Ke.access(e),d=Ke.set(t,o),p=o.events,p))for(s in delete d.handle,d.events={},p)for(a=0,n=p[s].length;a<n;a++)Oe.event.add(t,s,p[s][a]);Ze.hasData(e)&&(r=Ze.access(e),c=Oe.extend({},r),Ze.set(t,c))}}function D(e,t){var a=t.nodeName.toLowerCase();"input"===a&&pt.test(e.type)?t.checked=e.checked:("input"===a||"textarea"===a)&&(t.defaultValue=e.defaultValue)}function L(e,t,n,s){t=ye.apply([],t);var o=0,d=e.length,r=t[0],c=Me(r),l,p,u,m,g,h;if(c||1<d&&"string"==typeof r&&!Ee.checkClone&&xt.test(r))return e.each(function(a){var i=e.eq(a);c&&(t[0]=r.call(this,a,i.html())),L(i,t,n,s)});if(d&&(l=A(t,e[0].ownerDocument,!1,e,s),p=l.firstChild,1===l.childNodes.length&&(l=p),p||s)){for(u=Oe.map(S(l,"script"),O),m=u.length;o<d;o++)g=l,o!==d-1&&(g=Oe.clone(g,!0,!0),m&&Oe.merge(u,S(g,"script"))),n.call(e[o],g,o);if(m)for(h=u[u.length-1].ownerDocument,Oe.map(u,P),o=0;o<m;o++)g=u[o],mt.test(g.type||"")&&!Ke.access(g,"globalEval")&&Oe.contains(h,g)&&(g.src&&"module"!==(g.type||"").toLowerCase()?Oe._evalUrl&&!g.noModule&&Oe._evalUrl(g.src,{nonce:g.nonce||g.getAttribute("nonce")}):a(g.textContent.replace(wt,""),g,h))}return e}function H(e,t,a){for(var n=t?Oe.filter(t,e):e,s=0,o;null!=(o=n[s]);s++)a||1!==o.nodeType||Oe.cleanData(S(o)),o.parentNode&&(a&&ot(o)&&k(S(o,"script")),o.parentNode.removeChild(o));return e}function B(e,t,a){var i=e.style,n,s,o,d;return a=a||St(e),a&&(d=a.getPropertyValue(t)||a[t],""===d&&!ot(e)&&(d=Oe.style(e,t)),!Ee.pixelBoxStyles()&&Ct.test(d)&&kt.test(t)&&(n=i.width,s=i.minWidth,o=i.maxWidth,i.minWidth=i.maxWidth=i.width=d,d=a.width,i.width=n,i.minWidth=s,i.maxWidth=o)),void 0===d?d:d+""}function V(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function q(e){for(var t=e[0].toUpperCase()+e.slice(1),a=At.length;a--;)if(e=At[a]+t,e in Tt)return e}function U(e){var t=Oe.cssProps[e]||Et[e];return t?t:e in Tt?e:Et[e]=q(e)||e}function F(e,t,a){var i=it.exec(t);return i?he(0,i[2]-(a||0))+(i[3]||"px"):t}function z(e,t,a,n,s,o){var d="width"===t?1:0,r=0,c=0;if(a===(n?"border":"content"))return 0;for(;4>d;d+=2)"margin"===a&&(c+=Oe.css(e,a+nt[d],!0,s)),n?("content"===a&&(c-=Oe.css(e,"padding"+nt[d],!0,s)),"margin"!==a&&(c-=Oe.css(e,"border"+nt[d]+"Width",!0,s))):(c+=Oe.css(e,"padding"+nt[d],!0,s),"padding"===a?r+=Oe.css(e,"border"+nt[d]+"Width",!0,s):c+=Oe.css(e,"border"+nt[d]+"Width",!0,s));return!n&&0<=o&&(c+=he(0,ge(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-c-r-.5))||0),c}function G(e,t,a){var i=St(e),n=!Ee.boxSizingReliable()||a,s=n&&"border-box"===Oe.css(e,"boxSizing",!1,i),o=s,d=B(e,t,i),r="offset"+t[0].toUpperCase()+t.slice(1);if(Ct.test(d)){if(!a)return d;d="auto"}return(!Ee.boxSizingReliable()&&s||"auto"===d||!parseFloat(d)&&"inline"===Oe.css(e,"display",!1,i))&&e.getClientRects().length&&(s="border-box"===Oe.css(e,"boxSizing",!1,i),o=r in e,o&&(d=e[r])),d=parseFloat(d)||0,d+z(e,t,a||(s?"border":"content"),o,i,d)+"px"}function W(e,t,a,i,n){return new W.prototype.init(e,t,a,i,n)}function Y(){jt&&(!1===fe.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(Y):e.setTimeout(Y,Oe.fx.interval),Oe.fx.tick())}function X(){return e.setTimeout(function(){$t=void 0}),$t=Date.now()}function Q(e,t){var a=0,n={height:e},s;for(t=t?1:0;4>a;a+=2-t)s=nt[a],n["margin"+s]=n["padding"+s]=e;return t&&(n.opacity=n.width=e),n}function J(e,t,a){for(var i=(ee.tweeners[t]||[]).concat(ee.tweeners["*"]),n=0,s=i.length,o;n<s;n++)if(o=i[n].call(a,t,e))return o}function K(e,t,a){var i="width"in t||"height"in t,n=this,s={},o=e.style,d=e.nodeType&&rt(e),r=Ke.get(e,"fxshow"),c,l,p,u,m,g,h,v;for(c in a.queue||(u=Oe._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,m=u.empty.fire,u.empty.fire=function(){u.unqueued||m()}),u.unqueued++,n.always(function(){n.always(function(){u.unqueued--,Oe.queue(e,"fx").length||u.empty.fire()})})),t)if(l=t[c],Ot.test(l)){if(delete t[c],p=p||"toggle"===l,l===(d?"hide":"show"))if("show"===l&&r&&void 0!==r[c])d=!0;else continue;s[c]=r&&r[c]||Oe.style(e,c)}if(g=!Oe.isEmptyObject(t),g||!Oe.isEmptyObject(s))for(c in i&&1===e.nodeType&&(a.overflow=[o.overflow,o.overflowX,o.overflowY],h=r&&r.display,null==h&&(h=Ke.get(e,"display")),v=Oe.css(e,"display"),"none"===v&&(h?v=h:(C([e],!0),h=e.style.display||h,v=Oe.css(e,"display"),C([e]))),("inline"===v||"inline-block"===v&&null!=h)&&"none"===Oe.css(e,"float")&&(!g&&(n.done(function(){o.display=h}),null==h&&(v=o.display,h="none"===v?"":v)),o.display="inline-block")),a.overflow&&(o.overflow="hidden",n.always(function(){o.overflow=a.overflow[0],o.overflowX=a.overflow[1],o.overflowY=a.overflow[2]})),g=!1,s)g||(r?"hidden"in r&&(d=r.hidden):r=Ke.access(e,"fxshow",{display:h}),p&&(r.hidden=!d),d&&C([e],!0),n.done(function(){for(c in d||C([e]),Ke.remove(e,"fxshow"),s)Oe.style(e,c,s[c])})),g=J(d?r[c]:0,c,n),c in r||(r[c]=g.start,d&&(g.end=g.start,g.start=0))}function Z(e,t){var a,i,n,s,o;for(a in e)if(i=h(a),n=t[i],s=e[a],Array.isArray(s)&&(n=s[1],s=e[a]=s[0]),a!==i&&(e[i]=s,delete e[a]),o=Oe.cssHooks[i],o&&"expand"in o)for(a in s=o.expand(s),delete e[i],s)a in e||(e[a]=s[a],t[a]=n);else t[i]=n}function ee(e,t,a){var i=0,n=ee.prefilters.length,s=Oe.Deferred().always(function(){delete o.elem}),o=function(){if(l)return!1;for(var t=$t||X(),a=he(0,d.startTime+d.duration-t),i=a/d.duration||0,n=1-i,o=0,r=d.tweens.length;o<r;o++)d.tweens[o].run(n);return(s.notifyWith(e,[d,n,a]),1>n&&r)?a:(r||s.notifyWith(e,[d,1,0]),s.resolveWith(e,[d]),!1)},d=s.promise({elem:e,props:Oe.extend({},t),opts:Oe.extend(!0,{specialEasing:{},easing:Oe.easing._default},a),originalProperties:t,originalOptions:a,startTime:$t||X(),duration:a.duration,tweens:[],createTween:function(t,a){var i=Oe.Tween(e,d.opts,t,a,d.opts.specialEasing[t]||d.opts.easing);return d.tweens.push(i),i},stop:function(t){var a=0,i=t?d.tweens.length:0;if(l)return this;for(l=!0;a<i;a++)d.tweens[a].run(1);return t?(s.notifyWith(e,[d,1,0]),s.resolveWith(e,[d,t])):s.rejectWith(e,[d,t]),this}}),r=d.props,c,l;for(Z(r,d.opts.specialEasing);i<n;i++)if(c=ee.prefilters[i].call(d,e,r,d.opts),c)return Me(c.stop)&&(Oe._queueHooks(d.elem,d.opts.queue).stop=c.stop.bind(c)),c;return Oe.map(r,J,d),Me(d.opts.start)&&d.opts.start.call(e,d),d.progress(d.opts.progress).done(d.opts.done,d.opts.complete).fail(d.opts.fail).always(d.opts.always),Oe.fx.timer(Oe.extend(o,{elem:e,anim:d,queue:d.opts.queue})),d}function te(e){var t=e.match(ze)||[];return t.join(" ")}function ae(e){return e.getAttribute&&e.getAttribute("class")||""}function ie(e){return Array.isArray(e)?e:"string"==typeof e?e.match(ze)||[]:[]}function ne(e,t,a,s){if(Array.isArray(t))Oe.each(t,function(t,i){a||Wt.test(e)?s(e,i):ne(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,a,s)});else if(!a&&"object"===n(t))for(var o in t)ne(e+"["+o+"]",t[o],a,s);else s(e,t)}function se(e){return function(t,a){"string"!=typeof t&&(a=t,t="*");var n=0,s=t.toLowerCase().match(ze)||[],o;if(Me(a))for(;o=s[n++];)"+"===o[0]?(o=o.slice(1)||"*",(e[o]=e[o]||[]).unshift(a)):(e[o]=e[o]||[]).push(a)}}function oe(e,t,a,i){function n(d){var r;return s[d]=!0,Oe.each(e[d]||[],function(e,d){var c=d(t,a,i);return"string"!=typeof c||o||s[c]?o?!(r=c):void 0:(t.dataTypes.unshift(c),n(c),!1)}),r}var s={},o=e===sa;return n(t.dataTypes[0])||!s["*"]&&n("*")}function de(e,t){var a=Oe.ajaxSettings.flatOptions||{},i,n;for(i in t)void 0!==t[i]&&((a[i]?e:n||(n={}))[i]=t[i]);return n&&Oe.extend(!0,e,n),e}function re(e,t,a){for(var i=e.contents,n=e.dataTypes,s,o,d,r;"*"===n[0];)n.shift(),void 0===s&&(s=e.mimeType||t.getResponseHeader("Content-Type"));if(s)for(o in i)if(i[o]&&i[o].test(s)){n.unshift(o);break}if(n[0]in a)d=n[0];else{for(o in a){if(!n[0]||e.converters[o+" "+n[0]]){d=o;break}r||(r=o)}d=d||r}return d?(d!==n[0]&&n.unshift(d),a[d]):void 0}function ce(e,t,a,i){var n={},s=e.dataTypes.slice(),o,d,r,c,l;if(s[1])for(r in e.converters)n[r.toLowerCase()]=e.converters[r];for(d=s.shift();d;)if(e.responseFields[d]&&(a[e.responseFields[d]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=d,d=s.shift(),d)if("*"===d)d=l;else if("*"!==l&&l!==d){if(r=n[l+" "+d]||n["* "+d],!r)for(o in n)if(c=o.split(" "),c[1]===d&&(r=n[l+" "+c[0]]||n["* "+c[0]],r)){!0===r?r=n[o]:!0!==n[o]&&(d=c[0],s.unshift(c[1]));break}if(!0!==r)if(r&&e.throws)t=r(t);else try{t=r(t)}catch(t){return{state:"parsererror",error:r?t:"No conversion from "+l+" to "+d}}}return{state:"success",data:t}}var ve=[],fe=e.document,_e=Object.getPrototypeOf,be=ve.slice,ye=ve.concat,xe=ve.push,we=ve.indexOf,Ce={},Se=Ce.toString,ke=Ce.hasOwnProperty,Ae=ke.toString,Te=Ae.call(Object),Ee={},Me=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},Ie=function(e){return null!=e&&e===e.window},Ne={type:!0,src:!0,nonce:!0,noModule:!0},Re="3.4.1",Oe=function(e,t){return new Oe.fn.init(e,t)},Pe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;Oe.fn=Oe.prototype={jquery:Re,constructor:Oe,length:0,toArray:function(){return be.call(this)},get:function(e){return null==e?be.call(this):0>e?this[e+this.length]:this[e]},pushStack:function(e){var t=Oe.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return Oe.each(this,e)},map:function(e){return this.pushStack(Oe.map(this,function(t,a){return e.call(t,a,t)}))},slice:function(){return this.pushStack(be.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,a=+e+(0>e?t:0);return this.pushStack(0<=a&&a<t?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:xe,sort:ve.sort,splice:ve.splice},Oe.extend=Oe.fn.extend=function(){var e=arguments[0]||{},t=1,a=arguments.length,n=!1,s,o,d,r,c,l;for("boolean"==typeof e&&(n=e,e=arguments[t]||{},t++),"object"==typeof e||Me(e)||(e={}),t===a&&(e=this,t--);t<a;t++)if(null!=(s=arguments[t]))for(o in s)(r=s[o],"__proto__"!==o&&e!==r)&&(n&&r&&(Oe.isPlainObject(r)||(c=Array.isArray(r)))?(d=e[o],l=c&&!Array.isArray(d)?[]:c||Oe.isPlainObject(d)?d:{},c=!1,e[o]=Oe.extend(n,l,r)):void 0!==r&&(e[o]=r));return e},Oe.extend({expando:"jQuery"+(Re+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,a;return!!(e&&"[object Object]"===Se.call(e))&&((t=_e(e),!!!t)||(a=ke.call(t,"constructor")&&t.constructor,"function"==typeof a&&Ae.call(a)===Te))},isEmptyObject:function(e){for(var t in e)return!1;return!0},globalEval:function(e,t){a(e,{nonce:t&&t.nonce})},each:function(e,t){var a=0,n;if(s(e))for(n=e.length;a<n&&!1!==t.call(e[a],a,e[a]);a++);else for(a in e)if(!1===t.call(e[a],a,e[a]))break;return e},trim:function(e){return null==e?"":(e+"").replace(Pe,"")},makeArray:function(e,t){var a=t||[];return null!=e&&(s(Object(e))?Oe.merge(a,"string"==typeof e?[e]:e):xe.call(a,e)),a},inArray:function(e,t,a){return null==t?-1:we.call(t,e,a)},merge:function(e,t){for(var a=+t.length,n=0,s=e.length;n<a;n++)e[s++]=t[n];return e.length=s,e},grep:function(e,t,a){for(var n=[],s=0,o=e.length,d;s<o;s++)d=!t(e[s],s),d!==!a&&n.push(e[s]);return n},map:function(e,t,a){var n=0,o=[],d,r;if(s(e))for(d=e.length;n<d;n++)r=t(e[n],n,a),null!=r&&o.push(r);else for(n in e)r=t(e[n],n,a),null!=r&&o.push(r);return ye.apply([],o)},guid:1,support:Ee}),"function"==typeof Symbol&&(Oe.fn[Symbol.iterator]=ve[Symbol.iterator]),Oe.each(["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error","Symbol"],function(e,t){Ce["[object "+t+"]"]=t.toLowerCase()});var $e=/*!
 * Sizzle CSS Selector Engine v2.3.4
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://js.foundation/
 *
 * Date: 2019-04-08
 */function(e){function t(e,t,a,n){var s=t&&t.ownerDocument,o=t?t.nodeType:9,d,r,c,l,p,h,v;if(a=a||[],"string"!=typeof e||!e||1!==o&&9!==o&&11!==o)return a;if(!n&&((t?t.ownerDocument||t:k)!==ye&&be(t),t=t||ye,we)){if(11!==o&&(p=Z.exec(e)))if(!(d=p[1])){if(p[2])return L.apply(a,t.getElementsByTagName(e)),a;if((d=p[3])&&re.getElementsByClassName&&t.getElementsByClassName)return L.apply(a,t.getElementsByClassName(d)),a}else if(9===o){if(!(c=t.getElementById(d)))return a;if(c.id===d)return a.push(c),a}else if(s&&(c=s.getElementById(d))&&Ae(t,c)&&c.id===d)return a.push(c),a;if(re.qsa&&!N[e+" "]&&(!Ce||!Ce.test(e))&&(1!==o||"object"!==t.nodeName.toLowerCase())){if(v=e,s=t,1===o&&z.test(e)){for((l=t.getAttribute("id"))?l=l.replace(ie,ne):t.setAttribute("id",l=S),h=ue(e),r=h.length;r--;)h[r]="#"+l+" "+g(h[r]);v=h.join(","),s=ee.test(e)&&u(t.parentNode)||t}try{return L.apply(a,s.querySelectorAll(v)),a}catch(t){N(e,!0)}finally{l===S&&t.removeAttribute("id")}}}return he(e.replace(q,"$1"),t,a,n)}function a(){function e(a,i){return t.push(a+" ")>ce.cacheLength&&delete e[t.shift()],e[a+" "]=i}var t=[];return e}function n(e){return e[S]=!0,e}function s(e){var t=ye.createElement("fieldset");try{return!!e(t)}catch(t){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var a=e.split("|"),n=a.length;n--;)ce.attrHandle[a[n]]=t}function d(e,t){var a=t&&e,i=a&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(i)return i;if(a)for(;a=a.nextSibling;)if(a===t)return-1;return e?1:-1}function r(e){return function(t){var a=t.nodeName.toLowerCase();return"input"===a&&t.type===e}}function c(e){return function(t){var a=t.nodeName.toLowerCase();return("input"===a||"button"===a)&&t.type===e}}function l(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:!!("label"in t)&&t.disabled===e}}function p(e){return n(function(t){return t=+t,n(function(a,n){for(var s=e([],a.length,t),o=s.length,d;o--;)a[d=s[o]]&&(a[d]=!(n[d]=a[d]))})})}function u(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function m(){}function g(e){for(var t=0,a=e.length,n="";t<a;t++)n+=e[t].value;return n}function h(e,t,a){var i=t.dir,n=t.next,s=n||i,o=a&&"parentNode"===s,d=T++;return t.first?function(t,a,n){for(;t=t[i];)if(1===t.nodeType||o)return e(t,a,n);return!1}:function(t,a,r){var c=[A,d],l,p,u;if(r){for(;t=t[i];)if((1===t.nodeType||o)&&e(t,a,r))return!0;}else for(;t=t[i];)if(1===t.nodeType||o)if(u=t[S]||(t[S]={}),p=u[t.uniqueID]||(u[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[i]||t;else{if((l=p[s])&&l[0]===A&&l[1]===d)return c[2]=l[2];if(p[s]=c,c[2]=e(t,a,r))return!0}return!1}}function v(e){return 1<e.length?function(t,a,n){for(var s=e.length;s--;)if(!e[s](t,a,n))return!1;return!0}:e[0]}function f(e,a,n){for(var s=0,o=a.length;s<o;s++)t(e,a[s],n);return n}function b(e,t,a,n,s){for(var o=[],d=0,r=e.length,c;d<r;d++)(c=e[d])&&(!a||a(c,n,s))&&(o.push(c),null!=t&&t.push(d));return o}function x(e,t,a,s,o,d){return s&&!s[S]&&(s=x(s)),o&&!o[S]&&(o=x(o,d)),n(function(n,d,r,c){var l=[],p=[],u=d.length,m=n||f(t||"*",r.nodeType?[r]:r,[]),g=e&&(n||!t)?b(m,l,e,r,c):m,h=a?o||(n?e:u||s)?[]:d:g,v,x,w;if(a&&a(g,h,r,c),s)for(v=b(h,p),s(v,[],r,c),x=v.length;x--;)(w=v[x])&&(h[p[x]]=!(g[p[x]]=w));if(!n)h=b(h===d?h.splice(u,h.length):h),o?o(null,d,h,c):L.apply(d,h);else if(o||e){if(o){for(v=[],x=h.length;x--;)(w=h[x])&&v.push(g[x]=w);o(null,h=[],v,c)}for(x=h.length;x--;)(w=h[x])&&-1<(v=o?B(n,w):l[x])&&(n[v]=!(d[v]=w))}})}function w(e){for(var t=e.length,a=ce.relative[e[0].type],n=a||ce.relative[" "],s=a?1:0,o=h(function(e){return e===c},n,!0),d=h(function(e){return-1<B(c,e)},n,!0),r=[function(e,t,i){var n=!a&&(i||t!==ve)||((c=t).nodeType?o(e,t,i):d(e,t,i));return c=null,n}],c,l,p;s<t;s++)if(l=ce.relative[e[s].type])r=[h(v(r),l)];else{if(l=ce.filter[e[s].type].apply(null,e[s].matches),l[S]){for(p=++s;p<t&&!ce.relative[e[p].type];p++);return x(1<s&&v(r),1<s&&g(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(q,"$1"),l,s<p&&w(e.slice(s,p)),p<t&&w(e=e.slice(p)),p<t&&g(e))}r.push(l)}return v(r)}function C(e,a){var s=0<a.length,o=0<e.length,d=function(n,d,r,c,l){var p=0,u="0",m=n&&[],g=[],h=ve,v=n||o&&ce.find.TAG("*",l),f=A+=null==h?1:Math.random()||.1,x=v.length,w,C,S;for(l&&(ve=d===ye||d||l);u!==x&&null!=(w=v[u]);u++){if(o&&w){for(C=0,d||w.ownerDocument===ye||(be(w),r=!we);S=e[C++];)if(S(w,d||ye,r)){c.push(w);break}l&&(A=f)}s&&((w=!S&&w)&&p--,n&&m.push(w))}if(p+=u,s&&u!==p){for(C=0;S=a[C++];)S(m,g,d,r);if(n){if(0<p)for(;u--;)m[u]||g[u]||(g[u]=j.call(c));g=b(g)}L.apply(c,g),l&&!n&&0<g.length&&1<p+a.length&&t.uniqueSort(c)}return l&&(A=f,ve=h),m};return s?n(d):d}var S="sizzle"+1*new Date,k=e.document,A=0,T=0,E=a(),M=a(),I=a(),N=a(),R=function(e,t){return e===t&&(_e=!0),0},O={}.hasOwnProperty,P=[],j=P.pop,D=P.push,L=P.push,H=P.slice,B=function(e,t){for(var a=0,n=e.length;a<n;a++)if(e[a]===t)return a;return-1},V=/[\x20\t\r\n\f]+/g,q=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,U=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,F=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,z=/[\x20\t\r\n\f]|>/,G=/:((?:\\.|[\w-]|[^\0-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\0-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\0-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,W=/^(?:\\.|[\w-]|[^\0-\xa0])+$/,Y={ID:/^#((?:\\.|[\w-]|[^\0-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\0-\xa0])+)/,TAG:/^((?:\\.|[\w-]|[^\0-\xa0])+|[*])/,ATTR:/^\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\0-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\0-\xa0])+))|)[\x20\t\r\n\f]*\]/,PSEUDO:/^:((?:\\.|[\w-]|[^\0-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\0-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\0-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,CHILD:/^:(only|first|last|nth|nth-last)-(child|of-type)(?:\([\x20\t\r\n\f]*(even|odd|(([+-]|)(\d*)n|)[\x20\t\r\n\f]*(?:([+-]|)[\x20\t\r\n\f]*(\d+)|))[\x20\t\r\n\f]*\)|)/i,bool:/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,needsContext:/^[\x20\t\r\n\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i},X=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=/\\([\da-f]{1,6}[\x20\t\r\n\f]?|([\x20\t\r\n\f])|.)/ig,ae=function(e,t,a){var i="0x"+t-65536;return i!=i||a?t:0>i?me(i+65536):me(55296|i>>10,56320|1023&i)},ie=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ne=function(e,t){return t?"\0"===e?"\uFFFD":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},se=function(){be()},oe=h(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"}),de,re,ce,le,pe,ue,ge,he,ve,fe,_e,be,ye,xe,we,Ce,Se,ke,Ae;try{L.apply(P=H.call(k.childNodes),k.childNodes),P[k.childNodes.length].nodeType}catch(t){L={apply:P.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){for(var a=e.length,n=0;e[a++]=t[n++];);e.length=a-1}}}for(de in re=t.support={},pe=t.isXML=function(e){var t=e.namespaceURI,a=(e.ownerDocument||e).documentElement;return!X.test(t||a&&a.nodeName||"HTML")},be=t.setDocument=function(e){var t=e?e.ownerDocument||e:k,a,i;return t!==ye&&9===t.nodeType&&t.documentElement?(ye=t,xe=ye.documentElement,we=!pe(ye),k!==ye&&(i=ye.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",se,!1):i.attachEvent&&i.attachEvent("onunload",se)),re.attributes=s(function(e){return e.className="i",!e.getAttribute("className")}),re.getElementsByTagName=s(function(e){return e.appendChild(ye.createComment("")),!e.getElementsByTagName("*").length}),re.getElementsByClassName=K.test(ye.getElementsByClassName),re.getById=s(function(e){return xe.appendChild(e).id=S,!ye.getElementsByName||!ye.getElementsByName(S).length}),re.getById?(ce.filter.ID=function(e){var t=e.replace(te,ae);return function(e){return e.getAttribute("id")===t}},ce.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&we){var a=t.getElementById(e);return a?[a]:[]}}):(ce.filter.ID=function(e){var t=e.replace(te,ae);return function(e){var a="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return a&&a.value===t}},ce.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&we){var a=t.getElementById(e),n,s,o;if(a){if(n=a.getAttributeNode("id"),n&&n.value===e)return[a];for(o=t.getElementsByName(e),s=0;a=o[s++];)if(n=a.getAttributeNode("id"),n&&n.value===e)return[a]}return[]}}),ce.find.TAG=re.getElementsByTagName?function(e,t){return"undefined"==typeof t.getElementsByTagName?re.qsa?t.querySelectorAll(e):void 0:t.getElementsByTagName(e)}:function(e,t){var a=[],n=0,s=t.getElementsByTagName(e),o;if("*"===e){for(;o=s[n++];)1===o.nodeType&&a.push(o);return a}return s},ce.find.CLASS=re.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&we)return t.getElementsByClassName(e)},Se=[],Ce=[],(re.qsa=K.test(ye.querySelectorAll))&&(s(function(e){xe.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&Ce.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll("[selected]").length||Ce.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)"),e.querySelectorAll("[id~="+S+"-]").length||Ce.push("~="),e.querySelectorAll(":checked").length||Ce.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||Ce.push(".#.+[+~]")}),s(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=ye.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&Ce.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&Ce.push(":enabled",":disabled"),xe.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&Ce.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),Ce.push(",.*:")})),(re.matchesSelector=K.test(ke=xe.matches||xe.webkitMatchesSelector||xe.mozMatchesSelector||xe.oMatchesSelector||xe.msMatchesSelector))&&s(function(e){re.disconnectedMatch=ke.call(e,"*"),ke.call(e,"[s!='']:x"),Se.push("!=",":((?:\\\\.|[\\w-]|[^\0-\\xa0])+)(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\0-\\xa0])+)(?:[\\x20\\t\\r\\n\\f]*([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|((?:\\\\.|[\\w-]|[^\0-\\xa0])+))|)[\\x20\\t\\r\\n\\f]*\\])*)|.*)\\)|)")}),Ce=Ce.length&&new RegExp(Ce.join("|")),Se=Se.length&&new RegExp(Se.join("|")),a=K.test(xe.compareDocumentPosition),Ae=a||K.test(xe.contains)?function(e,t){var a=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!!(i&&1===i.nodeType&&(a.contains?a.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},R=a?function(e,t){if(e===t)return _e=!0,0;var a=!e.compareDocumentPosition-!t.compareDocumentPosition;return a?a:(a=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&a||!re.sortDetached&&t.compareDocumentPosition(e)===a?e===ye||e.ownerDocument===k&&Ae(k,e)?-1:t===ye||t.ownerDocument===k&&Ae(k,t)?1:fe?B(fe,e)-B(fe,t):0:4&a?-1:1)}:function(e,t){if(e===t)return _e=!0,0;var a=0,n=e.parentNode,s=t.parentNode,o=[e],r=[t],c;if(!n||!s)return e===ye?-1:t===ye?1:n?-1:s?1:fe?B(fe,e)-B(fe,t):0;if(n===s)return d(e,t);for(c=e;c=c.parentNode;)o.unshift(c);for(c=t;c=c.parentNode;)r.unshift(c);for(;o[a]===r[a];)a++;return a?d(o[a],r[a]):o[a]===k?-1:r[a]===k?1:0},ye):ye},t.matches=function(e,a){return t(e,null,null,a)},t.matchesSelector=function(e,a){if((e.ownerDocument||e)!==ye&&be(e),re.matchesSelector&&we&&!N[a+" "]&&(!Se||!Se.test(a))&&(!Ce||!Ce.test(a)))try{var i=ke.call(e,a);if(i||re.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(t){N(a,!0)}return 0<t(a,ye,null,[e]).length},t.contains=function(e,t){return(e.ownerDocument||e)!==ye&&be(e),Ae(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==ye&&be(e);var a=ce.attrHandle[t.toLowerCase()],i=a&&O.call(ce.attrHandle,t.toLowerCase())?a(e,t,!we):void 0;return void 0===i?re.attributes||!we?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null:i},t.escape=function(e){return(e+"").replace(ie,ne)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t=[],a=0,n=0,s;if(_e=!re.detectDuplicates,fe=!re.sortStable&&e.slice(0),e.sort(R),_e){for(;s=e[n++];)s===e[n]&&(a=t.push(n));for(;a--;)e.splice(t[a],1)}return fe=null,e},le=t.getText=function(e){var t="",a=0,n=e.nodeType,s;if(!n)for(;s=e[a++];)t+=le(s);else if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)t+=le(e)}else if(3===n||4===n)return e.nodeValue;return t},ce=t.selectors={cacheLength:50,createPseudo:n,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ae),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ae),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(!e[3]&&t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t=!e[6]&&e[2],a;return Y.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":t&&G.test(t)&&(a=ue(t,!0))&&(a=t.indexOf(")",t.length-a)-t.length)&&(e[0]=e[0].slice(0,a),e[2]=t.slice(0,a)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ae).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"([\\x20\\t\\r\\n\\f]|$)"))&&E(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,a,i){return function(n){var s=t.attr(n,e);return null==s?"!="===a:!a||(s+="","="===a?s===i:"!="===a?s!==i:"^="===a?i&&0===s.indexOf(i):"*="===a?i&&-1<s.indexOf(i):"$="===a?i&&s.slice(-i.length)===i:"~="===a?-1<(" "+s.replace(V," ")+" ").indexOf(i):"|="==a&&(s===i||s.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,a,i,n){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),d="of-type"===t;return 1===i&&0===n?function(e){return!!e.parentNode}:function(t,a,r){var c=s===o?"previousSibling":"nextSibling",l=t.parentNode,p=d&&t.nodeName.toLowerCase(),u=!r&&!d,m=!1,g,h,v,f,b,x;if(l){if(s){for(;c;){for(f=t;f=f[c];)if(d?f.nodeName.toLowerCase()===p:1===f.nodeType)return!1;x=c="only"===e&&!x&&"nextSibling"}return!0}if(x=[o?l.firstChild:l.lastChild],o&&u){for(f=l,v=f[S]||(f[S]={}),h=v[f.uniqueID]||(v[f.uniqueID]={}),g=h[e]||[],b=g[0]===A&&g[1],m=b&&g[2],f=b&&l.childNodes[b];f=++b&&f&&f[c]||(m=b=0)||x.pop();)if(1===f.nodeType&&++m&&f===t){h[e]=[A,b,m];break}}else if(u&&(f=t,v=f[S]||(f[S]={}),h=v[f.uniqueID]||(v[f.uniqueID]={}),g=h[e]||[],b=g[0]===A&&g[1],m=b),!1===m)for(;(f=++b&&f&&f[c]||(m=b=0)||x.pop())&&!((d?f.nodeName.toLowerCase()===p:1===f.nodeType)&&++m&&(u&&(v=f[S]||(f[S]={}),h=v[f.uniqueID]||(v[f.uniqueID]={}),h[e]=[A,m]),f===t)););return m-=n,m===i||0==m%i&&0<=m/i}}},PSEUDO:function(e,a){var s=ce.pseudos[e]||ce.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e),i;return s[S]?s(a):1<s.length?(i=[e,e,"",a],ce.setFilters.hasOwnProperty(e.toLowerCase())?n(function(e,t){for(var n=s(e,a),o=n.length,d;o--;)d=B(e,n[o]),e[d]=!(t[d]=n[o])}):function(e){return s(e,0,i)}):s}},pseudos:{not:n(function(e){var t=[],a=[],s=ge(e.replace(q,"$1"));return s[S]?n(function(e,t,a,n){for(var o=s(e,null,n,[]),d=e.length,r;d--;)(r=o[d])&&(e[d]=!(t[d]=r))}):function(e,i,n){return t[0]=e,s(t,null,n,a),t[0]=null,!a.pop()}}),has:n(function(e){return function(a){return 0<t(e,a).length}}),contains:n(function(e){return e=e.replace(te,ae),function(t){return-1<(t.textContent||le(t)).indexOf(e)}}),lang:n(function(e){return W.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(te,ae).toLowerCase(),function(t){var a;do if(a=we?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return a=a.toLowerCase(),a===e||0===a.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var a=e.location&&e.location.hash;return a&&a.slice(1)===t.id},root:function(e){return e===xe},focus:function(e){return e===ye.activeElement&&(!ye.hasFocus||ye.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:l(!1),disabled:l(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(6>e.nodeType)return!1;return!0},parent:function(e){return!ce.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:p(function(){return[0]}),last:p(function(e,t){return[t-1]}),eq:p(function(e,t,a){return[0>a?a+t:a]}),even:p(function(e,t){for(var a=0;a<t;a+=2)e.push(a);return e}),odd:p(function(e,t){for(var a=1;a<t;a+=2)e.push(a);return e}),lt:p(function(e,t,a){for(var n=0>a?a+t:a>t?t:a;0<=--n;)e.push(n);return e}),gt:p(function(e,t,a){for(var n=0>a?a+t:a;++n<t;)e.push(n);return e})}},ce.pseudos.nth=ce.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})ce.pseudos[de]=r(de);for(de in{submit:!0,reset:!0})ce.pseudos[de]=c(de);return m.prototype=ce.filters=ce.pseudos,ce.setFilters=new m,ue=t.tokenize=function(e,a){var i=M[e+" "],n,s,o,d,r,c,l;if(i)return a?0:i.slice(0);for(r=e,c=[],l=ce.preFilter;r;){for(d in(!n||(s=U.exec(r)))&&(s&&(r=r.slice(s[0].length)||r),c.push(o=[])),n=!1,(s=F.exec(r))&&(n=s.shift(),o.push({value:n,type:s[0].replace(q," ")}),r=r.slice(n.length)),ce.filter)(s=Y[d].exec(r))&&(!l[d]||(s=l[d](s)))&&(n=s.shift(),o.push({value:n,type:d,matches:s}),r=r.slice(n.length));if(!n)break}return a?r.length:r?t.error(e):M(e,c).slice(0)},ge=t.compile=function(e,t){var a=[],n=[],s=I[e+" "],o;if(!s){for(t||(t=ue(e)),o=t.length;o--;)s=w(t[o]),s[S]?a.push(s):n.push(s);s=I(e,C(n,a)),s.selector=e}return s},he=t.select=function(e,t,a,n){var s="function"==typeof e&&e,o=!n&&ue(e=s.selector||e),d,r,c,l,p;if(a=a||[],1===o.length){if(r=o[0]=o[0].slice(0),2<r.length&&"ID"===(c=r[0]).type&&9===t.nodeType&&we&&ce.relative[r[1].type]){if(t=(ce.find.ID(c.matches[0].replace(te,ae),t)||[])[0],!t)return a;s&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(d=Y.needsContext.test(e)?0:r.length;d--&&(c=r[d],!ce.relative[l=c.type]);)if((p=ce.find[l])&&(n=p(c.matches[0].replace(te,ae),ee.test(r[0].type)&&u(t.parentNode)||t))){if(r.splice(d,1),e=n.length&&g(r),!e)return L.apply(a,n),a;break}}return(s||ge(e,o))(n,t,!we,a,!t||ee.test(e)&&u(t.parentNode)||t),a},re.sortStable=S.split("").sort(R).join("")===S,re.detectDuplicates=!!_e,be(),re.sortDetached=s(function(e){return 1&e.compareDocumentPosition(ye.createElement("fieldset"))}),s(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,a){if(!a)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),re.attributes&&s(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,a){if(!a&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),s(function(e){return null==e.getAttribute("disabled")})||o("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",function(e,t,a){var i;if(!a)return!0===e[t]?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);Oe.find=$e,Oe.expr=$e.selectors,Oe.expr[":"]=Oe.expr.pseudos,Oe.uniqueSort=Oe.unique=$e.uniqueSort,Oe.text=$e.getText,Oe.isXMLDoc=$e.isXML,Oe.contains=$e.contains,Oe.escapeSelector=$e.escape;var je=function(e,t,a){for(var i=[];(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(void 0!==a&&Oe(e).is(a))break;i.push(e)}return i},De=function(e,t){for(var a=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&a.push(e);return a},Le=Oe.expr.match.needsContext,He=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;Oe.filter=function(e,t,a){var i=t[0];return a&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?Oe.find.matchesSelector(i,e)?[i]:[]:Oe.find.matches(e,Oe.grep(t,function(e){return 1===e.nodeType}))},Oe.fn.extend({find:function(e){var t=this.length,a=this,n,s;if("string"!=typeof e)return this.pushStack(Oe(e).filter(function(){for(n=0;n<t;n++)if(Oe.contains(a[n],this))return!0}));for(s=this.pushStack([]),n=0;n<t;n++)Oe.find(e,a[n],s);return 1<t?Oe.uniqueSort(s):s},filter:function(e){return this.pushStack(d(this,e||[],!1))},not:function(e){return this.pushStack(d(this,e||[],!0))},is:function(e){return!!d(this,"string"==typeof e&&Le.test(e)?Oe(e):e||[],!1).length}});var Be=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Ve=Oe.fn.init=function(e,t,a){var i,n;if(!e)return this;if(a=a||qe,"string"==typeof e){if(i="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:Be.exec(e),i&&(i[1]||!t)){if(i[1]){if(t=t instanceof Oe?t[0]:t,Oe.merge(this,Oe.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:fe,!0)),He.test(i[1])&&Oe.isPlainObject(t))for(i in t)Me(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return n=fe.getElementById(i[2]),n&&(this[0]=n,this.length=1),this}return!t||t.jquery?(t||a).find(e):this.constructor(t).find(e)}return e.nodeType?(this[0]=e,this.length=1,this):Me(e)?void 0===a.ready?e(Oe):a.ready(e):Oe.makeArray(e,this)},qe;Ve.prototype=Oe.fn,qe=Oe(fe);var Ue=/^(?:parents|prev(?:Until|All))/,Fe={children:!0,contents:!0,next:!0,prev:!0};Oe.fn.extend({has:function(e){var t=Oe(e,this),a=t.length;return this.filter(function(){for(var e=0;e<a;e++)if(Oe.contains(this,t[e]))return!0})},closest:function(e,t){var a=0,n=this.length,s=[],o="string"!=typeof e&&Oe(e),d;if(!Le.test(e))for(;a<n;a++)for(d=this[a];d&&d!==t;d=d.parentNode)if(11>d.nodeType&&(o?-1<o.index(d):1===d.nodeType&&Oe.find.matchesSelector(d,e))){s.push(d);break}return this.pushStack(1<s.length?Oe.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?we.call(Oe(e),this[0]):we.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(Oe.uniqueSort(Oe.merge(this.get(),Oe(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),Oe.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return je(e,"parentNode")},parentsUntil:function(e,t,a){return je(e,"parentNode",a)},next:function(e){return r(e,"nextSibling")},prev:function(e){return r(e,"previousSibling")},nextAll:function(e){return je(e,"nextSibling")},prevAll:function(e){return je(e,"previousSibling")},nextUntil:function(e,t,a){return je(e,"nextSibling",a)},prevUntil:function(e,t,a){return je(e,"previousSibling",a)},siblings:function(e){return De((e.parentNode||{}).firstChild,e)},children:function(e){return De(e.firstChild)},contents:function(e){return"undefined"==typeof e.contentDocument?(o(e,"template")&&(e=e.content||e),Oe.merge([],e.childNodes)):e.contentDocument}},function(e,t){Oe.fn[e]=function(a,i){var n=Oe.map(this,t,a);return"Until"!==e.slice(-5)&&(i=a),i&&"string"==typeof i&&(n=Oe.filter(i,n)),1<this.length&&(!Fe[e]&&Oe.uniqueSort(n),Ue.test(e)&&n.reverse()),this.pushStack(n)}});var ze=/[^\x20\t\r\n\f]+/g;Oe.Callbacks=function(e){e="string"==typeof e?c(e):Oe.extend({},e);var t=[],a=[],i=-1,s=function(){for(p=p||e.once,l=d=!0;a.length;i=-1)for(r=a.shift();++i<t.length;)!1===t[i].apply(r[0],r[1])&&e.stopOnFalse&&(i=t.length,r=!1);e.memory||(r=!1),d=!1,p&&(r?t=[]:t="")},o={add:function(){return t&&(r&&!d&&(i=t.length-1,a.push(r)),function a(i){Oe.each(i,function(i,s){Me(s)?(!e.unique||!o.has(s))&&t.push(s):s&&s.length&&"string"!==n(s)&&a(s)})}(arguments),r&&!d&&s()),this},remove:function(){return Oe.each(arguments,function(e,a){for(var n;-1<(n=Oe.inArray(a,t,n));)t.splice(n,1),n<=i&&i--}),this},has:function(e){return e?-1<Oe.inArray(e,t):0<t.length},empty:function(){return t&&(t=[]),this},disable:function(){return p=a=[],t=r="",this},disabled:function(){return!t},lock:function(){return p=a=[],r||d||(t=r=""),this},locked:function(){return!!p},fireWith:function(e,t){return p||(t=t||[],t=[e,t.slice?t.slice():t],a.push(t),!d&&s()),this},fire:function(){return o.fireWith(this,arguments),this},fired:function(){return!!l}},d,r,l,p;return o},Oe.extend({Deferred:function(t){var a=[["notify","progress",Oe.Callbacks("memory"),Oe.Callbacks("memory"),2],["resolve","done",Oe.Callbacks("once memory"),Oe.Callbacks("once memory"),0,"resolved"],["reject","fail",Oe.Callbacks("once memory"),Oe.Callbacks("once memory"),1,"rejected"]],i="pending",n={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return n.then(null,e)},pipe:function(){var e=arguments;return Oe.Deferred(function(t){Oe.each(a,function(a,i){var n=Me(e[i[4]])&&e[i[4]];s[i[1]](function(){var e=n&&n.apply(this,arguments);e&&Me(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[i[0]+"With"](this,n?[e]:arguments)})}),e=null}).promise()},then:function(t,i,n){function s(t,a,i,n){return function(){var d=this,r=arguments,c=function(){var e,c;if(!(t<o)){if(e=i.apply(d,r),e===a.promise())throw new TypeError("Thenable self-resolution");c=e&&("object"==typeof e||"function"==typeof e)&&e.then,Me(c)?n?c.call(e,s(o,a,l,n),s(o,a,p,n)):(o++,c.call(e,s(o,a,l,n),s(o,a,p,n),s(o,a,l,a.notifyWith))):(i!==l&&(d=void 0,r=[e]),(n||a.resolveWith)(d,r))}},u=n?c:function(){try{c()}catch(n){Oe.Deferred.exceptionHook&&Oe.Deferred.exceptionHook(n,u.stackTrace),t+1>=o&&(i!==p&&(d=void 0,r=[n]),a.rejectWith(d,r))}};t?u():(Oe.Deferred.getStackHook&&(u.stackTrace=Oe.Deferred.getStackHook()),e.setTimeout(u))}}var o=0;return Oe.Deferred(function(e){a[0][3].add(s(0,e,Me(n)?n:l,e.notifyWith)),a[1][3].add(s(0,e,Me(t)?t:l)),a[2][3].add(s(0,e,Me(i)?i:p))}).promise()},promise:function(e){return null==e?n:Oe.extend(e,n)}},s={};return Oe.each(a,function(e,t){var o=t[2],d=t[5];n[t[1]]=o.add,d&&o.add(function(){i=d},a[3-e][2].disable,a[3-e][3].disable,a[0][2].lock,a[0][3].lock),o.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=o.fireWith}),n.promise(s),t&&t.call(s,s),s},when:function(e){var t=arguments.length,a=t,n=Array(a),s=be.call(arguments),o=Oe.Deferred(),d=function(e){return function(a){n[e]=this,s[e]=1<arguments.length?be.call(arguments):a,--t||o.resolveWith(n,s)}};if(1>=t&&(u(e,o.done(d(a)).resolve,o.reject,!t),"pending"===o.state()||Me(s[a]&&s[a].then)))return o.then();for(;a--;)u(s[a],d(a),o.reject);return o.promise()}});var Ge=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;Oe.Deferred.exceptionHook=function(t,a){e.console&&e.console.warn&&t&&Ge.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,a)},Oe.readyException=function(t){e.setTimeout(function(){throw t})};var We=Oe.Deferred();Oe.fn.ready=function(e){return We.then(e).catch(function(e){Oe.readyException(e)}),this},Oe.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?! --Oe.readyWait:!Oe.isReady)&&(Oe.isReady=!0,!0!==e&&0<--Oe.readyWait||We.resolveWith(fe,[Oe]))}}),Oe.ready.then=We.then,"complete"!==fe.readyState&&("loading"===fe.readyState||fe.documentElement.doScroll)?(fe.addEventListener("DOMContentLoaded",m),e.addEventListener("load",m)):e.setTimeout(Oe.ready);var Ye=function(e,t,a,s,o,d,r){var c=0,l=e.length,p=null==a;if("object"===n(a))for(c in o=!0,a)Ye(e,t,c,a[c],!0,d,r);else if(void 0!==s&&(o=!0,Me(s)||(r=!0),p&&(r?(t.call(e,s),t=null):(p=t,t=function(e,t,a){return p.call(Oe(e),a)})),t))for(;c<l;c++)t(e[c],a,r?s:s.call(e[c],c,t(e[c],a)));return o?e:p?t.call(e):l?t(e[0],a):d},Xe=/^-ms-/,Qe=/-([a-z])/g,Je=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};v.uid=1,v.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Je(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,a){var i=this.cache(e),n;if("string"==typeof t)i[h(t)]=a;else for(n in t)i[h(n)]=t[n];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][h(t)]},access:function(e,t,a){return void 0===t||t&&"string"==typeof t&&void 0===a?this.get(e,t):(this.set(e,t,a),void 0===a?t:a)},remove:function(e,t){var a=e[this.expando],n;if(void 0!==a){if(void 0!==t)for(Array.isArray(t)?t=t.map(h):(t=h(t),t=(t in a)?[t]:t.match(ze)||[]),n=t.length;n--;)delete a[t[n]];(void 0===t||Oe.isEmptyObject(a))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!Oe.isEmptyObject(t)}};var Ke=new v,Ze=new v,et=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,tt=/[A-Z]/g;Oe.extend({hasData:function(e){return Ze.hasData(e)||Ke.hasData(e)},data:function(e,t,a){return Ze.access(e,t,a)},removeData:function(e,t){Ze.remove(e,t)},_data:function(e,t,a){return Ke.access(e,t,a)},_removeData:function(e,t){Ke.remove(e,t)}}),Oe.fn.extend({data:function(e,t){var a=this[0],n=a&&a.attributes,s,o,d;if(void 0===e){if(this.length&&(d=Ze.get(a),1===a.nodeType&&!Ke.get(a,"hasDataAttrs"))){for(s=n.length;s--;)n[s]&&(o=n[s].name,0===o.indexOf("data-")&&(o=h(o.slice(5)),b(a,o,d[o])));Ke.set(a,"hasDataAttrs",!0)}return d}return"object"==typeof e?this.each(function(){Ze.set(this,e)}):Ye(this,function(t){var i;return a&&void 0===t?(i=Ze.get(a,e),void 0!==i)?i:(i=b(a,e),void 0===i?void 0:i):void this.each(function(){Ze.set(this,e,t)})},null,t,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Ze.remove(this,e)})}}),Oe.extend({queue:function(e,t,a){var i;if(e)return t=(t||"fx")+"queue",i=Ke.get(e,t),a&&(!i||Array.isArray(a)?i=Ke.access(e,t,Oe.makeArray(a)):i.push(a)),i||[]},dequeue:function(e,t){t=t||"fx";var a=Oe.queue(e,t),i=a.length,n=a.shift(),s=Oe._queueHooks(e,t),o=function(){Oe.dequeue(e,t)};"inprogress"===n&&(n=a.shift(),i--),n&&("fx"===t&&a.unshift("inprogress"),delete s.stop,n.call(e,o,s)),!i&&s&&s.empty.fire()},_queueHooks:function(e,t){var a=t+"queueHooks";return Ke.get(e,a)||Ke.access(e,a,{empty:Oe.Callbacks("once memory").add(function(){Ke.remove(e,[t+"queue",a])})})}}),Oe.fn.extend({queue:function(e,t){var a=2;return"string"!=typeof e&&(t=e,e="fx",a--),arguments.length<a?Oe.queue(this[0],e):void 0===t?this:this.each(function(){var a=Oe.queue(this,e,t);Oe._queueHooks(this,e),"fx"===e&&"inprogress"!==a[0]&&Oe.dequeue(this,e)})},dequeue:function(e){return this.each(function(){Oe.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var a=1,n=Oe.Deferred(),s=this,o=this.length,d=function(){--a||n.resolveWith(s,[s])},r;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)r=Ke.get(s[o],e+"queueHooks"),r&&r.empty&&(a++,r.empty.add(d));return d(),n.promise(t)}});var at=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,it=new RegExp("^(?:([+-])=|)("+at+")([a-z%]*)$","i"),nt=["Top","Right","Bottom","Left"],st=fe.documentElement,ot=function(e){return Oe.contains(e.ownerDocument,e)},dt={composed:!0};st.getRootNode&&(ot=function(e){return Oe.contains(e.ownerDocument,e)||e.getRootNode(dt)===e.ownerDocument});var rt=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&ot(e)&&"none"===Oe.css(e,"display")},ct=function(e,t,a,i){var n={},s,o;for(o in t)n[o]=e.style[o],e.style[o]=t[o];for(o in s=a.apply(e,i||[]),t)e.style[o]=n[o];return s},lt={};Oe.fn.extend({show:function(){return C(this,!0)},hide:function(){return C(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){rt(this)?Oe(this).show():Oe(this).hide()})}});var pt=/^(?:checkbox|radio)$/i,ut=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,mt=/^$|^module$|\/(?:java|ecma)script/i,gt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};gt.optgroup=gt.option,gt.tbody=gt.tfoot=gt.colgroup=gt.caption=gt.thead,gt.th=gt.td;var ht=/<|&#?\w+;/;(function(){var e=fe.createDocumentFragment(),t=e.appendChild(fe.createElement("div")),a=fe.createElement("input");a.setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),t.appendChild(a),Ee.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",Ee.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue})();var vt=/^key/,ft=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,_t=/^([^.]*)(?:\.(.+)|)/;Oe.event={global:{},add:function(a,i,n,s,o){var d=Ke.get(a),r,c,l,p,u,e,m,g,h,v,f;if(d)for(n.handler&&(r=n,n=r.handler,o=r.selector),o&&Oe.find.matchesSelector(st,o),n.guid||(n.guid=Oe.guid++),(p=d.events)||(p=d.events={}),(c=d.handle)||(c=d.handle=function(t){return"undefined"!=typeof Oe&&Oe.event.triggered!==t.type?Oe.event.dispatch.apply(a,arguments):void 0}),i=(i||"").match(ze)||[""],u=i.length;u--;)(l=_t.exec(i[u])||[],h=f=l[1],v=(l[2]||"").split(".").sort(),!!h)&&(m=Oe.event.special[h]||{},h=(o?m.delegateType:m.bindType)||h,m=Oe.event.special[h]||{},e=Oe.extend({type:h,origType:f,data:s,handler:n,guid:n.guid,selector:o,needsContext:o&&Oe.expr.match.needsContext.test(o),namespace:v.join(".")},r),(g=p[h])||(g=p[h]=[],g.delegateCount=0,(!m.setup||!1===m.setup.call(a,s,v,c))&&a.addEventListener&&a.addEventListener(h,c)),m.add&&(m.add.call(a,e),!e.handler.guid&&(e.handler.guid=n.guid)),o?g.splice(g.delegateCount++,0,e):g.push(e),Oe.event.global[h]=!0)},remove:function(e,a,i,n,s){var o=Ke.hasData(e)&&Ke.get(e),d,r,c,l,p,u,m,g,h,v,f;if(o&&(l=o.events)){for(a=(a||"").match(ze)||[""],p=a.length;p--;){if(c=_t.exec(a[p])||[],h=f=c[1],v=(c[2]||"").split(".").sort(),!h){for(h in l)Oe.event.remove(e,h+a[p],i,n,!0);continue}for(m=Oe.event.special[h]||{},h=(n?m.delegateType:m.bindType)||h,g=l[h]||[],c=c[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),r=d=g.length;d--;)u=g[d],(s||f===u.origType)&&(!i||i.guid===u.guid)&&(!c||c.test(u.namespace))&&(!n||n===u.selector||"**"===n&&u.selector)&&(g.splice(d,1),u.selector&&g.delegateCount--,m.remove&&m.remove.call(e,u));r&&!g.length&&((!m.teardown||!1===m.teardown.call(e,v,o.handle))&&Oe.removeEvent(e,h,o.handle),delete l[h])}Oe.isEmptyObject(l)&&Ke.remove(e,"handle events")}},dispatch:function(e){var t=Oe.event.fix(e),a=Array(arguments.length),n=(Ke.get(this,"events")||{})[t.type]||[],s=Oe.event.special[t.type]||{},o,d,r,c,l,p;for(a[0]=t,o=1;o<arguments.length;o++)a[o]=arguments[o];if(t.delegateTarget=this,!(s.preDispatch&&!1===s.preDispatch.call(this,t))){for(p=Oe.event.handlers.call(this,t,n),o=0;(c=p[o++])&&!t.isPropagationStopped();)for(t.currentTarget=c.elem,d=0;(l=c.handlers[d++])&&!t.isImmediatePropagationStopped();)(!t.rnamespace||!1===l.namespace||t.rnamespace.test(l.namespace))&&(t.handleObj=l,t.data=l.data,r=((Oe.event.special[l.origType]||{}).handle||l.handler).apply(c.elem,a),void 0!==r&&!1===(t.result=r)&&(t.preventDefault(),t.stopPropagation()));return s.postDispatch&&s.postDispatch.call(this,t),t.result}},handlers:function(e,t){var a=[],n=t.delegateCount,s=e.target,o,d,r,c,l;if(n&&s.nodeType&&!("click"===e.type&&1<=e.button))for(;s!==this;s=s.parentNode||this)if(1===s.nodeType&&("click"!==e.type||!0!==s.disabled)){for(c=[],l={},o=0;o<n;o++)d=t[o],r=d.selector+" ",void 0===l[r]&&(l[r]=d.needsContext?-1<Oe(r,this).index(s):Oe.find(r,this,null,[s]).length),l[r]&&c.push(d);c.length&&a.push({elem:s,handlers:c})}return s=this,n<t.length&&a.push({elem:s,handlers:t.slice(n)}),a},addProp:function(e,t){Object.defineProperty(Oe.Event.prototype,e,{enumerable:!0,configurable:!0,get:Me(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[Oe.expando]?e:new Oe.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pt.test(t.type)&&t.click&&o(t,"input")&&i(t,"click",T),!1},trigger:function(e){var t=this||e;return pt.test(t.type)&&t.click&&o(t,"input")&&i(t,"click"),!0},_default:function(e){var t=e.target;return pt.test(t.type)&&t.click&&o(t,"input")&&Ke.get(t,"click")||o(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},Oe.removeEvent=function(e,t,a){e.removeEventListener&&e.removeEventListener(t,a)},Oe.Event=function(e,t){return this instanceof Oe.Event?void(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?T:E,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&Oe.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[Oe.expando]=!0):new Oe.Event(e,t)},Oe.Event.prototype={constructor:Oe.Event,isDefaultPrevented:E,isPropagationStopped:E,isImmediatePropagationStopped:E,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=T,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=T,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=T,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},Oe.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&vt.test(e.type)?null==e.charCode?e.keyCode:e.charCode:!e.which&&void 0!==t&&ft.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},Oe.event.addProp),Oe.each({focus:"focusin",blur:"focusout"},function(e,t){Oe.event.special[e]={setup:function(){return i(this,e,M),!1},trigger:function(){return i(this,e),!0},delegateType:t}}),Oe.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){Oe.event.special[e]={delegateType:t,bindType:t,handle:function(e){var a=this,i=e.relatedTarget,n=e.handleObj,s;return i&&(i===a||Oe.contains(a,i))||(e.type=n.origType,s=n.handler.apply(this,arguments),e.type=t),s}}}),Oe.fn.extend({on:function(e,t,a,i){return N(this,e,t,a,i)},one:function(e,t,a,i){return N(this,e,t,a,i,1)},off:function(e,t,a){var i,n;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,Oe(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return(!1===t||"function"==typeof t)&&(a=t,t=void 0),!1===a&&(a=E),this.each(function(){Oe.event.remove(this,e,a,t)})}});var bt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,yt=/<script|<style|<link/i,xt=/checked\s*(?:[^=]|=\s*.checked.)/i,wt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;Oe.extend({htmlPrefilter:function(e){return e.replace(bt,"<$1></$2>")},clone:function(e,t,a){var n=e.cloneNode(!0),s=ot(e),o,d,r,c;if(!Ee.noCloneChecked&&(1===e.nodeType||11===e.nodeType)&&!Oe.isXMLDoc(e))for(c=S(n),r=S(e),(o=0,d=r.length);o<d;o++)D(r[o],c[o]);if(t)if(a)for(r=r||S(e),c=c||S(n),(o=0,d=r.length);o<d;o++)j(r[o],c[o]);else j(e,n);return c=S(n,"script"),0<c.length&&k(c,!s&&S(e,"script")),n},cleanData:function(e){for(var t=Oe.event.special,a=0,n,s,o;void 0!==(s=e[a]);a++)if(Je(s)){if(n=s[Ke.expando]){if(n.events)for(o in n.events)t[o]?Oe.event.remove(s,o):Oe.removeEvent(s,o,n.handle);s[Ke.expando]=void 0}s[Ze.expando]&&(s[Ze.expando]=void 0)}}}),Oe.fn.extend({detach:function(e){return H(this,e,!0)},remove:function(e){return H(this,e)},text:function(e){return Ye(this,function(e){return void 0===e?Oe.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return L(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=R(this,e);t.appendChild(e)}})},prepend:function(){return L(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=R(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return L(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return L(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e=0,t;null!=(t=this[e]);e++)1===t.nodeType&&(Oe.cleanData(S(t,!1)),t.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return Oe.clone(this,e,t)})},html:function(e){return Ye(this,function(e){var t=this[0]||{},a=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!yt.test(e)&&!gt[(ut.exec(e)||["",""])[1].toLowerCase()]){e=Oe.htmlPrefilter(e);try{for(;a<n;a++)t=this[a]||{},1===t.nodeType&&(Oe.cleanData(S(t,!1)),t.innerHTML=e);t=0}catch(t){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return L(this,arguments,function(t){var a=this.parentNode;0>Oe.inArray(this,e)&&(Oe.cleanData(S(this)),a&&a.replaceChild(t,this))},e)}}),Oe.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){Oe.fn[e]=function(e){for(var a=[],n=Oe(e),s=n.length-1,o=0,d;o<=s;o++)d=o===s?this:this.clone(!0),Oe(n[o])[t](d),xe.apply(a,d.get());return this.pushStack(a)}});var Ct=new RegExp("^("+at+")(?!px)[a-z%]+$","i"),St=function(t){var a=t.ownerDocument.defaultView;return a&&a.opener||(a=e),a.getComputedStyle(t)},kt=new RegExp(nt.join("|"),"i");(function(){function t(){if(n){i.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",n.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",st.appendChild(i).appendChild(n);var t=e.getComputedStyle(n);s="1%"!==t.top,c=12===a(t.marginLeft),n.style.right="60%",r=36===a(t.right),o=36===a(t.width),n.style.position="absolute",d=12===a(n.offsetWidth/3),st.removeChild(i),n=null}}function a(e){return ue(parseFloat(e))}var i=fe.createElement("div"),n=fe.createElement("div"),s,o,d,r,c;n.style&&(n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",Ee.clearCloneStyle="content-box"===n.style.backgroundClip,Oe.extend(Ee,{boxSizingReliable:function(){return t(),o},pixelBoxStyles:function(){return t(),r},pixelPosition:function(){return t(),s},reliableMarginLeft:function(){return t(),c},scrollboxSize:function(){return t(),d}}))})();var At=["Webkit","Moz","ms"],Tt=fe.createElement("div").style,Et={},Mt=/^(none|table(?!-c[ea]).+)/,It=/^--/,Nt={position:"absolute",visibility:"hidden",display:"block"},Rt={letterSpacing:"0",fontWeight:"400"};Oe.extend({cssHooks:{opacity:{get:function(e,t){if(t){var a=B(e,"opacity");return""===a?"1":a}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,a,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n=h(t),s=It.test(t),o=e.style,d,r,c;if(s||(t=U(n)),c=Oe.cssHooks[t]||Oe.cssHooks[n],void 0!==a){if(r=typeof a,"string"===r&&(d=it.exec(a))&&d[1]&&(a=x(e,t,d),r="number"),null==a||a!==a)return;"number"!==r||s||(a+=d&&d[3]||(Oe.cssNumber[n]?"":"px")),Ee.clearCloneStyle||""!==a||0!==t.indexOf("background")||(o[t]="inherit"),c&&"set"in c&&void 0===(a=c.set(e,a,i))||(s?o.setProperty(t,a):o[t]=a)}else return c&&"get"in c&&void 0!==(d=c.get(e,!1,i))?d:o[t]}},css:function(e,t,a,i){var n=h(t),s=It.test(t),o,d,r;return s||(t=U(n)),r=Oe.cssHooks[t]||Oe.cssHooks[n],r&&"get"in r&&(o=r.get(e,!0,a)),void 0===o&&(o=B(e,t,i)),"normal"===o&&t in Rt&&(o=Rt[t]),""===a||a?(d=parseFloat(o),!0===a||isFinite(d)?d||0:o):o}}),Oe.each(["height","width"],function(e,t){Oe.cssHooks[t]={get:function(e,a,i){if(a)return!Mt.test(Oe.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?G(e,t,i):ct(e,Nt,function(){return G(e,t,i)})},set:function(e,a,i){var n=St(e),s=!Ee.scrollboxSize()&&"absolute"===n.position,o=(s||i)&&"border-box"===Oe.css(e,"boxSizing",!1,n),d=i?z(e,t,i,o,n):0,r;return o&&s&&(d-=ge(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(n[t])-z(e,t,"border",!1,n)-.5)),d&&(r=it.exec(a))&&"px"!==(r[3]||"px")&&(e.style[t]=a,a=Oe.css(e,t)),F(e,a,d)}}}),Oe.cssHooks.marginLeft=V(Ee.reliableMarginLeft,function(e,t){if(t)return(parseFloat(B(e,"marginLeft"))||e.getBoundingClientRect().left-ct(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),Oe.each({margin:"",padding:"",border:"Width"},function(e,t){Oe.cssHooks[e+t]={expand:function(a){for(var n=0,s={},o="string"==typeof a?a.split(" "):[a];4>n;n++)s[e+nt[n]+t]=o[n]||o[n-2]||o[0];return s}},"margin"!==e&&(Oe.cssHooks[e+t].set=F)}),Oe.fn.extend({css:function(e,t){return Ye(this,function(e,t,a){var n={},s=0,o,d;if(Array.isArray(t)){for(o=St(e),d=t.length;s<d;s++)n[t[s]]=Oe.css(e,t[s],!1,o);return n}return void 0===a?Oe.css(e,t):Oe.style(e,t,a)},e,t,1<arguments.length)}}),Oe.Tween=W,W.prototype={constructor:W,init:function(e,t,a,i,n,s){this.elem=e,this.prop=a,this.easing=n||Oe.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=s||(Oe.cssNumber[a]?"":"px")},cur:function(){var e=W.propHooks[this.prop];return e&&e.get?e.get(this):W.propHooks._default.get(this)},run:function(e){var t=W.propHooks[this.prop],a;return this.pos=this.options.duration?a=Oe.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):a=e,this.now=(this.end-this.start)*a+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),t&&t.set?t.set(this):W.propHooks._default.set(this),this}},W.prototype.init.prototype=W.prototype,W.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=Oe.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){Oe.fx.step[e.prop]?Oe.fx.step[e.prop](e):1===e.elem.nodeType&&(Oe.cssHooks[e.prop]||null!=e.elem.style[U(e.prop)])?Oe.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},W.propHooks.scrollTop=W.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},Oe.easing={linear:function(e){return e},swing:function(e){return .5-le(e*pe)/2},_default:"swing"},Oe.fx=W.prototype.init,Oe.fx.step={};var Ot=/^(?:toggle|show|hide)$/,Pt=/queueHooks$/,$t,jt;Oe.Animation=Oe.extend(ee,{tweeners:{"*":[function(e,t){var a=this.createTween(e,t);return x(a.elem,e,it.exec(t),a),a}]},tweener:function(e,t){Me(e)?(t=e,e=["*"]):e=e.match(ze);for(var a=0,i=e.length,n;a<i;a++)n=e[a],ee.tweeners[n]=ee.tweeners[n]||[],ee.tweeners[n].unshift(t)},prefilters:[K],prefilter:function(e,t){t?ee.prefilters.unshift(e):ee.prefilters.push(e)}}),Oe.speed=function(e,t,a){var i=e&&"object"==typeof e?Oe.extend({},e):{complete:a||!a&&t||Me(e)&&e,duration:e,easing:a&&t||t&&!Me(t)&&t};return Oe.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in Oe.fx.speeds?i.duration=Oe.fx.speeds[i.duration]:i.duration=Oe.fx.speeds._default),(null==i.queue||!0===i.queue)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){Me(i.old)&&i.old.call(this),i.queue&&Oe.dequeue(this,i.queue)},i},Oe.fn.extend({fadeTo:function(e,t,a,i){return this.filter(rt).css("opacity",0).show().end().animate({opacity:t},e,a,i)},animate:function(e,t,a,i){var n=Oe.isEmptyObject(e),s=Oe.speed(t,a,i),o=function(){var t=ee(this,Oe.extend({},e),s);(n||Ke.get(this,"finish"))&&t.stop(!0)};return o.finish=o,n||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,t,a){var i=function(e){var t=e.stop;delete e.stop,t(a)};return"string"!=typeof e&&(a=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=Oe.timers,o=Ke.get(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Pt.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(null==e||s[n].queue===e)&&(s[n].anim.stop(a),t=!1,s.splice(n,1));(t||!a)&&Oe.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t=Ke.get(this),a=t[e+"queue"],i=t[e+"queueHooks"],n=Oe.timers,s=a?a.length:0,o;for(t.finish=!0,Oe.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),o=n.length;o--;)n[o].elem===this&&n[o].queue===e&&(n[o].anim.stop(!0),n.splice(o,1));for(o=0;o<s;o++)a[o]&&a[o].finish&&a[o].finish.call(this);delete t.finish})}}),Oe.each(["toggle","show","hide"],function(e,t){var a=Oe.fn[t];Oe.fn[t]=function(e,i,n){return null==e||"boolean"==typeof e?a.apply(this,arguments):this.animate(Q(t,!0),e,i,n)}}),Oe.each({slideDown:Q("show"),slideUp:Q("hide"),slideToggle:Q("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){Oe.fn[e]=function(e,a,i){return this.animate(t,e,a,i)}}),Oe.timers=[],Oe.fx.tick=function(){var e=0,t=Oe.timers,a;for($t=Date.now();e<t.length;e++)a=t[e],a()||t[e]!==a||t.splice(e--,1);t.length||Oe.fx.stop(),$t=void 0},Oe.fx.timer=function(e){Oe.timers.push(e),Oe.fx.start()},Oe.fx.interval=13,Oe.fx.start=function(){jt||(jt=!0,Y())},Oe.fx.stop=function(){jt=null},Oe.fx.speeds={slow:600,fast:200,_default:400},Oe.fn.delay=function(t,a){return t=Oe.fx?Oe.fx.speeds[t]||t:t,a=a||"fx",this.queue(a,function(a,i){var n=e.setTimeout(a,t);i.stop=function(){e.clearTimeout(n)}})},function(){var e=fe.createElement("input"),t=fe.createElement("select"),a=t.appendChild(fe.createElement("option"));e.type="checkbox",Ee.checkOn=""!==e.value,Ee.optSelected=a.selected,e=fe.createElement("input"),e.value="t",e.type="radio",Ee.radioValue="t"===e.value}();var Dt=Oe.expr.attrHandle,Lt;Oe.fn.extend({attr:function(e,t){return Ye(this,Oe.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){Oe.removeAttr(this,e)})}}),Oe.extend({attr:function(e,t,a){var i=e.nodeType,n,s;if(3!==i&&8!==i&&2!==i)return"undefined"==typeof e.getAttribute?Oe.prop(e,t,a):(1===i&&Oe.isXMLDoc(e)||(s=Oe.attrHooks[t.toLowerCase()]||(Oe.expr.match.bool.test(t)?Lt:void 0)),void 0!==a)?null===a?void Oe.removeAttr(e,t):s&&"set"in s&&void 0!==(n=s.set(e,a,t))?n:(e.setAttribute(t,a+""),a):s&&"get"in s&&null!==(n=s.get(e,t))?n:(n=Oe.find.attr(e,t),null==n?void 0:n)},attrHooks:{type:{set:function(e,t){if(!Ee.radioValue&&"radio"===t&&o(e,"input")){var a=e.value;return e.setAttribute("type",t),a&&(e.value=a),t}}}},removeAttr:function(e,t){var a=0,n=t&&t.match(ze),s;if(n&&1===e.nodeType)for(;s=n[a++];)e.removeAttribute(s)}}),Lt={set:function(e,t,a){return!1===t?Oe.removeAttr(e,a):e.setAttribute(a,a),a}},Oe.each(Oe.expr.match.bool.source.match(/\w+/g),function(e,t){var a=Dt[t]||Oe.find.attr;Dt[t]=function(e,t,i){var n=t.toLowerCase(),s,o;return i||(o=Dt[n],Dt[n]=s,s=null==a(e,t,i)?null:n,Dt[n]=o),s}});var Ht=/^(?:input|select|textarea|button)$/i,Bt=/^(?:a|area)$/i;Oe.fn.extend({prop:function(e,t){return Ye(this,Oe.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[Oe.propFix[e]||e]})}}),Oe.extend({prop:function(e,t,a){var i=e.nodeType,n,s;if(3!==i&&8!==i&&2!==i)return 1===i&&Oe.isXMLDoc(e)||(t=Oe.propFix[t]||t,s=Oe.propHooks[t]),void 0===a?s&&"get"in s&&null!==(n=s.get(e,t))?n:e[t]:s&&"set"in s&&void 0!==(n=s.set(e,a,t))?n:e[t]=a},propHooks:{tabIndex:{get:function(e){var t=Oe.find.attr(e,"tabindex");return t?parseInt(t,10):Ht.test(e.nodeName)||Bt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),Ee.optSelected||(Oe.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),Oe.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Oe.propFix[this.toLowerCase()]=this}),Oe.fn.extend({addClass:function(e){var t=0,a,n,s,o,d,r,c;if(Me(e))return this.each(function(t){Oe(this).addClass(e.call(this,t,ae(this)))});if(a=ie(e),a.length)for(;n=this[t++];)if(o=ae(n),s=1===n.nodeType&&" "+te(o)+" ",s){for(r=0;d=a[r++];)0>s.indexOf(" "+d+" ")&&(s+=d+" ");c=te(s),o!==c&&n.setAttribute("class",c)}return this},removeClass:function(e){var t=0,a,n,s,o,d,r,c;if(Me(e))return this.each(function(t){Oe(this).removeClass(e.call(this,t,ae(this)))});if(!arguments.length)return this.attr("class","");if(a=ie(e),a.length)for(;n=this[t++];)if(o=ae(n),s=1===n.nodeType&&" "+te(o)+" ",s){for(r=0;d=a[r++];)for(;-1<s.indexOf(" "+d+" ");)s=s.replace(" "+d+" "," ");c=te(s),o!==c&&n.setAttribute("class",c)}return this},toggleClass:function(e,t){var a=typeof e,n="string"==a||Array.isArray(e);return"boolean"==typeof t&&n?t?this.addClass(e):this.removeClass(e):Me(e)?this.each(function(a){Oe(this).toggleClass(e.call(this,a,ae(this),t),t)}):this.each(function(){var t,s,o,d;if(n)for(s=0,o=Oe(this),d=ie(e);t=d[s++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else(void 0===e||"boolean"===a)&&(t=ae(this),t&&Ke.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":Ke.get(this,"__className__")||""))})},hasClass:function(e){var t=0,a,n;for(a=" "+e+" ";n=this[t++];)if(1===n.nodeType&&-1<(" "+te(ae(n))+" ").indexOf(a))return!0;return!1}});var Vt=/\r/g;Oe.fn.extend({val:function(e){var t=this[0],a,i,n;return arguments.length?(n=Me(e),this.each(function(t){var i;1!==this.nodeType||(i=n?e.call(this,t,Oe(this).val()):e,null==i?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=Oe.map(i,function(e){return null==e?"":e+""})),a=Oe.valHooks[this.type]||Oe.valHooks[this.nodeName.toLowerCase()],(!a||!("set"in a)||void 0===a.set(this,i,"value"))&&(this.value=i))})):t?(a=Oe.valHooks[t.type]||Oe.valHooks[t.nodeName.toLowerCase()],a&&"get"in a&&void 0!==(i=a.get(t,"value")))?i:(i=t.value,"string"==typeof i?i.replace(Vt,""):null==i?"":i):void 0}}),Oe.extend({valHooks:{option:{get:function(e){var t=Oe.find.attr(e,"value");return null==t?te(Oe.text(e)):t}},select:{get:function(e){var t=e.options,a=e.selectedIndex,n="select-one"===e.type,s=n?null:[],d=n?a+1:t.length,r,c,l;for(l=0>a?d:n?a:0;l<d;l++)if(c=t[l],(c.selected||l===a)&&!c.disabled&&(!c.parentNode.disabled||!o(c.parentNode,"optgroup"))){if(r=Oe(c).val(),n)return r;s.push(r)}return s},set:function(e,t){for(var a=e.options,n=Oe.makeArray(t),s=a.length,o,d;s--;)d=a[s],(d.selected=-1<Oe.inArray(Oe.valHooks.option.get(d),n))&&(o=!0);return o||(e.selectedIndex=-1),n}}}}),Oe.each(["radio","checkbox"],function(){Oe.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<Oe.inArray(Oe(e).val(),t)}},Ee.checkOn||(Oe.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),Ee.focusin="onfocusin"in e;var qt=/^(?:focusinfocus|focusoutblur)$/,Ut=function(t){t.stopPropagation()};Oe.extend(Oe.event,{trigger:function(t,a,n,s){var o=[n||fe],d=ke.call(t,"type")?t.type:t,r=ke.call(t,"namespace")?t.namespace.split("."):[],c,l,p,u,m,g,h,v;if((l=v=p=n=n||fe,3!==n.nodeType&&8!==n.nodeType)&&!qt.test(d+Oe.event.triggered)&&(-1<d.indexOf(".")&&(r=d.split("."),d=r.shift(),r.sort()),m=0>d.indexOf(":")&&"on"+d,t=t[Oe.expando]?t:new Oe.Event(d,"object"==typeof t&&t),t.isTrigger=s?2:3,t.namespace=r.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),a=null==a?[t]:Oe.makeArray(a,[t]),h=Oe.event.special[d]||{},s||!h.trigger||!1!==h.trigger.apply(n,a))){if(!s&&!h.noBubble&&!Ie(n)){for(u=h.delegateType||d,qt.test(u+d)||(l=l.parentNode);l;l=l.parentNode)o.push(l),p=l;p===(n.ownerDocument||fe)&&o.push(p.defaultView||p.parentWindow||e)}for(c=0;(l=o[c++])&&!t.isPropagationStopped();)v=l,t.type=1<c?u:h.bindType||d,g=(Ke.get(l,"events")||{})[t.type]&&Ke.get(l,"handle"),g&&g.apply(l,a),g=m&&l[m],g&&g.apply&&Je(l)&&(t.result=g.apply(l,a),!1===t.result&&t.preventDefault());return t.type=d,s||t.isDefaultPrevented()||h._default&&!1!==h._default.apply(o.pop(),a)||!Je(n)||!m||!Me(n[d])||Ie(n)||(p=n[m],p&&(n[m]=null),Oe.event.triggered=d,t.isPropagationStopped()&&v.addEventListener(d,Ut),n[d](),t.isPropagationStopped()&&v.removeEventListener(d,Ut),Oe.event.triggered=void 0,p&&(n[m]=p)),t.result}},simulate:function(t,a,i){var n=Oe.extend(new Oe.Event,i,{type:t,isSimulated:!0});Oe.event.trigger(n,null,a)}}),Oe.fn.extend({trigger:function(e,t){return this.each(function(){Oe.event.trigger(e,t,this)})},triggerHandler:function(e,t){var a=this[0];if(a)return Oe.event.trigger(e,t,a,!0)}}),Ee.focusin||Oe.each({focus:"focusin",blur:"focusout"},function(e,t){var a=function(e){Oe.event.simulate(t,e.target,Oe.event.fix(e))};Oe.event.special[t]={setup:function(){var i=this.ownerDocument||this,n=Ke.access(i,t);n||i.addEventListener(e,a,!0),Ke.access(i,t,(n||0)+1)},teardown:function(){var i=this.ownerDocument||this,n=Ke.access(i,t)-1;n?Ke.access(i,t,n):(i.removeEventListener(e,a,!0),Ke.remove(i,t))}}});var Ft=e.location,zt=Date.now(),Gt=/\?/;Oe.parseXML=function(t){var a;if(!t||"string"!=typeof t)return null;try{a=new e.DOMParser().parseFromString(t,"text/xml")}catch(t){a=void 0}return(!a||a.getElementsByTagName("parsererror").length)&&Oe.error("Invalid XML: "+t),a};var Wt=/\[\]$/,Yt=/\r?\n/g,Xt=/^(?:submit|button|image|reset|file)$/i,Qt=/^(?:input|select|textarea|keygen)/i;Oe.param=function(e,t){var a=[],i=function(e,t){var i=Me(t)?t():t;a[a.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)},n;if(null==e)return"";if(Array.isArray(e)||e.jquery&&!Oe.isPlainObject(e))Oe.each(e,function(){i(this.name,this.value)});else for(n in e)ne(n,e[n],t,i);return a.join("&")},Oe.fn.extend({serialize:function(){return Oe.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=Oe.prop(this,"elements");return e?Oe.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!Oe(this).is(":disabled")&&Qt.test(this.nodeName)&&!Xt.test(e)&&(this.checked||!pt.test(e))}).map(function(e,t){var a=Oe(this).val();return null==a?null:Array.isArray(a)?Oe.map(a,function(e){return{name:t.name,value:e.replace(Yt,"\r\n")}}):{name:t.name,value:a.replace(Yt,"\r\n")}}).get()}});var Jt=/%20/g,Kt=/#.*$/,Zt=/([?&])_=[^&]*/,ea=/^(.*?):[ \t]*([^\r\n]*)$/mg,ta=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,aa=/^(?:GET|HEAD)$/,ia=/^\/\//,na={},sa={},oa="*/".concat("*"),da=fe.createElement("a");da.href=Ft.href,Oe.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ft.href,type:"GET",isLocal:ta.test(Ft.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":Oe.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?de(de(e,Oe.ajaxSettings),t):de(Oe.ajaxSettings,e)},ajaxPrefilter:se(na),ajaxTransport:se(sa),ajax:function(t,a){function n(t,a,i,n){var p=a,u,m,b,w,k;C||(C=!0,x&&e.clearTimeout(x),h=void 0,f=n||"",g.readyState=0<t?4:0,u=200<=t&&300>t||304===t,i&&(w=re(o,g,i)),w=ce(o,w,g,u),u?(o.ifModified&&(k=g.getResponseHeader("Last-Modified"),k&&(Oe.lastModified[v]=k),k=g.getResponseHeader("etag"),k&&(Oe.etag[v]=k)),204===t||"HEAD"===o.type?p="nocontent":304===t?p="notmodified":(p=w.state,m=w.data,b=w.error,u=!b)):(b=p,(t||!p)&&(p="error",0>t&&(t=0))),g.status=t,g.statusText=(a||p)+"",u?r.resolveWith(s,[m,p,g]):r.rejectWith(s,[g,p,b]),g.statusCode(l),l=void 0,S&&d.trigger(u?"ajaxSuccess":"ajaxError",[g,o,u?m:b]),c.fireWith(s,[g,p]),S&&(d.trigger("ajaxComplete",[g,o]),! --Oe.active&&Oe.event.trigger("ajaxStop")))}"object"==typeof t&&(a=t,t=void 0),a=a||{};var o=Oe.ajaxSetup({},a),s=o.context||o,d=o.context&&(s.nodeType||s.jquery)?Oe(s):Oe.event,r=Oe.Deferred(),c=Oe.Callbacks("once memory"),l=o.statusCode||{},p={},u={},m="canceled",g={readyState:0,getResponseHeader:function(e){var t;if(C){if(!b)for(b={};t=ea.exec(f);)b[t[1].toLowerCase()+" "]=(b[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=b[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return C?f:null},setRequestHeader:function(e,t){return null==C&&(e=u[e.toLowerCase()]=u[e.toLowerCase()]||e,p[e]=t),this},overrideMimeType:function(e){return null==C&&(o.mimeType=e),this},statusCode:function(e){if(e)if(C)g.always(e[g.status]);else for(var t in e)l[t]=[l[t],e[t]];return this},abort:function(e){var t=e||m;return h&&h.abort(t),n(0,t),this}},h,v,f,b,x,w,C,S,k,A;if(r.promise(g),o.url=((t||o.url||Ft.href)+"").replace(ia,Ft.protocol+"//"),o.type=a.method||a.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(ze)||[""],null==o.crossDomain){w=fe.createElement("a");try{w.href=o.url,w.href=w.href,o.crossDomain=da.protocol+"//"+da.host!=w.protocol+"//"+w.host}catch(t){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=Oe.param(o.data,o.traditional)),oe(na,o,a,g),C)return g;for(k in S=Oe.event&&o.global,S&&0==Oe.active++&&Oe.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!aa.test(o.type),v=o.url.replace(Kt,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(Jt,"+")):(A=o.url.slice(v.length),o.data&&(o.processData||"string"==typeof o.data)&&(v+=(Gt.test(v)?"&":"?")+o.data,delete o.data),!1===o.cache&&(v=v.replace(Zt,"$1"),A=(Gt.test(v)?"&":"?")+"_="+zt++ +A),o.url=v+A),o.ifModified&&(Oe.lastModified[v]&&g.setRequestHeader("If-Modified-Since",Oe.lastModified[v]),Oe.etag[v]&&g.setRequestHeader("If-None-Match",Oe.etag[v])),(o.data&&o.hasContent&&!1!==o.contentType||a.contentType)&&g.setRequestHeader("Content-Type",o.contentType),g.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"===o.dataTypes[0]?"":", */*; q=0.01"):o.accepts["*"]),o.headers)g.setRequestHeader(k,o.headers[k]);if(o.beforeSend&&(!1===o.beforeSend.call(s,g,o)||C))return g.abort();if(m="abort",c.add(o.complete),g.done(o.success),g.fail(o.error),h=oe(sa,o,a,g),!h)n(-1,"No Transport");else{if(g.readyState=1,S&&d.trigger("ajaxSend",[g,o]),C)return g;o.async&&0<o.timeout&&(x=e.setTimeout(function(){g.abort("timeout")},o.timeout));try{C=!1,h.send(p,n)}catch(t){if(C)throw t;n(-1,t)}}return g},getJSON:function(e,t,a){return Oe.get(e,t,a,"json")},getScript:function(e,t){return Oe.get(e,void 0,t,"script")}}),Oe.each(["get","post"],function(e,t){Oe[t]=function(e,a,i,n){return Me(a)&&(n=n||i,i=a,a=void 0),Oe.ajax(Oe.extend({url:e,type:t,dataType:n,data:a,success:i},Oe.isPlainObject(e)&&e))}}),Oe._evalUrl=function(e,t){return Oe.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){Oe.globalEval(e,t)}})},Oe.fn.extend({wrapAll:function(e){var t;return this[0]&&(Me(e)&&(e=e.call(this[0])),t=Oe(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return Me(e)?this.each(function(t){Oe(this).wrapInner(e.call(this,t))}):this.each(function(){var t=Oe(this),a=t.contents();a.length?a.wrapAll(e):t.append(e)})},wrap:function(e){var t=Me(e);return this.each(function(a){Oe(this).wrapAll(t?e.call(this,a):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){Oe(this).replaceWith(this.childNodes)}),this}}),Oe.expr.pseudos.hidden=function(e){return!Oe.expr.pseudos.visible(e)},Oe.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},Oe.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(t){}};var ra={0:200,1223:204},ca=Oe.ajaxSettings.xhr();Ee.cors=!!ca&&"withCredentials"in ca,Ee.ajax=ca=!!ca,Oe.ajaxTransport(function(t){var a,n;if(Ee.cors||ca&&!t.crossDomain)return{send:function(s,o){var d=t.xhr(),r;if(d.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(r in t.xhrFields)d[r]=t.xhrFields[r];for(r in t.mimeType&&d.overrideMimeType&&d.overrideMimeType(t.mimeType),t.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest"),s)d.setRequestHeader(r,s[r]);a=function(e){return function(){a&&(a=n=d.onload=d.onerror=d.onabort=d.ontimeout=d.onreadystatechange=null,"abort"===e?d.abort():"error"===e?"number"==typeof d.status?o(d.status,d.statusText):o(0,"error"):o(ra[d.status]||d.status,d.statusText,"text"!==(d.responseType||"text")||"string"!=typeof d.responseText?{binary:d.response}:{text:d.responseText},d.getAllResponseHeaders()))}},d.onload=a(),n=d.onerror=d.ontimeout=a("error"),void 0===d.onabort?d.onreadystatechange=function(){4===d.readyState&&e.setTimeout(function(){a&&n()})}:d.onabort=n,a=a("abort");try{d.send(t.hasContent&&t.data||null)}catch(t){if(a)throw t}},abort:function(){a&&a()}}}),Oe.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),Oe.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return Oe.globalEval(e),e}}}),Oe.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),Oe.ajaxTransport("script",function(e){if(e.crossDomain||e.scriptAttrs){var t,a;return{send:function(i,n){t=Oe("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",a=function(e){t.remove(),a=null,e&&n("error"===e.type?404:200,e.type)}),fe.head.appendChild(t[0])},abort:function(){a&&a()}}}});var la=[],pa=/(=)\?(?=&|$)|\?\?/;Oe.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=la.pop()||Oe.expando+"_"+zt++;return this[e]=!0,e}}),Oe.ajaxPrefilter("json jsonp",function(t,a,i){var n=!1!==t.jsonp&&(pa.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&pa.test(t.data)&&"data"),s,o,d;if(n||"jsonp"===t.dataTypes[0])return s=t.jsonpCallback=Me(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,n?t[n]=t[n].replace(pa,"$1"+s):!1!==t.jsonp&&(t.url+=(Gt.test(t.url)?"&":"?")+t.jsonp+"="+s),t.converters["script json"]=function(){return d||Oe.error(s+" was not called"),d[0]},t.dataTypes[0]="json",o=e[s],e[s]=function(){d=arguments},i.always(function(){void 0===o?Oe(e).removeProp(s):e[s]=o,t[s]&&(t.jsonpCallback=a.jsonpCallback,la.push(s)),d&&Me(o)&&o(d[0]),d=o=void 0}),"script"}),Ee.createHTMLDocument=function(){var e=fe.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),Oe.parseHTML=function(e,t,a){if("string"!=typeof e)return[];"boolean"==typeof t&&(a=t,t=!1);var i,n,s;return(t||(Ee.createHTMLDocument?(t=fe.implementation.createHTMLDocument(""),i=t.createElement("base"),i.href=fe.location.href,t.head.appendChild(i)):t=fe),n=He.exec(e),s=!a&&[],n)?[t.createElement(n[1])]:(n=A([e],t,s),s&&s.length&&Oe(s).remove(),Oe.merge([],n.childNodes))},Oe.fn.load=function(e,t,a){var i=this,n=e.indexOf(" "),s,o,d;return-1<n&&(s=te(e.slice(n)),e=e.slice(0,n)),Me(t)?(a=t,t=void 0):t&&"object"==typeof t&&(o="POST"),0<i.length&&Oe.ajax({url:e,type:o||"GET",dataType:"html",data:t}).done(function(e){d=arguments,i.html(s?Oe("<div>").append(Oe.parseHTML(e)).find(s):e)}).always(a&&function(e,t){i.each(function(){a.apply(this,d||[e.responseText,t,e])})}),this},Oe.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){Oe.fn[t]=function(e){return this.on(t,e)}}),Oe.expr.pseudos.animated=function(e){return Oe.grep(Oe.timers,function(t){return e===t.elem}).length},Oe.offset={setOffset:function(e,t,a){var i=Oe.css(e,"position"),n=Oe(e),s={},o,d,r,c,l,p,u;"static"===i&&(e.style.position="relative"),l=n.offset(),r=Oe.css(e,"top"),p=Oe.css(e,"left"),u=("absolute"===i||"fixed"===i)&&-1<(r+p).indexOf("auto"),u?(o=n.position(),c=o.top,d=o.left):(c=parseFloat(r)||0,d=parseFloat(p)||0),Me(t)&&(t=t.call(e,a,Oe.extend({},l))),null!=t.top&&(s.top=t.top-l.top+c),null!=t.left&&(s.left=t.left-l.left+d),"using"in t?t.using.call(e,s):n.css(s)}},Oe.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){Oe.offset.setOffset(this,e,t)});var t=this[0],a,i;if(t)return t.getClientRects().length?(a=t.getBoundingClientRect(),i=t.ownerDocument.defaultView,{top:a.top+i.pageYOffset,left:a.left+i.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var e=this[0],t={top:0,left:0},a,i,n;if("fixed"===Oe.css(e,"position"))i=e.getBoundingClientRect();else{for(i=this.offset(),n=e.ownerDocument,a=e.offsetParent||n.documentElement;a&&(a===n.body||a===n.documentElement)&&"static"===Oe.css(a,"position");)a=a.parentNode;a&&a!==e&&1===a.nodeType&&(t=Oe(a).offset(),t.top+=Oe.css(a,"borderTopWidth",!0),t.left+=Oe.css(a,"borderLeftWidth",!0))}return{top:i.top-t.top-Oe.css(e,"marginTop",!0),left:i.left-t.left-Oe.css(e,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===Oe.css(e,"position");)e=e.offsetParent;return e||st})}}),Oe.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var a="pageYOffset"===t;Oe.fn[e]=function(i){return Ye(this,function(e,i,n){var s;return Ie(e)?s=e:9===e.nodeType&&(s=e.defaultView),void 0===n?s?s[t]:e[i]:void(s?s.scrollTo(a?s.pageXOffset:n,a?n:s.pageYOffset):e[i]=n)},e,i,arguments.length)}}),Oe.each(["top","left"],function(e,t){Oe.cssHooks[t]=V(Ee.pixelPosition,function(e,a){if(a)return a=B(e,t),Ct.test(a)?Oe(e).position()[t]+"px":a})}),Oe.each({Height:"height",Width:"width"},function(e,t){Oe.each({padding:"inner"+e,content:t,"":"outer"+e},function(a,i){Oe.fn[i]=function(n,s){var o=arguments.length&&(a||"boolean"!=typeof n),d=a||(!0===n||!0===s?"margin":"border");return Ye(this,function(t,a,n){var s;return Ie(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,he(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===n?Oe.css(t,a,d):Oe.style(t,a,n,d)},t,o?n:void 0,o)}})}),Oe.each(["blur","focus","focusin","focusout","resize","scroll","click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","change","select","submit","keydown","keypress","keyup","contextmenu"],function(e,t){Oe.fn[t]=function(e,a){return 0<arguments.length?this.on(t,null,e,a):this.trigger(t)}}),Oe.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),Oe.fn.extend({bind:function(e,t,a){return this.on(e,null,t,a)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,a,i){return this.on(t,e,a,i)},undelegate:function(e,t,a){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",a)}}),Oe.proxy=function(e,t){var a,i,n;if("string"==typeof t&&(a=e[t],t=e,e=a),!!Me(e))return i=be.call(arguments,2),n=function(){return e.apply(t||this,i.concat(be.call(arguments)))},n.guid=e.guid=e.guid||Oe.guid++,n},Oe.holdReady=function(e){e?Oe.readyWait++:Oe.ready(!0)},Oe.isArray=Array.isArray,Oe.parseJSON=JSON.parse,Oe.nodeName=o,Oe.isFunction=Me,Oe.isWindow=Ie,Oe.camelCase=h,Oe.type=n,Oe.now=Date.now,Oe.isNumeric=function(e){var t=Oe.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return Oe});var ua=e.jQuery,ma=e.$;return Oe.noConflict=function(t){return e.$===Oe&&(e.$=ma),t&&e.jQuery===Oe&&(e.jQuery=ua),Oe},t||(e.jQuery=e.$=Oe),Oe}),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(a,i,n){t.Backbone=e(t,n,a,i)});else if("undefined"!=typeof exports){var a=require("underscore"),i;try{i=require("jquery")}catch(t){}e(t,exports,a,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,a,i){var n=Math.max,s=e.Backbone,o=Array.prototype.slice;t.VERSION="1.3.3",t.$=i,t.noConflict=function(){return e.Backbone=s,this},t.emulateHTTP=!1,t.emulateJSON=!1;var d=function(e,t,i){return 1===e?function(){return a[t](this[i])}:2===e?function(e){return a[t](this[i],e)}:3===e?function(e,n){return a[t](this[i],c(e,this),n)}:4===e?function(e,n,s){return a[t](this[i],c(e,this),n,s)}:function(){var e=o.call(arguments);return e.unshift(this[i]),a[t].apply(a,e)}},r=function(e,t,i){a.each(t,function(t,n){a[n]&&(e.prototype[n]=d(t,n,i))})},c=function(e,t){return a.isFunction(e)?e:a.isObject(e)&&!t._isModel(e)?l(e):a.isString(e)?function(t){return t.get(e)}:e},l=function(e){var t=a.matches(e);return function(e){return t(e.attributes)}},p=t.Events={},u=/\s+/,m=function(e,t,n,s,o){var d=0,r;if(n&&"object"==typeof n)for(void 0!==s&&("context"in o)&&void 0===o.context&&(o.context=s),r=a.keys(n);d<r.length;d++)t=m(e,t,r[d],n[r[d]],o);else if(n&&u.test(n))for(r=n.split(u);d<r.length;d++)t=e(t,r[d],s,o);else t=e(t,n,s,o);return t};p.on=function(e,t,a){return g(this,e,t,a)};var g=function(e,t,a,i,n){if(e._events=m(h,e._events||{},t,a,{context:i,ctx:e,listening:n}),n){var s=e._listeners||(e._listeners={});s[n.id]=n}return e};p.listenTo=function(e,t,i){if(!e)return this;var n=e._listenId||(e._listenId=a.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=s[n];if(!o){var d=this._listenId||(this._listenId=a.uniqueId("l"));o=s[n]={obj:e,objId:n,id:d,listeningTo:s,count:0}}return g(e,t,i,this,o),this};var h=function(e,t,a,i){if(a){var n=e[t]||(e[t]=[]),s=i.context,o=i.ctx,d=i.listening;d&&d.count++,n.push({callback:a,context:s,ctx:s||o,listening:d})}return e};p.off=function(e,t,a){return this._events?(this._events=m(v,this._events,e,t,{context:a,listeners:this._listeners}),this):this},p.stopListening=function(e,t,n){var s=this._listeningTo;if(!s)return this;for(var o=e?[e._listenId]:a.keys(s),d=0,r;d<o.length&&(r=s[o[d]],!!r);d++)r.obj.off(t,n,this);return this};var v=function(e,t,n,s){if(e){var o=0,d=s.context,r=s.listeners,c;if(!t&&!n&&!d){for(var l=a.keys(r);o<l.length;o++)c=r[l[o]],delete r[c.id],delete c.listeningTo[c.objId];return}for(var p=t?[t]:a.keys(e);o<p.length;o++){t=p[o];var u=e[t];if(!u)break;for(var m=[],g=0,h;g<u.length;g++)h=u[g],n&&n!==h.callback&&n!==h.callback._callback||d&&d!==h.context?m.push(h):(c=h.listening,c&&0==--c.count&&(delete r[c.id],delete c.listeningTo[c.objId]));m.length?e[t]=m:delete e[t]}return e}};p.once=function(e,t,i){var n=m(f,{},e,t,a.bind(this.off,this));return"string"==typeof e&&null==i&&(t=void 0),this.on(n,t,i)},p.listenToOnce=function(e,t,i){var n=m(f,{},t,i,a.bind(this.stopListening,this,e));return this.listenTo(e,n)};var f=function(e,t,i,n){if(i){var s=e[t]=a.once(function(){n(t,s),i.apply(this,arguments)});s._callback=i}return e};p.trigger=function(e){if(!this._events)return this;for(var t=n(0,arguments.length-1),a=Array(t),s=0;s<t;s++)a[s]=arguments[s+1];return m(b,this._events,e,void 0,a),this};var b=function(e,t,a,i){if(e){var n=e[t],s=e.all;n&&s&&(s=s.slice()),n&&x(n,i),s&&x(s,[t].concat(i))}return e},x=function(e,t){var a=-1,n=e.length,s=t[0],o=t[1],d=t[2],r;switch(t.length){case 0:for(;++a<n;)(r=e[a]).callback.call(r.ctx);return;case 1:for(;++a<n;)(r=e[a]).callback.call(r.ctx,s);return;case 2:for(;++a<n;)(r=e[a]).callback.call(r.ctx,s,o);return;case 3:for(;++a<n;)(r=e[a]).callback.call(r.ctx,s,o,d);return;default:for(;++a<n;)(r=e[a]).callback.apply(r.ctx,t);}};p.bind=p.on,p.unbind=p.off,a.extend(t,p);var w=t.Model=function(e,t){var i=e||{};t||(t={}),this.cid=a.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{});var n=a.result(this,"defaults");i=a.defaults(a.extend({},n,i),n),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};a.extend(w.prototype,p,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return a.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!a.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var s;if("object"==typeof e?(s=e,n=t):(s={})[e]=t,n||(n={}),!this._validate(s,n))return!1;var o=n.unset,d=n.silent,r=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=a.clone(this.attributes),this.changed={});var l=this.attributes,p=this.changed,u=this._previousAttributes;for(var m in s)t=s[m],a.isEqual(l[m],t)||r.push(m),a.isEqual(u[m],t)?delete p[m]:p[m]=t,o?delete l[m]:l[m]=t;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!d){r.length&&(this._pending=n);for(var g=0;g<r.length;g++)this.trigger("change:"+r[g],this,l[r[g]],n)}if(c)return this;if(!d)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,a.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,a.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!a.isEmpty(this.changed):a.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&a.clone(this.changed);var t=this._changing?this._previousAttributes:this.attributes,i={};for(var n in e){var s=e[n];a.isEqual(t[n],s)||(i[n]=s)}return!!a.size(i)&&i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(e){e=a.extend({parse:!0},e);var t=this,i=e.success;return e.success=function(a){var n=e.parse?t.parse(a,e):a;return!!t.set(n,e)&&void(i&&i.call(e.context,t,a,e),t.trigger("sync",t,a,e))},q(this,e),this.sync("read",this,e)},save:function(e,t,i){var n;null==e||"object"==typeof e?(n=e,i=t):(n={})[e]=t,i=a.extend({validate:!0,parse:!0},i);var s=i.wait;if(n&&!s){if(!this.set(n,i))return!1;}else if(!this._validate(n,i))return!1;var o=this,d=i.success,r=this.attributes;i.success=function(e){o.attributes=r;var t=i.parse?o.parse(e,i):e;return s&&(t=a.extend({},n,t)),(!t||o.set(t,i))&&void(d&&d.call(i.context,o,e,i),o.trigger("sync",o,e,i))},q(this,i),n&&s&&(this.attributes=a.extend({},r,n));var c=this.isNew()?"create":i.patch?"patch":"update";"patch"!=c||i.attrs||(i.attrs=n);var l=this.sync(c,this,i);return this.attributes=r,l},destroy:function(e){e=e?a.clone(e):{};var t=this,i=e.success,n=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(a){n&&s(),i&&i.call(e.context,t,a,e),t.isNew()||t.trigger("sync",t,a,e)};var o=!1;return this.isNew()?a.defer(e.success):(q(this,e),o=this.sync("delete",this,e)),n||s(),o},url:function(){var e=a.result(this,"urlRoot")||a.result(this.collection,"url")||V();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},a.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=a.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,a.extend(t,{validationError:i})),!1)}});r(w,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var C=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,a.extend({silent:!0},t))},S={add:!0,remove:!0,merge:!0},k={add:!0,remove:!1},A=function(e,t,a){a=Math.min(n(a,0),e.length);var s=Array(e.length-a),o=t.length,d;for(d=0;d<s.length;d++)s[d]=e[d+a];for(d=0;d<o;d++)e[d+a]=t[d];for(d=0;d<s.length;d++)e[d+o+a]=s[d]};a.extend(C.prototype,p,{model:w,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,a.extend({merge:!1},t,k))},remove:function(e,t){t=a.extend({},t);var i=!a.isArray(e);e=i?[e]:e.slice();var n=this._removeModels(e,t);return!t.silent&&n.length&&(t.changes={added:[],merged:[],removed:n},this.trigger("update",this,t)),i?n[0]:n},set:function(e,t){if(null!=e){t=a.extend({},S,t),t.parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!a.isArray(e);e=n?[e]:e.slice();var s=t.at;null!=s&&(s=+s),s>this.length&&(s=this.length),0>s&&(s+=this.length+1);var o=[],d=[],r=[],c=[],l={},p=t.add,u=t.merge,m=t.remove,g=!1,h=this.comparator&&null==s&&!1!==t.sort,v=a.isString(this.comparator)?this.comparator:null,f,b;for(b=0;b<e.length;b++){f=e[b];var x=this.get(f);if(x){if(u&&f!==x){var w=this._isModel(f)?f.attributes:f;t.parse&&(w=x.parse(w,t)),x.set(w,t),r.push(x),h&&!g&&(g=x.hasChanged(v))}l[x.cid]||(l[x.cid]=!0,o.push(x)),e[b]=x}else p&&(f=e[b]=this._prepareModel(f,t),f&&(d.push(f),this._addReference(f,t),l[f.cid]=!0,o.push(f)))}if(m){for(b=0;b<this.length;b++)f=this.models[b],l[f.cid]||c.push(f);c.length&&this._removeModels(c,t)}var C=!1;if(o.length&&!h&&p&&m?(C=this.length!==o.length||a.some(this.models,function(e,t){return e!==o[t]}),this.models.length=0,A(this.models,o,0),this.length=this.models.length):d.length&&(h&&(g=!0),A(this.models,d,null==s?this.length:s),this.length=this.models.length),g&&this.sort({silent:!0}),!t.silent){for(b=0;b<d.length;b++)null!=s&&(t.index=s+b),f=d[b],f.trigger("add",f,this,t);(g||C)&&this.trigger("sort",this,t),(d.length||c.length||r.length)&&(t.changes={added:d,removed:c,merged:r},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?a.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,a.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,a.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,a.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return o.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[this.modelId(e.attributes||e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return 0>e&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var i=t.length;return a.isFunction(t)&&(t=a.bind(t,this)),1===i||a.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){e=a.extend({parse:!0},e);var t=e.success,i=this;return e.success=function(a){var n=e.reset?"reset":"set";i[n](a,e),t&&t.call(e.context,i,a,e),i.trigger("sync",i,a,e)},q(this,e),this.sync("read",this,e)},create:function(e,t){t=t?a.clone(t):{};var i=t.wait;if(e=this._prepareModel(e,t),!e)return!1;i||this.add(e,t);var n=this,s=t.success;return t.success=function(e,t,a){i&&n.add(e,a),s&&s.call(a.context,e,t,a)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?a.clone(t):{},t.collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_removeModels:function(e,t){for(var a=[],n=0,s;n<e.length;n++)if(s=this.get(e[n]),s){var o=this.indexOf(s);this.models.splice(o,1),this.length--,delete this._byId[s.cid];var d=this.modelId(s.attributes);null!=d&&delete this._byId[d],t.silent||(t.index=o,s.trigger("remove",s,this,t)),a.push(s),this._removeReference(s,t)}return a},_isModel:function(e){return e instanceof w},_addReference:function(e){this._byId[e.cid]=e;var t=this.modelId(e.attributes);null!=t&&(this._byId[t]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e){delete this._byId[e.cid];var t=this.modelId(e.attributes);null!=t&&delete this._byId[t],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,a,i){if(t){if(("add"===e||"remove"===e)&&a!==this)return;if("destroy"===e&&this.remove(t,i),"change"===e){var n=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);n!==s&&(null!=n&&delete this._byId[n],null!=s&&(this._byId[s]=t))}}this.trigger.apply(this,arguments)}});r(C,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models");var T=t.View=function(e){this.cid=a.uniqueId("view"),a.extend(this,a.pick(e,M)),this._ensureElement(),this.initialize.apply(this,arguments)},E=/^(\S+)\s*(.*)$/,M=["model","collection","el","id","attributes","className","tagName","events"];a.extend(T.prototype,p,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=a.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var i=e[t];if(a.isFunction(i)||(i=this[i]),i){var n=t.match(E);this.delegate(n[1],n[2],a.bind(i,this))}}return this},delegate:function(e,t,a){return this.$el.on(e+".delegateEvents"+this.cid,t,a),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,a){return this.$el.off(e+".delegateEvents"+this.cid,t,a),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(!this.el){var e=a.extend({},a.result(this,"attributes"));this.id&&(e.id=a.result(this,"id")),this.className&&(e["class"]=a.result(this,"className")),this.setElement(this._createElement(a.result(this,"tagName"))),this._setAttributes(e)}else this.setElement(a.result(this,"el"))},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,i,n){var s=I[e];a.defaults(n||(n={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};if(n.url||(o.url=a.result(i,"url")||V()),null==n.data&&i&&("create"===e||"update"===e||"patch"===e)&&(o.contentType="application/json",o.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),n.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",n.emulateJSON&&(o.data._method=s);var d=n.beforeSend;n.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",s),d)return d.apply(this,arguments)}}"GET"===o.type||n.emulateJSON||(o.processData=!1);var r=n.error;n.error=function(e,t,a){n.textStatus=t,n.errorThrown=a,r&&r.call(n.context,e,t,a)};var c=n.xhr=t.ajax(a.extend(o,n));return i.trigger("request",i,c,n),c};var I={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var N=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},R=/\((.*?)\)/g,O=/(\(\?)?:\w+/g,P=/\*\w+/g,j=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(N.prototype,p,{initialize:function(){},route:function(e,i,n){a.isRegExp(e)||(e=this._routeToRegExp(e)),a.isFunction(i)&&(n=i,i=""),n||(n=this[i]);var s=this;return t.history.route(e,function(a){var o=s._extractParameters(e,a);!1!==s.execute(n,o,i)&&(s.trigger.apply(s,["route:"+i].concat(o)),s.trigger("route",i,o),t.history.trigger("route",s,i,o))}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,a){return t.history.navigate(e,a),this},_bindRoutes:function(){if(this.routes){this.routes=a.result(this,"routes");for(var e=a.keys(this.routes),t;null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(e){return e=e.replace(j,"\\$&").replace(R,"(?:$1)?").replace(O,function(e,t){return t?e:"([^/?]+)"}).replace(P,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return a.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var D=t.History=function(){this.handlers=[],this.checkUrl=a.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},L=/^[#\/]|\s+$/g,H=/^\/+|\/+$/g,B=/#.*$/;D.started=!1,a.extend(D.prototype,p,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(this._usePushState||!this._wantsHashChange?e=this.getPath():e=this.getHash()),e.replace(L,"")},start:function(e){if(D.started)throw new Error("Backbone.history has already been started");if(D.started=!0,this.options=a.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.history&&this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(H,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,n=i.insertBefore(this.iframe,i.firstChild).contentWindow;n.document.open(),n.document.close(),n.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e!==this.fragment&&void(this.iframe&&this.navigate(e),this.loadUrl())},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),a.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(e,t){if(!D.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var a=this.root;(""===e||"?"===e.charAt(0))&&(a=a.slice(0,-1)||"/");var i=a+e;if(e=this.decodeFragment(e.replace(B,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var n=this.iframe.contentWindow;t.replace||(n.document.open(),n.document.close()),this._updateHash(n.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,a){if(a){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new D;w.extend=C.extend=N.extend=T.extend=D.extend=function(e,t){var i=this,n;return n=e&&a.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)},a.extend(n,i,t),n.prototype=a.create(i.prototype,e),n.prototype.constructor=n,n.__super__=i.prototype,n};var V=function(){throw new Error("A \"url\" property or function must be specified")},q=function(e,t){var a=t.error;t.error=function(i){a&&a.call(t.context,e,i,t),e.trigger("error",e,i,t)}};return t});(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("moment",t):e.moment=t()})(this,function(){'use strict';var $t=Math.abs,jt=Math.round,Dt=Math.ceil,Lt=Math.floor,Ht=Math.pow,Bt=Math.min,Vt=Math.max;function e(){return qt.apply(null,arguments)}function t(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function a(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function i(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function n(e){return void 0===e}function s(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function o(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function d(e,t){var a=[],n;for(n=0;n<e.length;++n)a.push(t(e[n],n));return a}function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){for(var a in t)r(t,a)&&(e[a]=t[a]);return r(t,"toString")&&(e.toString=t.toString),r(t,"valueOf")&&(e.valueOf=t.valueOf),e}function l(e,t,a,i){return Ge(e,t,a,i,!0).utc()}function p(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function u(e){return null==e._pf&&(e._pf=p()),e._pf}function m(e){if(null==e._isValid){var t=u(e),a=Ut.call(t.parsedDateParts,function(e){return null!=e}),i=!isNaN(e._d.getTime())&&0>t.overflow&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&a);if(e._strict&&(i=i&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null==Object.isFrozen||!Object.isFrozen(e))e._isValid=i;else return i}return e._isValid}function g(e){var t=l(NaN);return null==e?u(t).userInvalidated=!0:c(u(t),e),t}function h(e,t){var a,s,o;if(n(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),n(t._i)||(e._i=t._i),n(t._f)||(e._f=t._f),n(t._l)||(e._l=t._l),n(t._strict)||(e._strict=t._strict),n(t._tzm)||(e._tzm=t._tzm),n(t._isUTC)||(e._isUTC=t._isUTC),n(t._offset)||(e._offset=t._offset),n(t._pf)||(e._pf=u(t)),n(t._locale)||(e._locale=t._locale),0<Ft.length)for(a=0;a<Ft.length;a++)s=Ft[a],o=t[s],n(o)||(e[s]=o);return e}function v(t){h(this,t),this._d=new Date(null==t._d?NaN:t._d.getTime()),this.isValid()||(this._d=new Date(NaN)),!1===zt&&(zt=!0,e.updateOffset(this),zt=!1)}function f(e){return e instanceof v||null!=e&&null!=e._isAMomentObject}function b(e){return 0>e?Dt(e)||0:Lt(e)}function x(e){var t=+e,a=0;return 0!=t&&isFinite(t)&&(a=b(t)),a}function w(e,t,a){var n=Bt(e.length,t.length),s=$t(e.length-t.length),o=0,d;for(d=0;d<n;d++)(a&&e[d]!==t[d]||!a&&x(e[d])!==x(t[d]))&&o++;return o+s}function C(t){!1===e.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function S(t,a){var n=!0;return c(function(){if(null!=e.deprecationHandler&&e.deprecationHandler(null,t),n){for(var s=[],o=0,d;o<arguments.length;o++){if(d="","object"==typeof arguments[o]){for(var r in d+="\n["+o+"] ",arguments[0])d+=r+": "+arguments[0][r]+", ";d=d.slice(0,-2)}else d=arguments[o];s.push(d)}C(t+"\nArguments: "+Array.prototype.slice.call(s).join("")+"\n"+new Error().stack),n=!1}return a.apply(this,arguments)},a)}function k(t,a){null!=e.deprecationHandler&&e.deprecationHandler(t,a),Gt[t]||(C(a),Gt[t]=!0)}function A(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function T(e,t){var i=c({},e),n;for(n in t)r(t,n)&&(a(e[n])&&a(t[n])?(i[n]={},c(i[n],e[n]),c(i[n],t[n])):null==t[n]?delete i[n]:i[n]=t[n]);for(n in e)r(e,n)&&!r(t,n)&&a(e[n])&&(i[n]=c({},i[n]));return i}function E(e){null!=e&&this.set(e)}function M(e,t){var a=e.toLowerCase();Xt[a]=Xt[a+"s"]=Xt[t]=e}function I(e){return"string"==typeof e?Xt[e]||Xt[e.toLowerCase()]:void 0}function N(e){var t={},a,i;for(i in e)r(e,i)&&(a=I(i),a&&(t[a]=e[i]));return t}function R(e,t){Qt[e]=t}function O(e){var t=[];for(var a in e)t.push({unit:a,priority:Qt[a]});return t.sort(function(e,t){return e.priority-t.priority}),t}function P(e,t,a){var i=""+$t(e),n=t-i.length;return(0<=e?a?"+":"":"-")+Ht(10,Vt(0,n)).toString().substr(1)+i}function j(e,t,a,i){var n=i;"string"==typeof i&&(n=function(){return this[i]()}),e&&(ea[e]=n),t&&(ea[t[0]]=function(){return P(n.apply(this,arguments),t[1],t[2])}),a&&(ea[a]=function(){return this.localeData().ordinal(n.apply(this,arguments),e)})}function D(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function L(e){var t=e.match(Jt),a,n;for(a=0,n=t.length;a<n;a++)t[a]=ea[t[a]]?ea[t[a]]:D(t[a]);return function(a){var s="",o;for(o=0;o<n;o++)s+=A(t[o])?t[o].call(a,e):t[o];return s}}function H(e,t){return e.isValid()?(t=B(t,e.localeData()),Zt[t]=Zt[t]||L(t),Zt[t](e)):e.localeData().invalidDate()}function B(e,t){function a(e){return t.longDateFormat(e)||e}var n=5;for(Kt.lastIndex=0;0<=n&&Kt.test(e);)e=e.replace(Kt,a),Kt.lastIndex=0,n-=1;return e}function V(e,t,a){_a[e]=A(t)?t:function(e){return e&&a?a:t}}function q(e,t){return r(_a,e)?_a[e](t._strict,t._locale):new RegExp(U(e))}function U(e){return F(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,a,i,n){return t||a||i||n}))}function F(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function z(e,t){var a=t,n;for("string"==typeof e&&(e=[e]),s(t)&&(a=function(e,a){a[t]=x(e)}),n=0;n<e.length;n++)ba[e[n]]=a}function G(e,t){z(e,function(e,a,i,n){i._w=i._w||{},t(e,i._w,i,n)})}function W(e,t,a){null!=t&&r(ba,e)&&ba[e](t,a._a,a,e)}function Y(e){return X(e)?366:365}function X(e){return 0==e%4&&0!=e%100||0==e%400}function Q(t,a){return function(i){return null==i?J(this,t):(K(this,t,i),e.updateOffset(this,a),this)}}function J(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function K(e,t,a){e.isValid()&&!isNaN(a)&&("FullYear"===t&&X(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](a,e.month(),ee(a,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](a))}function Z(e,t){return(e%t+t)%t}function ee(e,t){if(isNaN(e)||isNaN(t))return NaN;var a=Z(t,12);return e+=(t-a)/12,1===a?X(e)?29:28:31-a%7%2}function te(e,t,a){var n=e.toLocaleLowerCase(),s,o,d;if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;12>s;++s)d=l([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(d,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(d,"").toLocaleLowerCase();return a?"MMM"===t?(o=Ta.call(this._shortMonthsParse,n),-1===o?null:o):(o=Ta.call(this._longMonthsParse,n),-1===o?null:o):"MMM"===t?(o=Ta.call(this._shortMonthsParse,n),-1!==o)?o:(o=Ta.call(this._longMonthsParse,n),-1===o?null:o):(o=Ta.call(this._longMonthsParse,n),-1!==o)?o:(o=Ta.call(this._shortMonthsParse,n),-1===o?null:o)}function ae(e,t){var a;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=x(t);else if(t=e.localeData().monthsParse(t),!s(t))return e;return a=Bt(e.date(),ee(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,a),e}function ie(t){return null==t?J(this,"Month"):(ae(this,t),e.updateOffset(this,!0),this)}function ne(){function e(e,t){return t.length-e.length}var t=[],a=[],n=[],s,o;for(s=0;12>s;s++)o=l([2e3,s]),t.push(this.monthsShort(o,"")),a.push(this.months(o,"")),n.push(this.months(o,"")),n.push(this.monthsShort(o,""));for(t.sort(e),a.sort(e),n.sort(e),s=0;12>s;s++)t[s]=F(t[s]),a[s]=F(a[s]);for(s=0;24>s;s++)n[s]=F(n[s]);this._monthsRegex=new RegExp("^("+n.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+t.join("|")+")","i")}function se(e,t,a,i,n,o,s){var d;return 100>e&&0<=e?(d=new Date(e+400,t,a,i,n,o,s),isFinite(d.getFullYear())&&d.setFullYear(e)):d=new Date(e,t,a,i,n,o,s),d}function oe(e){var t;if(100>e&&0<=e){var a=Array.prototype.slice.call(arguments);a[0]=e+400,t=new Date(Date.UTC.apply(null,a)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)}else t=new Date(Date.UTC.apply(null,arguments));return t}function de(e,t,a){var i=7+t-a,n=(7+oe(e,0,i).getUTCDay()-t)%7;return-n+i-1}function re(e,t,a,i,n){var s=de(e,i,n),o=1+7*(t-1)+(7+a-i)%7+s,d,r;return 0>=o?(d=e-1,r=Y(d)+o):o>Y(e)?(d=e+1,r=o-Y(e)):(d=e,r=o),{year:d,dayOfYear:r}}function ce(e,t,a){var i=de(e.year(),t,a),n=Lt((e.dayOfYear()-i-1)/7)+1,s,o;return 1>n?(o=e.year()-1,s=n+le(o,t,a)):n>le(e.year(),t,a)?(s=n-le(e.year(),t,a),o=e.year()+1):(o=e.year(),s=n),{week:s,year:o}}function le(e,t,a){var i=de(e,t,a),n=de(e+1,t,a);return(Y(e)-i+n)/7}function pe(e,t){return"string"==typeof e?isNaN(e)?(e=t.weekdaysParse(e),"number"==typeof e?e:null):parseInt(e,10):e}function ue(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function me(e,t){return e.slice(t,7).concat(e.slice(0,t))}function ge(e,t,a){var n=e.toLocaleLowerCase(),s,o,d;if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;7>s;++s)d=l([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(d,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(d,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(d,"").toLocaleLowerCase();return a?"dddd"===t?(o=Ta.call(this._weekdaysParse,n),-1===o?null:o):"ddd"===t?(o=Ta.call(this._shortWeekdaysParse,n),-1===o?null:o):(o=Ta.call(this._minWeekdaysParse,n),-1===o?null:o):"dddd"===t?(o=Ta.call(this._weekdaysParse,n),-1!==o)?o:(o=Ta.call(this._shortWeekdaysParse,n),-1!==o)?o:(o=Ta.call(this._minWeekdaysParse,n),-1===o?null:o):"ddd"===t?(o=Ta.call(this._shortWeekdaysParse,n),-1!==o)?o:(o=Ta.call(this._weekdaysParse,n),-1!==o)?o:(o=Ta.call(this._minWeekdaysParse,n),-1===o?null:o):(o=Ta.call(this._minWeekdaysParse,n),-1!==o)?o:(o=Ta.call(this._weekdaysParse,n),-1!==o)?o:(o=Ta.call(this._shortWeekdaysParse,n),-1===o?null:o)}function he(){function e(e,t){return t.length-e.length}var t=[],a=[],n=[],s=[],o,d,r,c,p;for(o=0;7>o;o++)d=l([2e3,1]).day(o),r=this.weekdaysMin(d,""),c=this.weekdaysShort(d,""),p=this.weekdays(d,""),t.push(r),a.push(c),n.push(p),s.push(r),s.push(c),s.push(p);for(t.sort(e),a.sort(e),n.sort(e),s.sort(e),o=0;7>o;o++)a[o]=F(a[o]),n[o]=F(n[o]),s[o]=F(s[o]);this._weekdaysRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+n.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+t.join("|")+")","i")}function ve(){return this.hours()%12||12}function fe(e,t){j(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function _e(e,t){return t._meridiemParse}function be(e){return e?e.toLowerCase().replace("_","-"):e}function ye(e){for(var t=0,a,n,s,o;t<e.length;){for(o=be(e[t]).split("-"),a=o.length,n=be(e[t+1]),n=n?n.split("-"):null;0<a;){if(s=xe(o.slice(0,a).join("-")),s)return s;if(n&&n.length>=a&&w(o,n,!0)>=a-1)break;a--}t++}return Fa}function xe(e){var t=null;if(!Pa[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=Fa._abbr;var a=require;a("./locale/"+e),we(t)}catch(t){}return Pa[e]}function we(e,t){var a;return e&&(a=n(t)?Se(e):Ce(e,t),a?Fa=a:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),Fa._abbr}function Ce(e,t){if(null!==t){var a=Oa,i;if(t.abbr=e,null!=Pa[e])k("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),a=Pa[e]._config;else if(null!=t.parentLocale)if(null!=Pa[t.parentLocale])a=Pa[t.parentLocale]._config;else if(i=xe(t.parentLocale),null!=i)a=i._config;else return $a[t.parentLocale]||($a[t.parentLocale]=[]),$a[t.parentLocale].push({name:e,config:t}),null;return Pa[e]=new E(T(a,t)),$a[e]&&$a[e].forEach(function(e){Ce(e.name,e.config)}),we(e),Pa[e]}return delete Pa[e],null}function Se(e){var a;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Fa;if(!t(e)){if(a=xe(e),a)return a;e=[e]}return ye(e)}function ke(){return Wt(Pa)}function Ae(e){var t=e._a,a;return t&&-2===u(e).overflow&&(a=0>t[1]||11<t[1]?1:1>t[2]||t[2]>ee(t[0],t[1])?2:0>t[3]||24<t[3]||24===t[3]&&(0!==t[4]||0!==t[5]||0!==t[6])?3:0>t[4]||59<t[4]?4:0>t[5]||59<t[5]?5:0>t[6]||999<t[6]?6:-1,u(e)._overflowDayOfYear&&(0>a||2<a)&&(a=2),u(e)._overflowWeeks&&-1===a&&(a=7),u(e)._overflowWeekday&&-1===a&&(a=8),u(e).overflow=a),e}function Te(e,t,a){return null==e?null==t?a:t:e}function Ee(t){var a=new Date(e.now());return t._useUTC?[a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()]:[a.getFullYear(),a.getMonth(),a.getDate()]}function Me(e){var t=[],a,n,s,o,d;if(!e._d){for(s=Ee(e),e._w&&null==e._a[2]&&null==e._a[1]&&Ie(e),null!=e._dayOfYear&&(d=Te(e._a[0],s[0]),(e._dayOfYear>Y(d)||0===e._dayOfYear)&&(u(e)._overflowDayOfYear=!0),n=oe(d,0,e._dayOfYear),e._a[1]=n.getUTCMonth(),e._a[2]=n.getUTCDate()),a=0;3>a&&null==e._a[a];++a)e._a[a]=t[a]=s[a];for(;7>a;a++)e._a[a]=t[a]=null==e._a[a]?2===a?1:0:e._a[a];24===e._a[3]&&0===e._a[4]&&0===e._a[5]&&0===e._a[6]&&(e._nextDay=!0,e._a[3]=0),e._d=(e._useUTC?oe:se).apply(null,t),o=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[3]=24),e._w&&"undefined"!=typeof e._w.d&&e._w.d!==o&&(u(e).weekdayMismatch=!0)}}function Ie(e){var t,a,i,n,s,o,d,r;if(t=e._w,null!=t.GG||null!=t.W||null!=t.E)s=1,o=4,a=Te(t.GG,e._a[0],ce(We(),1,4).year),i=Te(t.W,1),n=Te(t.E,1),(1>n||7<n)&&(r=!0);else{s=e._locale._week.dow,o=e._locale._week.doy;var c=ce(We(),s,o);a=Te(t.gg,e._a[0],c.year),i=Te(t.w,c.week),null==t.d?null==t.e?n=s:(n=t.e+s,(0>t.e||6<t.e)&&(r=!0)):(n=t.d,(0>n||6<n)&&(r=!0))}1>i||i>le(a,s,o)?u(e)._overflowWeeks=!0:null==r?(d=re(a,i,n,s,o),e._a[0]=d.year,e._dayOfYear=d.dayOfYear):u(e)._overflowWeekday=!0}function Ne(e){var t=e._i,a=ja.exec(t)||Da.exec(t),n,s,o,d,r,c;if(a){for(u(e).iso=!0,n=0,s=Ha.length;n<s;n++)if(Ha[n][1].exec(a[1])){d=Ha[n][0],o=!1!==Ha[n][2];break}if(null==d)return void(e._isValid=!1);if(a[3]){for(n=0,s=Ba.length;n<s;n++)if(Ba[n][1].exec(a[3])){r=(a[2]||" ")+Ba[n][0];break}if(null==r)return void(e._isValid=!1)}if(!o&&null!=r)return void(e._isValid=!1);if(a[4])if(La.exec(a[4]))c="Z";else return void(e._isValid=!1);e._f=d+(r||"")+(c||""),He(e)}else e._isValid=!1}function Re(e,t,a,i,n,s){var o=[Oe(e),Ma.indexOf(t),parseInt(a,10),parseInt(i,10),parseInt(n,10)];return s&&o.push(parseInt(s,10)),o}function Oe(e){var t=parseInt(e,10);return 49>=t?2e3+t:999>=t?1900+t:t}function Pe(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function $e(e,t,a){if(e){var i=Ia.indexOf(e),n=new Date(t[0],t[1],t[2]).getDay();if(i!==n)return u(a).weekdayMismatch=!0,a._isValid=!1,!1}return!0}function je(e,t,a){if(e)return Ua[e];if(t)return 0;var i=parseInt(a,10),n=i%100;return 60*((i-n)/100)+n}function De(e){var t=qa.exec(Pe(e._i));if(t){var a=Re(t[4],t[3],t[2],t[5],t[6],t[7]);if(!$e(t[1],a,e))return;e._a=a,e._tzm=je(t[8],t[9],t[10]),e._d=oe.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),u(e).rfc2822=!0}else e._isValid=!1}function Le(t){var a=Va.exec(t._i);if(null!==a)return void(t._d=new Date(+a[1]));if(Ne(t),!1===t._isValid)delete t._isValid;else return;if(De(t),!1===t._isValid)delete t._isValid;else return;e.createFromInputFallback(t)}function He(t){if(t._f===e.ISO_8601)return void Ne(t);if(t._f===e.RFC_2822)return void De(t);t._a=[],u(t).empty=!0;var a=""+t._i,n=a.length,s=0,o,d,r,c,l;for(r=B(t._f,t._locale).match(Jt)||[],o=0;o<r.length;o++)c=r[o],d=(a.match(q(c,t))||[])[0],d&&(l=a.substr(0,a.indexOf(d)),0<l.length&&u(t).unusedInput.push(l),a=a.slice(a.indexOf(d)+d.length),s+=d.length),ea[c]?(d?u(t).empty=!1:u(t).unusedTokens.push(c),W(c,d,t)):t._strict&&!d&&u(t).unusedTokens.push(c);u(t).charsLeftOver=n-s,0<a.length&&u(t).unusedInput.push(a),12>=t._a[3]&&!0===u(t).bigHour&&0<t._a[3]&&(u(t).bigHour=void 0),u(t).parsedDateParts=t._a.slice(0),u(t).meridiem=t._meridiem,t._a[3]=Be(t._locale,t._a[3],t._meridiem),Me(t),Ae(t)}function Be(e,t,a){var i;return null==a?t:null==e.meridiemHour?null==e.isPM?t:(i=e.isPM(a),i&&12>t&&(t+=12),i||12!==t||(t=0),t):e.meridiemHour(t,a)}function Ve(e){var t,a,n,s,o;if(0===e._f.length)return u(e).invalidFormat=!0,void(e._d=new Date(NaN));for(s=0;s<e._f.length;s++)(o=0,t=h({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[s],He(t),!!m(t))&&(o+=u(t).charsLeftOver,o+=10*u(t).unusedTokens.length,u(t).score=o,(null==n||o<n)&&(n=o,a=t));c(e,a||t)}function qe(e){if(!e._d){var t=N(e._i);e._a=d([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),Me(e)}}function Ue(e){var t=new v(Ae(Fe(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function Fe(e){var a=e._i,i=e._f;return(e._locale=e._locale||Se(e._l),null===a||void 0===i&&""===a)?g({nullInput:!0}):("string"==typeof a&&(e._i=a=e._locale.preparse(a)),f(a))?new v(Ae(a)):(o(a)?e._d=a:t(i)?Ve(e):i?He(e):ze(e),m(e)||(e._d=null),e)}function ze(i){var r=i._i;n(r)?i._d=new Date(e.now()):o(r)?i._d=new Date(r.valueOf()):"string"==typeof r?Le(i):t(r)?(i._a=d(r.slice(0),function(e){return parseInt(e,10)}),Me(i)):a(r)?qe(i):s(r)?i._d=new Date(r):e.createFromInputFallback(i)}function Ge(e,n,s,o,d){var r={};return(!0===s||!1===s)&&(o=s,s=void 0),(a(e)&&i(e)||t(e)&&0===e.length)&&(e=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=d,r._l=s,r._i=e,r._f=n,r._strict=o,Ue(r)}function We(e,t,a,i){return Ge(e,t,a,i,!1)}function Ye(e,a){var n,s;if(1===a.length&&t(a[0])&&(a=a[0]),!a.length)return We();for(n=a[0],s=1;s<a.length;++s)(!a[s].isValid()||a[s][e](n))&&(n=a[s]);return n}function Xe(e){for(var t in e)if(-1===Ta.call(Wa,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var a=!1,n=0;n<Wa.length;++n)if(e[Wa[n]]){if(a)return!1;parseFloat(e[Wa[n]])!==x(e[Wa[n]])&&(a=!0)}return!0}function Qe(e){var t=N(e),a=t.year||0,i=t.quarter||0,n=t.month||0,s=t.week||t.isoWeek||0,o=t.day||0,d=t.hour||0,r=t.minute||0,c=t.second||0,l=t.millisecond||0;this._isValid=Xe(t),this._milliseconds=+l+1e3*c+6e4*r+60*(60*(1e3*d)),this._days=+o+7*s,this._months=+n+3*i+12*a,this._data={},this._locale=Se(),this._bubble()}function Je(e){return e instanceof Qe}function Ke(e){return 0>e?-1*jt(-1*e):jt(e)}function Ze(e,t){j(e,0,0,function(){var e=this.utcOffset(),a="+";return 0>e&&(e=-e,a="-"),a+P(~~(e/60),2)+t+P(~~e%60,2)})}function et(e,t){var a=(t||"").match(e);if(null===a)return null;var i=a[a.length-1]||[],n=(i+"").match(Ya)||["-",0,0],s=+(60*n[1])+x(n[2]);return 0===s?0:"+"===n[0]?s:-s}function tt(t,a){var i,n;return a._isUTC?(i=a.clone(),n=(f(t)||o(t)?t.valueOf():We(t).valueOf())-i.valueOf(),i._d.setTime(i._d.valueOf()+n),e.updateOffset(i,!1),i):We(t).local()}function at(e){return 15*-jt(e._d.getTimezoneOffset()/15)}function it(){return!!this.isValid()&&this._isUTC&&0===this._offset}function nt(e,t){var a=e,i=null,n,o,d;return Je(e)?a={ms:e._milliseconds,d:e._days,M:e._months}:s(e)?(a={},t?a[t]=e:a.milliseconds=e):(i=Xa.exec(e))?(n="-"===i[1]?-1:1,a={y:0,d:x(i[2])*n,h:x(i[3])*n,m:x(i[4])*n,s:x(i[5])*n,ms:x(Ke(1e3*i[6]))*n}):(i=Qa.exec(e))?(n="-"===i[1]?-1:1,a={y:st(i[2],n),M:st(i[3],n),w:st(i[4],n),d:st(i[5],n),h:st(i[6],n),m:st(i[7],n),s:st(i[8],n)}):null==a?a={}:"object"==typeof a&&("from"in a||"to"in a)&&(d=dt(We(a.from),We(a.to)),a={},a.ms=d.milliseconds,a.M=d.months),o=new Qe(a),Je(e)&&r(e,"_locale")&&(o._locale=e._locale),o}function st(e,t){var a=e&&parseFloat(e.replace(",","."));return(isNaN(a)?0:a)*t}function ot(e,t){var a={};return a.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(a.months,"M").isAfter(t)&&--a.months,a.milliseconds=+t-+e.clone().add(a.months,"M"),a}function dt(e,t){var a;return e.isValid()&&t.isValid()?(t=tt(t,e),e.isBefore(t)?a=ot(e,t):(a=ot(t,e),a.milliseconds=-a.milliseconds,a.months=-a.months),a):{milliseconds:0,months:0}}function rt(e,t){return function(a,i){var n,s;return null===i||isNaN(+i)||(k(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),s=a,a=i,i=s),a="string"==typeof a?+a:a,n=nt(a,i),ct(this,n,e),this}}function ct(t,a,i,n){var s=a._milliseconds,o=Ke(a._days),d=Ke(a._months);t.isValid()&&(n=null==n||n,d&&ae(t,J(t,"Month")+d*i),o&&K(t,"Date",J(t,"Date")+o*i),s&&t._d.setTime(t._d.valueOf()+s*i),n&&e.updateOffset(t,o||d))}function lt(e,t){var a=12*(t.year()-e.year())+(t.month()-e.month()),i=e.clone().add(a,"months"),n,s;return 0>t-i?(n=e.clone().add(a-1,"months"),s=(t-i)/(i-n)):(n=e.clone().add(a+1,"months"),s=(t-i)/(n-i)),-(a+s)||0}function pt(e){var t;return void 0===e?this._locale._abbr:(t=Se(e),null!=t&&(this._locale=t),this)}function ut(){return this._locale}function mt(e,t){return(e%t+t)%t}function gt(e,t,a){return 100>e&&0<=e?new Date(e+400,t,a)-12622780800000:new Date(e,t,a).valueOf()}function ht(e,t,a){return 100>e&&0<=e?Date.UTC(e+400,t,a)-12622780800000:Date.UTC(e,t,a)}function vt(e,t){j(0,[e,e.length],0,t)}function ft(e,t,a,i,n){var s;return null==e?ce(this,i,n).year:(s=le(e,i,n),t>s&&(t=s),_t.call(this,e,t,a,i,n))}function _t(e,t,a,i,n){var s=re(e,t,a,i,n),o=oe(s.year,0,s.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}function bt(e,t){t[6]=x(1e3*("0."+e))}function yt(e){return e}function xt(e,t,a,i){var n=Se(),s=l().set(i,t);return n[a](s,e)}function wt(e,t,a){if(s(e)&&(t=e,e=void 0),e=e||"",null!=t)return xt(e,t,a,"month");var n=[],o;for(o=0;12>o;o++)n[o]=xt(e,o,a,"month");return n}function Ct(e,t,a,n){"boolean"==typeof e?(s(t)&&(a=t,t=void 0),t=t||""):(t=e,a=t,e=!1,s(t)&&(a=t,t=void 0),t=t||"");var o=Se(),d=e?o._week.dow:0;if(null!=a)return xt(t,(a+d)%7,n,"day");var r=[],c;for(c=0;7>c;c++)r[c]=xt(t,(c+d)%7,n,"day");return r}function St(e,t,a,i){var n=nt(t,a);return e._milliseconds+=i*n._milliseconds,e._days+=i*n._days,e._months+=i*n._months,e._bubble()}function kt(e){return 0>e?Lt(e):Dt(e)}function At(e){return 4800*e/146097}function Tt(e){return 146097*e/4800}function Et(e){return function(){return this.as(e)}}function Mt(e){return function(){return this.isValid()?this._data[e]:NaN}}function It(e,t,a,i,n){return n.relativeTime(t||1,!!a,e,i)}function Nt(e,t,i){var n=nt(e).abs(),s=Si(n.as("s")),o=Si(n.as("m")),d=Si(n.as("h")),r=Si(n.as("d")),c=Si(n.as("M")),l=Si(n.as("y")),p=s<=ki.ss&&["s",s]||s<ki.s&&["ss",s]||1>=o&&["m"]||o<ki.m&&["mm",o]||1>=d&&["h"]||d<ki.h&&["hh",d]||1>=r&&["d"]||r<ki.d&&["dd",r]||1>=c&&["M"]||c<ki.M&&["MM",c]||1>=l&&["y"]||["yy",l];return p[2]=t,p[3]=0<+e,p[4]=i,It.apply(null,p)}function Rt(e){return void 0===e?Si:"function"==typeof e&&(Si=e,!0)}function Ot(e){return(0<e)-(0>e)||+e}function Pt(){if(!this.isValid())return this.localeData().invalidDate();var e=Ai(this._milliseconds)/1e3,t=Ai(this._days),a=Ai(this._months),i,n,o;i=b(e/60),n=b(i/60),e%=60,i%=60,o=b(a/12),a%=12;var d=o,r=a,c=t,l=n,p=i,u=e?e.toFixed(3).replace(/\.?0+$/,""):"",s=this.asSeconds();if(!s)return"P0D";var m=0>s?"-":"",g=Ot(this._months)===Ot(s)?"":"-",h=Ot(this._days)===Ot(s)?"":"-",v=Ot(this._milliseconds)===Ot(s)?"":"-";return m+"P"+(d?g+d+"Y":"")+(r?g+r+"M":"")+(c?h+c+"D":"")+(l||p||u?"T":"")+(l?v+l+"H":"")+(p?v+p+"M":"")+(u?v+u+"S":"")}var qt,Ut;Ut=Array.prototype.some?Array.prototype.some:function(e){for(var a=Object(this),t=a.length>>>0,n=0;n<t;n++)if(n in a&&e.call(this,a[n],n,a))return!0;return!1};var Ft=e.momentProperties=[],zt=!1,Gt={};e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;var Wt=Object.keys?Object.keys:function(e){var t=[],a;for(a in e)r(e,a)&&t.push(a);return t};var Yt=/\d{1,2}/,Xt={},Qt={},Jt=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Kt=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Zt={},ea={},ta=/\d/,aa=/\d\d/,ia=/\d{3}/,na=/\d{4}/,sa=/[+-]?\d{6}/,oa=/\d\d?/,da=/\d\d\d\d?/,ra=/\d\d\d\d\d\d?/,ca=/\d{1,3}/,la=/\d{1,4}/,pa=/[+-]?\d{1,6}/,ua=/\d+/,ma=/[+-]?\d+/,ga=/Z|[+-]\d\d:?\d\d/gi,ha=/Z|[+-]\d\d(?::?\d\d)?/gi,va=/[+-]?\d+(\.\d{1,3})?/,fa=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,_a={},ba={},ya=0,xa=1,wa=2,Ca=3,Sa=4,ka=5;j("Y",0,0,function(){var e=this.year();return 9999>=e?""+e:"+"+e}),j(0,["YY",2],0,function(){return this.year()%100}),j(0,["YYYY",4],0,"year"),j(0,["YYYYY",5],0,"year"),j(0,["YYYYYY",6,!0],0,"year"),M("year","y"),R("year",1),V("Y",ma),V("YY",oa,aa),V("YYYY",la,na),V("YYYYY",pa,sa),V("YYYYYY",pa,sa),z(["YYYYY","YYYYYY"],ya),z("YYYY",function(t,a){a[ya]=2===t.length?e.parseTwoDigitYear(t):x(t)}),z("YY",function(t,a){a[ya]=e.parseTwoDigitYear(t)}),z("Y",function(e,t){t[ya]=parseInt(e,10)}),e.parseTwoDigitYear=function(e){return x(e)+(68<x(e)?1900:2e3)};var Aa=Q("FullYear",!0),Ta;Ta=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},j("M",["MM",2],"Mo",function(){return this.month()+1}),j("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),j("MMMM",0,0,function(e){return this.localeData().months(this,e)}),M("month","M"),R("month",8),V("M",oa),V("MM",oa,aa),V("MMM",function(e,t){return t.monthsShortRegex(e)}),V("MMMM",function(e,t){return t.monthsRegex(e)}),z(["M","MM"],function(e,t){t[xa]=x(e)-1}),z(["MMM","MMMM"],function(e,t,a,i){var n=a._locale.monthsParse(e,i,a._strict);null==n?u(a).invalidMonth=e:t[xa]=n});var Ea=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Ma=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];j("w",["ww",2],"wo","week"),j("W",["WW",2],"Wo","isoWeek"),M("week","w"),M("isoWeek","W"),R("week",5),R("isoWeek",5),V("w",oa),V("ww",oa,aa),V("W",oa),V("WW",oa,aa),G(["w","ww","W","WW"],function(e,t,a,i){t[i.substr(0,1)]=x(e)});j("d",0,"do","day"),j("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),j("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),j("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),j("e",0,0,"weekday"),j("E",0,0,"isoWeekday"),M("day","d"),M("weekday","e"),M("isoWeekday","E"),R("day",11),R("weekday",11),R("isoWeekday",11),V("d",oa),V("e",oa),V("E",oa),V("dd",function(e,t){return t.weekdaysMinRegex(e)}),V("ddd",function(e,t){return t.weekdaysShortRegex(e)}),V("dddd",function(e,t){return t.weekdaysRegex(e)}),G(["dd","ddd","dddd"],function(e,t,a,i){var n=a._locale.weekdaysParse(e,i,a._strict);null==n?u(a).invalidWeekday=e:t.d=n}),G(["d","e","E"],function(e,t,a,i){t[i]=x(e)});var Ia=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];j("H",["HH",2],0,"hour"),j("h",["hh",2],0,ve),j("k",["kk",2],0,function(){return this.hours()||24}),j("hmm",0,0,function(){return""+ve.apply(this)+P(this.minutes(),2)}),j("hmmss",0,0,function(){return""+ve.apply(this)+P(this.minutes(),2)+P(this.seconds(),2)}),j("Hmm",0,0,function(){return""+this.hours()+P(this.minutes(),2)}),j("Hmmss",0,0,function(){return""+this.hours()+P(this.minutes(),2)+P(this.seconds(),2)}),fe("a",!0),fe("A",!1),M("hour","h"),R("hour",13),V("a",_e),V("A",_e),V("H",oa),V("h",oa),V("k",oa),V("HH",oa,aa),V("hh",oa,aa),V("kk",oa,aa),V("hmm",da),V("hmmss",ra),V("Hmm",da),V("Hmmss",ra),z(["H","HH"],Ca),z(["k","kk"],function(e,t){var a=x(e);t[Ca]=24===a?0:a}),z(["a","A"],function(e,t,a){a._isPm=a._locale.isPM(e),a._meridiem=e}),z(["h","hh"],function(e,t,a){t[Ca]=x(e),u(a).bigHour=!0}),z("hmm",function(e,t,a){var i=e.length-2;t[Ca]=x(e.substr(0,i)),t[Sa]=x(e.substr(i)),u(a).bigHour=!0}),z("hmmss",function(e,t,a){var i=e.length-4,n=e.length-2;t[Ca]=x(e.substr(0,i)),t[Sa]=x(e.substr(i,2)),t[ka]=x(e.substr(n)),u(a).bigHour=!0}),z("Hmm",function(e,t){var a=e.length-2;t[Ca]=x(e.substr(0,a)),t[Sa]=x(e.substr(a))}),z("Hmmss",function(e,t){var a=e.length-4,i=e.length-2;t[Ca]=x(e.substr(0,a)),t[Sa]=x(e.substr(a,2)),t[ka]=x(e.substr(i))});var Na=/[ap]\.?m?\.?/i,Ra=Q("Hours",!0),Oa={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:Yt,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:Ma,week:{dow:0,doy:6},weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekdaysShort:Ia,meridiemParse:Na},Pa={},$a={},ja=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Da=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,La=/Z|[+-]\d\d(?::?\d\d)?/,Ha=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Ba=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Va=/^\/?Date\((\-?\d+)/i,qa=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Ua={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480},Fa;e.createFromInputFallback=S("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),e.ISO_8601=function(){},e.RFC_2822=function(){};var za=S("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=We.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:g()}),Ga=S("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=We.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:g()}),Wa=["year","quarter","month","week","day","hour","minute","second","millisecond"];Ze("Z",":"),Ze("ZZ",""),V("Z",ha),V("ZZ",ha),z(["Z","ZZ"],function(e,t,a){a._useUTC=!0,a._tzm=et(ha,e)});var Ya=/([\+\-]|\d\d)/gi;e.updateOffset=function(){};var Xa=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Qa=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;nt.fn=Qe.prototype,nt.invalid=function(){return nt(NaN)};var Ja=rt(1,"add"),Ka=rt(-1,"subtract");e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Za=S("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});j(0,["gg",2],0,function(){return this.weekYear()%100}),j(0,["GG",2],0,function(){return this.isoWeekYear()%100}),vt("gggg","weekYear"),vt("ggggg","weekYear"),vt("GGGG","isoWeekYear"),vt("GGGGG","isoWeekYear"),M("weekYear","gg"),M("isoWeekYear","GG"),R("weekYear",1),R("isoWeekYear",1),V("G",ma),V("g",ma),V("GG",oa,aa),V("gg",oa,aa),V("GGGG",la,na),V("gggg",la,na),V("GGGGG",pa,sa),V("ggggg",pa,sa),G(["gggg","ggggg","GGGG","GGGGG"],function(e,t,a,i){t[i.substr(0,2)]=x(e)}),G(["gg","GG"],function(t,a,i,n){a[n]=e.parseTwoDigitYear(t)}),j("Q",0,"Qo","quarter"),M("quarter","Q"),R("quarter",7),V("Q",ta),z("Q",function(e,t){t[xa]=3*(x(e)-1)}),j("D",["DD",2],"Do","date"),M("date","D"),R("date",9),V("D",oa),V("DD",oa,aa),V("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),z(["D","DD"],wa),z("Do",function(e,t){t[wa]=x(e.match(oa)[0])});var ei=Q("Date",!0);j("DDD",["DDDD",3],"DDDo","dayOfYear"),M("dayOfYear","DDD"),R("dayOfYear",4),V("DDD",ca),V("DDDD",ia),z(["DDD","DDDD"],function(e,t,a){a._dayOfYear=x(e)}),j("m",["mm",2],0,"minute"),M("minute","m"),R("minute",14),V("m",oa),V("mm",oa,aa),z(["m","mm"],Sa);var ti=Q("Minutes",!1);j("s",["ss",2],0,"second"),M("second","s"),R("second",15),V("s",oa),V("ss",oa,aa),z(["s","ss"],ka);var ai=Q("Seconds",!1);j("S",0,0,function(){return~~(this.millisecond()/100)}),j(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),j(0,["SSS",3],0,"millisecond"),j(0,["SSSS",4],0,function(){return 10*this.millisecond()}),j(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),j(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),j(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),j(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),j(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),M("millisecond","ms"),R("millisecond",16),V("S",ca,ta),V("SS",ca,aa),V("SSS",ca,ia);var ii;for(ii="SSSS";9>=ii.length;ii+="S")V(ii,ua);for(ii="S";9>=ii.length;ii+="S")z(ii,bt);var ni=Q("Milliseconds",!1);j("z",0,0,"zoneAbbr"),j("zz",0,0,"zoneName");var si=v.prototype;si.add=Ja,si.calendar=function(t,a){var i=t||We(),n=tt(i,this).startOf("day"),s=e.calendarFormat(this,n)||"sameElse",o=a&&(A(a[s])?a[s].call(this,i):a[s]);return this.format(o||this.localeData().calendar(s,this,We(i)))},si.clone=function(){return new v(this)},si.diff=function(e,t,a){var i,n,s;return this.isValid()?(i=tt(e,this),!i.isValid())?NaN:(n=6e4*(i.utcOffset()-this.utcOffset()),t=I(t),(s="year"===t?lt(this,i)/12:"month"===t?lt(this,i):"quarter"===t?lt(this,i)/3:"second"===t?(this-i)/1e3:"minute"===t?(this-i)/6e4:"hour"===t?(this-i)/36e5:"day"===t?(this-i-n)/864e5:"week"===t?(this-i-n)/6048e5:this-i,a?s:b(s))):NaN},si.endOf=function(t){var a;if(t=I(t),void 0===t||"millisecond"===t||!this.isValid())return this;var i=this._isUTC?ht:gt;return"year"===t?a=i(this.year()+1,0,1)-1:"quarter"===t?a=i(this.year(),this.month()-this.month()%3+3,1)-1:"month"===t?a=i(this.year(),this.month()+1,1)-1:"week"===t?a=i(this.year(),this.month(),this.date()-this.weekday()+7)-1:"isoWeek"===t?a=i(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1:"day"===t||"date"===t?a=i(this.year(),this.month(),this.date()+1)-1:"hour"===t?(a=this._d.valueOf(),a+=3600000-mt(a+(this._isUTC?0:60000*this.utcOffset()),3600000)-1):"minute"===t?(a=this._d.valueOf(),a+=60000-mt(a,60000)-1):"second"===t?(a=this._d.valueOf(),a+=1000-mt(a,1000)-1):void 0,this._d.setTime(a),e.updateOffset(this,!0),this},si.format=function(t){t||(t=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var a=H(this,t);return this.localeData().postformat(a)},si.from=function(e,t){return this.isValid()&&(f(e)&&e.isValid()||We(e).isValid())?nt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},si.fromNow=function(e){return this.from(We(),e)},si.to=function(e,t){return this.isValid()&&(f(e)&&e.isValid()||We(e).isValid())?nt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},si.toNow=function(e){return this.to(We(),e)},si.get=function(e){return e=I(e),A(this[e])?this[e]():this},si.invalidAt=function(){return u(this).overflow},si.isAfter=function(e,t){var a=f(e)?e:We(e);return!!(this.isValid()&&a.isValid())&&(t=I(t)||"millisecond","millisecond"===t?this.valueOf()>a.valueOf():a.valueOf()<this.clone().startOf(t).valueOf())},si.isBefore=function(e,t){var a=f(e)?e:We(e);return!!(this.isValid()&&a.isValid())&&(t=I(t)||"millisecond","millisecond"===t?this.valueOf()<a.valueOf():this.clone().endOf(t).valueOf()<a.valueOf())},si.isBetween=function(e,t,a,i){var n=f(e)?e:We(e),s=f(t)?t:We(t);return!!(this.isValid()&&n.isValid()&&s.isValid())&&(i=i||"()",("("===i[0]?this.isAfter(n,a):!this.isBefore(n,a))&&(")"===i[1]?this.isBefore(s,a):!this.isAfter(s,a)))},si.isSame=function(e,t){var a=f(e)?e:We(e),i;return!!(this.isValid()&&a.isValid())&&(t=I(t)||"millisecond","millisecond"===t?this.valueOf()===a.valueOf():(i=a.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf()))},si.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},si.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},si.isValid=function(){return m(this)},si.lang=Za,si.locale=pt,si.localeData=ut,si.max=Ga,si.min=za,si.parsingFlags=function(){return c({},u(this))},si.set=function(e,t){if("object"==typeof e){e=N(e);for(var a=O(e),n=0;n<a.length;n++)this[a[n].unit](e[a[n].unit])}else if(e=I(e),A(this[e]))return this[e](t);return this},si.startOf=function(t){var a;if(t=I(t),void 0===t||"millisecond"===t||!this.isValid())return this;var i=this._isUTC?ht:gt;return"year"===t?a=i(this.year(),0,1):"quarter"===t?a=i(this.year(),this.month()-this.month()%3,1):"month"===t?a=i(this.year(),this.month(),1):"week"===t?a=i(this.year(),this.month(),this.date()-this.weekday()):"isoWeek"===t?a=i(this.year(),this.month(),this.date()-(this.isoWeekday()-1)):"day"===t||"date"===t?a=i(this.year(),this.month(),this.date()):"hour"===t?(a=this._d.valueOf(),a-=mt(a+(this._isUTC?0:60000*this.utcOffset()),3600000)):"minute"===t?(a=this._d.valueOf(),a-=mt(a,60000)):"second"===t?(a=this._d.valueOf(),a-=mt(a,1000)):void 0,this._d.setTime(a),e.updateOffset(this,!0),this},si.subtract=Ka,si.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},si.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},si.toDate=function(){return new Date(this.valueOf())},si.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,a=t?this.clone().utc():this;return 0>a.year()||9999<a.year()?H(a,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):A(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+1e3*(60*this.utcOffset())).toISOString().replace("Z",H(a,"Z")):H(a,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},si.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var a="["+e+"(\"]",i=0<=this.year()&&9999>=this.year()?"YYYY":"YYYYYY",n=t+"[\")]";return this.format(a+i+"-MM-DD[T]HH:mm:ss.SSS"+n)},si.toJSON=function(){return this.isValid()?this.toISOString():null},si.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},si.unix=function(){return Lt(this.valueOf()/1e3)},si.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},si.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},si.year=Aa,si.isLeapYear=function(){return X(this.year())},si.weekYear=function(e){return ft.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},si.isoWeekYear=function(e){return ft.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},si.quarter=si.quarters=function(e){return null==e?Dt((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},si.month=ie,si.daysInMonth=function(){return ee(this.year(),this.month())},si.week=si.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},si.isoWeek=si.isoWeeks=function(e){var t=ce(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},si.weeksInYear=function(){var e=this.localeData()._week;return le(this.year(),e.dow,e.doy)},si.isoWeeksInYear=function(){return le(this.year(),1,4)},si.date=ei,si.day=si.days=function(e){if(!this.isValid())return null==e?NaN:this;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==e?t:(e=pe(e,this.localeData()),this.add(e-t,"d"))},si.weekday=function(e){if(!this.isValid())return null==e?NaN:this;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},si.isoWeekday=function(e){if(!this.isValid())return null==e?NaN:this;if(null!=e){var t=ue(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},si.dayOfYear=function(e){var t=jt((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},si.hour=si.hours=Ra,si.minute=si.minutes=ti,si.second=si.seconds=ai,si.millisecond=si.milliseconds=ni,si.utcOffset=function(t,a,i){var n=this._offset||0,s;if(!this.isValid())return null==t?NaN:this;if(null!=t){if("string"!=typeof t)16>$t(t)&&!i&&(t*=60);else if(t=et(ha,t),null===t)return this;return!this._isUTC&&a&&(s=at(this)),this._offset=t,this._isUTC=!0,null!=s&&this.add(s,"m"),n!==t&&(!a||this._changeInProgress?ct(this,nt(t-n,"m"),1,!1):!this._changeInProgress&&(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?n:at(this)},si.utc=function(e){return this.utcOffset(0,e)},si.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(at(this),"m")),this},si.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=et(ga,this._i);null==e?this.utcOffset(0,!0):this.utcOffset(e)}return this},si.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?We(e).utcOffset():0,0==(this.utcOffset()-e)%60)},si.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},si.isLocal=function(){return!!this.isValid()&&!this._isUTC},si.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},si.isUtc=it,si.isUTC=it,si.zoneAbbr=function(){return this._isUTC?"UTC":""},si.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},si.dates=S("dates accessor is deprecated. Use date instead.",ei),si.months=S("months accessor is deprecated. Use month instead",ie),si.years=S("years accessor is deprecated. Use year instead",Aa),si.zone=S("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null==e?-this.utcOffset():("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this)}),si.isDSTShifted=S("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!n(this._isDSTShifted))return this._isDSTShifted;var e={};if(h(e,this),e=Fe(e),e._a){var t=e._isUTC?l(e._a):We(e._a);this._isDSTShifted=this.isValid()&&0<w(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var oi=E.prototype;oi.calendar=function(e,t,a){var i=this._calendar[e]||this._calendar.sameElse;return A(i)?i.call(t,a):i},oi.longDateFormat=function(e){var t=this._longDateFormat[e],a=this._longDateFormat[e.toUpperCase()];return t||!a?t:(this._longDateFormat[e]=a.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},oi.invalidDate=function(){return this._invalidDate},oi.ordinal=function(e){return this._ordinal.replace("%d",e)},oi.preparse=yt,oi.postformat=yt,oi.relativeTime=function(e,t,a,i){var n=this._relativeTime[a];return A(n)?n(e,t,a,i):n.replace(/%d/i,e)},oi.pastFuture=function(e,t){var a=this._relativeTime[0<e?"future":"past"];return A(a)?a(t):a.replace(/%s/i,t)},oi.set=function(e){var t,a;for(a in e)t=e[a],A(t)?this[a]=t:this["_"+a]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},oi.months=function(e,a){return e?t(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Ea).test(a)?"format":"standalone"][e.month()]:t(this._months)?this._months:this._months.standalone},oi.monthsShort=function(e,a){return e?t(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Ea.test(a)?"format":"standalone"][e.month()]:t(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},oi.monthsParse=function(e,t,a){var n,s,o;if(this._monthsParseExact)return te.call(this,e,t,a);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),n=0;12>n;n++){if(s=l([2e3,n]),a&&!this._longMonthsParse[n]&&(this._longMonthsParse[n]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[n]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),a||this._monthsParse[n]||(o="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[n]=new RegExp(o.replace(".",""),"i")),a&&"MMMM"===t&&this._longMonthsParse[n].test(e))return n;if(a&&"MMM"===t&&this._shortMonthsParse[n].test(e))return n;if(!a&&this._monthsParse[n].test(e))return n}},oi.monthsRegex=function(e){return this._monthsParseExact?(r(this,"_monthsRegex")||ne.call(this),e?this._monthsStrictRegex:this._monthsRegex):(r(this,"_monthsRegex")||(this._monthsRegex=fa),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},oi.monthsShortRegex=function(e){return this._monthsParseExact?(r(this,"_monthsRegex")||ne.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(r(this,"_monthsShortRegex")||(this._monthsShortRegex=fa),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},oi.week=function(e){return ce(e,this._week.dow,this._week.doy).week},oi.firstDayOfYear=function(){return this._week.doy},oi.firstDayOfWeek=function(){return this._week.dow},oi.weekdays=function(e,a){var i=t(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(a)?"format":"standalone"];return!0===e?me(i,this._week.dow):e?i[e.day()]:i},oi.weekdaysMin=function(e){return!0===e?me(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},oi.weekdaysShort=function(e){return!0===e?me(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},oi.weekdaysParse=function(e,t,a){var n,s,o;if(this._weekdaysParseExact)return ge.call(this,e,t,a);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),n=0;7>n;n++){if(s=l([2e3,1]).day(n),a&&!this._fullWeekdaysParse[n]&&(this._fullWeekdaysParse[n]=new RegExp("^"+this.weekdays(s,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[n]=new RegExp("^"+this.weekdaysShort(s,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[n]=new RegExp("^"+this.weekdaysMin(s,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[n]||(o="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[n]=new RegExp(o.replace(".",""),"i")),a&&"dddd"===t&&this._fullWeekdaysParse[n].test(e))return n;if(a&&"ddd"===t&&this._shortWeekdaysParse[n].test(e))return n;if(a&&"dd"===t&&this._minWeekdaysParse[n].test(e))return n;if(!a&&this._weekdaysParse[n].test(e))return n}},oi.weekdaysRegex=function(e){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||he.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(r(this,"_weekdaysRegex")||(this._weekdaysRegex=fa),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},oi.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||he.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(r(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=fa),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},oi.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||he.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(r(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=fa),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},oi.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},oi.meridiem=function(e,t,a){return 11<e?a?"pm":"PM":a?"am":"AM"},we("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,a=1===x(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+a}}),e.lang=S("moment.lang is deprecated. Use moment.locale instead.",we),e.langData=S("moment.langData is deprecated. Use moment.localeData instead.",Se);var di=$t,ri=Et("ms"),ci=Et("s"),li=Et("m"),pi=Et("h"),ui=Et("d"),mi=Et("w"),gi=Et("M"),hi=Et("Q"),vi=Et("y"),fi=Mt("milliseconds"),_i=Mt("seconds"),bi=Mt("minutes"),yi=Mt("hours"),xi=Mt("days"),wi=Mt("months"),Ci=Mt("years"),Si=jt,ki={ss:44,s:45,m:45,h:22,d:26,M:11},Ai=$t,Ti=Qe.prototype;return Ti.isValid=function(){return this._isValid},Ti.abs=function(){var e=this._data;return this._milliseconds=di(this._milliseconds),this._days=di(this._days),this._months=di(this._months),e.milliseconds=di(e.milliseconds),e.seconds=di(e.seconds),e.minutes=di(e.minutes),e.hours=di(e.hours),e.months=di(e.months),e.years=di(e.years),this},Ti.add=function(e,t){return St(this,e,t,1)},Ti.subtract=function(e,t){return St(this,e,t,-1)},Ti.as=function(e){if(!this.isValid())return NaN;var t=this._milliseconds,a,i;if(e=I(e),"month"===e||"quarter"===e||"year"===e)switch(a=this._days+t/864e5,i=this._months+At(a),e){case"month":return i;case"quarter":return i/3;case"year":return i/12;}else switch(a=this._days+jt(Tt(this._months)),e){case"week":return a/7+t/6048e5;case"day":return a+t/864e5;case"hour":return 24*a+t/36e5;case"minute":return 1440*a+t/6e4;case"second":return 86400*a+t/1e3;case"millisecond":return Lt(864e5*a)+t;default:throw new Error("Unknown unit "+e);}},Ti.asMilliseconds=ri,Ti.asSeconds=ci,Ti.asMinutes=li,Ti.asHours=pi,Ti.asDays=ui,Ti.asWeeks=mi,Ti.asMonths=gi,Ti.asQuarters=hi,Ti.asYears=vi,Ti.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*x(this._months/12):NaN},Ti._bubble=function(){var e=this._milliseconds,t=this._days,a=this._months,i=this._data,n,s,o,d,r;return 0<=e&&0<=t&&0<=a||0>=e&&0>=t&&0>=a||(e+=864e5*kt(Tt(a)+t),t=0,a=0),i.milliseconds=e%1e3,n=b(e/1e3),i.seconds=n%60,s=b(n/60),i.minutes=s%60,o=b(s/60),i.hours=o%24,t+=b(o/24),r=b(At(t)),a+=r,t-=kt(Tt(r)),d=b(a/12),a%=12,i.days=t,i.months=a,i.years=d,this},Ti.clone=function(){return nt(this)},Ti.get=function(e){return e=I(e),this.isValid()?this[e+"s"]():NaN},Ti.milliseconds=fi,Ti.seconds=_i,Ti.minutes=bi,Ti.hours=yi,Ti.days=xi,Ti.weeks=function(){return b(this.days()/7)},Ti.months=wi,Ti.years=Ci,Ti.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t=this.localeData(),a=Nt(this,!e,t);return e&&(a=t.pastFuture(+this,a)),t.postformat(a)},Ti.toISOString=Pt,Ti.toString=Pt,Ti.toJSON=Pt,Ti.locale=pt,Ti.localeData=ut,Ti.toIsoString=S("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Pt),Ti.lang=Za,j("X",0,0,"unix"),j("x",0,0,"valueOf"),V("x",ma),V("X",va),z("X",function(e,t,a){a._d=new Date(1e3*parseFloat(e,10))}),z("x",function(e,t,a){a._d=new Date(x(e))}),e.version="2.24.0",function(e){qt=e}(We),e.fn=si,e.min=function(){var e=[].slice.call(arguments,0);return Ye("isBefore",e)},e.max=function(){var e=[].slice.call(arguments,0);return Ye("isAfter",e)},e.now=function(){return Date.now?Date.now():+new Date},e.utc=l,e.unix=function(e){return We(1e3*e)},e.months=function(e,t){return wt(e,t,"months")},e.isDate=o,e.locale=we,e.invalid=g,e.duration=nt,e.isMoment=f,e.weekdays=function(e,t,a){return Ct(e,t,a,"weekdays")},e.parseZone=function(){return We.apply(null,arguments).parseZone()},e.localeData=Se,e.isDuration=Je,e.monthsShort=function(e,t){return wt(e,t,"monthsShort")},e.weekdaysMin=function(e,t,a){return Ct(e,t,a,"weekdaysMin")},e.defineLocale=Ce,e.updateLocale=function(e,t){if(null!=t){var a=Oa,i,n;n=xe(e),null!=n&&(a=n._config),t=T(a,t),i=new E(t),i.parentLocale=Pa[e],Pa[e]=i,we(e)}else null!=Pa[e]&&(null==Pa[e].parentLocale?null!=Pa[e]&&delete Pa[e]:Pa[e]=Pa[e].parentLocale);return Pa[e]},e.locales=ke,e.weekdaysShort=function(e,t,a){return Ct(e,t,a,"weekdaysShort")},e.normalizeUnits=I,e.relativeTimeRounding=Rt,e.relativeTimeThreshold=function(e,t){return void 0!==ki[e]&&(void 0===t?ki[e]:(ki[e]=t,"s"===e&&(ki.ss=t-1),!0))},e.calendarFormat=function(e,t){var a=e.diff(t,"days",!0);return-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse"},e.prototype=si,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e}),function(e,t){"function"==typeof define&&define.amd?define("wavesurfer",[],function(){return e.WaveSurfer=t()}):"object"==typeof exports?module.exports=t():e.WaveSurfer=t()}(this,function(){var t=Math.round,a=Math.ceil,n=Math.floor,s=Math.min,o=Math.max,d={defaultParams:{audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,progressColor:"#555",normalize:!1,renderer:"MultiCanvas",scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999"},init:function(e){if(this.params=d.util.extend({},this.defaultParams,e),this.container="string"==typeof e.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(this.mediaContainer=null==this.params.mediaContainer?this.container:"string"==typeof this.params.mediaContainer?document.querySelector(this.params.mediaContainer):this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.tmpEvents=[],this.currentAjax=null,this.createDrawer(),this.createBackend(),this.createPeakCache(),this.isDestroyed=!1},createDrawer:function(){var t=this;this.drawer=Object.create(d.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){t.drawBuffer(),t.drawer.progress(t.backend.getPlayedPercents())}),this.drawer.on("click",function(a,e){setTimeout(function(){t.seekTo(e)},0)}),this.drawer.on("scroll",function(a){t.params.partialRender&&t.drawBuffer(),t.fireEvent("scroll",a)})},createBackend:function(){var e=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||d.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement"),this.backend=Object.create(d[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){e.fireEvent("finish")}),this.backend.on("play",function(){e.fireEvent("play")}),this.backend.on("pause",function(){e.fireEvent("pause")}),this.backend.on("audioprocess",function(t){e.drawer.progress(e.backend.getPlayedPercents()),e.fireEvent("audioprocess",t)})},createPeakCache:function(){this.params.partialRender&&(this.peakCache=Object.create(d.PeakCache),this.peakCache.init())},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(e,t){this.fireEvent("interaction",this.play.bind(this,e,t)),this.backend.play(e,t)},pause:function(){this.backend.isPaused()||this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(e){this.skip(-e||-this.params.skipLength)},skipForward:function(e){this.skip(e||this.params.skipLength)},skip:function(e){var t=this.getCurrentTime()||0,a=this.getDuration()||1;t=o(0,s(a,t+(e||0))),this.seekAndCenter(t/a)},seekAndCenter:function(e){this.seekTo(e),this.drawer.recenter(e)},seekTo:function(e){this.fireEvent("interaction",this.seekTo.bind(this,e));var t=this.backend.isPaused();t||this.backend.pause();var a=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(e*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),t||this.backend.play(),this.params.scrollParent=a,this.fireEvent("seek",e)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(e){this.backend.setVolume(e)},getVolume:function(){return this.backend.getVolume()},setPlaybackRate:function(e){this.backend.setPlaybackRate(e)},getPlaybackRate:function(){return this.backend.getPlaybackRate()},toggleMute:function(){this.setMute(!this.isMuted)},setMute:function(e){e===this.isMuted||(e?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0):(this.backend.setVolume(this.savedVolume),this.isMuted=!1))},getMute:function(){return this.isMuted},getFilters:function(){return this.backend.filters||[]},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var e=t(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),a=this.drawer.getWidth(),n=e,o=this.drawer.getScrollX(),d=s(o+a,n);if(this.params.fillParent&&(!this.params.scrollParent||e<a)&&(n=a,o=0,d=n),this.params.partialRender)for(var r=this.peakCache.addRangeToPeakCache(n,o,d),c=0,l;c<r.length;c++)l=this.backend.getPeaks(n,r[c][0],r[c][1]),this.drawer.drawPeaks(l,n,r[c][0],r[c][1]);else{o=0,d=n;var l=this.backend.getPeaks(n,o,d);this.drawer.drawPeaks(l,n,o,d)}this.fireEvent("redraw",l,n)},zoom:function(e){this.params.minPxPerSec=e,this.params.scrollParent=!0,this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",e)},loadArrayBuffer:function(e){this.decodeArrayBuffer(e,function(e){this.isDestroyed||this.loadDecodedBuffer(e)}.bind(this))},loadDecodedBuffer:function(e){this.backend.load(e),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(e){var t=this,a=new FileReader;a.addEventListener("progress",function(a){t.onProgress(a)}),a.addEventListener("load",function(a){t.loadArrayBuffer(a.target.result)}),a.addEventListener("error",function(){t.fireEvent("error","Error reading file")}),a.readAsArrayBuffer(e),this.empty()},load:function(e,t,a){switch(this.empty(),this.params.backend){case"WebAudio":return this.loadBuffer(e,t);case"MediaElement":return this.loadMediaElement(e,t,a);}},loadBuffer:function(e,t){var a=function(t){return t&&this.tmpEvents.push(this.once("ready",t)),this.getArrayBuffer(e,this.loadArrayBuffer.bind(this))}.bind(this);return t?void(this.backend.setPeaks(t),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",a))):a()},loadMediaElement:function(e,t,a){var i=e;if("string"==typeof e)this.backend.load(i,this.mediaContainer,t,a);else{var n=e;this.backend.loadElt(n,t),i=n.src}this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(e){this.fireEvent("error",e)}.bind(this))),t&&this.backend.setPeaks(t),(!t||this.params.forceDecode)&&this.backend.supportsWebAudio()&&this.getArrayBuffer(i,function(e){this.decodeArrayBuffer(e,function(e){this.backend.buffer=e,this.backend.setPeaks(null),this.drawBuffer(),this.fireEvent("waveform-ready")}.bind(this))}.bind(this))},decodeArrayBuffer:function(e,t){this.arraybuffer=e,this.backend.decodeArrayBuffer(e,function(a){this.isDestroyed||this.arraybuffer!=e||(t(a),this.arraybuffer=null)}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(e,t){var a=this,i=d.util.ajax({url:e,responseType:"arraybuffer"});return this.currentAjax=i,this.tmpEvents.push(i.on("progress",function(t){a.onProgress(t)}),i.on("success",function(e){t(e),a.currentAjax=null}),i.on("error",function(t){a.fireEvent("error","XHR error: "+t.target.statusText),a.currentAjax=null})),i},onProgress:function(a){if(a.lengthComputable)var e=a.loaded/a.total;else e=a.loaded/(a.loaded+1e6);this.fireEvent("loading",t(100*e),a.target)},exportPCM:function(e,a,i){e=e||1024,a=a||1e4,i=i||!1;var n=this.backend.getPeaks(e,a),s=[].map.call(n,function(e){return t(e*a)/a}),o=JSON.stringify(s);return i||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(o)),o},exportImage:function(e,t){return e||(e="image/png"),t||(t=1),this.drawer.getImage(e,t)},cancelAjax:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)},clearTmpEvents:function(){this.tmpEvents.forEach(function(t){t.un()})},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0}};return d.create=function(e){var t=Object.create(d);return t.init(e),t},d.util={extend:function(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){Object.keys(t).forEach(function(a){e[a]=t[a]})}),e},debounce:function(e,t,a){var i=function(){o=null,a||e.apply(s,n)},n,s,o;return function(){s=this,n=arguments;var d=a&&!o;clearTimeout(o),o=setTimeout(i,t),o||(o=setTimeout(i,t)),d&&e.apply(s,n)}},min:function(e){var t=+Infinity;for(var a in e)e[a]<t&&(t=e[a]);return t},max:function(e){var t=-Infinity;for(var a in e)e[a]>t&&(t=e[a]);return t},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(e){var t=Object.create(d.Observer),a=new XMLHttpRequest,i=!1;return a.open(e.method||"GET",e.url,!0),a.responseType=e.responseType||"json",a.addEventListener("progress",function(a){t.fireEvent("progress",a),a.lengthComputable&&a.loaded==a.total&&(i=!0)}),a.addEventListener("load",function(n){i||t.fireEvent("progress",n),t.fireEvent("load",n),200==a.status||206==a.status?t.fireEvent("success",a.response,n):t.fireEvent("error",n)}),a.addEventListener("error",function(a){t.fireEvent("error",a)}),a.send(),t.xhr=a,t}},d.Observer={on:function(e,t){this.handlers||(this.handlers={});var a=this.handlers[e];return a||(a=this.handlers[e]=[]),a.push(t),{name:e,callback:t,un:this.un.bind(this,e,t)}},un:function(e,t){if(this.handlers){var a=this.handlers[e];if(a)if(t)for(var n=a.length-1;0<=n;n--)a[n]==t&&a.splice(n,1);else a.length=0}},unAll:function(){this.handlers=null},once:function(e,t){var a=this,i=function(){t.apply(this,arguments),setTimeout(function(){a.un(e,i)},0)};return this.on(e,i)},fireEvent:function(e){if(this.handlers){var t=this.handlers[e],a=Array.prototype.slice.call(arguments,1);t&&t.forEach(function(e){e.apply(null,a)})}}},d.util.extend(d,d.Observer),d.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!!(window.AudioContext||window.webkitAudioContext)},getAudioContext:function(){return this.ac||(this.ac=new(window.AudioContext||window.webkitAudioContext)),this.ac},getOfflineAudioContext:function(e){return d.WebAudio.offlineAudioContext||(d.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),d.WebAudio.offlineAudioContext},init:function(e){this.params=e,this.ac=e.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states=[Object.create(d.WebAudio.state.playing),Object.create(d.WebAudio.state.paused),Object.create(d.WebAudio.state.finished)],this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(this.PAUSED_STATE),this.setPlaybackRate(this.params.audioRate),this.setLength(0)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(e){e&&e.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(e){this.state!==this.states[e]&&(this.state=this.states[e],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(e){this.disconnectFilters(),e&&e.length&&(this.filters=e,this.analyser.disconnect(),e.reduce(function(e,t){return e.connect(t),t},this.analyser).connect(this.gainNode))},createScriptNode:function(){this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(this.scriptBufferSize):this.ac.createJavaScriptNode(this.scriptBufferSize),this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var e=this;this.scriptNode.onaudioprocess=function(){var t=e.getCurrentTime();t>=e.getDuration()?(e.setState(e.FINISHED_STATE),e.fireEvent("pause")):t>=e.scheduledPause?e.pause():e.state===e.states[e.PLAYING_STATE]&&e.fireEvent("audioprocess",t)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(e){this.gainNode.gain.value=e},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(e,t,a){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(e,function(e){t(e)}.bind(this),a)},setPeaks:function(e){this.peaks=e},setLength:function(e){if(!(this.mergedPeaks&&e==2*this.mergedPeaks.length-1+2)){this.splitPeaks=[],this.mergedPeaks=[];for(var t=this.buffer?this.buffer.numberOfChannels:1,a=0;a<t;a++)this.splitPeaks[a]=[],this.splitPeaks[a][2*(e-1)]=0,this.splitPeaks[a][2*(e-1)+1]=0;this.mergedPeaks[2*(e-1)]=0,this.mergedPeaks[2*(e-1)+1]=0}},getPeaks:function(e,t,a){if(this.peaks)return this.peaks;this.setLength(e);for(var n=this.buffer.length/e,s=this.buffer.numberOfChannels,o=0;o<s;o++)for(var d=this.splitPeaks[o],r=this.buffer.getChannelData(o),l=t;l<=a;l++){for(var p=~~(l*n),u=0,m=0,g=p,h;g<~~(p+n);g+=~~(n/10)||1)h=r[g],h>m&&(m=h),h<u&&(u=h);d[2*l]=m,d[2*l+1]=u,(0==o||m>this.mergedPeaks[2*l])&&(this.mergedPeaks[2*l]=m),(0==o||u<this.mergedPeaks[2*l+1])&&(this.mergedPeaks[2*l+1]=u)}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.audioContext||"function"!=typeof this.ac.close||this.ac.close()},load:function(e){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=e,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(e,t){if(this.buffer)return this.scheduledPause=null,null==e&&(e=this.getCurrentTime(),e>=this.getDuration()&&(e=0)),null==t&&(t=this.getDuration()),this.startPosition=e,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:e,end:t}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(e,t){if(this.buffer){this.createSource();var a=this.seekTo(e,t);e=a.start,t=a.end,this.scheduledPause=t,this.source.start(0,e,t-e),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(this.PLAYING_STATE),this.fireEvent("play")}},pause:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE),this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},getPlaybackRate:function(){return this.playbackRate},setPlaybackRate:function(e){e=e||1,this.isPaused()?this.playbackRate=e:(this.pause(),this.playbackRate=e,this.play())}},d.WebAudio.state={},d.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},d.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition}},d.WebAudio.state.finished={init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},d.util.extend(d.WebAudio,d.Observer),d.MediaElement=Object.create(d.WebAudio),d.util.extend(d.MediaElement,{init:function(e){this.params=e,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=e.mediaType.toLowerCase(),this.elementPosition=e.elementPosition,this.setPlaybackRate(this.params.audioRate),this.createTimer()},createTimer:function(){var e=this,t=function(){if(!e.isPaused()){e.fireEvent("audioprocess",e.getCurrentTime());var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame;a(t)}};this.on("play",t)},load:function(e,t,a,i){var n=this,s=document.createElement(this.mediaType);s.controls=this.params.mediaControls,s.autoplay=this.params.autoplay||!1,s.preload=null==i?"auto":i,s.src=e,s.style.width="100%";var o=t.querySelector(this.mediaType);o&&t.removeChild(o),t.appendChild(s),this._load(s,a)},loadElt:function(e,t){var a=this,i=e;i.controls=this.params.mediaControls,i.autoplay=this.params.autoplay||!1,this._load(i,t)},_load:function(e,t){var a=this;"function"==typeof e.load&&e.load(),e.addEventListener("error",function(){a.fireEvent("error","Error loading media element")}),e.addEventListener("canplay",function(){a.fireEvent("canplay")}),e.addEventListener("ended",function(){a.fireEvent("finish")}),this.media=e,this.peaks=t,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var e=(this.buffer||this.media).duration;return e>=1/0&&(e=this.media.seekable.end(0)),e},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},setPlaybackRate:function(e){this.playbackRate=e||1,this.media.playbackRate=this.playbackRate},seekTo:function(e){null!=e&&(this.media.currentTime=e),this.clearPlayEnd()},play:function(e,t){this.seekTo(e),this.media.play(),t&&this.setPlayEnd(t),this.fireEvent("play")},pause:function(){this.media&&this.media.pause(),this.clearPlayEnd(),this.fireEvent("pause")},setPlayEnd:function(e){var t=this;this.onPlayEnd=function(a){a>=e&&(t.pause(),t.seekTo(e))},this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(e,t,a){return this.buffer?d.WebAudio.getPeaks.call(this,e,t,a):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(e){this.media.volume=e},destroy:function(){this.pause(),this.unAll(),this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),d.AudioElement=d.MediaElement,d.Drawer={init:function(e,t){this.container=e,this.params=t,this.width=0,this.height=t.height*this.params.pixelRatio,this.lastPos=0,this.initDrawer(t),this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(t,e){e||t.preventDefault();var a=t.targetTouches?t.targetTouches[0].clientX:t.clientX,i=this.wrapper.getBoundingClientRect(),n=this.width,s=this.getWidth(),o;return!this.params.fillParent&&n<s?(o=(a-i.left)*this.params.pixelRatio/n||0,1<o&&(o=1)):o=(a-i.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,o},setupWrapperEvents:function(){var t=this;this.wrapper.addEventListener("click",function(a){var e=t.wrapper.offsetHeight-t.wrapper.clientHeight;if(0!=e){var i=t.wrapper.getBoundingClientRect();if(a.clientY>=i.bottom-e)return}t.params.interact&&t.fireEvent("click",a,t.handleEvent(a))}),this.wrapper.addEventListener("scroll",function(a){t.fireEvent("scroll",a)})},drawPeaks:function(e,t,a,i){this.setWidth(t),this.params.barWidth?this.drawBars(e,0,a,i):this.drawWave(e,0,a,i)},style:function(e,t){return Object.keys(t).forEach(function(a){e.style[a]!==t[a]&&(e.style[a]=t[a])}),e},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(e){var t=this.wrapper.scrollWidth*e;this.recenterOnPosition(t,!0)},recenterOnPosition:function(e,t){var a=this.wrapper.scrollLeft,i=~~(this.wrapper.clientWidth/2),n=e-i,d=n-a,r=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=r){if(!t&&-i<=d&&d<i){d=o(-5,s(5,d)),n=a+d}n=o(0,s(r,n)),n!=a&&(this.wrapper.scrollLeft=n)}},getScrollX:function(){return t(this.wrapper.scrollLeft*this.params.pixelRatio)},getWidth:function(){return t(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(e){this.width==e||(this.width=e,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize())},setHeight:function(e){e==this.height||(this.height=e,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(e){var a=1/this.params.pixelRatio,i=t(e*this.width)*a;if(i<this.lastPos||i-this.lastPos>=a){if(this.lastPos=i,this.params.scrollParent&&this.params.autoCenter){var n=~~(this.wrapper.scrollWidth*e);this.recenterOnPosition(n)}this.updateProgress(i)}},destroy:function(){this.unAll(),this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=null)},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){}},d.util.extend(d.Drawer,d.Observer),d.Drawer.Canvas=Object.create(d.Drawer),d.util.extend(d.Drawer.Canvas,{createElements:function(){var e=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:0,top:0,bottom:0}));if(this.waveCc=e.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor){var t=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=t.getContext("2d")}},updateSize:function(){var e=t(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:e+"px"}),this.style(this.progressWave,{display:"block"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:e+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawBars:function(e,a,s,r){var c=this;if(e[0]instanceof Array){var i=e;if(this.params.splitChannels)return this.setHeight(i.length*this.params.height*this.params.pixelRatio),void i.forEach(function(e,t){c.drawBars(e,t,s,r)});e=i[0]}var l=[].some.call(e,function(e){return 0>e}),p=1;l&&(p=2);var u=.5/this.params.pixelRatio,m=this.width,g=this.params.height*this.params.pixelRatio,v=g/2,f=e.length/p,b=this.params.barWidth*this.params.pixelRatio,x=o(this.params.pixelRatio,~~(b/2)),w=1;if(this.params.normalize){var C=d.util.max(e),S=d.util.min(e);w=-S>C?-S:C}var k=f/m;this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(o){if(o)for(var d=s/k;d<r/k;d+=b+x){var c=e[n(d*k*p)]||0,l=t(c/w*v);o.fillRect(d+u,v-l+(g*a||0),b+u,2*l)}},this)},drawWave:function(e,a,n,s){var o=this;if(e[0]instanceof Array){var r=e;if(this.params.splitChannels)return this.setHeight(r.length*this.params.height*this.params.pixelRatio),void r.forEach(function(e,t){o.drawWave(e,t,n,s)});e=r[0]}var c=[].some.call(e,function(e){return 0>e});if(!c){for(var l=[],p=0,u=e.length;p<u;p++)l[2*p]=e[p],l[2*p+1]=-e[p];e=l}var m=.5/this.params.pixelRatio,g=this.params.height*this.params.pixelRatio,v=g*a||0,f=g/2,b=~~(e.length/2),x=1;this.params.fillParent&&this.width!=b&&(x=this.width/b);var w=1;if(this.params.normalize){var C=d.util.max(e),S=d.util.min(e);w=-S>C?-S:C}this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(a){if(a){a.beginPath(),a.moveTo(n*x+m,f+v);for(var o=n,d;o<s;o++)d=t(e[2*o]/w*f),a.lineTo(o*x+m,f-d+v);for(var o=s-1,d;o>=n;o--)d=t(e[2*o+1]/w*f),a.lineTo(o*x+m,f-d+v);a.closePath(),a.fill(),a.fillRect(0,f+v-m,this.width,m)}},this)},updateProgress:function(e){this.style(this.progressWave,{width:e+"px"})},getImage:function(e,t){return this.waveCc.canvas.toDataURL(e,t)}}),d.Drawer.MultiCanvas=Object.create(d.Drawer),d.util.extend(d.Drawer.MultiCanvas,{initDrawer:function(e){if(this.maxCanvasWidth=null==e.maxCanvasWidth?4e3:e.maxCanvasWidth,this.maxCanvasElementWidth=t(this.maxCanvasWidth/this.params.pixelRatio),1>=this.maxCanvasWidth)throw"maxCanvasWidth must be greater than 1.";else if(1==this.maxCanvasWidth%2)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},createElements:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.addCanvas()},updateSize:function(){for(var e=t(this.width/this.params.pixelRatio),n=a(e/this.maxCanvasElementWidth);this.canvases.length<n;)this.addCanvas();for(;this.canvases.length>n;)this.removeCanvas();for(var s in this.canvases){var i=this.maxCanvasWidth+2*a(this.params.pixelRatio/2);s==this.canvases.length-1&&(i=this.width-this.maxCanvasWidth*(this.canvases.length-1)),this.updateDimensions(this.canvases[s],i,this.height),this.clearWaveForEntry(this.canvases[s])}},addCanvas:function(){var e={},t=this.maxCanvasElementWidth*this.canvases.length;e.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:t+"px",top:0,bottom:0})),e.waveCtx=e.wave.getContext("2d"),this.hasProgressCanvas&&(e.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:t+"px",top:0,bottom:0})),e.progressCtx=e.progress.getContext("2d")),this.canvases.push(e)},removeCanvas:function(){var e=this.canvases.pop();e.wave.parentElement.removeChild(e.wave),this.hasProgressCanvas&&e.progress.parentElement.removeChild(e.progress)},updateDimensions:function(e,a,i){var n=t(a/this.params.pixelRatio),s=t(this.width/this.params.pixelRatio);e.start=e.waveCtx.canvas.offsetLeft/s||0,e.end=e.start+n/s,e.waveCtx.canvas.width=a,e.waveCtx.canvas.height=i,this.style(e.waveCtx.canvas,{width:n+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(e.progressCtx.canvas.width=a,e.progressCtx.canvas.height=i,this.style(e.progressCtx.canvas,{width:n+"px"}))},clearWave:function(){for(var e in this.canvases)this.clearWaveForEntry(this.canvases[e])},clearWaveForEntry:function(e){e.waveCtx.clearRect(0,0,e.waveCtx.canvas.width,e.waveCtx.canvas.height),this.hasProgressCanvas&&e.progressCtx.clearRect(0,0,e.progressCtx.canvas.width,e.progressCtx.canvas.height)},drawBars:function(e,a,s,r){var c=this;if(e[0]instanceof Array){var l=e;if(this.params.splitChannels)return this.setHeight(l.length*this.params.height*this.params.pixelRatio),void l.forEach(function(e,t){c.drawBars(e,t,s,r)});e=l[0]}var p=[].some.call(e,function(e){return 0>e}),u=1;p&&(u=2);var m=this.width,g=this.params.height*this.params.pixelRatio,v=g/2,f=e.length/u,b=this.params.barWidth*this.params.pixelRatio,x=o(this.params.pixelRatio,~~(b/2)),w=1;if(this.params.normalize){var C=d.util.max(e),S=d.util.min(e);w=-S>C?-S:C}for(var k=f/m,A=s/k;A<r/k;A+=b+x){var T=e[n(A*k*u)]||0,E=t(T/w*v);this.fillRect(A+this.halfPixel,v-E+(g*a||0),b+this.halfPixel,2*E)}},drawWave:function(e,t,a,n){var s=this;if(e[0]instanceof Array){var o=e;if(this.params.splitChannels)return this.setHeight(o.length*this.params.height*this.params.pixelRatio),void o.forEach(function(e,t){s.drawWave(e,t,a,n)});e=o[0]}var r=[].some.call(e,function(e){return 0>e});if(!r){for(var c=[],l=0,p=e.length;l<p;l++)c[2*l]=e[l],c[2*l+1]=-e[l];e=c}var u=this.params.height*this.params.pixelRatio,m=u*t||0,g=u/2,h=1;if(this.params.normalize){var v=d.util.max(e),f=d.util.min(e);h=-f>v?-f:v}this.drawLine(e,h,g,m,a,n),this.fillRect(0,g+m-this.halfPixel,this.width,this.halfPixel)},drawLine:function(e,t,a,i,n,s){for(var o in this.canvases){var d=this.canvases[o];this.setFillStyles(d),this.drawLineToContext(d,d.waveCtx,e,t,a,i,n,s),this.drawLineToContext(d,d.progressCtx,e,t,a,i,n,s)}},drawLineToContext:function(e,a,n,d,r,c,l,p){if(a){var u=n.length/2,m=1;this.params.fillParent&&this.width!=u&&(m=this.width/u);var g=t(u*e.start),v=t(u*e.end);if(!(g>p||v<l)){var f=o(g,l),b=s(v,p);a.beginPath(),a.moveTo((f-g)*m+this.halfPixel,r+c);for(var x=f;x<b;x++){var w=n[2*x]||0,C=t(w/d*r);a.lineTo((x-g)*m+this.halfPixel,r-C+c)}for(var x=b-1;x>=f;x--){var w=n[2*x+1]||0,C=t(w/d*r);a.lineTo((x-g)*m+this.halfPixel,r-C+c)}a.closePath(),a.fill()}}},fillRect:function(e,t,d,r){for(var c=n(e/this.maxCanvasWidth),l=s(a((e+d)/this.maxCanvasWidth)+1,this.canvases.length),p=c;p<l;p++){var u=this.canvases[p],m=p*this.maxCanvasWidth,g={x1:o(e,p*this.maxCanvasWidth),y1:t,x2:s(e+d,p*this.maxCanvasWidth+u.waveCtx.canvas.width),y2:t+r};g.x1<g.x2&&(this.setFillStyles(u),this.fillRectToContext(u.waveCtx,g.x1-m,g.y1,g.x2-g.x1,g.y2-g.y1),this.fillRectToContext(u.progressCtx,g.x1-m,g.y1,g.x2-g.x1,g.y2-g.y1))}},fillRectToContext:function(e,t,a,i,n){e&&e.fillRect(t,a,i,n)},setFillStyles:function(e){e.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(e.progressCtx.fillStyle=this.params.progressColor)},updateProgress:function(e){this.style(this.progressWave,{width:e+"px"})}}),d.PeakCache={init:function(){this.clearPeakCache()},clearPeakCache:function(){this.peakCacheRanges=[],this.peakCacheLength=-1},addRangeToPeakCache:function(e,t,a){e!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=e);for(var n=[],s=0;s<this.peakCacheRanges.length&&this.peakCacheRanges[s]<t;)s++;for(0==s%2&&n.push(t);s<this.peakCacheRanges.length&&this.peakCacheRanges[s]<=a;)n.push(this.peakCacheRanges[s]),s++;0==s%2&&n.push(a),n=n.filter(function(e,t,a){return 0==t?e!=a[t+1]:t==a.length-1?e!=a[t-1]:e!=a[t-1]&&e!=a[t+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(n),this.peakCacheRanges=this.peakCacheRanges.sort(function(e,t){return e-t}).filter(function(e,t,a){return 0==t?e!=a[t+1]:t==a.length-1?e!=a[t-1]:e!=a[t-1]&&e!=a[t+1]});var o=[];for(s=0;s<n.length;s+=2)o.push([n[s],n[s+1]]);return o},getCacheRanges:function(){for(var e=[],t=0;t<this.peakCacheRanges.length;t+=2)e.push([this.peakCacheRanges[t],this.peakCacheRanges[t+1]]);return e}},function(){var e=function(){var e=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(e,function(e){var t=d.util.extend({container:e,backend:"MediaElement",mediaControls:!0},e.dataset);e.style.display="block";var a=d.create(t);if(e.dataset.peaks)var i=JSON.parse(e.dataset.peaks);a.load(e.dataset.url,i)})};"complete"===document.readyState?e():window.addEventListener("load",e)}(),d}),function(e){function t(e){return i?i[e]:(i=require("unicode/category/So"),n=["sign","cross","of","symbol","staff","hand","black","white"].map(function(e){return new RegExp(e,"gi")}),i[e])}function a(e,s){e=e.toString(),"string"==typeof s&&(s={replacement:s}),s=s||{},s.mode=s.mode||a.defaults.mode;for(var o=a.defaults.modes[s.mode],d=["replacement","multicharmap","charmap","remove","lower"],r=0,c=d.length,p;r<c;r++)p=d[r],s[p]=p in s?s[p]:o[p];"undefined"==typeof s.symbols&&(s.symbols=o.symbols);var u=[];for(var p in s.multicharmap)if(s.multicharmap.hasOwnProperty(p)){var m=p.length;-1===u.indexOf(m)&&u.push(m)}for(var g="",r=0,c=e.length,h,v,f;r<c;r++){if(f=e[r],!u.some(function(t){var a=e.substr(r,t);return!!s.multicharmap[a]&&(r+=t-1,f=s.multicharmap[a],!0)})&&(s.charmap[f]?(f=s.charmap[f],h=f.charCodeAt(0)):h=e.charCodeAt(r),s.symbols&&(v=t(h)))){f=v.name.toLowerCase();for(var b=0,x=n.length;b<x;b++)f=f.replace(n[b],"");f=f.trim()}f=f.replace(/[^\w\s\-\.\_~]/g,""),s.remove&&(f=f.replace(s.remove,"")),g+=f}return g=g.trim(),g=g.replace(/[-\s]+/g,s.replacement),g=g.replace(s.replacement+"$",""),s.lower&&(g=g.toLowerCase()),g}var i,n;if(a.defaults={mode:"pretty"},a.multicharmap=a.defaults.multicharmap={"<3":"love","&&":"and","||":"or","w/":"with"},a.charmap=a.defaults.charmap={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Æ:"AE",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ő:"O",Ø:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ű:"U",Ý:"Y",Þ:"TH",ß:"ss",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",æ:"ae",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ð:"d",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ő:"o",ø:"o",ù:"u",ú:"u",û:"u",ü:"u",ű:"u",ý:"y",þ:"th",ÿ:"y",ẞ:"SS",α:"a",β:"b",γ:"g",δ:"d",ε:"e",ζ:"z",η:"h",θ:"8",ι:"i",κ:"k",λ:"l",μ:"m",ν:"n",ξ:"3",ο:"o",π:"p",ρ:"r",σ:"s",τ:"t",υ:"y",φ:"f",χ:"x",ψ:"ps",ω:"w",ά:"a",έ:"e",ί:"i",ό:"o",ύ:"y",ή:"h",ώ:"w",ς:"s",ϊ:"i",ΰ:"y",ϋ:"y",ΐ:"i",Α:"A",Β:"B",Γ:"G",Δ:"D",Ε:"E",Ζ:"Z",Η:"H",Θ:"8",Ι:"I",Κ:"K",Λ:"L",Μ:"M",Ν:"N",Ξ:"3",Ο:"O",Π:"P",Ρ:"R",Σ:"S",Τ:"T",Υ:"Y",Φ:"F",Χ:"X",Ψ:"PS",Ω:"W",Ά:"A",Έ:"E",Ί:"I",Ό:"O",Ύ:"Y",Ή:"H",Ώ:"W",Ϊ:"I",Ϋ:"Y",ş:"s",Ş:"S",ı:"i",İ:"I",ğ:"g",Ğ:"G",а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"yo",ж:"zh",з:"z",и:"i",й:"j",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"h",ц:"c",ч:"ch",ш:"sh",щ:"sh",ъ:"u",ы:"y",ь:"",э:"e",ю:"yu",я:"ya",А:"A",Б:"B",В:"V",Г:"G",Д:"D",Е:"E",Ё:"Yo",Ж:"Zh",З:"Z",И:"I",Й:"J",К:"K",Л:"L",М:"M",Н:"N",О:"O",П:"P",Р:"R",С:"S",Т:"T",У:"U",Ф:"F",Х:"H",Ц:"C",Ч:"Ch",Ш:"Sh",Щ:"Sh",Ъ:"U",Ы:"Y",Ь:"",Э:"E",Ю:"Yu",Я:"Ya",Є:"Ye",І:"I",Ї:"Yi",Ґ:"G",є:"ye",і:"i",ї:"yi",ґ:"g",č:"c",ď:"d",ě:"e",ň:"n",ř:"r",š:"s",ť:"t",ů:"u",ž:"z",Č:"C",Ď:"D",Ě:"E",Ň:"N",Ř:"R",Š:"S",Ť:"T",Ů:"U",Ž:"Z",ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ś:"S",Ź:"Z",Ż:"Z",ā:"a",ē:"e",ģ:"g",ī:"i",ķ:"k",ļ:"l",ņ:"n",ū:"u",Ā:"A",Ē:"E",Ģ:"G",Ī:"I",Ķ:"K",Ļ:"L",Ņ:"N",Ū:"U",أ:"a",ب:"b",ت:"t",ث:"th",ج:"g",ح:"h",خ:"kh",د:"d",ذ:"th",ر:"r",ز:"z",س:"s",ش:"sh",ص:"s",ض:"d",ط:"t",ظ:"th",ع:"aa",غ:"gh",ف:"f",ق:"k",ك:"k",ل:"l",م:"m",ن:"n",ه:"h",و:"o",ي:"y",ė:"e",į:"i",ų:"u",Ė:"E",Į:"I",Ų:"U",ț:"t",Ț:"T",ţ:"t",Ţ:"T",ș:"s",Ș:"S",ă:"a",Ă:"A",Ạ:"A",Ả:"A",Ầ:"A",Ấ:"A",Ậ:"A",Ẩ:"A",Ẫ:"A",Ằ:"A",Ắ:"A",Ặ:"A",Ẳ:"A",Ẵ:"A",Ẹ:"E",Ẻ:"E",Ẽ:"E",Ề:"E",Ế:"E",Ệ:"E",Ể:"E",Ễ:"E",Ị:"I",Ỉ:"I",Ĩ:"I",Ọ:"O",Ỏ:"O",Ồ:"O",Ố:"O",Ộ:"O",Ổ:"O",Ỗ:"O",Ơ:"O",Ờ:"O",Ớ:"O",Ợ:"O",Ở:"O",Ỡ:"O",Ụ:"U",Ủ:"U",Ũ:"U",Ư:"U",Ừ:"U",Ứ:"U",Ự:"U",Ử:"U",Ữ:"U",Ỳ:"Y",Ỵ:"Y",Ỷ:"Y",Ỹ:"Y",Đ:"D",ạ:"a",ả:"a",ầ:"a",ấ:"a",ậ:"a",ẩ:"a",ẫ:"a",ằ:"a",ắ:"a",ặ:"a",ẳ:"a",ẵ:"a",ẹ:"e",ẻ:"e",ẽ:"e",ề:"e",ế:"e",ệ:"e",ể:"e",ễ:"e",ị:"i",ỉ:"i",ĩ:"i",ọ:"o",ỏ:"o",ồ:"o",ố:"o",ộ:"o",ổ:"o",ỗ:"o",ơ:"o",ờ:"o",ớ:"o",ợ:"o",ở:"o",ỡ:"o",ụ:"u",ủ:"u",ũ:"u",ư:"u",ừ:"u",ứ:"u",ự:"u",ử:"u",ữ:"u",ỳ:"y",ỵ:"y",ỷ:"y",ỹ:"y",đ:"d","€":"euro","₢":"cruzeiro","₣":"french franc","£":"pound","₤":"lira","₥":"mill","₦":"naira","₧":"peseta","₨":"rupee","₩":"won","₪":"new shequel","₫":"dong","₭":"kip","₮":"tugrik","₯":"drachma","₰":"penny","₱":"peso","₲":"guarani","₳":"austral","₴":"hryvnia","₵":"cedi","¢":"cent","¥":"yen",元:"yuan",円:"yen","﷼":"rial","₠":"ecu","¤":"currency","฿":"baht",$:"dollar","₹":"indian rupee","©":"(c)",œ:"oe",Œ:"OE","∑":"sum","®":"(r)","†":"+","“":"\"","”":"\"","‘":"'","’":"'","∂":"d",ƒ:"f","™":"tm","℠":"sm","…":"...","˚":"o",º:"o",ª:"a","•":"*","∆":"delta","∞":"infinity","♥":"love","&":"and","|":"or","<":"less",">":"greater"},a.defaults.modes={rfc3986:{replacement:"-",symbols:!0,remove:null,lower:!0,charmap:a.defaults.charmap,multicharmap:a.defaults.multicharmap},pretty:{replacement:"-",symbols:!0,remove:/[.]/g,lower:!1,charmap:a.defaults.charmap,multicharmap:a.defaults.multicharmap}},"undefined"!=typeof define&&define.amd){for(var s in a.defaults.modes)a.defaults.modes.hasOwnProperty(s)&&(a.defaults.modes[s].symbols=!1);define("slug",[],function(){return a})}else if("undefined"!=typeof module&&module.exports)t(),module.exports=a;else{for(var s in a.defaults.modes)a.defaults.modes.hasOwnProperty(s)&&(a.defaults.modes[s].symbols=!1);e.slug=a}}(this);(function(e){"function"==typeof define&&define.amd?define("magnific-popup",["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery||window.Zepto)})(function(t){var e=Math.min,a=function(){},i=!!window.jQuery,o=t(window),d=function(e,t){m.ev.on("mfp"+e+".mfp",t)},r=function(e,a,i,n){var s=document.createElement("div");return s.className="mfp-"+e,i&&(s.innerHTML=i),n?a&&a.appendChild(s):(s=t(s),a&&s.appendTo(a)),s},c=function(a,i){m.ev.triggerHandler("mfp"+a,i),m.st.callbacks&&(a=a.charAt(0).toLowerCase()+a.slice(1),m.st.callbacks[a]&&m.st.callbacks[a].apply(m,t.isArray(i)?i:[i]))},l=function(e){return e===b&&m.currTemplate.closeBtn||(m.currTemplate.closeBtn=t(m.st.closeMarkup.replace("%title%",m.st.tClose)),b=e),m.currTemplate.closeBtn},p=function(){t.magnificPopup.instance||(m=new a,m.init(),t.magnificPopup.instance=m)},u=function(){var e=document.createElement("p").style,t=["ms","O","Moz","Webkit"];if(void 0!==e.transition)return!0;for(;t.length;)if(t.pop()+"Transition"in e)return!0;return!1},m,g,h,v,f,b;a.prototype={constructor:a,init:function(){var e=navigator.appVersion;m.isLowIE=m.isIE8=document.all&&!document.addEventListener,m.isAndroid=/android/gi.test(e),m.isIOS=/iphone|ipad|ipod/gi.test(e),m.supportsTransition=u(),m.probablyMobile=m.isAndroid||m.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent),h=t(document),m.popupsCache={}},open:function(e){var a;if(!1===e.isObj){m.items=e.items.toArray(),m.index=0;var p=e.items,u;for(a=0;a<p.length;a++)if(u=p[a],u.parsed&&(u=u.el[0]),u===e.el[0]){m.index=a;break}}else m.items=t.isArray(e.items)?e.items:[e.items],m.index=e.index||0;if(m.isOpen)return void m.updateItemHTML();m.types=[],f="",m.ev=e.mainEl&&e.mainEl.length?e.mainEl.eq(0):h,e.key?(!m.popupsCache[e.key]&&(m.popupsCache[e.key]={}),m.currTemplate=m.popupsCache[e.key]):m.currTemplate={},m.st=t.extend(!0,{},t.magnificPopup.defaults,e),m.fixedContentPos="auto"===m.st.fixedContentPos?!m.probablyMobile:m.st.fixedContentPos,m.st.modal&&(m.st.closeOnContentClick=!1,m.st.closeOnBgClick=!1,m.st.showCloseBtn=!1,m.st.enableEscapeKey=!1),m.bgOverlay||(m.bgOverlay=r("bg").on("click.mfp",function(){m.close()}),m.wrap=r("wrap").attr("tabindex",-1).on("click.mfp",function(t){m._checkIfClose(t.target)&&m.close()}),m.container=r("container",m.wrap)),m.contentContainer=r("content"),m.st.preloader&&(m.preloader=r("preloader",m.container,m.st.tLoading));var g=t.magnificPopup.modules;for(a=0;a<g.length;a++){var v=g[a];v=v.charAt(0).toUpperCase()+v.slice(1),m["init"+v].call(m)}c("BeforeOpen"),m.st.showCloseBtn&&(m.st.closeBtnInside?(d("MarkupParse",function(t,e,a,i){a.close_replaceWith=l(i.type)}),f+=" mfp-close-btn-in"):m.wrap.append(l())),m.st.alignTop&&(f+=" mfp-align-top"),m.fixedContentPos?m.wrap.css({overflow:m.st.overflowY,overflowX:"hidden",overflowY:m.st.overflowY}):m.wrap.css({top:o.scrollTop(),position:"absolute"}),!1!==m.st.fixedBgPos&&("auto"!==m.st.fixedBgPos||m.fixedContentPos)||m.bgOverlay.css({height:h.height(),position:"absolute"}),m.st.enableEscapeKey&&h.on("keyup.mfp",function(t){27===t.keyCode&&m.close()}),o.on("resize.mfp",function(){m.updateSize()}),m.st.closeOnContentClick||(f+=" mfp-auto-cursor"),f&&m.wrap.addClass(f);var b=m.wH=o.height(),x={};if(m.fixedContentPos&&m._hasScrollBar(b)){var w=m._getScrollbarSize();w&&(x.marginRight=w)}m.fixedContentPos&&(m.isIE7?t("body, html").css("overflow","hidden"):x.overflow="hidden");var s=m.st.mainClass;return m.isIE7&&(s+=" mfp-ie7"),s&&m._addClassToMFP(s),m.updateItemHTML(),c("BuildControls"),t("html").css(x),m.bgOverlay.add(m.wrap).prependTo(m.st.prependTo||t(document.body)),m._lastFocusedEl=document.activeElement,setTimeout(function(){m.content?(m._addClassToMFP("mfp-ready"),m._setFocus()):m.bgOverlay.addClass("mfp-ready"),h.on("focusin.mfp",m._onFocusIn)},16),m.isOpen=!0,m.updateSize(b),c("Open"),e},close:function(){m.isOpen&&(c("BeforeClose"),m.isOpen=!1,m.st.removalDelay&&!m.isLowIE&&m.supportsTransition?(m._addClassToMFP("mfp-removing"),setTimeout(function(){m._close()},m.st.removalDelay)):m._close())},_close:function(){c("Close");var e="mfp-removing mfp-ready ";if(m.bgOverlay.detach(),m.wrap.detach(),m.container.empty(),m.st.mainClass&&(e+=m.st.mainClass+" "),m._removeClassFromMFP(e),m.fixedContentPos){var a={marginRight:""};m.isIE7?t("body, html").css("overflow",""):a.overflow="",t("html").css(a)}h.off("keyup.mfp focusin.mfp"),m.ev.off(".mfp"),m.wrap.attr("class","mfp-wrap").removeAttr("style"),m.bgOverlay.attr("class","mfp-bg"),m.container.attr("class","mfp-container"),m.st.showCloseBtn&&(!m.st.closeBtnInside||!0===m.currTemplate[m.currItem.type])&&m.currTemplate.closeBtn&&m.currTemplate.closeBtn.detach(),m.st.autoFocusLast&&m._lastFocusedEl&&t(m._lastFocusedEl).focus(),m.currItem=null,m.content=null,m.currTemplate=null,m.prevHeight=0,c("AfterClose")},updateSize:function(e){if(m.isIOS){var t=document.documentElement.clientWidth/window.innerWidth,a=window.innerHeight*t;m.wrap.css("height",a),m.wH=a}else m.wH=e||o.height();m.fixedContentPos||m.wrap.css("height",m.wH),c("Resize")},updateItemHTML:function(){var e=m.items[m.index];m.contentContainer.detach(),m.content&&m.content.detach(),e.parsed||(e=m.parseEl(m.index));var a=e.type;if(c("BeforeChange",[m.currItem?m.currItem.type:"",a]),m.currItem=e,!m.currTemplate[a]){var i=!!m.st[a]&&m.st[a].markup;c("FirstMarkupParse",i),m.currTemplate[a]=!i||t(i)}v&&v!==e.type&&m.container.removeClass("mfp-"+v+"-holder");var n=m["get"+a.charAt(0).toUpperCase()+a.slice(1)](e,m.currTemplate[a]);m.appendContent(n,a),e.preloaded=!0,c("Change",e),v=e.type,m.container.prepend(m.contentContainer),c("AfterChange")},appendContent:function(e,t){m.content=e,e?m.st.showCloseBtn&&m.st.closeBtnInside&&!0===m.currTemplate[t]?!m.content.find(".mfp-close").length&&m.content.append(l()):m.content=e:m.content="",c("BeforeAppend"),m.container.addClass("mfp-"+t+"-holder"),m.contentContainer.append(m.content)},parseEl:function(e){var a=m.items[e],n;if(a.tagName?a={el:t(a)}:(n=a.type,a={data:a,src:a.src}),a.el){for(var s=m.types,o=0;o<s.length;o++)if(a.el.hasClass("mfp-"+s[o])){n=s[o];break}a.src=a.el.attr("data-mfp-src"),a.src||(a.src=a.el.attr("href"))}return a.type=n||m.st.type||"inline",a.index=e,a.parsed=!0,m.items[e]=a,c("ElementParse",a),m.items[e]},addGroup:function(t,a){var i=function(i){i.mfpEl=this,m._openClick(i,t,a)};a||(a={});a.mainEl=t,a.items?(a.isObj=!0,t.off("click.magnificPopup").on("click.magnificPopup",i)):(a.isObj=!1,a.delegate?t.off("click.magnificPopup").on("click.magnificPopup",a.delegate,i):(a.items=t,t.off("click.magnificPopup").on("click.magnificPopup",i)))},_openClick:function(a,e,i){var n=i.midClick===void 0?t.magnificPopup.defaults.midClick:i.midClick;if(!(!n&&(2===a.which||a.ctrlKey||a.metaKey||a.altKey||a.shiftKey))){var s=void 0===i.disableOn?t.magnificPopup.defaults.disableOn:i.disableOn;if(s)if(t.isFunction(s)){if(!s.call(m))return!0;}else if(o.width()<s)return!0;a.type&&(a.preventDefault(),m.isOpen&&a.stopPropagation()),i.el=t(a.mfpEl),i.delegate&&(i.items=e.find(i.delegate)),m.open(i)}},updateStatus:function(e,t){if(m.preloader){g!==e&&m.container.removeClass("mfp-s-"+g),t||"loading"!==e||(t=m.st.tLoading);var a={status:e,text:t};c("UpdateStatus",a),e=a.status,t=a.text,m.preloader.html(t),m.preloader.find("a").on("click",function(t){t.stopImmediatePropagation()}),m.container.addClass("mfp-s-"+e),g=e}},_checkIfClose:function(e){if(!t(e).hasClass("mfp-prevent-close")){var a=m.st.closeOnContentClick,i=m.st.closeOnBgClick;if(a&&i)return!0;if(!m.content||t(e).hasClass("mfp-close")||m.preloader&&e===m.preloader[0])return!0;if(e!==m.content[0]&&!t.contains(m.content[0],e)){if(i&&t.contains(document,e))return!0;}else if(a)return!0;return!1}},_addClassToMFP:function(e){m.bgOverlay.addClass(e),m.wrap.addClass(e)},_removeClassFromMFP:function(e){this.bgOverlay.removeClass(e),m.wrap.removeClass(e)},_hasScrollBar:function(e){return(m.isIE7?h.height():document.body.scrollHeight)>(e||o.height())},_setFocus:function(){(m.st.focus?m.content.find(m.st.focus).eq(0):m.wrap).focus()},_onFocusIn:function(a){if(a.target!==m.wrap[0]&&!t.contains(m.wrap[0],a.target))return m._setFocus(),!1},_parseMarkup:function(e,a,i){var n;i.data&&(a=t.extend(i.data,a)),c("MarkupParse",[e,a,i]),t.each(a,function(a,i){if(void 0===i||!1===i)return!0;if(n=a.split("_"),1<n.length){var s=e.find(".mfp-"+n[0]);if(0<s.length){var o=n[1];"replaceWith"===o?s[0]!==i[0]&&s.replaceWith(i):"img"===o?s.is("img")?s.attr("src",i):s.replaceWith(t("<img>").attr("src",i).attr("class",s.attr("class"))):s.attr(n[1],i)}}else e.find(".mfp-"+a).html(i)})},_getScrollbarSize:function(){if(m.scrollbarSize===void 0){var e=document.createElement("div");e.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(e),m.scrollbarSize=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return m.scrollbarSize}},t.magnificPopup={instance:null,proto:a.prototype,modules:[],open:function(e,a){return p(),e=e?t.extend(!0,{},e):{},e.isObj=!0,e.index=a||0,this.instance.open(e)},close:function(){return t.magnificPopup.instance&&t.magnificPopup.instance.close()},registerModule:function(e,a){a.options&&(t.magnificPopup.defaults[e]=a.options),t.extend(this.proto,a.proto),this.modules.push(e)},defaults:{disableOn:0,key:null,midClick:!1,mainClass:"",preloader:!0,focus:"",closeOnContentClick:!1,closeOnBgClick:!0,closeBtnInside:!0,showCloseBtn:!0,enableEscapeKey:!0,modal:!1,alignTop:!1,removalDelay:0,prependTo:null,fixedContentPos:"auto",fixedBgPos:"auto",overflowY:"auto",closeMarkup:"<button title=\"%title%\" type=\"button\" class=\"mfp-close\">&#215;</button>",tClose:"Close (Esc)",tLoading:"Loading...",autoFocusLast:!0}},t.fn.magnificPopup=function(e){p();var a=t(this);if(!("string"==typeof e))e=t.extend(!0,{},e),i?a.data("magnificPopup",e):a[0].magnificPopup=e,m.addGroup(a,e);else if("open"===e){var n=i?a.data("magnificPopup"):a[0].magnificPopup,s=parseInt(arguments[1],10)||0,o;n.items?o=n.items[s]:(o=a,n.delegate&&(o=o.find(n.delegate)),o=o.eq(s)),m._openClick({mfpEl:o},a,n)}else m.isOpen&&m[e].apply(m,Array.prototype.slice.call(arguments,1));return a};var x=function(){S&&(C.after(S.addClass(w)).detach(),S=null)},w,C,S;t.magnificPopup.registerModule("inline",{options:{hiddenClass:"hide",markup:"",tNotFound:"Content not found"},proto:{initInline:function(){m.types.push("inline"),d("Close.inline",function(){x()})},getInline:function(e,a){if(x(),e.src){var i=m.st.inline,n=t(e.src);if(n.length){var s=n[0].parentNode;s&&s.tagName&&(!C&&(w=i.hiddenClass,C=r(w),w="mfp-"+w),S=n.after(C).detach().removeClass(w)),m.updateStatus("ready")}else m.updateStatus("error",i.tNotFound),n=t("<div>");return e.inlineElement=n,n}return m.updateStatus("ready"),m._parseMarkup(a,{},e),a}}});var k=function(){T&&t(document.body).removeClass(T)},A=function(){k(),m.req&&m.req.abort()},T;t.magnificPopup.registerModule("ajax",{options:{settings:null,cursor:"mfp-ajax-cur",tError:"<a href=\"%url%\">The content</a> could not be loaded."},proto:{initAjax:function(){m.types.push("ajax"),T=m.st.ajax.cursor,d("Close.ajax",A),d("BeforeChange.ajax",A)},getAjax:function(e){T&&t(document.body).addClass(T),m.updateStatus("loading");var a=t.extend({url:e.src,success:function(a,i,n){var s={data:a,xhr:n};c("ParseAjax",s),m.appendContent(t(s.data),"ajax"),e.finished=!0,k(),m._setFocus(),setTimeout(function(){m.wrap.addClass("mfp-ready")},16),m.updateStatus("ready"),c("AjaxContentAdded")},error:function(){k(),e.finished=e.loadError=!0,m.updateStatus("error",m.st.ajax.tError.replace("%url%",e.src))}},m.st.ajax.settings);return m.req=t.ajax(a),""}}});var E=function(e){if(e.data&&e.data.title!==void 0)return e.data.title;var a=m.st.image.titleSrc;if(a){if(t.isFunction(a))return a.call(m,e);if(e.el)return e.el.attr(a)||""}return""},M;t.magnificPopup.registerModule("image",{options:{markup:"<div class=\"mfp-figure\"><div class=\"mfp-close\"></div><figure><div class=\"mfp-img\"></div><figcaption><div class=\"mfp-bottom-bar\"><div class=\"mfp-title\"></div><div class=\"mfp-counter\"></div></div></figcaption></figure></div>",cursor:"mfp-zoom-out-cur",titleSrc:"title",verticalFit:!0,tError:"<a href=\"%url%\">The image</a> could not be loaded."},proto:{initImage:function(){var e=m.st.image;m.types.push("image"),d("Open.image",function(){"image"===m.currItem.type&&e.cursor&&t(document.body).addClass(e.cursor)}),d("Close.image",function(){e.cursor&&t(document.body).removeClass(e.cursor),o.off("resize.mfp")}),d("Resize.image",m.resizeImage),m.isLowIE&&d("AfterChange",m.resizeImage)},resizeImage:function(){var e=m.currItem;if(e&&e.img&&m.st.image.verticalFit){var t=0;m.isLowIE&&(t=parseInt(e.img.css("padding-top"),10)+parseInt(e.img.css("padding-bottom"),10)),e.img.css("max-height",m.wH-t)}},_onImageHasSize:function(e){e.img&&(e.hasSize=!0,M&&clearInterval(M),e.isCheckingImgSize=!1,c("ImageHasSize",e),e.imgHidden&&(m.content&&m.content.removeClass("mfp-loading"),e.imgHidden=!1))},findImageSize:function(e){var t=0,a=e.img[0],i=function(n){M&&clearInterval(M),M=setInterval(function(){return 0<a.naturalWidth?void m._onImageHasSize(e):void(200<t&&clearInterval(M),t++,3===t?i(10):40===t?i(50):100==t&&i(500))},n)};i(1)},getImage:function(e,a){var i=0,n=function(){e&&(e.img[0].complete?(e.img.off(".mfploader"),e===m.currItem&&(m._onImageHasSize(e),m.updateStatus("ready")),e.hasSize=!0,e.loaded=!0,c("ImageLoadComplete")):(i++,200>i?setTimeout(n,100):s()))},s=function(){e&&(e.img.off(".mfploader"),e===m.currItem&&(m._onImageHasSize(e),m.updateStatus("error",o.tError.replace("%url%",e.src))),e.hasSize=!0,e.loaded=!0,e.loadError=!0)},o=m.st.image,d=a.find(".mfp-img");if(d.length){var r=document.createElement("img");r.className="mfp-img",e.el&&e.el.find("img").length&&(r.alt=e.el.find("img").attr("alt")),e.img=t(r).on("load.mfploader",n).on("error.mfploader",s),r.src=e.src,d.is("img")&&(e.img=e.img.clone()),r=e.img[0],0<r.naturalWidth?e.hasSize=!0:!r.width&&(e.hasSize=!1)}return(m._parseMarkup(a,{title:E(e),img_replaceWith:e.img},e),m.resizeImage(),e.hasSize)?(M&&clearInterval(M),e.loadError?(a.addClass("mfp-loading"),m.updateStatus("error",o.tError.replace("%url%",e.src))):(a.removeClass("mfp-loading"),m.updateStatus("ready")),a):(m.updateStatus("loading"),e.loading=!0,e.hasSize||(e.imgHidden=!0,a.addClass("mfp-loading"),m.findImageSize(e)),a)}}});var I=function(){return void 0===N&&(N=void 0!==document.createElement("p").style.MozTransform),N},N;t.magnificPopup.registerModule("zoom",{options:{enabled:!1,easing:"ease-in-out",duration:300,opener:function(e){return e.is("img")?e:e.find("img")}},proto:{initZoom:function(){var e=m.st.zoom,t;if(e.enabled&&m.supportsTransition){var a=e.duration,i=function(t){var a=t.clone().removeAttr("style").removeAttr("class").addClass("mfp-animated-image"),i="all "+e.duration/1e3+"s "+e.easing,n={position:"fixed",zIndex:9999,left:0,top:0,"-webkit-backface-visibility":"hidden"};return n["-webkit-transition"]=n["-moz-transition"]=n["-o-transition"]=n.transition=i,a.css(n),a},n=function(){m.content.css("visibility","visible")},s,o;d("BuildControls.zoom",function(){if(m._allowZoom()){if(clearTimeout(s),m.content.css("visibility","hidden"),t=m._getItemToZoom(),!t)return void n();o=i(t),o.css(m._getOffset()),m.wrap.append(o),s=setTimeout(function(){o.css(m._getOffset(!0)),s=setTimeout(function(){n(),setTimeout(function(){o.remove(),t=o=null,c("ZoomAnimationEnded")},16)},a)},16)}}),d("BeforeClose.zoom",function(){if(m._allowZoom()){if(clearTimeout(s),m.st.removalDelay=a,!t){if(t=m._getItemToZoom(),!t)return;o=i(t)}o.css(m._getOffset(!0)),m.wrap.append(o),m.content.css("visibility","hidden"),setTimeout(function(){o.css(m._getOffset())},16)}}),d("Close.zoom",function(){m._allowZoom()&&(n(),o&&o.remove(),t=null)})}},_allowZoom:function(){return"image"===m.currItem.type},_getItemToZoom:function(){return!!m.currItem.hasSize&&m.currItem.img},_getOffset:function(e){var a=e?m.currItem.img:m.st.zoom.opener(m.currItem.el||m.currItem);var n=a.offset(),s=parseInt(a.css("padding-top"),10),o=parseInt(a.css("padding-bottom"),10);n.top-=t(window).scrollTop()-s;var d={width:a.width(),height:(i?a.innerHeight():a[0].offsetHeight)-o-s};return I()?d["-moz-transform"]=d.transform="translate("+n.left+"px,"+n.top+"px)":(d.left=n.left,d.top=n.top),d}}});var R=function(e){if(m.currTemplate.iframe){var t=m.currTemplate.iframe.find("iframe");t.length&&(!e&&(t[0].src="//about:blank"),m.isIE8&&t.css("display",e?"block":"none"))}};t.magnificPopup.registerModule("iframe",{options:{markup:"<div class=\"mfp-iframe-scaler\"><div class=\"mfp-close\"></div><iframe class=\"mfp-iframe\" src=\"//about:blank\" frameborder=\"0\" allowfullscreen></iframe></div>",srcAction:"iframe_src",patterns:{youtube:{index:"youtube.com",id:"v=",src:"//www.youtube.com/embed/%id%?autoplay=1"},vimeo:{index:"vimeo.com/",id:"/",src:"//player.vimeo.com/video/%id%?autoplay=1"},gmaps:{index:"//maps.google.",src:"%id%&output=embed"}}},proto:{initIframe:function(){m.types.push("iframe"),d("BeforeChange",function(t,e,a){e!==a&&(e==="iframe"?R():a==="iframe"&&R(!0))}),d("Close.iframe",function(){R()})},getIframe:function(e,a){var i=e.src,n=m.st.iframe;t.each(n.patterns,function(){if(-1<i.indexOf(this.index))return this.id&&("string"==typeof this.id?i=i.substr(i.lastIndexOf(this.id)+this.id.length,i.length):i=this.id.call(this,i)),i=this.src.replace("%id%",i),!1});var s={};return n.srcAction&&(s[n.srcAction]=i),m._parseMarkup(a,s,e),m.updateStatus("ready"),a}}});var O=function(e){var t=m.items.length;if(e>t-1)return e-t;return 0>e?t+e:e},P=function(e,t,a){return e.replace(/%curr%/gi,t+1).replace(/%total%/gi,a)};t.magnificPopup.registerModule("gallery",{options:{enabled:!1,arrowMarkup:"<button title=\"%title%\" type=\"button\" class=\"mfp-arrow mfp-arrow-%dir%\"></button>",preload:[0,2],navigateByImgClick:!0,arrows:!0,tPrev:"Previous (Left arrow key)",tNext:"Next (Right arrow key)",tCounter:"%curr% of %total%"},proto:{initGallery:function(){var a=m.st.gallery;return m.direction=!0,!!(a&&a.enabled)&&void(f+=" mfp-gallery",d("Open.mfp-gallery",function(){a.navigateByImgClick&&m.wrap.on("click.mfp-gallery",".mfp-img",function(){if(1<m.items.length)return m.next(),!1}),h.on("keydown.mfp-gallery",function(t){37===t.keyCode?m.prev():39===t.keyCode&&m.next()})}),d("UpdateStatus.mfp-gallery",function(t,e){e.text&&(e.text=P(e.text,m.currItem.index,m.items.length))}),d("MarkupParse.mfp-gallery",function(t,e,i,n){var s=m.items.length;i.counter=1<s?P(a.tCounter,n.index,s):""}),d("BuildControls.mfp-gallery",function(){if(1<m.items.length&&a.arrows&&!m.arrowLeft){var e=a.arrowMarkup,i=m.arrowLeft=t(e.replace(/%title%/gi,a.tPrev).replace(/%dir%/gi,"left")).addClass("mfp-prevent-close"),n=m.arrowRight=t(e.replace(/%title%/gi,a.tNext).replace(/%dir%/gi,"right")).addClass("mfp-prevent-close");i.click(function(){m.prev()}),n.click(function(){m.next()}),m.container.append(i.add(n))}}),d("Change.mfp-gallery",function(){m._preloadTimeout&&clearTimeout(m._preloadTimeout),m._preloadTimeout=setTimeout(function(){m.preloadNearbyImages(),m._preloadTimeout=null},16)}),d("Close.mfp-gallery",function(){h.off(".mfp-gallery"),m.wrap.off("click.mfp-gallery"),m.arrowRight=m.arrowLeft=null}))},next:function(){m.direction=!0,m.index=O(m.index+1),m.updateItemHTML()},prev:function(){m.direction=!1,m.index=O(m.index-1),m.updateItemHTML()},goTo:function(e){m.direction=e>=m.index,m.index=e,m.updateItemHTML()},preloadNearbyImages:function(){var t=m.st.gallery.preload,a=e(t[0],m.items.length),n=e(t[1],m.items.length),s;for(s=1;s<=(m.direction?n:a);s++)m._preloadItem(m.index+s);for(s=1;s<=(m.direction?a:n);s++)m._preloadItem(m.index-s)},_preloadItem:function(e){if(e=O(e),!m.items[e].preloaded){var a=m.items[e];a.parsed||(a=m.parseEl(e)),c("LazyLoad",a),"image"===a.type&&(a.img=t("<img class=\"mfp-img\" />").on("load.mfploader",function(){a.hasSize=!0}).on("error.mfploader",function(){a.hasSize=!0,a.loadError=!0,c("LazyLoadError",a)}).attr("src",a.src)),a.preloaded=!0}}}});t.magnificPopup.registerModule("retina",{options:{replaceSrc:function(e){return e.src.replace(/\.\w+$/,function(e){return"@2x"+e})},ratio:1},proto:{initRetina:function(){if(1<window.devicePixelRatio){var t=m.st.retina,a=t.ratio;a=isNaN(a)?a():a,1<a&&(d("ImageHasSize.retina",function(t,e){e.img.css({"max-width":e.img[0].naturalWidth/a,width:"100%"})}),d("ElementParse.retina",function(i,e){e.src=t.replaceSrc(e,a)}))}}}}),p()}),function(e,t){if("function"==typeof define&&define.amd)define("strophe",[],t);else{var a=t();e.Strophe=a.Strophe,e.$build=a.$build,e.$iq=a.$iq,e.$msg=a.$msg,e.$pres=a.$pres,e.SHA1=a.SHA1,e.MD5=a.MD5,e.b64_hmac_sha1=a.b64_hmac_sha1,e.b64_sha1=a.b64_sha1,e.str_hmac_sha1=a.str_hmac_sha1,e.str_sha1=a.str_sha1}}(this,function(){var e=Math.abs,t=String.fromCharCode,a=Math.ceil,n=Math.floor,s=Math.pow,o=Math.min,d,r,c;return function(e){function t(e,t){return b.call(e,t)}function a(e,t){var a=t&&t.split("/"),n=v.map,s=n&&n["*"]||{},o,d,r,c,l,p,u,m,g,h,f,b;if(e){for(e=e.split("/"),l=e.length-1,v.nodeIdCompat&&w.test(e[l])&&(e[l]=e[l].replace(w,"")),"."===e[0].charAt(0)&&a&&(b=a.slice(0,a.length-1),e=b.concat(e)),g=0;g<e.length;g++)if(f=e[g],"."===f)e.splice(g,1),g-=1;else if(".."===f)if(0===g||1===g&&".."===e[2]||".."===e[g-1])continue;else 0<g&&(e.splice(g-1,2),g-=2);e=e.join("/")}if((a||s)&&n){for(o=e.split("/"),g=o.length;0<g;g-=1){if(d=o.slice(0,g).join("/"),a)for(h=a.length;0<h;h-=1)if(r=n[a.slice(0,h).join("/")],r&&(r=r[d],r)){c=r,p=g;break}if(c)break;!u&&s&&s[d]&&(u=s[d],m=g)}!c&&u&&(c=u,p=m),c&&(o.splice(0,p,c),e=o.join("/"))}return e}function n(t,a){return function(){var i=x.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),S.apply(e,i.concat([t,a]))}}function s(e){return function(t){return a(t,e)}}function o(e){return function(t){g[e]=t}}function l(a){if(t(h,a)){var i=h[a];delete h[a],f[a]=!0,C.apply(e,i)}if(!t(g,a)&&!t(f,a))throw new Error("No "+a);return g[a]}function p(e){var t=e?e.indexOf("!"):-1,a;return-1<t&&(a=e.substring(0,t),e=e.substring(t+1,e.length)),[a,e]}function u(e){return e?p(e):[]}function m(e){return function(){return v&&v.config&&v.config[e]||{}}}var g={},h={},v={},f={},b=Object.prototype.hasOwnProperty,x=[].slice,w=/\.js$/,C,S,k,A;k=function(e,t){var i=p(e),n=i[0],o=t[1],d;return e=i[1],n&&(n=a(n,o),d=l(n)),n?d&&d.normalize?e=d.normalize(e,s(o)):e=a(e,o):(e=a(e,o),i=p(e),n=i[0],e=i[1],n&&(d=l(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:d}},A={require:function(e){return n(e)},exports:function(t){var a=g[t];return"undefined"==typeof a?g[t]={}:a},module:function(e){return{id:e,uri:"",exports:g[e],config:m(e)}}},C=function(a,s,d,r){var c=[],p=typeof d,m,v,b,x,w,C,S;if(r=r||a,C=u(r),"undefined"==p||"function"===p){for(s=!s.length&&d.length?["require","exports","module"]:s,w=0;w<s.length;w+=1)if(x=k(s[w],C),v=x.f,"require"===v)c[w]=A.require(a);else if("exports"===v)c[w]=A.exports(a),S=!0;else if("module"===v)m=c[w]=A.module(a);else if(t(g,v)||t(h,v)||t(f,v))c[w]=l(v);else if(x.p)x.p.load(x.n,n(r,!0),o(v),{}),c[w]=g[v];else throw new Error(a+" missing "+v);b=d?d.apply(g[a],c):void 0,a&&(m&&m.exports!==e&&m.exports!==g[a]?g[a]=m.exports:(b!==e||!S)&&(g[a]=b))}else a&&(g[a]=d)},d=r=S=function(t,a,i,n,s){if("string"==typeof t)return A[t]?A[t](a):l(k(t,u(a)).f);if(!t.splice){if(v=t,v.deps&&S(v.deps,v.callback),!a)return;a.splice?(t=a,a=i,i=null):t=e}return a=a||function(){},"function"==typeof i&&(i=n,n=s),n?C(e,t,a,i):setTimeout(function(){C(e,t,a,i)},4),S},S.config=function(e){return S(e)},d._defined=g,c=function(e,a,i){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");a.splice||(i=a,a=[]),t(g,e)||t(h,e)||(h[e]=[e,a,i])},c.amd={jQuery:!0}}(),c("node_modules/almond/almond.js",function(){}),function(e,t){return"function"==typeof c&&c.amd?void c("strophe-polyfill",[],function(){return t(e)}):t(e)}(this,function(e){Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,a=Array.prototype.slice,i=Array.prototype.concat,n=a.call(arguments,1);return function(){return t.apply(e?e:this,i.call(n,a.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,i=+arguments[1]||0;for(i=0>i?a(i):n(i),0>i&&(i+=t);i<t;i++)if(i in this&&this[i]===e)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var a,i;if(null===this)throw new TypeError(" this is null or not defined");var n=Object(this),s=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(a=t),i=0;i<s;){var o;i in n&&(o=n[i],e.call(a,o,i,n)),i++}});e.btoa||(e.btoa=function(e){var t="",a=0,n,s,o,d,r,c,l;do n=e.charCodeAt(a++),s=e.charCodeAt(a++),o=e.charCodeAt(a++),d=n>>2,r=(3&n)<<4|s>>4,c=(15&s)<<2|o>>6,l=63&o,isNaN(s)?(r=(3&n)<<4,c=l=64):isNaN(o)&&(l=64),t=t+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);while(a<e.length);return t}),e.atob||(e.atob=function(e){var a="",n=0,s,o,d,r,c,l,p;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(n++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(n++)),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(n++)),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(n++)),s=r<<2|c>>4,o=(15&c)<<4|l>>2,d=(3&l)<<6|p,a+=t(s),64!==l&&(a+=t(o)),64!==p&&(a+=t(d));while(n<e.length);return a})}),function(e,t){"function"==typeof c&&c.amd?c("strophe-sha1",[],function(){return t()}):"object"==typeof exports?module.exports=t():e.SHA1=t()}(this,function(){function e(o,p){o[p>>5]|=128<<24-p%32,o[(p+64>>9<<4)+15]=p;var u=Array(80),m=1732584193,g=-271733879,h=-1732584194,v=271733878,f=-1009589776,x,w,C,S,k,A,T,E;for(x=0;x<o.length;x+=16){for(S=m,k=g,A=h,T=v,E=f,w=0;80>w;w++)u[w]=16>w?o[x+w]:l(u[w-3]^u[w-8]^u[w-14]^u[w-16],1),C=r(r(l(m,5),n(w,g,h,v)),r(r(f,u[w]),s(w))),f=v,v=h,h=l(g,30),g=m,m=C;m=r(m,S),g=r(g,k),h=r(h,A),v=r(v,T),f=r(f,E)}return[m,g,h,v,f]}function n(e,t,a,i){return 20>e?t&a|~t&i:40>e?t^a^i:60>e?t&a|t&i|a&i:t^a^i}function s(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function o(t,a){var n=p(t);16<n.length&&(n=e(n,8*t.length));for(var s=Array(16),o=Array(16),d=0;16>d;d++)s[d]=909522486^n[d],o[d]=1549556828^n[d];var r=e(s.concat(p(a)),512+8*a.length);return e(o.concat(r),672)}function r(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function l(e,t){return e<<t|e>>>32-t}function p(e){for(var t=[],a=0;a<8*e.length;a+=8)t[a>>5]|=(e.charCodeAt(a/8)&255)<<24-a%32;return t}function u(e){for(var a="",n=0;n<32*e.length;n+=8)a+=t(e[n>>5]>>>24-n%32&255);return a}function m(e){for(var t="",a=0,n,s;a<4*e.length;a+=3)for(n=(255&e[a>>2]>>8*(3-a%4))<<16|(255&e[a+1>>2]>>8*(3-(a+1)%4))<<8|255&e[a+2>>2]>>8*(3-(a+2)%4),s=0;4>s;s++)t+=8*a+6*s>32*e.length?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&n>>6*(3-s));return t}return{b64_hmac_sha1:function(e,t){return m(o(e,t))},b64_sha1:function(t){return m(e(p(t),8*t.length))},binb2str:u,core_hmac_sha1:o,str_hmac_sha1:function(e,t){return u(o(e,t))},str_sha1:function(t){return u(e(p(t),8*t.length))}}}),function(e,t){"function"==typeof c&&c.amd?c("strophe-md5",[],function(){return t()}):"object"==typeof exports?module.exports=t():e.MD5=t()}(this,function(){var e=function(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a},i=function(e,t){return e<<t|e>>>32-t},n=function(e){for(var t=[],a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t},o=function(e){for(var a="",n=0;n<32*e.length;n+=8)a+=t(255&e[n>>5]>>>n%32);return a},d=function(e){for(var t="0123456789abcdef",a="",n=0;n<4*e.length;n++)a+=t.charAt(15&e[n>>2]>>8*(n%4)+4)+t.charAt(15&e[n>>2]>>8*(n%4));return a},r=function(n,o,a,d,r,s){return e(i(e(e(o,n),e(d,s)),r),a)},l=function(e,a,i,n,o,d,s){return r(a&i|~a&n,e,a,o,d,s)},p=function(e,a,i,n,o,d,s){return r(a&n|i&~n,e,a,o,d,s)},u=function(e,a,i,n,o,d,s){return r(a^i^n,e,a,o,d,s)},m=function(e,a,i,n,o,d,s){return r(i^(a|~n),e,a,o,d,s)},g=function(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;for(var s=1732584193,o=-271733879,r=-1732584194,g=271733878,h=0,v,f,x,w;h<t.length;h+=16)v=s,f=o,x=r,w=g,s=l(s,o,r,g,t[h+0],7,-680876936),g=l(g,s,o,r,t[h+1],12,-389564586),r=l(r,g,s,o,t[h+2],17,606105819),o=l(o,r,g,s,t[h+3],22,-1044525330),s=l(s,o,r,g,t[h+4],7,-176418897),g=l(g,s,o,r,t[h+5],12,1200080426),r=l(r,g,s,o,t[h+6],17,-1473231341),o=l(o,r,g,s,t[h+7],22,-45705983),s=l(s,o,r,g,t[h+8],7,1770035416),g=l(g,s,o,r,t[h+9],12,-1958414417),r=l(r,g,s,o,t[h+10],17,-42063),o=l(o,r,g,s,t[h+11],22,-1990404162),s=l(s,o,r,g,t[h+12],7,1804603682),g=l(g,s,o,r,t[h+13],12,-40341101),r=l(r,g,s,o,t[h+14],17,-1502002290),o=l(o,r,g,s,t[h+15],22,1236535329),s=p(s,o,r,g,t[h+1],5,-165796510),g=p(g,s,o,r,t[h+6],9,-1069501632),r=p(r,g,s,o,t[h+11],14,643717713),o=p(o,r,g,s,t[h+0],20,-373897302),s=p(s,o,r,g,t[h+5],5,-701558691),g=p(g,s,o,r,t[h+10],9,38016083),r=p(r,g,s,o,t[h+15],14,-660478335),o=p(o,r,g,s,t[h+4],20,-405537848),s=p(s,o,r,g,t[h+9],5,568446438),g=p(g,s,o,r,t[h+14],9,-1019803690),r=p(r,g,s,o,t[h+3],14,-187363961),o=p(o,r,g,s,t[h+8],20,1163531501),s=p(s,o,r,g,t[h+13],5,-1444681467),g=p(g,s,o,r,t[h+2],9,-51403784),r=p(r,g,s,o,t[h+7],14,1735328473),o=p(o,r,g,s,t[h+12],20,-1926607734),s=u(s,o,r,g,t[h+5],4,-378558),g=u(g,s,o,r,t[h+8],11,-2022574463),r=u(r,g,s,o,t[h+11],16,1839030562),o=u(o,r,g,s,t[h+14],23,-35309556),s=u(s,o,r,g,t[h+1],4,-1530992060),g=u(g,s,o,r,t[h+4],11,1272893353),r=u(r,g,s,o,t[h+7],16,-155497632),o=u(o,r,g,s,t[h+10],23,-1094730640),s=u(s,o,r,g,t[h+13],4,681279174),g=u(g,s,o,r,t[h+0],11,-358537222),r=u(r,g,s,o,t[h+3],16,-722521979),o=u(o,r,g,s,t[h+6],23,76029189),s=u(s,o,r,g,t[h+9],4,-640364487),g=u(g,s,o,r,t[h+12],11,-421815835),r=u(r,g,s,o,t[h+15],16,530742520),o=u(o,r,g,s,t[h+2],23,-995338651),s=m(s,o,r,g,t[h+0],6,-198630844),g=m(g,s,o,r,t[h+7],10,1126891415),r=m(r,g,s,o,t[h+14],15,-1416354905),o=m(o,r,g,s,t[h+5],21,-57434055),s=m(s,o,r,g,t[h+12],6,1700485571),g=m(g,s,o,r,t[h+3],10,-1894986606),r=m(r,g,s,o,t[h+10],15,-1051523),o=m(o,r,g,s,t[h+1],21,-2054922799),s=m(s,o,r,g,t[h+8],6,1873313359),g=m(g,s,o,r,t[h+15],10,-30611744),r=m(r,g,s,o,t[h+6],15,-1560198380),o=m(o,r,g,s,t[h+13],21,1309151649),s=m(s,o,r,g,t[h+4],6,-145523070),g=m(g,s,o,r,t[h+11],10,-1120210379),r=m(r,g,s,o,t[h+2],15,718787259),o=m(o,r,g,s,t[h+9],21,-343485551),s=e(s,v),o=e(o,f),r=e(r,x),g=e(g,w);return[s,o,r,g]};return{hexdigest:function(e){return d(g(n(e),8*e.length))},hash:function(e){return o(g(n(e),8*e.length))}}}),function(e,t){"function"==typeof c&&c.amd?c("strophe-utils",[],function(){return t()}):"object"==typeof exports?module.exports=t():e.stropheUtils=t()}(this,function(){return{utf16to8:function(e){var a="",n=e.length,s,o;for(s=0;s<n;s++)o=e.charCodeAt(s),0<=o&&127>=o?a+=e.charAt(s):2047<o?(a+=t(224|15&o>>12),a+=t(128|63&o>>6),a+=t(128|63&o>>0)):(a+=t(192|31&o>>6),a+=t(128|63&o>>0));return a},addCookies:function(e){var t,a,i,n,s,o,d;for(t in e||{})s="",o="",d="",a=e[t],i="object"==typeof a,n=escape(unescape(i?a.value:a)),i&&(s=a.expires?";expires="+a.expires:"",o=a.domain?";domain="+a.domain:"",d=a.path?";path="+a.path:""),document.cookie=t+"="+n+s+o+d}}}),function(e,t){if("function"==typeof c&&c.amd)c("strophe-core",["strophe-sha1","strophe-md5","strophe-utils"],function(){return t.apply(this,arguments)});else if("object"==typeof exports)module.exports=t(r("./sha1"),r("./md5"),r("./utils"));else{var a=t(e.SHA1,e.MD5,e.stropheUtils);e.Strophe=a.Strophe,e.$build=a.$build,e.$iq=a.$iq,e.$msg=a.$msg,e.$pres=a.$pres,e.SHA1=a.SHA1,e.MD5=a.MD5,e.b64_hmac_sha1=a.SHA1.b64_hmac_sha1,e.b64_sha1=a.SHA1.b64_sha1,e.str_hmac_sha1=a.SHA1.str_hmac_sha1,e.str_sha1=a.SHA1.str_sha1}}(this,function(e,t,a){function n(e,t){return new r.Builder(e,t)}function s(e){return new r.Builder("message",e)}function o(e){return new r.Builder("iq",e)}function d(e){return new r.Builder("presence",e)}var r;return r={VERSION:"1.2.16",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<r.XHTML.tags.length;t++)if(e===r.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if("undefined"!=typeof r.XHTML.attributes[e]&&0<r.XHTML.attributes[e].length)for(var a=0;a<r.XHTML.attributes[e].length;a++)if(t===r.XHTML.attributes[e][a])return!0;return!1},validCSS:function(e){for(var t=0;t<r.XHTML.css.length;t++)if(e===r.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){r.NS[e]=t},forEachChild:function(e,t,a){var n,s;for(n=0;n<e.childNodes.length;n++)s=e.childNodes[n],s.nodeType===r.ElementType.NORMAL&&(!t||this.isTagEqual(s,t))&&a(s)},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&10>document.documentMode?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return r._xmlGenerator||(r._xmlGenerator=r._makeGenerator()),r._xmlGenerator},_getIEXmlDom:function(){for(var t=null,a=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],i=0;i<a.length&&null===t;i++)try{t=new ActiveXObject(a[i])}catch(a){t=null}return t},xmlElement:function(e){if(!e)return null;var t=r.xmlGenerator().createElement(e),n,s,o;for(n=1;n<arguments.length;n++){var d=arguments[n];if(d)if("string"==typeof d||"number"==typeof d)t.appendChild(r.xmlTextNode(d));else if("object"==typeof d&&"function"==typeof d.sort)for(s=0;s<d.length;s++){var c=d[s];"object"==typeof c&&"function"==typeof c.sort&&void 0!==c[1]&&null!==c[1]&&t.setAttribute(c[0],c[1])}else if("object"==typeof d)for(o in d)d.hasOwnProperty(o)&&void 0!==d[o]&&null!==d[o]&&t.setAttribute(o,d[o])}return t},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;"),e},xmlunescape:function(e){return e=e.replace(/\&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&apos;/g,"'"),e=e.replace(/&quot;/g,"\""),e},xmlTextNode:function(e){return r.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(DOMParser){var a=new DOMParser;t=a.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===r.ElementType.TEXT&&(t+=e.nodeValue);for(var a=0;a<e.childNodes.length;a++)e.childNodes[a].nodeType===r.ElementType.TEXT&&(t+=e.childNodes[a].nodeValue);return r.xmlescape(t)},copyElement:function(e){var t,a;if(e.nodeType===r.ElementType.NORMAL){for(a=r.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)a.setAttribute(e.attributes[t].nodeName,e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)a.appendChild(r.copyElement(e.childNodes[t]))}else e.nodeType===r.ElementType.TEXT&&(a=r.xmlGenerator().createTextNode(e.nodeValue));return a},createHtml:function(e){var t,a,n,s,o,d,c,l,p,u,m;if(e.nodeType===r.ElementType.NORMAL){if(s=e.nodeName.toLowerCase(),r.XHTML.validTag(s))try{for(a=r.xmlElement(s),t=0;t<r.XHTML.attributes[s].length;t++)if(o=r.XHTML.attributes[s][t],d=e.getAttribute(o),"undefined"!=typeof d&&null!==d&&""!==d&&!1!==d&&0!==d)if("style"===o&&"object"==typeof d&&"undefined"!=typeof d.cssText&&(d=d.cssText),"style"===o){for(c=[],l=d.split(";"),n=0;n<l.length;n++)p=l[n].split(":"),u=p[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),r.XHTML.validCSS(u)&&(m=p[1].replace(/^\s*/,"").replace(/\s*$/,""),c.push(u+": "+m));0<c.length&&(d=c.join("; "),a.setAttribute(o,d))}else a.setAttribute(o,d);for(t=0;t<e.childNodes.length;t++)a.appendChild(r.createHtml(e.childNodes[t]))}catch(t){a=r.xmlTextNode("")}else for(a=r.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)a.appendChild(r.createHtml(e.childNodes[t]));}else if(e.nodeType===r.ElementType.FRAGMENT)for(a=r.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)a.appendChild(r.createHtml(e.childNodes[t]));else e.nodeType===r.ElementType.TEXT&&(a=r.xmlTextNode(e.nodeValue));return a},escapeNode:function(e){return"string"==typeof e?e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40"):e},unescapeNode:function(e){return"string"==typeof e?e.replace(/\\20/g," ").replace(/\\22/g,"\"").replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\"):e},getNodeFromJid:function(e){return 0>e.indexOf("@")?null:e.split("@")[0]},getDomainFromJid:function(e){var t=r.getBareJidFromJid(e);if(0>t.indexOf("@"))return t;var a=t.split("@");return a.splice(0,1),a.join("@")},getResourceFromJid:function(e){var t=e.split("/");return 2>t.length?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(t){"undefined"!=typeof t.stack&&r.fatal(t.stack),t.sourceURL?r.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?r.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):r.fatal("error: "+t.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"==typeof window.console&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var a=e.nodeName,n,s;for(e.getAttribute("_realname")&&(a=e.getAttribute("_realname")),t="<"+a,n=0;n<e.attributes.length;n++)"_realname"!==e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName+"='"+r.xmlescape(e.attributes[n].value)+"'");if(0<e.childNodes.length){for(t+=">",n=0;n<e.childNodes.length;n++)switch(s=e.childNodes[n],s.nodeType){case r.ElementType.NORMAL:t+=r.serialize(s);break;case r.ElementType.TEXT:t+=r.xmlescape(s.nodeValue);break;case r.ElementType.CDATA:t+="<![CDATA["+s.nodeValue+"]]>";}t+="</"+a+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){r._connectionPlugins[e]=t}},r.Builder=function(e,t){("presence"===e||"message"===e||"iq"===e)&&(t&&!t.xmlns?t.xmlns=r.NS.CLIENT:!t&&(t={xmlns:r.NS.CLIENT})),this.nodeTree=r.xmlElement(e,t),this.node=this.nodeTree},r.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return r.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,a){var i=r.xmlElement(e,t,a);return this.node.appendChild(i),"string"!=typeof a&&"number"!=typeof a&&(this.node=i),this},cnode:function(e){var t=r.xmlGenerator(),a;try{a=void 0!==t.importNode}catch(t){a=!1}var i=a?t.importNode(e,!0):r.copyElement(e);return this.node.appendChild(i),this.node=i,this},t:function(e){var t=r.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var a=r.createHtml(t);0<a.childNodes.length;)this.node.appendChild(a.childNodes[0]);return this}},r.Handler=function(e,t,a,i,n,s,o){this.handler=e,this.ns=t,this.name=a,this.type=i,this.id=n,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(r.warn("The \"matchBare\" option is deprecated, use \"matchBareFromJid\" instead."),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.from=this.options.matchBareFromJid?s?r.getBareJidFromJid(s):null:s,this.user=!0},r.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=!1;if(!this.ns)return!0;var a=this;return r.forEachChild(e,null,function(e){a.getNamespace(e)===a.ns&&(t=!0)}),t=t||this.getNamespace(e)===this.ns,t},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=r.getBareJidFromJid(t));var a=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!r.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(a):a!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(t){throw r._handleError(t),t}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},r.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=new Date().getTime(),this.user=!0},r.TimedHandler.prototype={run:function(){return this.lastCalled=new Date().getTime(),this.handler()},reset:function(){this.lastCalled=new Date().getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},r.Connection=function(e,t){this.service=e,this.options=t||{};var i=this.options.protocol||"";for(var n in this._proto=0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===i.indexOf("ws")?new r.Websocket(this):new r.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),a.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),r._connectionPlugins)if(r._connectionPlugins.hasOwnProperty(n)){var s=r._connectionPlugins[n],o=function(){};o.prototype=s,this[n]=new o,this[n].init(this)}},r.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),a="x"===e?t:8|3&t;return a.toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,a){this.protocolErrorHandlers[e][t]=a},connect:function(e,t,a,i,n,s,o){this.jid=e,this.authzid=r.getBareJidFromJid(this.jid),this.authcid=o||r.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=a,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=r.getDomainFromJid(this.jid),this._changeConnectStatus(r.Status.CONNECTING,null),this._proto._connect(i,n,s)},attach:function(e,t,a,i,n,s,o){if(this._proto instanceof r.Bosh)this._proto._attach(e,t,a,i,n,s,o);else throw{name:"StropheSessionError",message:"The \"attach\" method can only be used with a BOSH connection."}},restore:function(e,t,a,i,n){if(this._sessionCachingSupported())this._proto._restore(e,t,a,i,n);else throw{name:"StropheSessionError",message:"The \"restore\" method can only be used with a BOSH connection."}},_sessionCachingSupported:function(){if(this._proto instanceof r.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},nextValidRid:function(){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,a,i){var n=null,s=this;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof a){var d=this.addHandler(function(e){n&&s.deleteTimedHandler(n);var i=e.getAttribute("type");"error"===i?a&&a(e):t&&t(e)},null,"presence",null,o);i&&(n=this.addTimedHandler(i,function(){return s.deleteHandler(d),a&&a(null),!1}))}return this.send(e),o},sendIQ:function(e,t,a,i){var n=null,s=this;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof a){var d=this.addHandler(function(e){n&&s.deleteTimedHandler(n);var i=e.getAttribute("type");if("result"===i)t&&t(e);else if("error"===i)a&&a(e);else throw{name:"StropheError",message:"Got bad IQ type of "+i}},null,"iq",["error","result"],o);i&&(n=this.addTimedHandler(i,function(){return s.deleteHandler(d),a&&a(null),!1}))}return this.send(e),o},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(e,t){var a=new r.TimedHandler(e,t);return this.addTimeds.push(a),a},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,a,i,n,s,o){var d=new r.Handler(e,t,a,i,n,s,o);return this.addHandlers.push(d),d},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);0<=t&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},e=e||[r.SASLAnonymous,r.SASLExternal,r.SASLMD5,r.SASLOAuthBearer,r.SASLXOAuth2,r.SASLPlain,r.SASLSHA1],e.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(r.Status.DISCONNECTING,e),r.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=d({xmlns:r.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else r.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,a){for(var i in r._connectionPlugins)if(r._connectionPlugins.hasOwnProperty(i)){var n=this[i];if(n.statusChanged)try{n.statusChanged(e,t)}catch(e){r.error(""+i+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(e,t,a)}catch(t){r._handleError(t),r.error("User connection callback caused an exception: "+t)}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),r.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(r.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){r.info("_dataRecv called");var a=this._proto._reqToData(e);if(null!==a){this.xmlInput!==r.Connection.prototype.xmlInput&&(a.nodeName===this._proto.strip&&a.childNodes.length?this.xmlInput(a.childNodes[0]):this.xmlInput(a)),this.rawInput!==r.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(r.serialize(a)));for(var n,s;0<this.removeHandlers.length;)s=this.removeHandlers.pop(),n=this.handlers.indexOf(s),0<=n&&this.handlers.splice(n,1);for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var o=a.getAttribute("type"),d,c;if(null!==o&&"terminate"===o)return this.disconnecting?void 0:(d=a.getAttribute("condition"),c=a.getElementsByTagName("conflict"),null===d?this._changeConnectStatus(r.Status.CONNFAIL,r.ErrorCondition.UNKOWN_REASON):("remote-stream-error"===d&&0<c.length&&(d="conflict"),this._changeConnectStatus(r.Status.CONNFAIL,d)),void this._doDisconnect(d));var l=this;r.forEachChild(a,null,function(e){var t,a;for(a=l.handlers,l.handlers=[],t=0;t<a.length;t++){var n=a[t];try{n.isMatch(e)&&(l.authenticated||!n.user)?n.run(e)&&l.handlers.push(n):l.handlers.push(n)}catch(t){r.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}},mechanisms:{},_connect_cb:function(e,t,a){r.info("_connect_cb was called"),this.connected=!0;var n;try{n=this._proto._reqToData(e)}catch(t){if("badformat"!==t)throw t;this._changeConnectStatus(r.Status.CONNFAIL,r.ErrorCondition.BAD_FORMAT),this._doDisconnect(r.ErrorCondition.BAD_FORMAT)}if(n){this.xmlInput!==r.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==r.Connection.prototype.rawInput&&(a?this.rawInput(a):this.rawInput(r.serialize(n)));var s=this._proto._connect_cb(n);if(s!==r.Status.CONNFAIL){var o;if(o=n.getElementsByTagNameNS?0<n.getElementsByTagNameNS(r.NS.STREAM,"features").length:0<n.getElementsByTagName("stream:features").length||0<n.getElementsByTagName("features").length,!o)return void this._proto._no_auth_received(t);var d=[],c=n.getElementsByTagName("mechanism"),l,p;if(0<c.length)for(l=0;l<c.length;l++)p=r.getText(c[l]),this.mechanisms[p]&&d.push(this.mechanisms[p]);return 0===d.length&&0===n.getElementsByTagName("auth").length?void this._proto._no_auth_received(t):void(!1!==this.do_authentication&&this.authenticate(d))}}},sortMechanismsByPriority:function(e){var t,a,n,s;for(t=0;t<e.length-1;++t){for(n=t,a=t+1;a<e.length;++a)e[a].prototype.priority>e[n].prototype.priority&&(n=a);n!==t&&(s=e[t],e[t]=e[n],e[n]=s)}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);var t=0,a=!1;for(t=0;t<e.length;++t)if(e[t].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[t],this._sasl_mechanism.onStart(this);var s=n("auth",{xmlns:r.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var o=this._sasl_mechanism.onChallenge(this,null);s.t(btoa(o))}this.send(s.tree()),a=!0;break}return a},_attemptLegacyAuth:function(){null===r.getNodeFromJid(this.jid)?(this._changeConnectStatus(r.Status.CONNFAIL,r.ErrorCondition.MISSING_JID_NODE),this.disconnect(r.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(r.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:r.NS.AUTH}).c("username",{}).t(r.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(r.getText(e)),a=this._sasl_mechanism.onChallenge(this,t),i=n("response",{xmlns:r.NS.SASL});return""!==a&&i.t(btoa(a)),this.send(i.tree()),!0},_auth1_cb:function(){var e=o({type:"set",id:"_auth_2"}).c("query",{xmlns:r.NS.AUTH}).c("username",{}).t(r.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return r.getResourceFromJid(this.jid)||(this.jid=r.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(r.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t=atob(r.getText(e)),a=/([a-z]+)=([^,]+)(,|$)/,i=t.match(a),n;if("v"===i[1]&&(n=i[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}r.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var s=[],o=function(e,t){for(;e.length;)this.deleteHandler(e.pop());return this._sasl_auth1_cb.bind(this)(t),!1};return s.push(this._addSysHandler(function(e){o.bind(this)(s,e)}.bind(this),null,"stream:features",null,null)),s.push(this._addSysHandler(function(e){o.bind(this)(s,e)}.bind(this),r.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,a;for(t=0;t<e.childNodes.length;t++)a=e.childNodes[t],"bind"===a.nodeName&&(this.do_bind=!0),"session"===a.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(r.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var n=r.getResourceFromJid(this.jid);return n?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:r.NS.BIND}).c("resource",{}).t(n).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:r.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"===e.getAttribute("type")){r.info("SASL binding failed.");var t=e.getElementsByTagName("conflict"),a;return 0<t.length&&(a=r.ErrorCondition.CONFLICT),this._changeConnectStatus(r.Status.AUTHFAIL,a,e),!1}var i=e.getElementsByTagName("bind"),n;return 0<i.length?void(n=i[0].getElementsByTagName("jid"),0<n.length&&(this.jid=r.getText(n[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:r.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null)))):(r.info("SASL binding failed."),this._changeConnectStatus(r.Status.AUTHFAIL,null,e),!1)},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return r.info("Session creation failed."),this._changeConnectStatus(r.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(r.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(r.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(r.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var a=new r.TimedHandler(e,t);return a.user=!1,this.addTimeds.push(a),a},_addSysHandler:function(e,t,a,i,n){var s=new r.Handler(e,t,a,i,n);return s.user=!1,this.addHandlers.push(s),s},_onDisconnectTimeout:function(){return r.info("_onDisconnectTimeout was called"),this._changeConnectStatus(r.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,a,n;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),0<=e&&this.timedHandlers.splice(e,1);var s=new Date().getTime();for(n=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],(this.authenticated||!t.user)&&(a=t.lastCalled+t.period,0>=a-s?t.run()&&n.push(t):n.push(t));this.timedHandlers=n,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},r.SASLMechanism=function(e,t,a){this.name=e,this.isClientFirst=t,this.priority=a},r.SASLMechanism.prototype={test:function(){return!0},onStart:function(e){this._connection=e},onChallenge:function(){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},r.SASLAnonymous=function(){},r.SASLAnonymous.prototype=new r.SASLMechanism("ANONYMOUS",!1,20),r.SASLAnonymous.prototype.test=function(e){return null===e.authcid},r.SASLPlain=function(){},r.SASLPlain.prototype=new r.SASLMechanism("PLAIN",!0,50),r.SASLPlain.prototype.test=function(e){return null!==e.authcid},r.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,a.utf16to8(t)},r.SASLSHA1=function(){},r.SASLSHA1.prototype=new r.SASLMechanism("SCRAM-SHA-1",!0,70),r.SASLSHA1.prototype.test=function(e){return null!==e.authcid},r.SASLSHA1.prototype.onChallenge=function(i,n,s){var o=s||t.hexdigest(1234567890*Math.random()),d="n="+a.utf16to8(i.authcid);return d+=",r=",d+=o,i._sasl_data.cnonce=o,i._sasl_data["client-first-message-bare"]=d,d="n,,"+d,this.onChallenge=function(t,n){for(var s="c=biws,",o=t._sasl_data["client-first-message-bare"]+","+n+",",d=t._sasl_data.cnonce,r=/([a-z]+)=([^,]+)(,|$)/,c,l,p,u,m,g,h,v,f,b,x,w,C;n.match(r);)switch(C=n.match(r),n=n.replace(C[0],""),C[1]){case"r":c=C[2];break;case"s":l=C[2];break;case"i":p=C[2];}if(c.substr(0,d.length)!==d)return t._sasl_data={},t._sasl_failure_cb();for(s+="r="+c,o+=s,l=atob(l),l+="\0\0\0\x01",f=a.utf16to8(t.pass),u=g=e.core_hmac_sha1(f,l),h=1;h<p;h++){for(m=e.core_hmac_sha1(f,e.binb2str(g)),v=0;5>v;v++)u[v]^=m[v];g=m}for(u=e.binb2str(u),b=e.core_hmac_sha1(u,"Client Key"),x=e.str_hmac_sha1(u,"Server Key"),w=e.core_hmac_sha1(e.str_sha1(e.binb2str(b)),o),t._sasl_data["server-signature"]=e.b64_hmac_sha1(x,o),v=0;5>v;v++)b[v]^=w[v];return s+=",p="+btoa(e.binb2str(b)),s}.bind(this),d},r.SASLMD5=function(){},r.SASLMD5.prototype=new r.SASLMechanism("DIGEST-MD5",!1,60),r.SASLMD5.prototype.test=function(e){return null!==e.authcid},r.SASLMD5.prototype._quote=function(e){return"\""+e.replace(/\\/g,"\\\\").replace(/"/g,"\\\"")+"\""},r.SASLMD5.prototype.onChallenge=function(e,i,n){for(var s=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,o=n||t.hexdigest(""+1234567890*Math.random()),d="",r=null,c="",l;i.match(s);)switch(l=i.match(s),i=i.replace(l[0],""),l[2]=l[2].replace(/^"(.+)"$/,"$1"),l[1]){case"realm":d=l[2];break;case"nonce":c=l[2];break;case"qop":l[2];break;case"host":r=l[2];}var p=e.servtype+"/"+e.domain;null!==r&&(p=p+"/"+r);var u=a.utf16to8(e.authcid+":"+d+":"+this._connection.pass),m=t.hash(u)+":"+c+":"+o,g="AUTHENTICATE:"+p,h="";return h+="charset=utf-8,",h+="username="+this._quote(a.utf16to8(e.authcid))+",",h+="realm="+this._quote(d)+",",h+="nonce="+this._quote(c)+",",h+="nc=00000001,",h+="cnonce="+this._quote(o)+",",h+="digest-uri="+this._quote(p)+",",h+="response="+t.hexdigest(t.hexdigest(m)+":"+c+":00000001:"+o+":auth:"+t.hexdigest(g))+",",h+="qop=auth",this.onChallenge=function(){return""},h},r.SASLOAuthBearer=function(){},r.SASLOAuthBearer.prototype=new r.SASLMechanism("OAUTHBEARER",!0,40),r.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},r.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="\x01",t+="auth=Bearer ",t+=e.pass,t+="\x01",t+="\x01",a.utf16to8(t)},r.SASLExternal=function(){},r.SASLExternal.prototype=new r.SASLMechanism("EXTERNAL",!0,10),r.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},r.SASLXOAuth2=function(){},r.SASLXOAuth2.prototype=new r.SASLMechanism("X-OAUTH2",!0,30),r.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},r.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,a.utf16to8(t)},{Strophe:r,$build:n,$iq:o,$msg:s,$pres:d,SHA1:e,MD5:t,b64_hmac_sha1:e.b64_hmac_sha1,b64_sha1:e.b64_sha1,str_hmac_sha1:e.str_hmac_sha1,str_sha1:e.str_sha1}}),function(e,t){if("function"==typeof c&&c.amd)c("strophe-bosh",["strophe-core"],function(e){return t(e.Strophe,e.$build)});else if("object"==typeof exports){var a=r("./core");module.exports=t(a.Strophe,a.$build)}else return t(Strophe,$build)}(this,function(t,a){return t.Request=function(e,a,i,n){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=a,this.func=a,this.rid=i,this.date=NaN,this.sends=n||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror";}else if(this.xhr.responseText)if(t.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=new DOMParser().parseFromString(this.xhr.responseText,"application/xml").documentElement,!e)throw new Error("Parsing produced null node");else if(e.querySelector("parsererror"))throw t.error("invalid response received: "+e.querySelector("parsererror").textContent),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},t.Bosh=function(e){this._conn=e,this.rid=n(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var e=a("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=n(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,a,i){this.wait=e||this.wait,this.hold=a||this.hold,this.errors=0;var n=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});i&&n.attrs({route:i});var s=this._conn._connect_cb;this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,s.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,a,i,n,s,o,d){this._conn.jid=e,this.sid=a,this.rid=i,this._conn.connect_callback=n,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=s||this.wait,this.hold=o||this.hold,this.window=d||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,a,i,n,s){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if("undefined"!=typeof o&&null!==o&&o.rid&&o.sid&&o.jid&&("undefined"==typeof e||null===e||t.getBareJidFromJid(o.jid)===t.getBareJidFromJid(e)||null===t.getNodeFromJid(e)&&t.getDomainFromJid(o.jid)===e))this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,a,i,n,s);else throw{name:"StropheSessionError",message:"_restore: no restoreable session."}},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var a=e.getAttribute("type"),i,n;if(null!==a&&"terminate"===a)return i=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+i),n=e.getElementsByTagName("conflict"),null===i?this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"):("remote-stream-error"===i&&0<n.length&&(i="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,i)),this._conn._doDisconnect(i),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var s=e.getAttribute("requests");s&&(this.window=parseInt(s,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var d=e.getAttribute("wait");d&&(this.wait=parseInt(d,10));var r=e.getAttribute("inactivity");r&&(this.inactivity=parseInt(r,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=n(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),a;a=this._conn.protocolErrorHandlers.HTTP[t],a&&a.call(this,t)},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){t.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var a=this._buildBody();this._requests.push(new t.Request(a.tree(),this._onRequestStateChange.bind(this,e),a.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var e;0<this._requests.length;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(2>this._requests.length&&0<e.length){for(var a=this._buildBody(),s=0;s<e.length;s++)null!==e[s]&&("restart"===e[s]?a.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):a.cnode(e[s]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(a.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),a.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(0<this._requests.length){var o=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>n(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),o>n(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+n(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,a){var i;if(4===e.xhr.readyState)try{i=e.xhr.status}catch(a){t.error("Caught an error while retrieving a request's status, reqStatus: "+i)}return"undefined"==typeof i&&(i="number"==typeof a?a:0),i},_onRequestStateChange:function(e,a){if(t.debug("request id "+a.id+"."+a.sends+" state changed to "+a.xhr.readyState),a.abort)return void(a.abort=!1);if(4===a.xhr.readyState){var i=this._getRequestStatus(a);if(this.lastResponseHeaders=a.xhr.getAllResponseHeaders(),this.disconnecting&&400<=i)return this._hitError(i),void this._callProtocolErrorHandlers(a);var s=0<i&&500>i,o=a.sends>this._conn.maxRetries;if((s||o)&&(this._removeRequest(a),t.debug("request id "+a.id+" should now be removed")),200===i){var d=this._requests[0]===a,r=this._requests[1]===a;(r||d&&0<this._requests.length&&this._requests[0].age()>n(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(+a.rid+1),t.debug("request id "+a.id+"."+a.sends+" got 200"),e(a),this.errors=0}else 0===i||400<=i&&600>i||12e3<=i?(t.error("request id "+a.id+"."+a.sends+" error "+i+" happened"),this._hitError(i),this._callProtocolErrorHandlers(a),400<=i&&500>i&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect())):t.error("request id "+a.id+"."+a.sends+" error "+i+" happened");s||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(t.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var a=this,i=this._requests[e],d=this._getRequestStatus(i,-1);if(i.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var r=i.age(),c=!isNaN(r)&&r>n(t.TIMEOUT*this.wait),l=null!==i.dead&&i.timeDead()>n(t.SECONDARY_TIMEOUT*this.wait),p=4===i.xhr.readyState&&(1>d||500<=d);if((c||l||p)&&(l&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),i.abort=!0,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[e]),0===i.xhr.readyState){t.debug("request id "+i.id+"."+i.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,!this._conn.options.sync),"undefined"!=typeof i.xhr.setRequestHeader&&i.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(i.xhr.withCredentials=!0)}catch(e){return t.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var m=function(){if(i.date=new Date,a._conn.options.customHeaders){var e=a._conn.options.customHeaders;for(var t in e)e.hasOwnProperty(t)&&i.xhr.setRequestHeader(t,e[t])}i.xhr.send(i.data)};if(1<i.sends){var g=1e3*o(n(t.TIMEOUT*this.wait),s(i.sends,3));setTimeout(function(){m()},g)}else m();i.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+i.xhr.readyState)},_removeRequest:function(e){t.debug("removing request");var a;for(a=this._requests.length-1;0<=a;a--)e===this._requests[a]&&this._requests.splice(a,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!==t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var a=this._buildBody().attrs({type:"terminate"});e&&a.cnode(e.tree());var i=new t.Request(a.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),a.tree().getAttribute("rid"));this._requests.push(i),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&e(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(e,t){if("function"==typeof c&&c.amd)c("strophe-websocket",["strophe-core"],function(e){return t(e.Strophe,e.$build)});else if("object"==typeof exports){var a=r("./core");module.exports=t(a.Strophe,a.$build)}else return t(Strophe,$build)}(this,function(t,a){return t.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var a="";a+="ws"===e.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",a+="://"+window.location.host,a+=0===t.indexOf("/")?t:window.location.pathname+t,e.service=a}},t.Websocket.prototype={_buildStream:function(){return a("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(a,n){var s;if(s=a.getElementsByTagNameNS?a.getElementsByTagNameNS(t.NS.STREAM,"error"):a.getElementsByTagName("stream:error"),0===s.length)return!1;for(var o=s[0],d="",r="",c=0,l;c<o.childNodes.length&&(l=o.childNodes[c],l.getAttribute("xmlns")==="urn:ietf:params:xml:ns:xmpp-streams");c++)"text"===l.nodeName?r=l.textContent:d=l.nodeName;var p="WebSocket stream error: ";return p+=d?d:"unknown",r&&(p+=" - "+r),t.error(p),this._conn._changeConnectStatus(n,d),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){var a=this._check_streamerror(e,t.Status.CONNFAIL);if(a)return t.Status.CONNFAIL},_handleStreamStart:function(e){var a=!1,i=e.getAttribute("xmlns");"string"==typeof i?i!==t.NS.FRAMING&&(a="Wrong xmlns in <open />: "+i):a="Missing xmlns in <open />";var n=e.getAttribute("version");return"string"==typeof n?"1.0"!=n&&(a="Wrong version in <open />: "+n):a="Missing version in <open />",!a||(this._conn._changeConnectStatus(t.Status.CONNFAIL,a),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var a=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===a)return;var i=new DOMParser().parseFromString(a,"text/xml").documentElement;this._conn.xmlInput(i),this._conn.rawInput(e.data),this._handleStreamStart(i)&&this._connect_cb(i)}else if(0===e.data.indexOf("<close ")){var n=new DOMParser().parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data);var s=n.getAttribute("see-other-uri");if(s){var o=this._conn.service,d=0<=o.indexOf("wss:")&&0<=s.indexOf("wss:")||0<=o.indexOf("ws:");d&&(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=s,this._connect())}else this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var r=this._streamWrap(e.data),c=new DOMParser().parseFromString(r,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(c,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var i=a("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(i.tree());var n=t.serialize(i);this._conn.rawOutput(n);try{this.socket.send(n)}catch(a){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(t){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(a){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):a&&1006===a.code&&!this._conn.connected&&this.socket?(t.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(t.Status.CONNFAIL,t.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){t.error("Websocket error "+e),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(0<e.length&&!this._conn.paused){for(var a=0;a<e.length;a++)if(null!==e[a]){var n,s;n="restart"===e[a]?this._buildStream().tree():e[a],s=t.serialize(n),this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}},_onMessage:function(e){var a="<close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing\" />",i,n;if(e.data===a)return this._conn.rawInput(a),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0!==e.data.search("<open "))n=this._streamWrap(e.data),i=new DOMParser().parseFromString(n,"text/xml").documentElement;else if(i=new DOMParser().parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(i))return;return this._check_streamerror(i,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===i.firstChild.nodeName&&"unavailable"===i.firstChild.getAttribute("type")?(this._conn.xmlInput(i),void this._conn.rawInput(t.serialize(i))):void this._conn._dataRecv(i,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var a=t.serialize(e);this._conn.rawOutput(a),this.socket.send(a)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},t}),function(){if("function"==typeof c&&c.amd)c("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(e){return e});else if("object"==typeof exports){var e=r("./core");r("./bosh"),r("./websocket"),module.exports=e}}(this),r(["strophe-polyfill"]),r("strophe")});(function(e,t){"function"==typeof define&&define.amd?define("strophe.disco",["strophe"],function(e){return t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}):t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres)})(this,function(e,t,a){e.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(t){this._connection=t,this._identities=[],this._features=[],this._items=[],t.addHandler(this._onDiscoInfo.bind(this),e.NS.DISCO_INFO,"iq","get",null,null),t.addHandler(this._onDiscoItems.bind(this),e.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(e,t,a,n){for(var s=0;s<this._identities.length;s++)if(this._identities[s].category==e&&this._identities[s].type==t&&this._identities[s].name==a&&this._identities[s].lang==n)return!1;return this._identities.push({category:e,type:t,name:a,lang:n}),!0},addFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]==e)return!1;return this._features.push(e),!0},removeFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]===e)return this._features.splice(t,1),!0;return!1},addItem:function(e,t,a,i){return(!a||i)&&(this._items.push({jid:e,name:t,node:a,call_back:i}),!0)},info:function(t,i,n,s,o){var d={xmlns:e.NS.DISCO_INFO};i&&(d.node=i);var r=a({from:this._connection.jid,to:t,type:"get"}).c("query",d);this._connection.sendIQ(r,n,s,o)},items:function(t,i,n,s,o){var d={xmlns:e.NS.DISCO_ITEMS};i&&(d.node=i);var r=a({from:this._connection.jid,to:t,type:"get"}).c("query",d);this._connection.sendIQ(r,n,s,o)},_buildIQResult:function(e,t){var i=e.getAttribute("id"),n=e.getAttribute("from"),s=a({type:"result",id:i});return null!==n&&s.attrs({to:n}),s.c("query",t)},_onDiscoInfo:function(t){var a=t.getElementsByTagName("query")[0].getAttribute("node"),n={xmlns:e.NS.DISCO_INFO},s;a&&(n.node=a);var o=this._buildIQResult(t,n);for(s=0;s<this._identities.length;s++)n={category:this._identities[s].category,type:this._identities[s].type},this._identities[s].name&&(n.name=this._identities[s].name),this._identities[s].lang&&(n["xml:lang"]=this._identities[s].lang),o.c("identity",n).up();for(s=0;s<this._features.length;s++)o.c("feature",{var:this._features[s]}).up();return this._connection.send(o.tree()),!0},_onDiscoItems:function(t){var a={xmlns:e.NS.DISCO_ITEMS},n=t.getElementsByTagName("query")[0].getAttribute("node"),s,o;if(n){for(a.node=n,s=[],o=0;o<this._items.length;o++)if(this._items[o].node==n){s=this._items[o].call_back(t);break}}else s=this._items;var d=this._buildIQResult(t,a);for(o=0;o<s.length;o++){var r={jid:s[o].jid};s[o].name&&(r.name=s[o].name),s[o].node&&(r.node=s[o].node),d.c("item",r).up()}return this._connection.send(d.tree()),!0}})}),function(e,t){"function"==typeof define&&define.amd?define("strophe.ping",["strophe"],function(e){return t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}):t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres)}(this,function(e,t,a){e.addConnectionPlugin("ping",{_c:null,init:function(t){this._c=t,e.addNamespace("PING","urn:xmpp:ping")},ping:function(t,i,n,s){var o=this._c.getUniqueId("ping"),d=a({type:"get",to:t,id:o}).c("ping",{xmlns:e.NS.PING});this._c.sendIQ(d,i,n,s)},pong:function(e){var t=e.getAttribute("from"),i=e.getAttribute("id"),n=a({type:"result",to:t,id:i});this._c.sendIQ(n)},addPingHandler:function(t){return this._c.addHandler(t,e.NS.PING,"iq","get")}})}),function(e,t){"function"==typeof define&&define.amd?define("strophe.rsm",["strophe"],function(e){return t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}):t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres)}(this,function(e,t){e.addNamespace("RSM","http://jabber.org/protocol/rsm"),e.RSM=function(e){if(this.attribs=["max","first","last","after","before","index","count"],"undefined"!=typeof e.xml)this.fromXMLElement(e.xml);else for(var t=0,a;t<this.attribs.length;t++)a=this.attribs[t],this[a]=e[a]},e.RSM.prototype={toXML:function(){for(var a=t("set",{xmlns:e.NS.RSM}),i=0,n;i<this.attribs.length;i++)n=this.attribs[i],"undefined"!=typeof this[n]&&(a=a.c(n).t(this[n].toString()).up());return a.tree()},next:function(t){var a=new e.RSM({max:t,after:this.last});return a},previous:function(t){var a=new e.RSM({max:t,before:this.first});return a},fromXMLElement:function(t){for(var a=0;a<this.attribs.length;a++){var i=this.attribs[a],n=t.getElementsByTagName(i)[0];"undefined"!=typeof n&&null!==n&&(this[i]=e.getText(n),"first"==i&&(this.index=n.getAttribute("index")))}}}}),function(e,t){define("strophe.caps",["strophe","strophe.disco"],function(e){t(e.Strophe,e.SHA1,e.$build,e.$iq,e.$msg,e.$pres)})}(this,function(e,t,a,i,n,s){var o=t.b64_sha1;e.addConnectionPlugin("caps",function(){var t,n,d,r,c,l,p,u;return n=null,c=function(t){if(n=t,e.addNamespace("CAPS","http://jabber.org/protocol/caps"),void 0===n.disco)throw new Error("disco plugin required!");if(void 0===o)throw new Error("SHA-1 library required!");n.disco.addFeature(e.NS.CAPS),n.disco.addFeature(e.NS.DISCO_INFO)},t=function(e){return n.disco.addFeature(e)},p=function(e){return n.disco.removeFeature(e)},getPres=function(){return s().cnode(d())},u=function(){return n.send(s().cnode(d().tree()))},d=function(t){t||(t={});var i=t.node;return i||(0<n.disco._identities.length?i=n.disco._identities[0].name||"":i="strophejs"),a("c",{xmlns:e.NS.CAPS,hash:"sha-1",node:i,ver:r()})},l=function(e,t){return e.sort(function(e,a){return e[t]>a[t]?-1:1})},r=function(){var e,t,a,s,d,r,c,p,u,m,g,h,v,f,b,x;for(d=[],b=n.disco._identities,(u=0,h=b.length);u<h;u++)a=b[u],d.push(a);for(t=[],x=n.disco._features,(m=0,v=x.length);m<v;m++)r=x[m],t.push(r);for(c in e="",l(d,"category"),l(d,"type"),l(d,"lang"),d)s=d[c],e+=""+s.category+"/"+s.type+"/"+s.lang+"/"+s.name+"<";for(t.sort(),g=0,f=t.length;g<f;g++)p=t[g],e+=""+p+"<";return o(e)},{init:c,removeFeature:p,addFeature:t,sendPres:u,generateVerificationString:r,createCapsNode:d}}())}),function(e,t){define("strophe.pubsub",["strophe","strophe.disco"],function(e){t(e.Strophe,e.$build,e.$iq)})}(this,function(e,t,a){e.Builder.prototype.form=function(t,a){var n=this.node.appendChild(e.xmlElement("x",{xmlns:"jabber:x:data",type:"submit"}));for(var s in n.appendChild(e.xmlElement("field",{var:"FORM_TYPE",type:"hidden"})).appendChild(e.xmlElement("value")).appendChild(e.xmlTextNode(t)),a)n.appendChild(e.xmlElement("field",{var:s})).appendChild(e.xmlElement("value")).appendChild(e.xmlTextNode(a[s]));return this},e.Builder.prototype.list=function(t,a){for(var n=0;n<a.length;++n)this.c(t,a[n].attrs),this.node.appendChild(a[n].data.cloneNode?a[n].data.cloneNode(!0):e.xmlTextNode(a[n].data)),this.up();return this},e.Builder.prototype.children=function(e){var t,a;for(t in e)e.hasOwnProperty(t)&&(a=e[t],Array.isArray(a)?this.list(t,a):"string"==typeof a?this.c(t,{},a):"number"==typeof a?this.c(t,{},""+a):"object"==typeof a?this.c(t).children(a).up():this.c(t).up());return this},e.addConnectionPlugin("pubsub",{_connection:null,_autoService:!0,service:null,jid:null,handler:{},init:function(t){this._connection=t,e.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),e.addNamespace("PUBSUB_SUBSCRIBE_OPTIONS",e.NS.PUBSUB+"#subscribe_options"),e.addNamespace("PUBSUB_ERRORS",e.NS.PUBSUB+"#errors"),e.addNamespace("PUBSUB_EVENT",e.NS.PUBSUB+"#event"),e.addNamespace("PUBSUB_OWNER",e.NS.PUBSUB+"#owner"),e.addNamespace("PUBSUB_AUTO_CREATE",e.NS.PUBSUB+"#auto-create"),e.addNamespace("PUBSUB_PUBLISH_OPTIONS",e.NS.PUBSUB+"#publish-options"),e.addNamespace("PUBSUB_NODE_CONFIG",e.NS.PUBSUB+"#node_config"),e.addNamespace("PUBSUB_CREATE_AND_CONFIGURE",e.NS.PUBSUB+"#create-and-configure"),e.addNamespace("PUBSUB_SUBSCRIBE_AUTHORIZATION",e.NS.PUBSUB+"#subscribe_authorization"),e.addNamespace("PUBSUB_GET_PENDING",e.NS.PUBSUB+"#get-pending"),e.addNamespace("PUBSUB_MANAGE_SUBSCRIPTIONS",e.NS.PUBSUB+"#manage-subscriptions"),e.addNamespace("PUBSUB_META_DATA",e.NS.PUBSUB+"#meta-data"),e.addNamespace("ATOM","http://www.w3.org/2005/Atom"),t.disco&&t.disco.addFeature(e.NS.PUBSUB)},statusChanged:function(t){var a=this._connection;this._autoService&&t===e.Status.CONNECTED&&(this.service="pubsub."+e.getDomainFromJid(a.jid),this.jid=a.jid)},connect:function(e,t){var a=this._connection;t===void 0&&(t=e,e=void 0),this.jid=e||a.jid,this.service=t||null,this._autoService=!1},storeHandler:function(e,t){this.handler[e]||(this.handler[e]=[]),this.handler[e].push(t)},removeHandler:function(e){var t=this.handler[e];if(this.handler[e]=[],t&&0<t.length)for(var a=0,n=t.length;a<n;a++)this._connection.deleteHandler(t[a])},createNode:function(t,i,n){var s=this._connection,o=s.getUniqueId("pubsubcreatenode"),d=a({from:this.jid,to:this.service,type:"set",id:o}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("create",{node:t});return i&&d.up().c("configure").form(e.NS.PUBSUB_NODE_CONFIG,i),s.addHandler(n,null,"iq",null,o,null),s.send(d.tree()),o},deleteNode:function(t,i){var n=this._connection,s=n.getUniqueId("pubsubdeletenode"),o=a({from:this.jid,to:this.service,type:"set",id:s}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("delete",{node:t});return n.addHandler(i,null,"iq",null,s,null),n.send(o.tree()),s},discoverNodes:function(t,i,n){var s=a({from:this.jid,to:this.service,type:"get"}).c("query",{xmlns:e.NS.DISCO_ITEMS});return this._connection.sendIQ(s.tree(),t,i,n)},getConfig:function(t,i){var n=this._connection,s=n.getUniqueId("pubsubconfigurenode"),o=a({from:this.jid,to:this.service,type:"get",id:s}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("configure",{node:t});return n.addHandler(i,null,"iq",null,s,null),n.send(o.tree()),s},getDefaultNodeConfig:function(t){var i=this._connection,n=i.getUniqueId("pubsubdefaultnodeconfig"),s=a({from:this.jid,to:this.service,type:"get",id:n}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("default");return i.addHandler(t,null,"iq",null,n,null),i.send(s.tree()),n},subscribe:function(t,i,n,s,o,d){var r=this._connection,c=r.getUniqueId("subscribenode"),l=this.jid;d&&(l=e.getBareJidFromJid(l));var p=a({from:this.jid,to:this.service,type:"set",id:c}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("subscribe",{node:t,jid:l});i&&p.up().c("options").form(e.NS.PUBSUB_SUBSCRIBE_OPTIONS,i);var u=r.addHandler(n,null,"message",null,null,null);return this.storeHandler(t,u),r.sendIQ(p.tree(),s,o),c},unsubscribe:function(t,i,n,s,o){var d=this._connection,r=d.getUniqueId("pubsubunsubscribenode"),c=a({from:this.jid,to:this.service,type:"set",id:r}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("unsubscribe",{node:t,jid:i});return n&&c.attrs({subid:n}),d.sendIQ(c.tree(),s,o),this.removeHandler(t),r},publish:function(t,i,n){var s=this._connection,o=s.getUniqueId("pubsubpublishnode"),d=a({from:this.jid,to:this.service,type:"set",id:o}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("publish",{node:t,jid:this.jid}).list("item",i);return s.addHandler(n,null,"iq",null,o,null),s.send(d.tree()),o},items:function(t,i,n,s){var o=a({from:this.jid,to:this.service,type:"get"}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("items",{node:t});return this._connection.sendIQ(o.tree(),i,n,s)},getSubscriptions:function(t){var i=this._connection,n=i.getUniqueId("pubsubsubscriptions"),s=a({from:this.jid,to:this.service,type:"get",id:n}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("subscriptions");return i.addHandler(t,null,"iq",null,n,null),i.send(s.tree()),n},getNodeSubscriptions:function(t,i){var n=this._connection,s=n.getUniqueId("pubsubsubscriptions"),o=a({from:this.jid,to:this.service,type:"get",id:s}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("subscriptions",{node:t});return n.addHandler(i,null,"iq",null,s,null),n.send(o.tree()),s},getSubOptions:function(t,i,n){var s=this._connection,o=s.getUniqueId("pubsubsuboptions"),d=a({from:this.jid,to:this.service,type:"get",id:o}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("options",{node:t,jid:this.jid});return i&&d.attrs({subid:i}),s.addHandler(n,null,"iq",null,o,null),s.send(d.tree()),o},getAffiliations:function(t,i){var n=this._connection,s=n.getUniqueId("pubsubaffiliations");"function"==typeof t&&(i=t,t=void 0);var o={},d={xmlns:e.NS.PUBSUB};t&&(o.node=t,d={xmlns:e.NS.PUBSUB_OWNER});var r=a({from:this.jid,to:this.service,type:"get",id:s}).c("pubsub",d).c("affiliations",o);return n.addHandler(i,null,"iq",null,s,null),n.send(r.tree()),s},setAffiliation:function(t,i,n,s){var o=this._connection,d=o.getUniqueId("pubsubaffiliations"),r=a({from:this.jid,to:this.service,type:"set",id:d}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("affiliations",{node:t}).c("affiliation",{jid:i,affiliation:n});return o.addHandler(s,null,"iq",null,d,null),o.send(r.tree()),d},publishAtom:function(a,n,s){Array.isArray(n)||(n=[n]);var o=[],d,r;for(d=0;d<n.length;d++)r=n[d],r.updated=r.updated||new Date().toISOString(),r.published&&r.published.toISOString&&(r.published=r.published.toISOString()),o.push({data:t("entry",{xmlns:e.NS.ATOM}).children(r).tree(),attrs:r.id?{id:r.id}:{}});return this.publish(a,o,s)}})}),function(e,t){define("backbone.localsync",["backbone","underscore"],function(e,a){return t(e,a)})}(this,function(t,a){try{localStorage.setItem("test",1),localStorage.removeItem("test"),t.useLocalStorage=!0}catch(a){Storage.prototype._getItem=Storage.prototype.getItem,Storage.prototype._setItem=Storage.prototype.setItem,Storage.prototype._removeItem=Storage.prototype.removeItem,Storage.prototype.getItem=function(){},Storage.prototype.setItem=function(){},Storage.prototype.removeItem=function(){},t.useLocalStorage=!1}var e=function(e){this.name=e;var t=localStorage.getItem(this.name);this.records=this.from_string(t,[])},i=function(e){this.version=e.version||1,this.name=e.name;var t=indexedDB.open(this.name,this.version);t.onupgradeneeded=function(){let e=t.result;this.createStore(e)}.bind(this),t.onsuccess=function(){this.db=t.result}.bind(this),this.createStore=function(t){t.createObjectStore(e.objStoreName,{keyPath:e.primKey})}};a.extend(i.prototype,{put:function(e,t,a){if(!this.db)return void(a&&a(!1));let i=this.db.transaction([e],"readwrite").objectStore(e),n=i.put(t);n.onsuccess=function(){a&&a(!0)}.bind(this),n.onerror=function(){a&&a(!1)}.bind(this)},get_all:function(e,t,i){if(!this.db)return void(i&&i(null));let n=this.db.transaction([e],"readonly").objectStore(e),s;s=a.isNull(t)?n.getAll():n.getAll(t),s.onsuccess=function(e){var t=e.target.result;t===void 0?i&&i(null):i&&i(t)}.bind(this)},get:function(e,t,a){if(!this.db)return void(a&&a(null));let i=this.db.transaction([e],"readonly").objectStore(e),n=i.get(t);n.onsuccess=function(e){var t=e.target.result;t===void 0?a&&a(null):a&&a(t)}.bind(this)},remove:function(e,t,a){if(!this.db)return void(a&&a(!1));let i=this.db.transaction([e],"readwrite").objectStore(e);var n=i.delete(t);n.onsuccess=function(){a&&a(!0)}.bind(this),n.onerror=function(){a&&a(!1)}.bind(this)},clear_database:function(e,t){if(!this.db)return void(t&&t(!1));let a=this.db.transaction([e],"readwrite").objectStore(e);var i=a.clear();i.onsuccess=function(){t&&t(!0)}.bind(this),i.onerror=function(){t&&t(!1)}.bind(this)}}),a.extend(e.prototype,{from_string:function(e,t){if(!e)return t;try{return JSON.parse(e)}catch(a){return t||{}}},to_string:function(e){try{return JSON.stringify(e)}catch(t){return""}},save:function(){this.records.length?localStorage.setItem(this.name,this.to_string(this.records)):localStorage.removeItem(this.name)},clear:function(){a.each(this.records,function(e){localStorage.removeItem(this._itemName(e))}.bind(this)),localStorage.removeItem(this.name)},create:function(e){localStorage.setItem(this._itemName(e.id),this.to_string(e)),this.records.push(e.id),this.save()},update:function(e){localStorage.setItem(this._itemName(e.id),this.to_string(e)),a.contains(this.records,e.id)||(this.records.push(e.id),this.save())},find:function(e){var t=localStorage.getItem(this._itemName(e.id));return this.from_string(t,{})},findAll:function(){return a.reduce(this.records,function(e,t){var a=localStorage.getItem(this._itemName(t));return a&&e.push(this.from_string(a,{})),e}.bind(this),[])},destroy:function(e){localStorage.removeItem(this._itemName(e.id));var t=this.records.indexOf(e.id);0<=t&&(this.records.splice(t,1),this.save())},_itemName:function(e){return this.name+"-"+e}}),t.sync=function(e,t,a){var i=t.storage||t.collection&&t.collection.storage;if(!i)return!1;var n;"read"===e?n=t.id?i.find(t):i.findAll():"create"===e?n=i.create(t):"update"===e?n=i.update(t):"delete"===e?n=i.destroy(t):void 0;n?a.success(n):a.error("Record not found")},t.ModelWithStorage=t.Model.extend({initialize:function(t,a){this.storage=new e(a.storage_name),"before"===a.fetch&&this.fetch(),this._initialize&&this._initialize(t,a),"after"===a.fetch&&this.fetch()},clearStorage:function(){this.storage.clear()}}),t.ModelWithDataBase=t.Model.extend({initialize:function(e,t){this.database=new i(t),this._initialize&&this._initialize(e,t)},clearDataBase:function(){this.database.clear()}}),t.CollectionWithStorage=t.Collection.extend({initialize:function(t,a){this.storage=new e(a.storage_name),this._initialize&&this._initialize(t,a)},clearStorage:function(){this.storage.clear()}})}),!function(){"use strict";function t(e){e?(f[0]=f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0,this.blocks=f):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}var h="object"==typeof window?window:{},s=!h.JS_SHA1_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;s&&(h=global);var i=!h.JS_SHA1_NO_COMMON_JS&&"object"==typeof module&&module.exports,e="function"==typeof define&&define.amd,r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],o=[-2147483648,8388608,32768,128],n=[24,16,8,0],a=["hex","array","digest","arrayBuffer"],f=[],u=function(e){return function(a){return new t(!0).update(a)[e]()}},c=function(){var n=u("hex");s&&(n=p(n)),n.create=function(){return new t},n.update=function(e){return n.create().update(e)};for(var o=0,d;o<a.length;++o)d=a[o],n[d]=u(d);return n},p=function(t){var h=eval("require('crypto')"),s=eval("require('buffer').Buffer"),i=function(e){if("string"==typeof e)return h.createHash("sha1").update(e,"utf8").digest("hex");if(e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(void 0===e.length)return t(e);return h.createHash("sha1").update(new s(e)).digest("hex")};return i};t.prototype.update=function(d){if(!this.finalized){var c="string"!=typeof d;c&&d.constructor===h.ArrayBuffer&&(d=new Uint8Array(d));for(var s=0,l=d.length||0,o=this.blocks,a,p;s<l;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),c)for(p=this.start;s<l&&64>p;++s)o[p>>2]|=d[s]<<n[3&p++];else for(p=this.start;s<l&&64>p;++s)128>(a=d.charCodeAt(s))?o[p>>2]|=a<<n[3&p++]:2048>a?(o[p>>2]|=(192|a>>6)<<n[3&p++],o[p>>2]|=(128|63&a)<<n[3&p++]):55296>a||57344<=a?(o[p>>2]|=(224|a>>12)<<n[3&p++],o[p>>2]|=(128|63&a>>6)<<n[3&p++],o[p>>2]|=(128|63&a)<<n[3&p++]):(a=65536+((1023&a)<<10|1023&d.charCodeAt(++s)),o[p>>2]|=(240|a>>18)<<n[3&p++],o[p>>2]|=(128|63&a>>12)<<n[3&p++],o[p>>2]|=(128|63&a>>6)<<n[3&p++],o[p>>2]|=(128|63&a)<<n[3&p++]);this.lastByteIndex=p,this.bytes+=p-this.start,64<=p?(this.block=o[16],this.start=p-64,this.hash(),this.hashed=!0):this.start=p}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes%=4294967296),this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=o[3&t],this.block=e[16],56<=t&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},t.prototype.hash=function(){var a=this.h0,d=this.h1,c=this.h2,l=this.h3,p=this.h4,u=this.blocks,n,m;for(n=16;80>n;++n)m=u[n-3]^u[n-8]^u[n-14]^u[n-16],u[n]=m<<1|m>>>31;for(n=0;20>n;n+=5)a=(m=(d=(m=(c=(m=(l=(m=(p=(m=a<<5|a>>>27)+(d&c|~d&l)+p+1518500249+u[n]<<0)<<5|p>>>27)+(a&(d=d<<30|d>>>2)|~a&c)+l+1518500249+u[n+1]<<0)<<5|l>>>27)+(p&(a=a<<30|a>>>2)|~p&d)+c+1518500249+u[n+2]<<0)<<5|c>>>27)+(l&(p=p<<30|p>>>2)|~l&a)+d+1518500249+u[n+3]<<0)<<5|d>>>27)+(c&(l=l<<30|l>>>2)|~c&p)+a+1518500249+u[n+4]<<0,c=c<<30|c>>>2;for(;40>n;n+=5)a=(m=(d=(m=(c=(m=(l=(m=(p=(m=a<<5|a>>>27)+(d^c^l)+p+1859775393+u[n]<<0)<<5|p>>>27)+(a^(d=d<<30|d>>>2)^c)+l+1859775393+u[n+1]<<0)<<5|l>>>27)+(p^(a=a<<30|a>>>2)^d)+c+1859775393+u[n+2]<<0)<<5|c>>>27)+(l^(p=p<<30|p>>>2)^a)+d+1859775393+u[n+3]<<0)<<5|d>>>27)+(c^(l=l<<30|l>>>2)^p)+a+1859775393+u[n+4]<<0,c=c<<30|c>>>2;for(;60>n;n+=5)a=(m=(d=(m=(c=(m=(l=(m=(p=(m=a<<5|a>>>27)+(d&c|d&l|c&l)+p-1894007588+u[n]<<0)<<5|p>>>27)+(a&(d=d<<30|d>>>2)|a&c|d&c)+l-1894007588+u[n+1]<<0)<<5|l>>>27)+(p&(a=a<<30|a>>>2)|p&d|a&d)+c-1894007588+u[n+2]<<0)<<5|c>>>27)+(l&(p=p<<30|p>>>2)|l&a|p&a)+d-1894007588+u[n+3]<<0)<<5|d>>>27)+(c&(l=l<<30|l>>>2)|c&p|l&p)+a-1894007588+u[n+4]<<0,c=c<<30|c>>>2;for(;80>n;n+=5)a=(m=(d=(m=(c=(m=(l=(m=(p=(m=a<<5|a>>>27)+(d^c^l)+p-899497514+u[n]<<0)<<5|p>>>27)+(a^(d=d<<30|d>>>2)^c)+l-899497514+u[n+1]<<0)<<5|l>>>27)+(p^(a=a<<30|a>>>2)^d)+c-899497514+u[n+2]<<0)<<5|c>>>27)+(l^(p=p<<30|p>>>2)^a)+d-899497514+u[n+3]<<0)<<5|d>>>27)+(c^(l=l<<30|l>>>2)^p)+a-899497514+u[n+4]<<0,c=c<<30|c>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+d<<0,this.h2=this.h2+c<<0,this.h3=this.h3+l<<0,this.h4=this.h4+p<<0},t.prototype.hex=function(){this.finalize();var a=this.h0,t=this.h1,n=this.h2,s=this.h3,i=this.h4;return r[15&a>>28]+r[15&a>>24]+r[15&a>>20]+r[15&a>>16]+r[15&a>>12]+r[15&a>>8]+r[15&a>>4]+r[15&a]+r[15&t>>28]+r[15&t>>24]+r[15&t>>20]+r[15&t>>16]+r[15&t>>12]+r[15&t>>8]+r[15&t>>4]+r[15&t]+r[15&n>>28]+r[15&n>>24]+r[15&n>>20]+r[15&n>>16]+r[15&n>>12]+r[15&n>>8]+r[15&n>>4]+r[15&n]+r[15&s>>28]+r[15&s>>24]+r[15&s>>20]+r[15&s>>16]+r[15&s>>12]+r[15&s>>8]+r[15&s>>4]+r[15&s]+r[15&i>>28]+r[15&i>>24]+r[15&i>>20]+r[15&i>>16]+r[15&i>>12]+r[15&i>>8]+r[15&i>>4]+r[15&i]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var a=this.h0,t=this.h1,n=this.h2,s=this.h3,i=this.h4;return[255&a>>24,255&a>>16,255&a>>8,255&a,255&t>>24,255&t>>16,255&t>>8,255&t,255&n>>24,255&n>>16,255&n>>8,255&n,255&s>>24,255&s>>16,255&s>>8,255&s,255&i>>24,255&i>>16,255&i>>8,255&i]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};var y=c();i?module.exports=y:(h.sha1=y,e&&define("sha1_hasher",[],function(){return y}))}(),!function(M,L,a,Y){"use strict";var Re=Math.abs;function X(e,t,a){return setTimeout(p(e,a),t)}function d(e,t,a){return!!Array.isArray(e)&&(l(e,a[t],a),!0)}function l(t,a,i){if(t)if(t.forEach)t.forEach(a,i);else if(t.length!==Y)for(n=0;n<t.length;)a.call(i,t[n],n,t),n++;else for(var n in t)t.hasOwnProperty(n)&&a.call(i,t[n],n,t)}function m(t,a,i){for(var n=Object.keys(a),e=0;e<n.length;)(!i||i&&t[n[e]]===Y)&&(t[n[e]]=a[n[e]]),e++;return t}function n(e,t){return m(e,t,!0)}function o(t,a,i){var n=a.prototype,s;s=t.prototype=Object.create(n),s.constructor=t,s._super=n,i&&m(s,i)}function p(e,t){return function(){return e.apply(t,arguments)}}function k(e,t){return typeof e==f?e.apply(t?t[0]||Y:Y,t):e}function r(e,t){return e===Y?t:e}function s(e,t,a){l(w(t),function(t){e.addEventListener(t,a,!1)})}function t(e,t,a){l(w(t),function(t){e.removeEventListener(t,a,!1)})}function u(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function v(e,t){return-1<e.indexOf(t)}function w(e){return e.trim().split(/\s+/g)}function x(e,t,a){if(e.indexOf&&!a)return e.indexOf(t);for(var i=0;i<e.length;){if(a&&e[i][a]==t||!a&&e[i]===t)return i;i++}return-1}function q(e){return Array.prototype.slice.call(e,0)}function z(t,i,a){for(var n=[],s=[],e=0,o;e<t.length;)o=i?t[e][i]:t[e],0>x(s,o)&&n.push(t[e]),s[e]=o,e++;return a&&(n=i?n.sort(function(e,t){return e[i]>t[i]}):n.sort()),n}function A(e,t){for(var a=t[0].toUpperCase()+t.slice(1),i=0,n,s;i<Oe.length;){if(n=Oe[i],s=n?n+a:t,s in e)return s;i++}return Y}function c(){return i++}function b(e){var t=e.ownerDocument;return t.defaultView||t.parentWindow}function E(e,t){var a=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){k(e.options.enable,[e])&&a.handler(t)},this.init()}function D(e){var t=e.options.inputClass,a;return a=t?t:G?ce:H?ue:F?ge:re,new a(e,B)}function B(t,a,i){var n=i.pointers.length,s=i.changedPointers.length,e=a&N&&0==n-s;i.isFirst=!!e,i.isFinal=!!(a&(P|Q)&&0==n-s),e&&(t.session={}),i.eventType=a,J(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function J(t,a){var n=t.session,s=a.pointers,o=s.length;n.firstInput||(n.firstInput=ee(a)),1<o&&!n.firstMultiple?n.firstMultiple=ee(a):1===o&&(n.firstMultiple=!1);var e=n.firstInput,d=n.firstMultiple,r=d?d.center:e.center,c=a.center=te(s);a.timeStamp=Pe(),a.deltaTime=a.timeStamp-e.timeStamp,a.angle=se(r,c),a.distance=ne(r,c),K(n,a),a.offsetDirection=ie(a.deltaX,a.deltaY),a.scale=d?de(d.pointers,s):1,a.rotation=d?oe(d.pointers,s):0,Z(n,a);var i=t.element;u(a.srcEvent.target,i)&&(i=a.srcEvent.target),a.target=i}function K(t,a){var i=a.center,n=t.offsetDelta||{},s=t.prevDelta||{},o=t.prevInput||{};(a.eventType===N||o.eventType===P)&&(s=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),a.deltaX=s.x+(i.x-n.x),a.deltaY=s.y+(i.y-n.y)}function Z(t,a){var i=t.lastInterval||a,n=a.timeStamp-i.timeStamp,e,s,o,d;if(a.eventType!=Q&&(n>I||i.velocity===Y)){var r=i.deltaX-a.deltaX,c=i.deltaY-a.deltaY,l=ae(n,r,c);s=l.x,o=l.y,e=h(l.x)>h(l.y)?l.x:l.y,d=ie(r,c),t.lastInterval=a}else e=i.velocity,s=i.velocityX,o=i.velocityY,d=i.direction;a.velocity=e,a.velocityX=s,a.velocityY=o,a.direction=d}function ee(e){for(var t=[],a=0;a<e.pointers.length;)t[a]={clientX:g(e.pointers[a].clientX),clientY:g(e.pointers[a].clientY)},a++;return{timeStamp:Pe(),pointers:t,center:te(t),deltaX:e.deltaX,deltaY:e.deltaY}}function te(t){var a=t.length;if(1===a)return{x:g(t[0].clientX),y:g(t[0].clientY)};for(var i=0,n=0,s=0;a>s;)i+=t[s].clientX,n+=t[s].clientY,s++;return{x:g(i/a),y:g(n/a)}}function ae(e,t,a){return{x:t/e||0,y:a/e||0}}function ie(e,t){return e===t?R:h(e)>=h(t)?0<e?S:T:0<t?U:V}function ne(t,a,i){i||(i=W);var n=a[i[0]]-t[i[0]],s=a[i[1]]-t[i[1]];return Math.sqrt(n*n+s*s)}function se(t,a,i){i||(i=W);var n=a[i[0]]-t[i[0]],s=a[i[1]]-t[i[1]];return 180*Math.atan2(s,n)/Math.PI}function oe(e,t){return se(t[1],t[0],$e)-se(e[1],e[0],$e)}function de(e,t){return ne(t[0],t[1],$e)/ne(e[0],e[1],$e)}function re(){this.evEl=De,this.evWin=Le,this.allow=!0,this.pressed=!1,E.apply(this,arguments)}function ce(){this.evEl=Ve,this.evWin=qe,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function le(){this.evTarget=Fe,this.evWin=ze,this.started=!1,E.apply(this,arguments)}function pe(e,t){var a=q(e.touches),i=q(e.changedTouches);return t&(P|Q)&&(a=z(a.concat(i),"identifier",!0)),[a,i]}function ue(){this.evTarget=We,this.targetIds={},E.apply(this,arguments)}function me(t,a){var n=q(t.touches),s=this.targetIds;if(a&(N|O)&&1===n.length)return s[n[0].identifier]=!0,[n,n];var o=q(t.changedTouches),d=[],r=this.target,i,c;if(c=n.filter(function(e){return u(e.target,r)}),a===N)for(i=0;i<c.length;)s[c[i].identifier]=!0,i++;for(i=0;i<o.length;)s[o[i].identifier]&&d.push(o[i]),a&(P|Q)&&delete s[o[i].identifier],i++;return d.length?[z(c.concat(d),"identifier",!0),d]:void 0}function ge(){E.apply(this,arguments);var e=p(this.handler,this);this.touch=new ue(this.manager,e),this.mouse=new re(this.manager,e)}function he(e,t){this.manager=e,this.set(t)}function ve(e){if(v(e,Ke))return Ke;var t=v(e,Ze),a=v(e,et);return t&&a?Ze+" "+et:t||a?t?Ze:et:v(e,Je)?Je:Qe}function fe(e){this.id=c(),this.manager=null,this.options=n(e||{},this.defaults),this.options.enable=r(this.options.enable,!0),this.state=tt,this.simultaneous={},this.requireFail=[]}function _e(e){return e&st?"cancel":e&nt?"end":e&it?"move":e&at?"start":""}function be(e){return e==V?"down":e==U?"up":e==S?"left":e==T?"right":""}function ye(e,t){var a=t.manager;return a?a.get(e):e}function xe(){fe.apply(this,arguments)}function we(){xe.apply(this,arguments),this.pX=null,this.pY=null}function Ce(){xe.apply(this,arguments)}function Se(){fe.apply(this,arguments),this._timer=null,this._input=null}function ke(){xe.apply(this,arguments)}function Ae(){xe.apply(this,arguments)}function Te(){fe.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ee(e,t){return t=t||{},t.recognizers=r(t.recognizers,Ee.defaults.preset),new Me(e,t)}function Me(e,t){t=t||{},this.options=n(t,Ee.defaults),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=D(this),this.touchAction=new he(this,this.options.touchAction),Ie(this,!0),l(t.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function Ie(e,t){var i=e.element;l(e.options.cssProps,function(e,a){i.style[A(i.style,a)]=t?e:""})}function Ne(e,t){var a=L.createEvent("Event");a.initEvent(e,!0,!0),a.gesture=t,t.target.dispatchEvent(a)}var Oe=["","webkit","moz","MS","ms","o"],e=L.createElement("div"),f="function",g=Math.round,h=Re,Pe=Date.now,i=1,j=/mobile|tablet|ip(ad|hone|od)|android/i,F="ontouchstart"in M,G=A(M,"PointerEvent")!==Y,H=F&&j.test(navigator.userAgent),I=25,N=1,O=2,P=4,Q=8,R=1,S=2,T=4,U=8,V=16,W=["x","y"],$e=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&s(this.element,this.evEl,this.domHandler),this.evTarget&&s(this.target,this.evTarget,this.domHandler),this.evWin&&s(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&t(this.element,this.evEl,this.domHandler),this.evTarget&&t(this.target,this.evTarget,this.domHandler),this.evWin&&t(b(this.element),this.evWin,this.domHandler)}};var je={mousedown:1,mousemove:2,mouseup:4},De="mousedown",Le="mousemove mouseup";o(re,E,{handler:function(e){var t=je[e.type];t&1&&0===e.button&&(this.pressed=!0),t&2&&1!==e.which&&(t=4),this.pressed&&this.allow&&(t&4&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var He={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Be={2:"touch",3:"pen",4:"mouse",5:"kinect"},Ve="pointerdown",qe="pointermove pointerup pointercancel";M.MSPointerEvent&&(Ve="MSPointerDown",qe="MSPointerMove MSPointerUp MSPointerCancel"),o(ce,E,{handler:function(t){var a=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),s=He[n],e=Be[t.pointerType]||t.pointerType,o=x(a,t.pointerId,"pointerId");s&1&&(0===t.button||e=="touch")?0>o&&(a.push(t),o=a.length-1):s&12&&(i=!0),0>o||(a[o]=t,this.callback(this.manager,s,{pointers:a,changedPointers:[t],pointerType:e,srcEvent:t}),i&&a.splice(o,1))}});var Ue={touchstart:1,touchmove:2,touchend:4,touchcancel:8},Fe="touchstart",ze="touchstart touchmove touchend touchcancel";o(le,E,{handler:function(e){var t=Ue[e.type];if(t===1&&(this.started=!0),this.started){var a=pe.call(this,e,t);t&12&&0==a[0].length-a[1].length&&(this.started=!1),this.callback(this.manager,t,{pointers:a[0],changedPointers:a[1],pointerType:"touch",srcEvent:e})}}});var Ge={touchstart:1,touchmove:2,touchend:4,touchcancel:8},We="touchstart touchmove touchend touchcancel";o(ue,E,{handler:function(e){var t=Ge[e.type],a=me.call(this,e,t);a&&this.callback(this.manager,t,{pointers:a[0],changedPointers:a[1],pointerType:"touch",srcEvent:e})}}),o(ge,E,{handler:function(t,a,i){var n=i.pointerType=="touch",s=i.pointerType=="mouse";if(n)this.mouse.allow=!1;else if(s&&!this.mouse.allow)return;a&12&&(this.mouse.allow=!0),this.callback(t,a,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ye=A(e.style,"touchAction"),Xe=Ye!==Y,Qe="auto",Je="manipulation",Ke="none",Ze="pan-x",et="pan-y";he.prototype={set:function(e){e=="compute"&&(e=this.compute()),Xe&&(this.manager.element.style[Ye]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return l(this.manager.recognizers,function(t){k(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),ve(e.join(" "))},preventDefaults:function(t){if(!Xe){var a=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return a.preventDefault(),void 0;var n=this.actions,s=v(n,"none"),e=v(n,"pan-y"),o=v(n,"pan-x");return s||e&&i&6||o&&i&24?this.preventSrc(a):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var tt=1,at=2,it=4,nt=8,st=16;fe.prototype={defaults:{},set:function(e){return m(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(d(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=ye(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return d(e,"dropRecognizeWith",this)?this:(e=ye(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(d(e,"requireFailure",this))return this;var t=this.requireFail;return e=ye(e,this),-1===x(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(d(e,"dropRequireFailure",this))return this;e=ye(e,this);var t=x(this.requireFail,e);return-1<t&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){a.manager.emit(a.options.event+(t?_e(i):""),e)}var a=this,i=this.state;8>i&&t(!0),t(),i>=8&&t(!0)},tryEmit:function(e){return this.canEmit()?this.emit(e):(this.state=32,void 0)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&33))return!1;e++}return!0},recognize:function(e){var t=m({},e);return k(this.options.enable,[this,t])?(this.state&56&&(this.state=1),this.state=this.process(t),this.state&30&&this.tryEmit(t),void 0):(this.reset(),this.state=32,void 0)},process:function(){},getTouchAction:function(){},reset:function(){}},o(xe,fe,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(t){var a=this.state,i=t.eventType,n=a&6,s=this.attrTest(t);return n&&(i&8||!s)?a|16:n||s?i&4?a|8:a&2?a|4:2:32}}),o(we,xe,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return e&6&&t.push("pan-y"),e&24&&t.push("pan-x"),t},directionTest:function(t){var a=this.options,i=!0,n=t.distance,s=t.direction,o=t.deltaX,r=t.deltaY;return s&a.direction||(a.direction&6?(s=0===o?1:0>o?2:4,i=o!=this.pX,n=Re(t.deltaX)):(s=0===r?1:0>r?8:16,i=r!=this.pY,n=Re(t.deltaY))),t.direction=s,i&&n>a.threshold&&s&a.direction},attrTest:function(e){return xe.prototype.attrTest.call(this,e)&&(this.state&2||!(this.state&2)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=be(e.direction);t&&this.manager.emit(this.options.event+t,e),this._super.emit.call(this,e)}}),o(Ce,xe,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Re(e.scale-1)>this.options.threshold||this.state&2)},emit:function(e){if(this._super.emit.call(this,e),1!==e.scale){var t=1>e.scale?"in":"out";this.manager.emit(this.options.event+t,e)}}}),o(Se,fe,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var a=this.options,i=t.pointers.length===a.pointers,n=t.distance<a.threshold,s=t.deltaTime>a.time;if(this._input=t,!n||!i||t.eventType&12&&!s)this.reset();else if(t.eventType&1)this.reset(),this._timer=X(function(){this.state=8,this.tryEmit()},a.time,this);else if(t.eventType&4)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===8&&(e&&e.eventType&4?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=Pe(),this.manager.emit(this.options.event,this._input)))}}),o(ke,xe,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Re(e.rotation)>this.options.threshold||this.state&2)}}),o(Ae,xe,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return we.prototype.getTouchAction.call(this)},attrTest:function(e){var t=this.options.direction,a;return t&30?a=e.velocity:t&6?a=e.velocityX:t&24&&(a=e.velocityY),this._super.attrTest.call(this,e)&&t&e.direction&&e.distance>this.options.threshold&&h(a)>this.options.velocity&&e.eventType&4},emit:function(e){var t=be(e.direction);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),o(Te,fe,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var a=this.options,i=t.pointers.length===a.pointers,n=t.distance<a.threshold,s=t.deltaTime<a.time;if(this.reset(),t.eventType&1&&0===this.count)return this.failTimeout();if(n&&s&&i){if(4!=t.eventType)return this.failTimeout();var e=!this.pTime||t.timeStamp-this.pTime<a.interval,o=!this.pCenter||ne(this.pCenter,t.center)<a.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,o&&e?this.count+=1:this.count=1,this._input=t;var d=this.count%a.taps;if(0==d)return this.hasRequireFailures()?(this._timer=X(function(){this.state=8,this.tryEmit()},a.interval,this),2):8}return 32},failTimeout:function(){return this._timer=X(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==8&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ee.VERSION="2.0.4",Ee.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[ke,{enable:!1}],[Ce,{enable:!1},["rotate"]],[Ae,{direction:6}],[we,{direction:6},["swipe"]],[Te],[Te,{event:"doubletap",taps:2},["tap"]],[Se]],cssProps:{userSelect:"default",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};Me.prototype={set:function(e){return m(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(t){var a=this.session;if(!a.stopped){this.touchAction.preventDefaults(t);var i=this.recognizers,n=a.curRecognizer,s;(!n||n&&n.state&8)&&(n=a.curRecognizer=null);for(var o=0;o<i.length;)s=i[o],a.stopped===2||n&&s!=n&&!s.canRecognizeWith(n)?s.reset():s.recognize(t),!n&&s.state&14&&(n=a.curRecognizer=s),o++}},get:function(e){if(e instanceof fe)return e;for(var t=this.recognizers,a=0;a<t.length;a++)if(t[a].options.event==e)return t[a];return null},add:function(e){if(d(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(d(e,"remove",this))return this;var t=this.recognizers;return e=this.get(e),t.splice(x(t,e),1),this.touchAction.update(),this},on:function(e,t){var i=this.handlers;return l(w(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this},off:function(e,t){var i=this.handlers;return l(w(e),function(e){t?i[e].splice(x(i[e],t),1):delete i[e]}),this},emit:function(e,t){this.options.domEvents&&Ne(e,t);var a=this.handlers[e]&&this.handlers[e].slice();if(a&&a.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<a.length;)a[i](t),i++}},destroy:function(){this.element&&Ie(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},m(Ee,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Me,Input:E,TouchAction:he,TouchInput:ue,MouseInput:re,PointerEventInput:ce,TouchMouseInput:ge,SingleTouchInput:le,Recognizer:fe,AttrRecognizer:xe,Tap:Te,Pan:we,Swipe:Ae,Pinch:Ce,Rotate:ke,Press:Se,on:s,off:t,each:l,merge:n,extend:m,inherit:o,bindFn:p,prefixed:A}),typeof define=="function"&&define.amd?define("hammerjs",[],function(){return Ee}):"undefined"!=typeof module&&module.exports?module.exports=Ee:M[a]=Ee}(window,document,"Hammer"),define("materialize",["jquery","hammerjs"],function(h,v){var f=Math.exp,w=Math.asin,C=Math.sin,S=Math.sqrt,M=Math.abs,I=Math.cos,N=Math.PI,L=Math.round,H=String.fromCharCode,B=Math.floor,V=Math.pow,q=Math.min,U=Math.max;window.$=window.jQuery=$=h,h.easing.jswing=h.easing.swing,h.extend(h.easing,{def:"easeOutQuad",swing:function(e,a,t,i,n){return h.easing[h.easing.def](e,a,t,i,n)},easeInQuad:function(e,a,i,n,s){return n*(a/=s)*a+i},easeOutQuad:function(e,a,i,n,s){return-n*(a/=s)*(a-2)+i},easeInOutQuad:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a+i:-n/2*(--a*(a-2)-1)+i},easeInCubic:function(e,a,i,n,s){return n*(a/=s)*a*a+i},easeOutCubic:function(e,a,i,n,s){return n*((a=a/s-1)*a*a+1)+i},easeInOutCubic:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a*a+i:n/2*((a-=2)*a*a+2)+i},easeInQuart:function(e,a,i,n,s){return n*(a/=s)*a*a*a+i},easeOutQuart:function(e,a,i,n,s){return-n*((a=a/s-1)*a*a*a-1)+i},easeInOutQuart:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a*a*a+i:-n/2*((a-=2)*a*a*a-2)+i},easeInQuint:function(e,a,i,n,s){return n*(a/=s)*a*a*a*a+i},easeOutQuint:function(e,a,i,n,s){return n*((a=a/s-1)*a*a*a*a+1)+i},easeInOutQuint:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a*a*a*a+i:n/2*((a-=2)*a*a*a*a+2)+i},easeInSine:function(e,a,t,i,n){return-i*I(a/n*(N/2))+i+t},easeOutSine:function(e,a,t,i,n){return i*C(a/n*(N/2))+t},easeInOutSine:function(e,a,t,i,n){return-i/2*(I(N*a/n)-1)+t},easeInExpo:function(e,a,t,i,n){return 0==a?t:i*V(2,10*(a/n-1))+t},easeOutExpo:function(e,a,t,i,n){return a==n?t+i:i*(-V(2,-10*a/n)+1)+t},easeInOutExpo:function(e,a,i,n,s){return 0==a?i:a==s?i+n:1>(a/=s/2)?n/2*V(2,10*(a-1))+i:n/2*(-V(2,-10*--a)+2)+i},easeInCirc:function(e,a,i,n,s){return-n*(S(1-(a/=s)*a)-1)+i},easeOutCirc:function(e,a,i,n,s){return n*S(1-(a=a/s-1)*a)+i},easeInOutCirc:function(e,a,i,n,s){return 1>(a/=s/2)?-n/2*(S(1-a*a)-1)+i:n/2*(S(1-(a-=2)*a)+1)+i},easeInElastic:function(e,i,n,o,r){var d=1.70158,c=0,l=o;if(0==i)return n;if(1==(i/=r))return n+o;if(c||(c=.3*r),l<M(o)){l=o;var d=c/4}else var d=c/(2*N)*w(o/l);return-(l*V(2,10*(i-=1))*C((i*r-d)*(2*N)/c))+n},easeOutElastic:function(e,i,n,o,r){var d=1.70158,c=0,l=o;if(0==i)return n;if(1==(i/=r))return n+o;if(c||(c=.3*r),l<M(o)){l=o;var d=c/4}else var d=c/(2*N)*w(o/l);return l*V(2,-10*i)*C((i*r-d)*(2*N)/c)+o+n},easeInOutElastic:function(e,i,n,o,r){var d=1.70158,c=0,l=o;if(0==i)return n;if(2==(i/=r/2))return n+o;if(c||(c=r*(.3*1.5)),l<M(o)){l=o;var d=c/4}else var d=c/(2*N)*w(o/l);return 1>i?-.5*(l*V(2,10*(i-=1))*C((i*r-d)*(2*N)/c))+n:.5*(l*V(2,-10*(i-=1))*C((i*r-d)*(2*N)/c))+o+n},easeInBack:function(e,a,i,n,o,d){return null==d&&(d=1.70158),n*(a/=o)*a*((d+1)*a-d)+i},easeOutBack:function(e,a,i,n,o,d){return null==d&&(d=1.70158),n*((a=a/o-1)*a*((d+1)*a+d)+1)+i},easeInOutBack:function(e,a,i,n,o,d){return null==d&&(d=1.70158),1>(a/=o/2)?n/2*(a*a*(((d*=1.525)+1)*a-d))+i:n/2*((a-=2)*a*(((d*=1.525)+1)*a+d)+2)+i},easeInBounce:function(e,a,t,i,n){return i-h.easing.easeOutBounce(e,n-a,0,i,n)+t},easeOutBounce:function(e,a,i,n,s){return(a/=s)<1/2.75?n*(7.5625*a*a)+i:a<2/2.75?n*(7.5625*(a-=1.5/2.75)*a+.75)+i:a<2.5/2.75?n*(7.5625*(a-=2.25/2.75)*a+.9375)+i:n*(7.5625*(a-=2.625/2.75)*a+.984375)+i},easeInOutBounce:function(e,a,t,i,n){return a<n/2?.5*h.easing.easeInBounce(e,2*a,0,i,n)+t:.5*h.easing.easeOutBounce(e,2*a-n,0,i,n)+.5*i+t}});h.extend(h.easing,{easeInOutMaterial:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a+i:n/4*((a-=2)*a*a+2)+i}});h.Velocity?console.log("Velocity is already loaded. You may be needlessly importing Velocity again; note that Materialize includes Velocity."):(!function(d){function c(i){var e=i.length,t=p.type(i);return!("function"===t||p.isWindow(i))&&(!!(1===i.nodeType&&e)||"array"===t||0===e||"number"==typeof e&&0<e&&e-1 in i)}if(!d.jQuery){var p=function(a,e){return new p.fn.init(a,e)};p.isWindow=function(t){return null!=t&&t==t.window},p.type=function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?t[n.call(a)]||"object":typeof a},p.isArray=Array.isArray||function(t){return"array"===p.type(t)},p.isPlainObject=function(i){if(!i||"object"!==p.type(i)||i.nodeType||p.isWindow(i))return!1;try{if(i.constructor&&!a.call(i,"constructor")&&!a.call(i.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(var e in i);return void 0===e||a.call(i,e)},p.each=function(t,e,d){var a=0,r=t.length,i=c(t),s;if(d){if(i)for(;r>a&&(s=e.apply(t[a],d),!1!==s);a++);else for(a in t)if(s=e.apply(t[a],d),!1===s)break;}else if(i)for(;r>a&&(s=e.call(t[a],a,t[a]),!1!==s);a++);else for(a in t)if(s=e.call(t[a],a,t[a]),!1===s)break;return t},p.data=function(a,e,t){if(void 0===t){var n=a[p.expando],s=n&&r[n];if(void 0===e)return s;if(s&&e in s)return s[e]}else if(void 0!==e){var n=a[p.expando]||(a[p.expando]=++p.uuid);return r[n]=r[n]||{},r[n][e]=t,t}},p.removeData=function(a,e){var t=a[p.expando],i=t&&r[t];i&&p.each(e,function(a,e){delete i[e]})},p.extend=function(){var d=arguments[0]||{},r=1,m=arguments.length,u=!1,g,h,v,f,b,x;for("boolean"==typeof d&&(u=d,d=arguments[r]||{},r++),"object"!=typeof d&&"function"!==p.type(d)&&(d={}),r===m&&(d=this,r--);m>r;r++)if(null!=(b=arguments[r]))for(f in b)g=d[f],v=b[f],d!==v&&(u&&v&&(p.isPlainObject(v)||(h=p.isArray(v)))?(h?(h=!1,x=g&&p.isArray(g)?g:[]):x=g&&p.isPlainObject(g)?g:{},d[f]=p.extend(u,x,v)):void 0!==v&&(d[f]=v));return d},p.queue=function(t,e,s){function n(t,e){var i=e||[];return null!=t&&(c(Object(t))?!function(i,e){for(var t=+e.length,s=0,o=i.length;t>s;)i[o++]=e[s++];if(t!=t)for(;void 0!==e[s];)i[o++]=e[s++];return i.length=o,i}(i,"string"==typeof t?[t]:t):[].push.call(i,t)),i}if(t){e=(e||"fx")+"queue";var o=p.data(t,e);return s?(!o||p.isArray(s)?o=p.data(t,e,n(s)):o.push(s),o):o||[]}},p.dequeue=function(a,i){p.each(a.nodeType?[a]:a,function(t,e){i=i||"fx";var a=p.queue(e,i),n=a.shift();"inprogress"===n&&(n=a.shift()),n&&("fx"===i&&a.unshift("inprogress"),n.call(e,function(){p.dequeue(e,i)}))})},p.fn=p.prototype={init:function(t){if(t.nodeType)return this[0]=t,this;throw new Error("Not a DOM node.")},offset:function(){var e=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:e.top+(d.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:e.left+(d.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function i(){for(var t=this.offsetParent||document;t&&"html"===!t.nodeType.toLowerCase&&"static"===t.style.position;)t=t.offsetParent;return t||document}var s=this[0],i=i.apply(s),t=this.offset(),a=/^(?:body|html)$/i.test(i.nodeName)?{top:0,left:0}:p(i).offset();return t.top-=parseFloat(s.style.marginTop)||0,t.left-=parseFloat(s.style.marginLeft)||0,i.style&&(a.top+=parseFloat(i.style.borderTopWidth)||0,a.left+=parseFloat(i.style.borderLeftWidth)||0),{top:t.top-a.top,left:t.left-a.left}}};var r={};p.expando="velocity"+new Date().getTime(),p.uuid=0;for(var t={},a=t.hasOwnProperty,n=t.toString,e=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],i=0;i<e.length;i++)t["[object "+e[i]+"]"]=e[i].toLowerCase();p.fn.init.prototype=p.fn,d.Velocity={Utilities:p}}}(window),function(t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?t():t()}(function(){return function(C,k,A,T){function e(i){for(var e=-1,s=i?i.length:0,o=[],a;++e<s;)a=i[e],a&&o.push(a);return o}function a(t){return c.isWrapped(t)?t=[].slice.call(t):c.isNode(t)&&(t=[t]),t}function X(a){var e=K.data(a,"velocity");return null===e?T:e}function i(a){return function(e){return L(e*a)*(1/a)}}function n(A,E,I,r){function n(a,e){return 1-3*e+3*a}function o(a,e){return 3*e-6*a}function i(t){return 3*t}function N(a,e,t){return((n(e,t)*a+o(e,t))*a+i(e))*a}function R(a,e,t){return 3*n(e,t)*a*a+2*o(e,t)*a+i(e)}function u(e,t){for(var a=0,s;l>a;++a){if(s=R(t,A,I),0===s)return t;var d=N(t,A,I)-e;t-=d/s}return t}function t(){for(var e=0;h>e;++e)x[e]=N(e*v,A,I)}function c(e,t,a){var d=0,c,l;do l=t+(a-t)/2,c=N(l,A,I)-e,0<c?a=l:t=l;while(M(c)>m&&++d<g);return l}function s(e){for(var t=0,a=1;a!=h-1&&x[a]<=e;++a)t+=v;--a;var o=(e-x[a])/(x[a+1]-x[a]),i=t+o*v,s=R(i,A,I);return s>=p?u(e,i):0==s?i:c(e,t,t+v)}function d(){w=!0,(A!=E||I!=r)&&t()}var l=4,p=.001,m=1e-7,g=10,h=11,v=1/10,f="Float32Array"in k;if(4!==arguments.length)return!1;for(var b=0;4>b;++b)if("number"!=typeof arguments[b]||isNaN(arguments[b])||!isFinite(arguments[b]))return!1;A=q(A,1),I=q(I,1),A=U(A,0),I=U(I,0);var x=f?new Float32Array(11):Array(11),w=!1,S=function(e){return w||d(),A===E&&I===r?e:0===e?0:1===e?1:N(s(e),E,r)};S.getControlPoints=function(){return[{x:A,y:E},{x:I,y:r}]};var C="generateBezier("+[A,E,I,r]+")";return S.toString=function(){return C},S}function E(a,e){var t=a;return c.isString(a)?Z.Easings[a]||(t=!1):t=c.isArray(a)&&1===a.length?i.apply(null,a):c.isArray(a)&&2===a.length?d.apply(null,a.concat([e])):!!(c.isArray(a)&&4===a.length)&&n.apply(null,a),!1===t&&(t=Z.Easings[Z.defaults.easing]?Z.defaults.easing:o),t}function J(a){if(a){var i=new Date().getTime(),t=Z.State.calls.length;1e4<t&&(Z.State.calls=e(Z.State.calls));for(var n=0;t>n;n++)if(Z.State.calls[n]){var f=Z.State.calls[n],s=f[0],l=f[2],u=f[3],b=!!u,g=null;u||(u=Z.State.calls[n][3]=i-16);for(var w=q((i-u)/l.duration,1),h=0,S=s.length;S>h;h++){var x=s[h],M=x.element;if(X(M)){var I=!1;if(l.display!==T&&null!==l.display&&"none"!==l.display){if("flex"===l.display){K.each(["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"],function(a,e){m.setPropertyValue(M,"display",e)})}m.setPropertyValue(M,"display",l.display)}for(var R in l.visibility!==T&&"hidden"!==l.visibility&&m.setPropertyValue(M,"visibility",l.visibility),x)if("element"!=R){var k=x[R],O=c.isString(k.easing)?Z.Easings[k.easing]:k.easing,P;if(1===w)P=k.endValue;else{var j=k.endValue-k.startValue;if(P=k.startValue+j*O(w,l,j),!b&&P===k.currentValue)continue}if(k.currentValue=P,"tween"===R)g=P;else{if(m.Hooks.registered[R]){var E=m.Hooks.getRoot(R),D=X(M).rootPropertyValueCache[E];D&&(k.rootPropertyValue=D)}var N=m.setPropertyValue(M,R,k.currentValue+(0===parseFloat(P)?"":k.unitType),k.rootPropertyValue,k.scrollData);m.Hooks.registered[R]&&(X(M).rootPropertyValueCache[E]=m.Normalizations.registered[E]?m.Normalizations.registered[E]("extract",null,N[1]):N[1]),"transform"===N[0]&&(I=!0)}}l.mobileHA&&X(M).transformCache.translate3d===T&&(X(M).transformCache.translate3d="(0px, 0px, 0px)",I=!0),I&&m.flushTransformCache(M)}}l.display!==T&&"none"!==l.display&&(Z.State.calls[n][2].display=!1),l.visibility!==T&&"hidden"!==l.visibility&&(Z.State.calls[n][2].visibility=!1),l.progress&&l.progress.call(f[1],f[1],w,U(0,u+l.duration-i),u,g),1===w&&r(n)}}Z.State.isTicking&&p(J)}function r(a,e){if(!Z.State.calls[a])return!1;for(var t=Z.State.calls[a][0],i=Z.State.calls[a][1],n=Z.State.calls[a][2],o=Z.State.calls[a][4],s=!1,r=0,g=t.length,c;g>r;r++){if(c=t[r].element,e||n.loop||("none"===n.display&&m.setPropertyValue(c,"display",n.display),"hidden"===n.visibility&&m.setPropertyValue(c,"visibility",n.visibility)),!0!==n.loop&&(K.queue(c)[1]===T||!/\.velocityQueueEntryFlag/i.test(K.queue(c)[1]))&&X(c)){X(c).isAnimating=!1,X(c).rootPropertyValueCache={};var h=!1;K.each(m.Lists.transforms3D,function(a,e){var t=/^scale/.test(e)?1:0,i=X(c).transformCache[e];X(c).transformCache[e]!==T&&new RegExp("^\\("+t+"[^.]").test(i)&&(h=!0,delete X(c).transformCache[e])}),n.mobileHA&&(h=!0,delete X(c).transformCache.translate3d),h&&m.flushTransformCache(c),m.Values.removeClass(c,"velocity-animating")}if(!e&&n.complete&&!n.loop&&r===g-1)try{n.complete.call(i,i)}catch(e){setTimeout(function(){throw e},1)}o&&!0!==n.loop&&o(i),X(c)&&!0===n.loop&&!e&&(K.each(X(c).tweensContainer,function(a,e){/^rotate/.test(a)&&360===parseFloat(e.endValue)&&(e.endValue=0,e.startValue=360),/^backgroundPosition/.test(a)&&100===parseFloat(e.endValue)&&"%"===e.unitType&&(e.endValue=0,e.startValue=100)}),Z(c,"reverse",{loop:!0,delay:n.delay})),!1!==n.queue&&K.dequeue(c,n.queue)}Z.State.calls[a]=!1;for(var v=0,f=Z.State.calls.length;f>v;v++)if(!1!==Z.State.calls[v]){s=!0;break}!1==s&&(Z.State.isTicking=!1,delete Z.State.calls,Z.State.calls=[])}var R=function(){if(A.documentMode)return A.documentMode;for(var a=7,i;4<a;a--)if(i=A.createElement("div"),i.innerHTML="<!--[if IE "+a+"]><span></span><![endif]-->",i.getElementsByTagName("span").length)return i=null,a;return T}(),t=function(){var i=0;return k.webkitRequestAnimationFrame||k.mozRequestAnimationFrame||function(e){var t=new Date().getTime(),a;return a=U(0,16-(t-i)),i=t+a,setTimeout(function(){e(t+a)},a)}}(),c={isString:function(t){return"string"==typeof t},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)},isNode:function(t){return t&&t.nodeType},isNodeList:function(t){return"object"==typeof t&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(t))&&t.length!==T&&(0===t.length||"object"==typeof t[0]&&0<t[0].nodeType)},isWrapped:function(t){return t&&(t.jquery||k.Zepto&&k.Zepto.zepto.isZ(t))},isSVG:function(t){return k.SVGElement&&t instanceof k.SVGElement},isEmptyObject:function(a){for(var e in a)return!1;return!0}},s=!1,K;if(C.fn&&C.fn.jquery?(K=C,s=!0):K=k.Velocity.Utilities,8>=R&&!s)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=R)return void(h.fn.velocity=h.fn.animate);var o="swing",Z={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:k.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:A.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:K,Redirects:{},Easings:{},Promise:k.Promise,defaults:{queue:"",duration:400,easing:"swing",begin:T,complete:T,progress:T,display:T,visibility:T,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(t){K.data(t,"velocity",{isSVG:c.isSVG(t),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:2,patch:2},debug:!1};k.pageYOffset===T?(Z.State.scrollAnchor=A.documentElement||A.body.parentNode||A.body,Z.State.scrollPropertyLeft="scrollLeft",Z.State.scrollPropertyTop="scrollTop"):(Z.State.scrollAnchor=k,Z.State.scrollPropertyLeft="pageXOffset",Z.State.scrollPropertyTop="pageYOffset");var d=function(){function d(t){return-t.tension*t.x-t.friction*t.v}function e(e,t,i){var a={x:e.x+i.dx*t,v:e.v+i.dv*t,tension:e.tension,friction:e.friction};return{dx:a.v,dv:d(a)}}function m(t,r){var a={dx:t.v,dv:d(t)},n=e(t,.5*r,a),o=e(t,.5*r,n),i=e(t,r,o),s=1/6*(a.dx+2*(n.dx+o.dx)+i.dx),c=1/6*(a.dv+2*(n.dv+o.dv)+i.dv);return t.x+=s*r,t.v+=c*r,t}return function d(a,r,g){var h={x:-1,v:0,tension:null,friction:null},l=[0],u=0,v=1e-4,p=.016,f,b,x;for(a=parseFloat(a)||500,r=parseFloat(r)||20,g=g||null,h.tension=a,h.friction=r,f=null!==g,f?(u=d(a,r),b=u/g*p):b=p;x=m(x||h,b),l.push(1+x.x),u+=16,M(x.x)>v&&M(x.v)>v;);return f?function(t){return l[0|t*(l.length-1)]}:u}}();Z.Easings={linear:function(t){return t},swing:function(t){return .5-I(t*N)/2},spring:function(t){return 1-I(4.5*t*N)*f(6*-t)}},K.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(a,e){Z.Easings[e[0]]=n.apply(null,e[1])});var m=Z.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var d=0,c;d<m.Lists.colors.length;d++)c="color"===m.Lists.colors[d]?"0 0 0 1":"255 255 255 1",m.Hooks.templates[m.Lists.colors[d]]=["Red Green Blue Alpha",c];var l,p,u;if(R)for(l in m.Hooks.templates){p=m.Hooks.templates[l],u=p[0].split(" ");var g=p[1].match(m.RegEx.valueSplit);"Color"===u[0]&&(u.push(u.shift()),g.push(g.shift()),m.Hooks.templates[l]=[u.join(" "),g.join(" ")])}for(l in m.Hooks.templates)for(var d in p=m.Hooks.templates[l],u=p[0].split(" "),u){var o=l+u[d],i=d;m.Hooks.registered[o]=[l,i]}},getRoot:function(a){var e=m.Hooks.registered[a];return e?e[0]:a},cleanRootPropertyValue:function(a,e){return m.RegEx.valueUnwrap.test(e)&&(e=e.match(m.RegEx.valueUnwrap)[1]),m.Values.isCSSNullValue(e)&&(e=m.Hooks.templates[a][1]),e},extractValue:function(i,e){var s=m.Hooks.registered[i];if(s){var o=s[0],a=s[1];return e=m.Hooks.cleanRootPropertyValue(o,e),e.toString().match(m.RegEx.valueSplit)[a]}return e},injectValue:function(d,e,t){var c=m.Hooks.registered[d];if(c){var a=c[0],i=c[1],s,l;return t=m.Hooks.cleanRootPropertyValue(a,t),s=t.toString().match(m.RegEx.valueSplit),s[i]=e,l=s.join(" ")}return t}},Normalizations:{registered:{clip:function(i,e,t){switch(i){case"name":return"clip";case"extract":var n;return m.RegEx.wrappedValueAlreadyExtracted.test(t)?n=t:(n=t.toString().match(m.RegEx.valueUnwrap),n=n?n[1].replace(/,(\s+)?/g," "):t),n;case"inject":return"rect("+t+")";}},blur:function(i,e,t){switch(i){case"name":return Z.State.isFirefox?"filter":"-webkit-filter";case"extract":var s=parseFloat(t);if(!s&&0!==s){var o=t.toString().match(/blur\(([0-9]+[A-z]+)\)/i);s=o?o[1]:0}return s;case"inject":return parseFloat(t)?"blur("+t+")":"none";}},opacity:function(i,e,t){if(8>=R)switch(i){case"name":return"filter";case"extract":var n=t.toString().match(/alpha\(opacity=(.*)\)/i);return t=n?n[1]/100:1;case"inject":return e.style.zoom=1,1<=parseFloat(t)?"":"alpha(opacity="+parseInt(100*parseFloat(t),10)+")";}else switch(i){case"name":return"opacity";case"extract":return t;case"inject":return t;}}},register:function(){9>=R||Z.State.isGingerbread||(m.Lists.transformsBase=m.Lists.transformsBase.concat(m.Lists.transforms3D));for(var a=0;a<m.Lists.transformsBase.length;a++)!function(){var i=m.Lists.transformsBase[a];m.Normalizations.registered[i]=function(t,e,a){switch(t){case"name":return"transform";case"extract":return X(e)===T||X(e).transformCache[i]===T?/^scale/i.test(i)?1:0:X(e).transformCache[i].replace(/[()]/g,"");case"inject":var s=!1;switch(i.substr(0,i.length-1)){case"translate":s=!/(%|px|em|rem|vw|vh|\d)$/i.test(a);break;case"scal":case"scale":Z.State.isAndroid&&X(e).transformCache[i]===T&&1>a&&(a=1),s=!/(\d)$/i.test(a);break;case"skew":s=!/(deg|\d)$/i.test(a);break;case"rotate":s=!/(deg|\d)$/i.test(a);}return s||(X(e).transformCache[i]="("+a+")"),X(e).transformCache[i];}}}();for(var a=0;a<m.Lists.colors.length;a++)!function(){var d=m.Lists.colors[a];m.Normalizations.registered[d]=function(t,e,a){switch(t){case"name":return d;case"extract":var r;if(m.RegEx.wrappedValueAlreadyExtracted.test(a))r=a;else{var c={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"},s;/^[A-z]+$/i.test(a)?s=c[a]===T?c.black:c[a]:m.RegEx.isHex.test(a)?s="rgb("+m.Values.hexToRgb(a).join(" ")+")":/^rgba?\(/i.test(a)||(s=c.black),r=(s||a).toString().match(m.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return 8>=R||3!==r.split(" ").length||(r+=" 1"),r;case"inject":return 8>=R?4===a.split(" ").length&&(a=a.split(/\s+/).slice(0,3).join(" ")):3===a.split(" ").length&&(a+=" 1"),(8>=R?"rgb":"rgba")+"("+a.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")";}}}()}},Names:{camelCase:function(t){return t.replace(/-(\w)/g,function(a,e){return e.toUpperCase()})},SVGAttribute:function(a){var e="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(R||Z.State.isAndroid&&!Z.State.isChrome)&&(e+="|transform"),new RegExp("^("+e+")$","i").test(a)},prefixCheck:function(i){if(Z.State.prefixMatches[i])return[Z.State.prefixMatches[i],!0];for(var e=["","Webkit","Moz","ms","O"],t=0,s=e.length;s>t;t++){var a;if(a=0==t?i:e[t]+i.replace(/^\w/,function(t){return t.toUpperCase()}),c.isString(Z.State.prefixElement.style[a]))return Z.State.prefixMatches[i]=a,[a,!0]}return[i,!1]}},Values:{hexToRgb:function(i){var n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,a;return i=i.replace(n,function(i,e,t,n){return e+e+t+t+n+n}),a=s.exec(i),a?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:[0,0,0]},isCSSNullValue:function(t){return 0==t||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(t)},getUnitType:function(t){return /^(rotate|skew)/i.test(t)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(t)?"":"px"},getDisplayType:function(a){var e=a&&a.tagName.toString().toLowerCase();return /^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(e)?"inline":/^(li)$/i.test(e)?"list-item":/^(tr)$/i.test(e)?"table-row":/^(table)$/i.test(e)?"table":/^(tbody)$/i.test(e)?"table-row-group":"block"},addClass:function(a,e){a.classList?a.classList.add(e):a.className+=(a.className.length?" ":"")+e},removeClass:function(a,e){a.classList?a.classList.remove(e):a.className=a.className.toString().replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(t,e,a,i){function o(t,e){function a(){s&&m.setPropertyValue(t,"display","none")}var n=0;if(8>=R)n=K.css(t,e);else{var s=!1;if(/^(width|height)$/.test(e)&&0===m.getPropertyValue(t,"display")&&(s=!0,m.setPropertyValue(t,"display",m.Values.getDisplayType(t))),!i){if("height"===e&&"border-box"!==m.getPropertyValue(t,"boxSizing").toString().toLowerCase()){var d=t.offsetHeight-(parseFloat(m.getPropertyValue(t,"borderTopWidth"))||0)-(parseFloat(m.getPropertyValue(t,"borderBottomWidth"))||0)-(parseFloat(m.getPropertyValue(t,"paddingTop"))||0)-(parseFloat(m.getPropertyValue(t,"paddingBottom"))||0);return a(),d}if("width"===e&&"border-box"!==m.getPropertyValue(t,"boxSizing").toString().toLowerCase()){var c=t.offsetWidth-(parseFloat(m.getPropertyValue(t,"borderLeftWidth"))||0)-(parseFloat(m.getPropertyValue(t,"borderRightWidth"))||0)-(parseFloat(m.getPropertyValue(t,"paddingLeft"))||0)-(parseFloat(m.getPropertyValue(t,"paddingRight"))||0);return a(),c}}var p;p=X(t)===T?k.getComputedStyle(t,null):X(t).computedStyle?X(t).computedStyle:X(t).computedStyle=k.getComputedStyle(t,null),"borderColor"===e&&(e="borderTopColor"),n=9===R&&"filter"===e?p.getPropertyValue(e):p[e],(""===n||null===n)&&(n=t.style[e]),a()}if("auto"===n&&/^(top|right|bottom|left)$/i.test(e)){var h=o(t,"position");("fixed"===h||"absolute"===h&&/top|left/i.test(e))&&(n=K(t).position()[e]+"px")}return n}var s;if(m.Hooks.registered[e]){var d=e,r=m.Hooks.getRoot(d);a===T&&(a=m.getPropertyValue(t,m.Names.prefixCheck(r)[0])),m.Normalizations.registered[r]&&(a=m.Normalizations.registered[r]("extract",t,a)),s=m.Hooks.extractValue(d,a)}else if(m.Normalizations.registered[e]){var c,u;c=m.Normalizations.registered[e]("name",t),"transform"!==c&&(u=o(t,m.Names.prefixCheck(c)[0]),m.Values.isCSSNullValue(u)&&m.Hooks.templates[e]&&(u=m.Hooks.templates[e][1])),s=m.Normalizations.registered[e]("extract",t,u)}if(!/^[\d-]/.test(s))if(!(X(t)&&X(t).isSVG&&m.Names.SVGAttribute(e)))s=o(t,m.Names.prefixCheck(e)[0]);else if(/^(height|width)$/i.test(e))try{s=t.getBBox()[e]}catch(e){s=0}else s=t.getAttribute(e);return m.Values.isCSSNullValue(s)&&(s=0),2<=Z.debug&&console.log("Get "+e+": "+s),s},setPropertyValue:function(t,e,i,d,c){var o=e;if("scroll"===e)c.container?c.container["scroll"+c.direction]=i:"Left"===c.direction?k.scrollTo(i,c.alternateValue):k.scrollTo(c.alternateValue,i);else if(m.Normalizations.registered[e]&&"transform"===m.Normalizations.registered[e]("name",t))m.Normalizations.registered[e]("inject",t,i),o="transform",i=X(t).transformCache[e];else{if(m.Hooks.registered[e]){var p=e,l=m.Hooks.getRoot(e);d=d||m.getPropertyValue(t,l),i=m.Hooks.injectValue(p,i,d),e=l}if(m.Normalizations.registered[e]&&(i=m.Normalizations.registered[e]("inject",t,i),e=m.Normalizations.registered[e]("name",t)),o=m.Names.prefixCheck(e)[0],8>=R)try{t.style[o]=i}catch(e){Z.debug&&console.log("Browser does not support ["+i+"] for ["+o+"]")}else X(t)&&X(t).isSVG&&m.Names.SVGAttribute(e)?t.setAttribute(e,i):t.style[o]=i;2<=Z.debug&&console.log("Set "+e+" ("+o+"): "+i)}return[o,i]},flushTransformCache:function(i){function e(e){return parseFloat(m.getPropertyValue(i,e))}var s="";if((R||Z.State.isAndroid&&!Z.State.isChrome)&&X(i).isSVG){var t={translate:[e("translateX"),e("translateY")],skewX:[e("skewX")],skewY:[e("skewY")],scale:1===e("scale")?[e("scaleX"),e("scaleY")]:[e("scale"),e("scale")],rotate:[e("rotateZ"),0,0]};K.each(X(i).transformCache,function(a){/^translate/i.test(a)?a="translate":/^scale/i.test(a)?a="scale":/^rotate/i.test(a)&&(a="rotate"),t[a]&&(s+=a+"("+t[a].join(" ")+") ",delete t[a])})}else{var a,d;K.each(X(i).transformCache,function(e){return a=X(i).transformCache[e],"transformPerspective"===e?(d=a,!0):(9===R&&"rotateZ"==e&&(e="rotate"),void(s+=e+a+" "))}),d&&(s="perspective"+d+" "+s)}m.setPropertyValue(i,"transform",s)}};m.Hooks.register(),m.Normalizations.register(),Z.hook=function(i,d,t){var r=T;return i=a(i),K.each(i,function(a,e){if(X(e)===T&&Z.init(e),t===T)r===T&&(r=Z.CSS.getPropertyValue(e,d));else{var i=Z.CSS.setPropertyValue(e,d,t);"transform"===i[0]&&Z.CSS.flushTransformCache(e),r=i}}),r};var l=function(){function t(){return n?S.promise||null:o}function i(){function a(){function a(a,e){var t=T,s=T,d=T;return c.isArray(a)?(t=a[0],!c.isArray(a[1])&&/^[\d-]/.test(a[1])||c.isFunction(a[1])||m.RegEx.isHex.test(a[1])?d=a[1]:(c.isString(a[1])&&!m.RegEx.isHex.test(a[1])||c.isArray(a[1]))&&(s=e?a[1]:E(a[1],o.duration),a[2]!==T&&(d=a[2]))):t=a,e||(s=s||o.easing),c.isFunction(t)&&(t=t.call(g,x,f)),c.isFunction(d)&&(d=d.call(g,x,f)),[t||0,s,d]}function i(i,e){var t,n;return n=(e||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(a){return t=a,""}),t||(t=m.Values.getUnitType(i)),[n,t]}function n(){var t={myParent:g.parentNode||A.body,position:m.getPropertyValue(g,"position"),fontSize:m.getPropertyValue(g,"fontSize")},e=t.position===N.lastPosition&&t.myParent===N.lastParent,a=t.fontSize===N.lastFontSize;N.lastParent=t.myParent,N.lastPosition=t.position,N.lastFontSize=t.fontSize;var i={};if(a&&e)i.emToPx=N.lastEmToPx,i.percentToPxWidth=N.lastPercentToPxWidth,i.percentToPxHeight=N.lastPercentToPxHeight;else{var n=X(g).isSVG?A.createElementNS("http://www.w3.org/2000/svg","rect"):A.createElement("div");Z.init(n),t.myParent.appendChild(n),K.each(["overflow","overflowX","overflowY"],function(a,e){Z.CSS.setPropertyValue(n,e,"hidden")}),Z.CSS.setPropertyValue(n,"position",t.position),Z.CSS.setPropertyValue(n,"fontSize",t.fontSize),Z.CSS.setPropertyValue(n,"boxSizing","content-box"),K.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(a,e){Z.CSS.setPropertyValue(n,e,"100%")}),Z.CSS.setPropertyValue(n,"paddingLeft","100em"),i.percentToPxWidth=N.lastPercentToPxWidth=(parseFloat(m.getPropertyValue(n,"width",null,!0))||1)/100,i.percentToPxHeight=N.lastPercentToPxHeight=(parseFloat(m.getPropertyValue(n,"height",null,!0))||1)/100,i.emToPx=N.lastEmToPx=(parseFloat(m.getPropertyValue(n,"paddingLeft"))||1)/100,t.myParent.removeChild(n)}return null===N.remToPx&&(N.remToPx=parseFloat(m.getPropertyValue(A.body,"fontSize"))||16),null===N.vwToPx&&(N.vwToPx=parseFloat(k.innerWidth)/100,N.vhToPx=parseFloat(k.innerHeight)/100),i.remToPx=N.remToPx,i.vwToPx=N.vwToPx,i.vhToPx=N.vhToPx,1<=Z.debug&&console.log("Unit ratios: "+JSON.stringify(i),g),i}if(o.begin&&0==x)try{o.begin.call(u,u)}catch(e){setTimeout(function(){throw e},1)}if("scroll"===ee){var s=/^x$/i.test(o.axis)?"Left":"Top",d=parseFloat(o.offset)||0,r,l,p;o.container?c.isWrapped(o.container)||c.isNode(o.container)?(o.container=o.container[0]||o.container,r=o.container["scroll"+s],p=r+K(g).position()[s.toLowerCase()]+d):o.container=null:(r=Z.State.scrollAnchor[Z.State["scrollProperty"+s]],l=Z.State.scrollAnchor[Z.State["scrollProperty"+("Left"===s?"Top":"Left")]],p=K(g).offset()[s.toLowerCase()]+d),e={scroll:{rootPropertyValue:!1,startValue:r,currentValue:r,endValue:p,unitType:"",easing:o.easing,scrollData:{container:o.container,direction:s,alternateValue:l}},element:g},Z.debug&&console.log("tweensContainer (scroll): ",e.scroll,g)}else if("reverse"===ee){if(!X(g).tweensContainer)return void K.dequeue(g,o.queue);"none"===X(g).opts.display&&(X(g).opts.display="auto"),"hidden"===X(g).opts.visibility&&(X(g).opts.visibility="visible"),X(g).opts.loop=!1,X(g).opts.begin=null,X(g).opts.complete=null,h.easing||delete o.easing,h.duration||delete o.duration,o=K.extend({},X(g).opts,o);var v=K.extend(!0,{},X(g).tweensContainer);for(var w in v)if("element"!=w){var R=v[w].startValue;v[w].startValue=v[w].currentValue=v[w].endValue,v[w].endValue=R,c.isEmptyObject(h)||(v[w].easing=o.easing),Z.debug&&console.log("reverse tweensContainer ("+w+"): "+JSON.stringify(v[w]),g)}e=v}else if("start"===ee){var v;for(var j in X(g).tweensContainer&&!0===X(g).isAnimating&&(v=X(g).tweensContainer),K.each(b,function(d,e){if(RegExp("^"+m.Lists.colors.join("$|^")+"$").test(d)){var t=a(e,!0),r=t[0],n=t[1],o=t[2];if(m.RegEx.isHex.test(r)){for(var i=["Red","Green","Blue"],s=m.Values.hexToRgb(r),l=o?m.Values.hexToRgb(o):T,p=0,u;p<i.length;p++)u=[s[p]],n&&u.push(n),l!==T&&u.push(l[p]),b[d+i[p]]=u;delete b[d]}}}),b){var H=a(b[j]),O=H[0],V=H[1],U=H[2];j=m.Names.camelCase(j);var F=m.Hooks.getRoot(j),I=!1;if(X(g).isSVG||"tween"===F||!1!==m.Names.prefixCheck(F)[1]||m.Normalizations.registered[F]!==T){(o.display!==T&&null!==o.display&&"none"!==o.display||o.visibility!==T&&"hidden"!==o.visibility)&&/opacity|filter/.test(j)&&!U&&0!==O&&(U=0),o._cacheValues&&v&&v[j]?(U===T&&(U=v[j].endValue+v[j].unitType),I=X(g).rootPropertyValueCache[F]):m.Hooks.registered[j]?U===T?(I=m.getPropertyValue(g,F),U=m.getPropertyValue(g,j,I)):I=m.Hooks.templates[F][1]:U===T&&(U=m.getPropertyValue(g,j));var te=!1,ae,ie,ne;if(ae=i(j,U),U=ae[0],ne=ae[1],ae=i(j,O),O=ae[0].replace(/^([+-\/*])=/,function(a,e){return te=e,""}),ie=ae[1],U=parseFloat(U)||0,O=parseFloat(O)||0,"%"===ie&&(/^(fontSize|lineHeight)$/.test(j)?(O/=100,ie="em"):/^scale/.test(j)?(O/=100,ie=""):/(Red|Green|Blue)$/i.test(j)&&(O=255*(O/100),ie="")),/[\/*]/.test(te))ie=ne;else if(ne!==ie&&0!==U)if(0===O)ie=ne;else{t=t||n();var se=/margin|padding|left|right|width|text|word|letter/i.test(j)||/X$/.test(j)||"x"===j?"x":"y";switch(ne){case"%":U*="x"===se?t.percentToPxWidth:t.percentToPxHeight;break;case"px":break;default:U*=t[ne+"ToPx"];}switch(ie){case"%":U*=1/("x"===se?t.percentToPxWidth:t.percentToPxHeight);break;case"px":break;default:U*=1/t[ie+"ToPx"];}}"+"===te?O=U+O:"-"===te?O=U-O:"*"===te?O=U*O:"/"===te?O=U/O:void 0,e[j]={rootPropertyValue:I,startValue:U,currentValue:U,endValue:O,unitType:ie,easing:V},Z.debug&&console.log("tweensContainer ("+j+"): "+JSON.stringify(e[j]),g)}else Z.debug&&console.log("Skipping ["+F+"] due to a lack of browser support.")}e.element=g}e.element&&(m.Values.addClass(g,"velocity-animating"),L.push(e),""===o.queue&&(X(g).tweensContainer=e,X(g).opts=o),X(g).isAnimating=!0,x==f-1?(Z.State.calls.push([L,u,o,null,S.resolver]),!1===Z.State.isTicking&&(Z.State.isTicking=!0,J())):x++)}var g=this,o=K.extend({},Z.defaults,h),e={},t;switch(X(g)===T&&Z.init(g),parseFloat(o.delay)&&!1!==o.queue&&K.queue(g,o.queue,function(t){Z.velocityQueueEntryFlag=!0,X(g).delayTimer={setTimeout:setTimeout(t,parseFloat(o.delay)),next:t}}),o.duration.toString().toLowerCase()){case"fast":o.duration=200;break;case"normal":o.duration=400;break;case"slow":o.duration=600;break;default:o.duration=parseFloat(o.duration)||1;}!1!==Z.mock&&(!0===Z.mock?o.duration=o.delay=1:(o.duration*=parseFloat(Z.mock)||1,o.delay*=parseFloat(Z.mock)||1)),o.easing=E(o.easing,o.duration),o.begin&&!c.isFunction(o.begin)&&(o.begin=null),o.progress&&!c.isFunction(o.progress)&&(o.progress=null),o.complete&&!c.isFunction(o.complete)&&(o.complete=null),o.display!==T&&null!==o.display&&(o.display=o.display.toString().toLowerCase(),"auto"===o.display&&(o.display=Z.CSS.Values.getDisplayType(g))),o.visibility!==T&&null!==o.visibility&&(o.visibility=o.visibility.toString().toLowerCase()),o.mobileHA=o.mobileHA&&Z.State.isMobile&&!Z.State.isGingerbread,!1===o.queue?o.delay?setTimeout(a,o.delay):a():K.queue(g,o.queue,function(e,t){return!0===t?(S.promise&&S.resolver(u),!0):(Z.velocityQueueEntryFlag=!0,void a(e))}),""!==o.queue&&"fx"!==o.queue||"inprogress"===K.queue(g)[0]||K.dequeue(g)}var e=arguments[0]&&(arguments[0].p||K.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||c.isString(arguments[0].properties)),n,o,p,u,b,h;if(c.isWrapped(this)?(n=!1,p=0,u=this,o=this):(n=!0,p=1,u=e?arguments[0].elements||arguments[0].e:arguments[0]),u=a(u)){e?(b=arguments[0].properties||arguments[0].p,h=arguments[0].options||arguments[0].o):(b=arguments[p],h=arguments[p+1]);var f=u.length,x=0;if(!/^(stop|finish)$/i.test(b)&&!K.isPlainObject(h)){var w=p+1;h={};for(var C=w;C<arguments.length;C++)!c.isArray(arguments[C])&&(/^(fast|normal|slow)$/i.test(arguments[C])||/^\d/.test(arguments[C]))?h.duration=arguments[C]:c.isString(arguments[C])||c.isArray(arguments[C])?h.easing=arguments[C]:c.isFunction(arguments[C])&&(h.complete=arguments[C])}var S={promise:null,resolver:null,rejecter:null};n&&Z.Promise&&(S.promise=new Z.Promise(function(a,e){S.resolver=a,S.rejecter=e}));var ee;switch(b){case"scroll":ee="scroll";break;case"reverse":ee="reverse";break;case"finish":case"stop":K.each(u,function(a,e){X(e)&&X(e).delayTimer&&(clearTimeout(X(e).delayTimer.setTimeout),X(e).delayTimer.next&&X(e).delayTimer.next(),delete X(e).delayTimer)});var M=[];return K.each(Z.State.calls,function(i,e){e&&K.each(e[1],function(t,s){var n=h===T?"":h;return!0!==n&&e[2].queue!==n&&(h!==T||!1!==e[2].queue)||void K.each(u,function(t,o){o===s&&((!0===h||c.isString(h))&&(K.each(K.queue(o,c.isString(h)?h:""),function(a,e){c.isFunction(e)&&e(null,!0)}),K.queue(o,c.isString(h)?h:"",[])),"stop"===b?(X(o)&&X(o).tweensContainer&&!1!==n&&K.each(X(o).tweensContainer,function(a,e){e.endValue=e.currentValue}),M.push(i)):"finish"===b&&(e[2].duration=1))})})}),"stop"===b&&(K.each(M,function(a,e){r(e,!0)}),S.promise&&S.resolver(u)),t();default:if(!K.isPlainObject(b)||c.isEmptyObject(b)){if(c.isString(b)&&Z.Redirects[b]){var I=K.extend({},h),P=I.duration,D=I.delay||0;return!0===I.backwards&&(u=K.extend(!0,[],u).reverse()),K.each(u,function(a,e){parseFloat(I.stagger)?I.delay=D+parseFloat(I.stagger)*a:c.isFunction(I.stagger)&&(I.delay=D+I.stagger.call(e,a,f)),I.drag&&(I.duration=parseFloat(P)||(/^(callout|transition)/.test(b)?1e3:400),I.duration=U(I.duration*(I.backwards?1-a/f:(a+1)/f),.75*I.duration,200)),Z.Redirects[b].call(e,e,I||{},a,f,u,S.promise?S:T)}),t()}var H="Velocity: First argument ("+b+") was not a property map, a known action, or a registered redirect. Aborting.";return S.promise?S.rejecter(new Error(H)):console.log(H),t()}ee="start";}var N={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},L=[];K.each(u,function(a,e){c.isNode(e)&&i.call(e)});var I=K.extend({},Z.defaults,h),R;if(I.loop=parseInt(I.loop),R=2*I.loop-1,I.loop)for(var B=0,F;R>B;B++)F={delay:I.delay,progress:I.progress},B==R-1&&(F.display=I.display,F.visibility=I.visibility,F.complete=I.complete),l(u,"reverse",F);return t()}};Z=K.extend(l,Z),Z.animate=l;var p=k.requestAnimationFrame||t;return Z.State.isMobile||A.hidden===T||A.addEventListener("visibilitychange",function(){A.hidden?(p=function(t){return setTimeout(function(){t(!0)},16)},J()):p=k.requestAnimationFrame||t}),C.Velocity=Z,C!==k&&(C.fn.velocity=l,C.fn.velocity.defaults=Z.defaults),K.each(["Down","Up"],function(a,m){Z.Redirects["slide"+m]=function(g,e,t,a,n,i){var s=K.extend({},e),o=s.begin,r=s.complete,c={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},l={};s.display===T&&(s.display="Down"===m?"inline"===Z.CSS.Values.getDisplayType(g)?"inline-block":"block":"none"),s.begin=function(){for(var e in o&&o.call(n,n),c){l[e]=g.style[e];var t=Z.CSS.getPropertyValue(g,e);c[e]="Down"===m?[t,0]:[0,t]}l.overflow=g.style.overflow,g.style.overflow="hidden"},s.complete=function(){for(var e in l)g.style[e]=l[e];r&&r.call(n,n),i&&i.resolver(n)},Z(g,c,s)}}),K.each(["In","Out"],function(a,d){Z.Redirects["fade"+d]=function(t,e,a,n,o,i){var s=K.extend({},e),r={opacity:"In"===d?1:0},l=s.complete;s.complete=a===n-1?function(){l&&l.call(o,o),i&&i.resolver(o)}:s.begin=null,s.display===T&&(s.display="In"===d?"auto":"none"),Z(this,r,s)}}),Z}(window.jQuery||window.Zepto||window,window,document)}));!function(Y,X,a,J){"use strict";function K(e,t,a){return setTimeout(p(e,a),t)}function d(e,t,a){return!!Array.isArray(e)&&(l(e,a[t],a),!0)}function l(t,a,i){if(t)if(t.forEach)t.forEach(a,i);else if(t.length!==J)for(n=0;n<t.length;)a.call(i,t[n],n,t),n++;else for(var n in t)t.hasOwnProperty(n)&&a.call(i,t[n],n,t)}function m(t,a,i){for(var n=Object.keys(a),e=0;e<n.length;)(!i||i&&t[n[e]]===J)&&(t[n[e]]=a[n[e]]),e++;return t}function n(e,t){return m(e,t,!0)}function o(t,a,i){var n=a.prototype,s;s=t.prototype=Object.create(n),s.constructor=t,s._super=n,i&&m(s,i)}function p(e,t){return function(){return e.apply(t,arguments)}}function k(e,t){return typeof e==f?e.apply(t?t[0]||J:J,t):e}function r(e,t){return e===J?t:e}function s(e,t,a){l(w(t),function(t){e.addEventListener(t,a,!1)})}function t(e,t,a){l(w(t),function(t){e.removeEventListener(t,a,!1)})}function u(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function v(e,t){return-1<e.indexOf(t)}function w(e){return e.trim().split(/\s+/g)}function x(e,t,a){if(e.indexOf&&!a)return e.indexOf(t);for(var i=0;i<e.length;){if(a&&e[i][a]==t||!a&&e[i]===t)return i;i++}return-1}function q(e){return Array.prototype.slice.call(e,0)}function z(t,i,a){for(var n=[],s=[],e=0,o;e<t.length;)o=i?t[e][i]:t[e],0>x(s,o)&&n.push(t[e]),s[e]=o,e++;return a&&(n=i?n.sort(function(e,t){return e[i]>t[i]}):n.sort()),n}function A(e,t){for(var a=t[0].toUpperCase()+t.slice(1),i=0,n,s;i<Pe.length;){if(n=Pe[i],s=n?n+a:t,s in e)return s;i++}return J}function c(){return i++}function b(e){var t=e.ownerDocument;return t.defaultView||t.parentWindow}function E(e,t){var a=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){k(e.options.enable,[e])&&a.handler(t)},this.init()}function D(e){var t=e.options.inputClass,a;return a=t?t:G?pe:H?ge:F?ve:le,new a(e,B)}function B(t,a,i){var n=i.pointers.length,s=i.changedPointers.length,e=a&je&&0==n-s;i.isFirst=!!e,i.isFinal=!!(a&(P|Q)&&0==n-s),e&&(t.session={}),i.eventType=a,Z(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function Z(t,a){var n=t.session,s=a.pointers,o=s.length;n.firstInput||(n.firstInput=ae(a)),1<o&&!n.firstMultiple?n.firstMultiple=ae(a):1===o&&(n.firstMultiple=!1);var e=n.firstInput,d=n.firstMultiple,r=d?d.center:e.center,c=a.center=ie(s);a.timeStamp=$e(),a.deltaTime=a.timeStamp-e.timeStamp,a.angle=de(r,c),a.distance=oe(r,c),ee(n,a),a.offsetDirection=se(a.deltaX,a.deltaY),a.scale=d?ce(d.pointers,s):1,a.rotation=d?re(d.pointers,s):0,te(n,a);var i=t.element;u(a.srcEvent.target,i)&&(i=a.srcEvent.target),a.target=i}function ee(t,a){var i=a.center,n=t.offsetDelta||{},s=t.prevDelta||{},o=t.prevInput||{};(a.eventType===je||o.eventType===P)&&(s=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),a.deltaX=s.x+(i.x-n.x),a.deltaY=s.y+(i.y-n.y)}function te(t,a){var i=t.lastInterval||a,n=a.timeStamp-i.timeStamp,e,s,o,d;if(a.eventType!=Q&&(n>I||i.velocity===J)){var r=i.deltaX-a.deltaX,c=i.deltaY-a.deltaY,l=ne(n,r,c);s=l.x,o=l.y,e=h(l.x)>h(l.y)?l.x:l.y,d=se(r,c),t.lastInterval=a}else e=i.velocity,s=i.velocityX,o=i.velocityY,d=i.direction;a.velocity=e,a.velocityX=s,a.velocityY=o,a.direction=d}function ae(e){for(var t=[],a=0;a<e.pointers.length;)t[a]={clientX:g(e.pointers[a].clientX),clientY:g(e.pointers[a].clientY)},a++;return{timeStamp:$e(),pointers:t,center:ie(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ie(t){var a=t.length;if(1===a)return{x:g(t[0].clientX),y:g(t[0].clientY)};for(var i=0,n=0,s=0;a>s;)i+=t[s].clientX,n+=t[s].clientY,s++;return{x:g(i/a),y:g(n/a)}}function ne(e,t,a){return{x:t/e||0,y:a/e||0}}function se(e,t){return e===t?R:h(e)>=h(t)?0<e?De:T:0<t?U:V}function oe(t,a,i){i||(i=W);var n=a[i[0]]-t[i[0]],s=a[i[1]]-t[i[1]];return S(n*n+s*s)}function de(t,a,i){i||(i=W);var n=a[i[0]]-t[i[0]],s=a[i[1]]-t[i[1]];return 180*Math.atan2(s,n)/N}function re(e,t){return de(t[1],t[0],Le)-de(e[1],e[0],Le)}function ce(e,t){return oe(t[0],t[1],Le)/oe(e[0],e[1],Le)}function le(){this.evEl=Be,this.evWin=Ve,this.allow=!0,this.pressed=!1,E.apply(this,arguments)}function pe(){this.evEl=Fe,this.evWin=ze,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function ue(){this.evTarget=We,this.evWin=Ye,this.started=!1,E.apply(this,arguments)}function me(e,t){var a=q(e.touches),i=q(e.changedTouches);return t&(P|Q)&&(a=z(a.concat(i),"identifier",!0)),[a,i]}function ge(){this.evTarget=Qe,this.targetIds={},E.apply(this,arguments)}function he(t,a){var n=q(t.touches),s=this.targetIds;if(a&(je|O)&&1===n.length)return s[n[0].identifier]=!0,[n,n];var o=q(t.changedTouches),d=[],r=this.target,i,c;if(c=n.filter(function(e){return u(e.target,r)}),a===je)for(i=0;i<c.length;)s[c[i].identifier]=!0,i++;for(i=0;i<o.length;)s[o[i].identifier]&&d.push(o[i]),a&(P|Q)&&delete s[o[i].identifier],i++;return d.length?[z(c.concat(d),"identifier",!0),d]:void 0}function ve(){E.apply(this,arguments);var e=p(this.handler,this);this.touch=new ge(this.manager,e),this.mouse=new le(this.manager,e)}function fe(e,t){this.manager=e,this.set(t)}function _e(e){if(v(e,tt))return tt;var t=v(e,at),a=v(e,it);return t&&a?at+" "+it:t||a?t?at:it:v(e,et)?et:Ze}function be(e){this.id=c(),this.manager=null,this.options=n(e||{},this.defaults),this.options.enable=r(this.options.enable,!0),this.state=nt,this.simultaneous={},this.requireFail=[]}function ye(e){return e&rt?"cancel":e&dt?"end":e&ot?"move":e&st?"start":""}function xe(e){return e==V?"down":e==U?"up":e==De?"left":e==T?"right":""}function we(e,t){var a=t.manager;return a?a.get(e):e}function Ce(){be.apply(this,arguments)}function Se(){Ce.apply(this,arguments),this.pX=null,this.pY=null}function ke(){Ce.apply(this,arguments)}function Ae(){be.apply(this,arguments),this._timer=null,this._input=null}function Te(){Ce.apply(this,arguments)}function Ee(){Ce.apply(this,arguments)}function Me(){be.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ie(e,t){return t=t||{},t.recognizers=r(t.recognizers,Ie.defaults.preset),new Ne(e,t)}function Ne(e,t){t=t||{},this.options=n(t,Ie.defaults),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=D(this),this.touchAction=new fe(this,this.options.touchAction),Re(this,!0),l(t.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function Re(e,t){var i=e.element;l(e.options.cssProps,function(e,a){i.style[A(i.style,a)]=t?e:""})}function Oe(e,t){var a=X.createEvent("Event");a.initEvent(e,!0,!0),a.gesture=t,t.target.dispatchEvent(a)}var Pe=["","webkit","moz","MS","ms","o"],e=X.createElement("div"),f="function",g=L,h=M,$e=Date.now,i=1,j=/mobile|tablet|ip(ad|hone|od)|android/i,F="ontouchstart"in Y,G=A(Y,"PointerEvent")!==J,H=F&&j.test(navigator.userAgent),I=25,je=1,O=2,P=4,Q=8,R=1,De=2,T=4,U=8,V=16,W=["x","y"],Le=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&s(this.element,this.evEl,this.domHandler),this.evTarget&&s(this.target,this.evTarget,this.domHandler),this.evWin&&s(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&t(this.element,this.evEl,this.domHandler),this.evTarget&&t(this.target,this.evTarget,this.domHandler),this.evWin&&t(b(this.element),this.evWin,this.domHandler)}};var He={mousedown:1,mousemove:2,mouseup:4},Be="mousedown",Ve="mousemove mouseup";o(le,E,{handler:function(e){var t=He[e.type];t&1&&0===e.button&&(this.pressed=!0),t&2&&1!==e.which&&(t=4),this.pressed&&this.allow&&(t&4&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var qe={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Ue={2:"touch",3:"pen",4:"mouse",5:"kinect"},Fe="pointerdown",ze="pointermove pointerup pointercancel";Y.MSPointerEvent&&(Fe="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel"),o(pe,E,{handler:function(t){var a=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),s=qe[n],e=Ue[t.pointerType]||t.pointerType,o=x(a,t.pointerId,"pointerId");s&1&&(0===t.button||e=="touch")?0>o&&(a.push(t),o=a.length-1):s&12&&(i=!0),0>o||(a[o]=t,this.callback(this.manager,s,{pointers:a,changedPointers:[t],pointerType:e,srcEvent:t}),i&&a.splice(o,1))}});var Ge={touchstart:1,touchmove:2,touchend:4,touchcancel:8},We="touchstart",Ye="touchstart touchmove touchend touchcancel";o(ue,E,{handler:function(e){var t=Ge[e.type];if(t===1&&(this.started=!0),this.started){var a=me.call(this,e,t);t&12&&0==a[0].length-a[1].length&&(this.started=!1),this.callback(this.manager,t,{pointers:a[0],changedPointers:a[1],pointerType:"touch",srcEvent:e})}}});var Xe={touchstart:1,touchmove:2,touchend:4,touchcancel:8},Qe="touchstart touchmove touchend touchcancel";o(ge,E,{handler:function(e){var t=Xe[e.type],a=he.call(this,e,t);a&&this.callback(this.manager,t,{pointers:a[0],changedPointers:a[1],pointerType:"touch",srcEvent:e})}}),o(ve,E,{handler:function(t,a,i){var n=i.pointerType=="touch",s=i.pointerType=="mouse";if(n)this.mouse.allow=!1;else if(s&&!this.mouse.allow)return;a&12&&(this.mouse.allow=!0),this.callback(t,a,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Je=A(e.style,"touchAction"),Ke=Je!==J,Ze="auto",et="manipulation",tt="none",at="pan-x",it="pan-y";fe.prototype={set:function(e){e=="compute"&&(e=this.compute()),Ke&&(this.manager.element.style[Je]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return l(this.manager.recognizers,function(t){k(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),_e(e.join(" "))},preventDefaults:function(t){if(!Ke){var a=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return a.preventDefault(),void 0;var n=this.actions,s=v(n,"none"),e=v(n,"pan-y"),o=v(n,"pan-x");return s||e&&i&6||o&&i&24?this.preventSrc(a):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var nt=1,st=2,ot=4,dt=8,rt=16;be.prototype={defaults:{},set:function(e){return m(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(d(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=we(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return d(e,"dropRecognizeWith",this)?this:(e=we(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(d(e,"requireFailure",this))return this;var t=this.requireFail;return e=we(e,this),-1===x(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(d(e,"dropRequireFailure",this))return this;e=we(e,this);var t=x(this.requireFail,e);return-1<t&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){a.manager.emit(a.options.event+(t?ye(i):""),e)}var a=this,i=this.state;8>i&&t(!0),t(),i>=8&&t(!0)},tryEmit:function(e){return this.canEmit()?this.emit(e):(this.state=32,void 0)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&33))return!1;e++}return!0},recognize:function(e){var t=m({},e);return k(this.options.enable,[this,t])?(this.state&56&&(this.state=1),this.state=this.process(t),this.state&30&&this.tryEmit(t),void 0):(this.reset(),this.state=32,void 0)},process:function(){},getTouchAction:function(){},reset:function(){}},o(Ce,be,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(t){var a=this.state,i=t.eventType,n=a&6,s=this.attrTest(t);return n&&(i&8||!s)?a|16:n||s?i&4?a|8:a&2?a|4:2:32}}),o(Se,Ce,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return e&6&&t.push("pan-y"),e&24&&t.push("pan-x"),t},directionTest:function(t){var a=this.options,i=!0,n=t.distance,s=t.direction,o=t.deltaX,r=t.deltaY;return s&a.direction||(a.direction&6?(s=0===o?1:0>o?2:4,i=o!=this.pX,n=M(t.deltaX)):(s=0===r?1:0>r?8:16,i=r!=this.pY,n=M(t.deltaY))),t.direction=s,i&&n>a.threshold&&s&a.direction},attrTest:function(e){return Ce.prototype.attrTest.call(this,e)&&(this.state&2||!(this.state&2)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=xe(e.direction);t&&this.manager.emit(this.options.event+t,e),this._super.emit.call(this,e)}}),o(ke,Ce,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(M(e.scale-1)>this.options.threshold||this.state&2)},emit:function(e){if(this._super.emit.call(this,e),1!==e.scale){var t=1>e.scale?"in":"out";this.manager.emit(this.options.event+t,e)}}}),o(Ae,be,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var a=this.options,i=t.pointers.length===a.pointers,n=t.distance<a.threshold,s=t.deltaTime>a.time;if(this._input=t,!n||!i||t.eventType&12&&!s)this.reset();else if(t.eventType&1)this.reset(),this._timer=K(function(){this.state=8,this.tryEmit()},a.time,this);else if(t.eventType&4)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===8&&(e&&e.eventType&4?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=$e(),this.manager.emit(this.options.event,this._input)))}}),o(Te,Ce,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(M(e.rotation)>this.options.threshold||this.state&2)}}),o(Ee,Ce,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return Se.prototype.getTouchAction.call(this)},attrTest:function(e){var t=this.options.direction,a;return t&30?a=e.velocity:t&6?a=e.velocityX:t&24&&(a=e.velocityY),this._super.attrTest.call(this,e)&&t&e.direction&&e.distance>this.options.threshold&&h(a)>this.options.velocity&&e.eventType&4},emit:function(e){var t=xe(e.direction);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),o(Me,be,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var a=this.options,i=t.pointers.length===a.pointers,n=t.distance<a.threshold,s=t.deltaTime<a.time;if(this.reset(),t.eventType&1&&0===this.count)return this.failTimeout();if(n&&s&&i){if(4!=t.eventType)return this.failTimeout();var e=!this.pTime||t.timeStamp-this.pTime<a.interval,o=!this.pCenter||oe(this.pCenter,t.center)<a.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,o&&e?this.count+=1:this.count=1,this._input=t;var d=this.count%a.taps;if(0==d)return this.hasRequireFailures()?(this._timer=K(function(){this.state=8,this.tryEmit()},a.interval,this),2):8}return 32},failTimeout:function(){return this._timer=K(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==8&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ie.VERSION="2.0.4",Ie.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Te,{enable:!1}],[ke,{enable:!1},["rotate"]],[Ee,{direction:6}],[Se,{direction:6},["swipe"]],[Me],[Me,{event:"doubletap",taps:2},["tap"]],[Ae]],cssProps:{userSelect:"default",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};Ne.prototype={set:function(e){return m(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(t){var a=this.session;if(!a.stopped){this.touchAction.preventDefaults(t);var i=this.recognizers,n=a.curRecognizer,s;(!n||n&&n.state&8)&&(n=a.curRecognizer=null);for(var o=0;o<i.length;)s=i[o],a.stopped===2||n&&s!=n&&!s.canRecognizeWith(n)?s.reset():s.recognize(t),!n&&s.state&14&&(n=a.curRecognizer=s),o++}},get:function(e){if(e instanceof be)return e;for(var t=this.recognizers,a=0;a<t.length;a++)if(t[a].options.event==e)return t[a];return null},add:function(e){if(d(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(d(e,"remove",this))return this;var t=this.recognizers;return e=this.get(e),t.splice(x(t,e),1),this.touchAction.update(),this},on:function(e,t){var i=this.handlers;return l(w(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this},off:function(e,t){var i=this.handlers;return l(w(e),function(e){t?i[e].splice(x(i[e],t),1):delete i[e]}),this},emit:function(e,t){this.options.domEvents&&Oe(e,t);var a=this.handlers[e]&&this.handlers[e].slice();if(a&&a.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<a.length;)a[i](t),i++}},destroy:function(){this.element&&Re(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},m(Ie,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ne,Input:E,TouchAction:fe,TouchInput:ge,MouseInput:le,PointerEventInput:pe,TouchMouseInput:ve,SingleTouchInput:ue,Recognizer:be,AttrRecognizer:Ce,Tap:Me,Pan:Se,Swipe:Ee,Pinch:ke,Rotate:Te,Press:Ae,on:s,off:t,each:l,merge:n,extend:m,inherit:o,bindFn:p,prefixed:A}),typeof define=="function"&&define.amd?define("materialize_anonymous_module_3",[],function(){return Ie}):"undefined"!=typeof module&&module.exports?module.exports=Ie:Y[a]=Ie}(window,document,"Hammer");(function(e){"function"==typeof define&&define.amd?define("materialize_anonymous_module_1",["jquery","hammerjs"],e):"object"==typeof exports?e(h,v):e(h,v)})(function(e,t){function a(a,i){var n=e(a);n.data("hammer")||n.data("hammer",new t(n[0],i))}e.fn.hammer=function(e){return this.each(function(){a(this,e)})},t.Manager.prototype.emit=function(t){return function(a,i){t.call(this,a,i),e(this.element).trigger({type:a,gesture:i})}}(t.Manager.prototype.emit)});(function(e){e.Package?Materialize={}:e.Materialize={}})(window),Materialize.guid=function(){function e(){return B(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),Materialize.elementOrParentIsFixed=function(e){var t=$(e),a=t.add(t.parents()),i=!1;return a.each(function(){if("fixed"===$(this).css("position"))return i=!0,!1}),i};var F=$?$.Velocity:h?h.Velocity:Velocity;(function(t){t.fn.collapsible=function(a){return a=t.extend({accordion:void 0},a),this.each(function(){function i(e){r=d.find("> li > .collapsible-header"),e.hasClass("active")?e.parent().addClass("active"):e.parent().removeClass("active"),e.parent().hasClass("active")?e.siblings(".collapsible-body").stop(!0,!1).slideDown({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}}):e.siblings(".collapsible-body").stop(!0,!1).slideUp({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}}),r.not(e).removeClass("active").parent().removeClass("active"),r.not(e).parent().children(".collapsible-body").stop(!0,!1).slideUp({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}})}function n(e){e.hasClass("active")?e.parent().addClass("active"):e.parent().removeClass("active"),e.parent().hasClass("active")?e.siblings(".collapsible-body").stop(!0,!1).slideDown({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}}):e.siblings(".collapsible-body").stop(!0,!1).slideUp({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}})}function s(e){var t=o(e);return 0<t.length}function o(e){return e.closest("li > .collapsible-header")}var d=t(this),r=t(this).find("> li > .collapsible-header"),c=d.data("collapsible");d.off("click.collapse","> li > .collapsible-header"),r.off("click.collapse"),d.on("click.collapse","> li > .collapsible-header",function(d){var e=t(this),r=t(d.target);s(r)&&(r=o(r)),r.toggleClass("active"),a.accordion||"accordion"===c||void 0===c?i(r):(n(r),e.hasClass("active")&&n(e))});var r=d.find("> li > .collapsible-header");a.accordion||"accordion"===c||void 0===c?i(r.filter(".active").first()):r.filter(".active").each(function(){n(t(this))})})},t(document).ready(function(){t(".collapsible").collapsible()})})(h);(function(t){t.fn.scrollTo=function(e){return t(this).scrollTop(t(this).scrollTop()-t(this).offset().top+t(e).offset().top),this},t.fn.dropdown=function(e){var a={inDuration:300,outDuration:225,constrain_width:!0,hover:!1,gutter:0,belowOrigin:!1,closeOnClick:!0,alignment:"left"};this.each(function(){function i(){void 0!==o.data("induration")&&(d.inDuration=o.data("inDuration")),void 0!==o.data("outduration")&&(d.outDuration=o.data("outDuration")),void 0!==o.data("constrainwidth")&&(d.constrain_width=o.data("constrainwidth")),void 0!==o.data("hover")&&(d.hover=o.data("hover")),void 0!==o.data("gutter")&&(d.gutter=o.data("gutter")),void 0!==o.data("beloworigin")&&(d.belowOrigin=o.data("beloworigin")),void 0!==o.data("closeOnClick")&&(d.closeOnClick=o.data("closeOnClick")),void 0!==o.data("alignment")&&(d.alignment=o.data("alignment"))}function n(e){"focus"===e&&(r=!0),i(),c.addClass("active"),o.addClass("active"),!0===d.constrain_width?c.css("width",o.outerWidth()):c.css("white-space","nowrap");var a=d.container?d.container.clientHeight:window.innerHeight,n=o.innerHeight(),s=o.offset().left,l=d.container?t(d.container).offset().top:t(window).scrollTop(),p=o.offset().top-l,u=d.alignment,m=0,g=0,h=0;!0===d.belowOrigin&&(h=n);var v=0,f=o.parent();if(!f.is("body")&&f[0].scrollHeight>f[0].clientHeight&&(v=f[0].scrollTop),s+c.innerWidth()>t(window).width()?u="right":0>s-c.innerWidth()+o.innerWidth()&&(u="left"),p+c.innerHeight()>a)if(0>p+n-c.innerHeight()){var b=a-p-h;c.css("max-height",b)}else h||(h+=n),h-=c.innerHeight();if("left"===u)m=d.gutter,g=o.position().left+m;else if("right"===u){var x=o.position().left+o.outerWidth()-c.outerWidth();m=-d.gutter,g=x+m}c.css({position:"absolute",top:o.position().top+h+v,left:g}),c.stop(!0,!0).css("opacity",0).slideDown({queue:!1,duration:d.inDuration,easing:"easeOutCubic",complete:function(){t(this).css("height",""),o.trigger("change_state",!0)}}).animate({opacity:1},{queue:!1,duration:d.inDuration,easing:"easeOutSine"})}function s(){r=!1,c.fadeOut(d.outDuration),c.removeClass("active"),o.removeClass("active"),setTimeout(function(){c.css("max-height",""),o.trigger("change_state",!1)},d.outDuration)}var o=t(this),d=t.extend({},a,e),r=!1,c=t("#"+o.attr("data-activates"));if(i(),o.after(c),d.hover){var l=!1;o.unbind("click."+o.attr("id")),o.on("mouseenter",function(){!1===l&&(n(),l=!0)}),o.on("mouseleave",function(a){var e=a.toElement||a.relatedTarget;t(e).closest(".dropdown-content").is(c)||(c.stop(!0,!0),s(),l=!1)}),c.on("mouseleave",function(a){var e=a.toElement||a.relatedTarget;t(e).closest(".dropdown-button").is(o)||(c.stop(!0,!0),s(),l=!1)})}else o.unbind("click."+o.attr("id")),o.bind("click."+o.attr("id"),function(a){r||(o[0]!=a.currentTarget||o.hasClass("active")||0!==t(a.target).closest(".dropdown-content").length?o.hasClass("active")&&(s(),t(document).unbind("click."+c.attr("id")+" touchstart."+c.attr("id"))):(a.preventDefault(),n("click")),c.hasClass("active")&&t(document).bind("click."+c.attr("id")+" touchstart."+c.attr("id"),function(a){c.is(a.target)||o.is(a.target)||o.find(a.target).length||(s(),t(document).unbind("click."+c.attr("id")+" touchstart."+c.attr("id")))}))});o.on("open",function(t,e){n(e)}),o.on("close",s)})},t(document).ready(function(){t(".dropdown-button").dropdown()})})(h);(function(t){var e=0,a=0,i=function(){return a++,"materialize-lean-overlay-"+a};Materialize.modalSettings={open:{},close:{}},t.fn.extend({openModal:function(a){var n=t("body"),s=n.innerWidth(),o=t.extend({opacity:.5,in_duration:350,out_duration:250,ready:void 0,complete:void 0,dismissible:!0,starting_top:"4%"},Materialize.modalSettings.open),d=t(this);d.hasClass("open")||(overlayID=i(),$overlay=t("<div class=\"lean-overlay\"></div>"),lStack=++e,$overlay.attr("id",overlayID).css("z-index",1e3+2*lStack),d.data("overlay-id",overlayID).css("z-index",1e3+2*lStack+1),d.addClass("open"),t("body").append($overlay),a=t.extend(o,a),a.dismissible&&($overlay.click(function(){d.closeModal(a)}),t(document).on("keyup.leanModal"+overlayID,function(t){27===t.keyCode&&d.closeModal(a)})),d.find(".modal-close").on("click.close",function(){d.closeModal(a)}),$overlay.css({display:"block",opacity:0}),d.css({display:"block",opacity:0}),$overlay.velocity({opacity:a.opacity/lStack},{duration:a.in_duration,queue:!1,ease:"easeOutCubic"}),d.data("associated-overlay",$overlay[0]),d.hasClass("bottom-sheet")?d.velocity({bottom:"0",opacity:1},{duration:a.in_duration,queue:!1,ease:"easeOutCubic",complete:function(){"function"==typeof a.ready&&a.ready()}}):(t.Velocity.hook(d,"scaleX",.7),d.css({top:a.starting_top}),d.velocity({top:"10%",opacity:1,scaleX:"1"},{duration:a.in_duration,queue:!1,ease:"easeOutCubic",complete:function(){"function"==typeof a.ready&&a.ready()}})))}}),t.fn.extend({closeModal:function(a){var i=t.extend({out_duration:250,complete:void 0},Materialize.modalSettings.close),n=t(this),s=n.data("overlay-id"),o=t("#"+s);return n.hasClass("open")?void(n.removeClass("open"),a=t.extend(i,a),n.find(".modal-close").off("click.close"),t(document).off("keyup.leanModal"+s),o.velocity({opacity:0},{duration:a.out_duration,queue:!1,ease:"easeOutQuart"}),n.hasClass("bottom-sheet")?n.velocity({bottom:"-100%",opacity:0},{duration:a.out_duration,queue:!1,ease:"easeOutCubic",complete:function(){o.css({display:"none"}),e--,o.remove(),"function"==typeof a.complete&&a.complete()}}):n.velocity({top:a.starting_top,opacity:0,scaleX:.7},{duration:a.out_duration,complete:function(){t(this).css("display","none"),e--,o.remove(),"function"==typeof a.complete&&a.complete()}})):void("function"==typeof a.complete&&a.complete())}}),t.fn.extend({leanModal:function(e){return this.each(function(){var a=t.extend({starting_top:"4%"},e);t(this).click(function(i){a.starting_top=(t(this).offset().top-t(window).scrollTop())/1.15;var e=t(this).attr("href")||"#"+t(this).data("target");t(e).openModal(a),i.preventDefault()})})}})})(h);(function(e){e.fn.materialbox=function(){return this.each(function(){function t(){i=!1;var t=s.parent(".material-placeholder"),n=window.innerWidth,o=window.innerHeight,r=s.data("width"),c=s.data("height");s.velocity("stop",!0),e("#materialbox-overlay").velocity("stop",!0),e(".materialbox-caption").velocity("stop",!0),e("#materialbox-overlay").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){a=!1,e(this).remove()}}),s.velocity({width:0,height:0,left:0,top:0},{duration:200,queue:!1,easing:"easeOutQuad"}),e(".materialbox-caption").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){t.css({height:"",width:"",position:"",top:"",left:""}),s.css({height:"",top:"",left:"",width:"","max-width":"",position:"","z-index":""}),s.removeClass("active"),i=!0,e(this).remove(),d&&d.css("overflow","")}})}if(!e(this).hasClass("initialized")){e(this).addClass("initialized");var a=!1,i=!0,n=275,s=e(this),o=e("<div></div>").addClass("material-placeholder"),d,r;s.wrap(o),s.on("click",function(){var o=s.parent(".material-placeholder"),c=window.innerWidth,l=window.innerHeight,p=s.width(),u=s.height();if(!1===i)return t(),!1;if(a&&!0===i)return t(),!1;i=!1,s.addClass("active"),a=!0,o.css({width:o[0].getBoundingClientRect().width,height:o[0].getBoundingClientRect().height,position:"relative",top:0,left:0}),d=void 0,r=o[0].parentNode;for(var m;null!==r&&!e(r).is(document);)m=e(r),"visible"!==m.css("overflow")&&(m.css("overflow","visible"),d=void 0===d?m:d.add(m)),r=r.parentNode;s.css({position:"absolute","z-index":1e3}).data("width",p).data("height",u);var g=e("<div id=\"materialbox-overlay\"></div>").css({opacity:0}).click(function(){!0===i&&t()});if(s.before(g),g.velocity({opacity:1},{duration:n,queue:!1,easing:"easeOutQuad"}),""!==s.data("caption")){var h=e("<div class=\"materialbox-caption\"></div>");h.text(s.data("caption")),e("body").append(h),h.css({display:"inline"}),h.velocity({opacity:1},{duration:n,queue:!1,easing:"easeOutQuad"})}var v=0,f=0,b=0;p/c>u/l?(v=u/p,f=.9*c,b=.9*c*v):(v=p/u,f=.9*l*v,b=.9*l),s.hasClass("responsive-img")?s.velocity({"max-width":f,width:p},{duration:0,queue:!1,complete:function(){s.css({left:0,top:0}).velocity({height:b,width:f,left:e(document).scrollLeft()+c/2-s.parent(".material-placeholder").offset().left-f/2,top:e(document).scrollTop()+l/2-s.parent(".material-placeholder").offset().top-b/2},{duration:n,queue:!1,easing:"easeOutQuad",complete:function(){i=!0}})}}):s.css("left",0).css("top",0).velocity({height:b,width:f,left:e(document).scrollLeft()+c/2-s.parent(".material-placeholder").offset().left-f/2,top:e(document).scrollTop()+l/2-s.parent(".material-placeholder").offset().top-b/2},{duration:n,queue:!1,easing:"easeOutQuad",complete:function(){i=!0}})}),e(window).scroll(function(){a&&t()}),e(document).keyup(function(n){27===n.keyCode&&!0===i&&a&&t()})}})},e(document).ready(function(){e(".materialboxed").materialbox()})})(h);(function(e){e.fn.parallax=function(){var t=e(window).width();return this.each(function(){function a(a){var n=601>t?0<i.height()?i.height():i.children("img").height():0<i.height()?i.height():500;var s=i.children("img").first(),o=s.height(),d=o-n,r=i.offset().top+n,c=i.offset().top,l=e(window).scrollTop(),p=window.innerHeight,u=(l+p-c)/(n+p),m=L(d*u);a&&s.css("display","block"),r>l&&c<l+p&&s.css("transform","translate3D(-50%,"+m+"px, 0)")}var i=e(this);i.addClass("parallax"),i.children("img").one("load",function(){a(!0)}).each(function(){this.complete&&e(this).load()}),e(window).scroll(function(){t=e(window).width(),a(!1)}),e(window).resize(function(){t=e(window).width(),a(!1)})})}})(h);(function(t){var e={init:function(){return this.each(function(){var a=t(this),i=t(window).width();a.width("100%");var n=a.find("li.tab a"),s=a.width(),o=U(s,a[0].scrollWidth)/n.length,d=0,r,c;r=t(n.filter("[href=\""+location.hash+"\"]")),0===r.length&&(r=t(this).find("li.tab a.active").first()),0===r.length&&(r=t(this).find("li.tab a").first()),r.addClass("active"),d=n.index(r),0>d&&(d=0),r[0]!==void 0&&(c=t(r[0].hash)),a.append("<div class=\"indicator\"></div>");var l=a.find(".indicator");a.is(":visible")&&(l.css({right:s-(d+1)*o}),l.css({left:d*o})),t(window).resize(function(){s=a.width(),o=U(s,a[0].scrollWidth)/n.length,0>d&&(d=0),0!==o&&0!==s&&(l.css({right:s-(d+1)*o}),l.css({left:d*o}))}),n.not(r).each(function(){t(this.hash).hide()}),a.on("click","a",function(i){if(t(this).parent().hasClass("disabled"))return void i.preventDefault();s=a.width(),o=U(s,a[0].scrollWidth)/n.length,r.removeClass("active"),c!==void 0&&c.hide(),r=t(this),c=t(this.hash),n=a.find("li.tab a"),r.addClass("active");var e=d;d=n.index(t(this)),0>d&&(d=0),c!==void 0&&c.show(),0<=d-e?(l.velocity({right:s-(d+1)*o},{duration:300,queue:!1,easing:"easeOutQuad"}),l.velocity({left:d*o},{duration:300,queue:!1,easing:"easeOutQuad",delay:90})):(l.velocity({left:d*o},{duration:300,queue:!1,easing:"easeOutQuad"}),l.velocity({right:s-(d+1)*o},{duration:300,queue:!1,easing:"easeOutQuad",delay:90})),i.preventDefault()})})},select_tab:function(e){this.find("a[href=\"#"+e+"\"]").trigger("click")}};t.fn.tabs=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));return"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on jQuery.tooltip"):e.init.apply(this,arguments)},t(document).ready(function(){t("ul.tabs").tabs()})})(h);(function(e){e.fn.tooltip=function(a){return"remove"===a?(this.each(function(){e("#"+e(this).attr("data-tooltip-id")).remove(),e(this).off("mouseenter.tooltip mouseleave.tooltip")}),!1):(a=e.extend({delay:350},a),this.each(function(){var i=Materialize.guid(),n=e(this);n.attr("data-tooltip-id",i);var s=e("<span></span>").text(n.attr("data-tooltip")),o=e("<div></div>");o.addClass("material-tooltip").append(s).appendTo(e("body")).attr("id",i);var d=e("<div></div>").addClass("backdrop");d.appendTo(o),d.css({top:0,left:0}),n.off("mouseenter.tooltip mouseleave.tooltip");var r=!1,c;n.on({"mouseenter.tooltip":function(){var e=n.attr("data-delay");e=void 0===e||""===e?a.delay:e,c=setTimeout(function(){r=!0,o.velocity("stop"),d.velocity("stop"),o.css({display:"block",left:"0px",top:"0px"}),o.children("span").text(n.attr("data-tooltip"));var e=n.outerWidth(),a=n.outerHeight(),i=n.attr("data-position"),s=o.outerHeight(),c=o.outerWidth(),l="0px",p="0px",u=8,m,g,h;"top"===i?(m=n.offset().top-s-5,g=n.offset().left+e/2-c/2,h=t(g,m,c,s),l="-10px",d.css({borderRadius:"14px 14px 0 0",transformOrigin:"50% 90%",marginTop:s,marginLeft:c/2-d.width()/2})):"left"===i?(m=n.offset().top+a/2-s/2,g=n.offset().left-c-5,h=t(g,m,c,s),p="-10px",d.css({width:"14px",height:"14px",borderRadius:"14px 0 0 14px",transformOrigin:"95% 50%",marginTop:s/2,marginLeft:c})):"right"===i?(m=n.offset().top+a/2-s/2,g=n.offset().left+e+5,h=t(g,m,c,s),p="+10px",d.css({width:"14px",height:"14px",borderRadius:"0 14px 14px 0",transformOrigin:"5% 50%",marginTop:s/2,marginLeft:"0px"})):(m=n.offset().top+n.outerHeight()+5,g=n.offset().left+e/2-c/2,h=t(g,m,c,s),l="+10px",d.css({marginLeft:c/2-d.width()/2})),o.css({top:h.y,left:h.x}),u=c/8,8>u&&(u=8),("right"===i||"left"===i)&&(u=c/10,6>u&&(u=6)),o.velocity({marginTop:l,marginLeft:p},{duration:350,queue:!1}).velocity({opacity:1},{duration:300,delay:50,queue:!1}),d.css({display:"block"}).velocity({opacity:1},{duration:55,delay:0,queue:!1}).velocity({scale:u},{duration:300,delay:0,queue:!1,easing:"easeInOutQuad"})},e)},"mouseleave.tooltip":function(){r=!1,clearTimeout(c),setTimeout(function(){!0!=r&&(o.velocity({opacity:0,marginTop:0,marginLeft:0},{duration:225,queue:!1}),d.velocity({opacity:0,scale:1},{duration:225,queue:!1,complete:function(){d.css("display","none"),o.css("display","none"),r=!1}}))},225)}})}))};var t=function(t,a,i,n){var s=t,o=a;return 0>s?s=4:s+i>window.innerWidth&&(s-=s+i-window.innerWidth),0>o?o=4:o+n>(options.container?options.container.clientHeight:window.innerHeight)+e(window).scrollTop&&(o-=o+n-(options.container?options.container.clientHeight:window.innerHeight)),{x:s,y:o}};e(document).ready(function(){e(".tooltipped").tooltip()})})(h);(function(t){'use strict';function a(e){return null!==e&&e===e.window}function i(e){return a(e)?e:9===e.nodeType&&e.defaultView}function n(e){var t={top:0,left:0},a=e&&e.ownerDocument,n,s;return n=a.documentElement,"undefined"!=typeof e.getBoundingClientRect&&(t=e.getBoundingClientRect()),s=i(a),{top:t.top+s.pageYOffset-n.clientTop,left:t.left+s.pageXOffset-n.clientLeft}}function s(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t+=i+":"+e[i]+";");return t}function o(t){if(!1===p.allowEvent(t))return null;for(var e=null,a=t.target||t.srcElement;null!==a.parentElement;){if(!(a instanceof SVGElement)&&-1!==a.className.indexOf("waves-effect")){e=a;break}else if(a.classList.contains("waves-effect")){e=a;break}a=a.parentElement}return e}function d(a){var e=o(a);null!==e&&(l.show(a,e),"ontouchstart"in t&&(e.addEventListener("touchend",l.hide,!1),e.addEventListener("touchcancel",l.hide,!1)),e.addEventListener("mouseup",l.hide,!1),e.addEventListener("mouseleave",l.hide,!1))}var r=r||{},c=document.querySelectorAll.bind(document),l={duration:750,show:function(t,e){if(2===t.button)return!1;var a=e||this,i=document.createElement("div");i.className="waves-ripple",a.appendChild(i);var o=n(a),d=t.pageY-o.top,r=t.pageX-o.left,c="scale("+10*(a.clientWidth/100)+")";"touches"in t&&(d=t.touches[0].pageY-o.top,r=t.touches[0].pageX-o.left),i.setAttribute("data-hold",Date.now()),i.setAttribute("data-scale",c),i.setAttribute("data-x",r),i.setAttribute("data-y",d);var p={top:d+"px",left:r+"px"};i.className+=" waves-notransition",i.setAttribute("style",s(p)),i.className=i.className.replace("waves-notransition",""),p["-webkit-transform"]=c,p["-moz-transform"]=c,p["-ms-transform"]=c,p["-o-transform"]=c,p.transform=c,p.opacity="1",p["-webkit-transition-duration"]=l.duration+"ms",p["-moz-transition-duration"]=l.duration+"ms",p["-o-transition-duration"]=l.duration+"ms",p["transition-duration"]=l.duration+"ms",p["-webkit-transition-timing-function"]="cubic-bezier(0.250, 0.460, 0.450, 0.940)",p["-moz-transition-timing-function"]="cubic-bezier(0.250, 0.460, 0.450, 0.940)",p["-o-transition-timing-function"]="cubic-bezier(0.250, 0.460, 0.450, 0.940)",p["transition-timing-function"]="cubic-bezier(0.250, 0.460, 0.450, 0.940)",i.setAttribute("style",s(p))},hide:function(t){p.touchup(t);var e=this,a=1.4*e.clientWidth,i=null,n=e.getElementsByClassName("waves-ripple");if(0<n.length)i=n[n.length-1];else return!1;var o=i.getAttribute("data-x"),d=i.getAttribute("data-y"),r=i.getAttribute("data-scale"),c=Date.now()-+i.getAttribute("data-hold"),u=350-c;0>u&&(u=0),setTimeout(function(){var t={top:d+"px",left:o+"px",opacity:"0","-webkit-transition-duration":l.duration+"ms","-moz-transition-duration":l.duration+"ms","-o-transition-duration":l.duration+"ms","transition-duration":l.duration+"ms","-webkit-transform":r,"-moz-transform":r,"-ms-transform":r,"-o-transform":r,transform:r};i.setAttribute("style",s(t)),setTimeout(function(){try{e.removeChild(i)}catch(t){return!1}},l.duration)},u)},wrapInput:function(e){for(var t=0,i;t<e.length;t++)if(i=e[t],"input"===i.tagName.toLowerCase()){var n=i.parentNode;if("i"===n.tagName.toLowerCase()&&-1!==n.className.indexOf("waves-effect"))continue;var s=document.createElement("i");s.className=i.className+" waves-input-wrapper";var o=i.getAttribute("style");o||(o=""),s.setAttribute("style",o),i.className="waves-button-input",i.removeAttribute("style"),n.replaceChild(s,i),s.appendChild(i)}}},p={touches:0,allowEvent:function(t){var e=!0;return"touchstart"===t.type?p.touches+=1:"touchend"===t.type||"touchcancel"===t.type?setTimeout(function(){0<p.touches&&(p.touches-=1)},500):"mousedown"===t.type&&0<p.touches&&(e=!1),e},touchup:function(t){p.allowEvent(t)}};r.displayEffect=function(e){e=e||{},"duration"in e&&(l.duration=e.duration),l.wrapInput(c(".waves-effect")),"ontouchstart"in t&&document.body.addEventListener("touchstart",d,!1),document.body.addEventListener("mousedown",d,!1)},r.attach=function(e){"input"===e.tagName.toLowerCase()&&(l.wrapInput([e]),e=e.parentElement),"ontouchstart"in t&&e.addEventListener("touchstart",d,!1),e.addEventListener("mousedown",d,!1)},t.Waves=r,document.addEventListener("DOMContentLoaded",function(){r.displayEffect()},!1)})(window);Materialize.toast=function(e,t,a,i){function n(e){var t=document.createElement("div");if(t.classList.add("toast"),a)for(var n=a.split(" "),s=0,o=n.length;s<o;s++)t.classList.add(n[s]);("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName)?t.appendChild(e):e instanceof h?t.appendChild(e[0]):t.innerHTML=e;var d=new v(t,{prevent_default:!1});return d.on("pan",function(a){var e=a.deltaX;t.classList.contains("panning")||t.classList.add("panning");var i=1-M(e/80);0>i&&(i=0),F(t,{left:e,opacity:i},{duration:50,queue:!1,easing:"easeOutQuad"})}),d.on("panend",function(a){var e=a.deltaX;M(e)>80?F(t,{marginTop:"-40px"},{duration:375,easing:"easeOutExpo",queue:!1,complete:function(){"function"==typeof i&&i(),t.parentNode.removeChild(t)}}):(t.classList.remove("panning"),F(t,{left:0,opacity:1},{duration:300,easing:"easeOutExpo",queue:!1}))}),t}a=a||"";var s=document.getElementById("toast-container");null===s&&(s=document.createElement("div"),s.id="toast-container",document.body.appendChild(s));var o=n(e);e&&s.appendChild(o),o.style.top="35px",o.style.opacity=0,F(o,{top:"0px",opacity:1},{duration:300,easing:"easeOutCubic",queue:!1});var d=t,r=setInterval(function(){null===o.parentNode&&window.clearInterval(r),o.classList.contains("panning")||(d-=20),0>=d&&(F(o,{opacity:0,marginTop:"-40px"},{duration:375,easing:"easeOutExpo",queue:!1,complete:function(){"function"==typeof i&&i(),this[0].parentNode.removeChild(this[0])}}),window.clearInterval(r))},20)};(function(t){var e={init:function(a){a=t.extend({menuWidth:240,edge:"left",closeOnClick:!1},a),t(this).each(function(){function e(e){o=!1,d=!1,t("#sidenav-overlay").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){t(this).remove()}}),"left"===a.edge?(s.css({width:"",right:"",left:"0"}),n.velocity({translateX:"-100%"},{duration:200,queue:!1,easing:"easeOutCubic",complete:function(){!0===e&&(n.removeAttr("style"),n.css("width",a.menuWidth))}})):(s.css({width:"",right:"0",left:""}),n.velocity({translateX:"100%"},{duration:200,queue:!1,easing:"easeOutCubic",complete:function(){!0===e&&(n.removeAttr("style"),n.css("width",a.menuWidth))}}))}var i=t(this),n=t("#"+i.attr("data-activates"));240!=a.menuWidth&&n.css("width",a.menuWidth);var s=t("<div class=\"drag-target\"></div>");t("body").append(s),"left"==a.edge?(n.css("transform","translateX(-100%)"),s.css({left:0})):(n.addClass("right-aligned").css("transform","translateX(100%)"),s.css({right:0})),n.hasClass("fixed")&&992<window.innerWidth&&n.css("transform","translateX(0)"),n.hasClass("fixed")&&t(window).resize(function(){992<window.innerWidth?0!=t("#sidenav-overlay").length&&d?e(!0):n.css("transform","translateX(0%)"):!1===d&&("left"===a.edge?n.css("transform","translateX(-100%)"):n.css("transform","translateX(100%)"))}),!0===a.closeOnClick&&n.on("click.itemclick","a:not(.collapsible-header)",function(){e()});var o=!1,d=!1;s.on("click",function(){e()}),s.hammer({prevent_default:!1}).bind("pan",function(i){if("touch"==i.gesture.pointerType){var s=i.gesture.direction,o=i.gesture.center.x,r=i.gesture.center.y,c=i.gesture.velocityX,l=t("body"),p=l.innerWidth();if(0===t("#sidenav-overlay").length){var u=t("<div id=\"sidenav-overlay\"></div>");u.css("opacity",0).click(function(){e()}),t("body").append(u)}if("left"===a.edge&&(o>a.menuWidth?o=a.menuWidth:0>o&&(o=0)),"left"===a.edge)o<a.menuWidth/2?d=!1:o>=a.menuWidth/2&&(d=!0),n.css("transform","translateX("+(o-a.menuWidth)+"px)");else{o<window.innerWidth-a.menuWidth/2?d=!0:o>=window.innerWidth-a.menuWidth/2&&(d=!1);var m=o-a.menuWidth/2;0>m&&(m=0),n.css("transform","translateX("+m+"px)")}var g;"left"===a.edge?(g=o/a.menuWidth,t("#sidenav-overlay").velocity({opacity:g},{duration:10,queue:!1,easing:"easeOutQuad"})):(g=M((o-window.innerWidth)/a.menuWidth),t("#sidenav-overlay").velocity({opacity:g},{duration:10,queue:!1,easing:"easeOutQuad"}))}}).bind("panend",function(i){if("touch"==i.gesture.pointerType){var e=i.gesture.velocityX,r=i.gesture.center.x,c=r-a.menuWidth,l=r-a.menuWidth/2;0<c&&(c=0),0>l&&(l=0),o=!1,"left"===a.edge?d&&.3>=e||-.5>e?(0!=c&&n.velocity({translateX:[0,c]},{duration:300,queue:!1,easing:"easeOutQuad"}),t("#sidenav-overlay").velocity({opacity:1},{duration:50,queue:!1,easing:"easeOutQuad"}),s.css({width:"50%",right:0,left:""})):(!d||.3<e)&&(n.velocity({translateX:[-1*a.menuWidth-10,c]},{duration:200,queue:!1,easing:"easeOutQuad"}),t("#sidenav-overlay").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){t(this).remove()}}),s.css({width:"10px",right:"",left:0})):d&&-.3<=e||.5<e?(n.velocity({translateX:[0,l]},{duration:300,queue:!1,easing:"easeOutQuad"}),t("#sidenav-overlay").velocity({opacity:1},{duration:50,queue:!1,easing:"easeOutQuad"}),s.css({width:"50%",right:"",left:0})):(!d||-.3>e)&&(n.velocity({translateX:[a.menuWidth+10,l]},{duration:200,queue:!1,easing:"easeOutQuad"}),t("#sidenav-overlay").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){t(this).remove()}}),s.css({width:"10px",right:0,left:""}))}}),i.click(function(){if(!0===d)d=!1,o=!1,e();else{var i=t("body"),r=i.innerWidth();t("body").append(s),"left"===a.edge?(s.css({width:"50%",right:0,left:""}),n.velocity({translateX:[0,-1*a.menuWidth]},{duration:300,queue:!1,easing:"easeOutQuad"})):(s.css({width:"50%",right:"",left:0}),n.velocity({translateX:[0,a.menuWidth]},{duration:300,queue:!1,easing:"easeOutQuad"}));var c=t("<div id=\"sidenav-overlay\"></div>");c.css("opacity",0).click(function(){d=!1,o=!1,e(),c.velocity({opacity:0},{duration:300,queue:!1,easing:"easeOutQuad",complete:function(){t(this).remove()}})}),t("body").append(c),c.velocity({opacity:1},{duration:300,queue:!1,easing:"easeOutQuad",complete:function(){d=!0,o=!1}})}return!1})})},show:function(){this.trigger("click")},hide:function(){t("#sidenav-overlay").trigger("click")}};t.fn.sideNav=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));return"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on jQuery.sideNav"):e.init.apply(this,arguments)}})(h);(function(t){function e(e,a,i,n){var s=t();return t.each(o,function(t,o){if(0<o.height()){var d=o.offset().top,r=o.offset().left,c=r+o.width(),l=d+o.height();!(r>a||c<n||d>i||l<e)&&s.push(o)}}),s}function a(){++c;var a=s.scrollTop(),i=s.scrollLeft(),n=i+s.width(),o=a+s.height(),r=e(a+l.top+200,n+l.right,o+l.bottom,i+l.left);t.each(r,function(e,t){var a=t.data("scrollSpy:ticks");"number"!=typeof a&&t.triggerHandler("scrollSpy:enter"),t.data("scrollSpy:ticks",c)}),t.each(d,function(e,t){var a=t.data("scrollSpy:ticks");"number"==typeof a&&a!==c&&(t.triggerHandler("scrollSpy:exit"),t.data("scrollSpy:ticks",null))}),d=r}function i(){s.trigger("scrollSpy:winSize")}/**
	 * Get time in ms
   * @license https://raw.github.com/jashkenas/underscore/master/LICENSE
	 * @type {function}
	 * @return {number}
	 */ /**
	 * Returns a function, that, when invoked, will only be triggered at most once
	 * during a given window of time. Normally, the throttled function will run
	 * as much as it can, without ever going more than once per `wait` duration;
	 * but if you'd like to disable the execution on the leading edge, pass
	 * `{leading: false}`. To disable execution on the trailing edge, ditto.
	 * @license https://raw.github.com/jashkenas/underscore/master/LICENSE
	 * @param {function} func
	 * @param {number} wait
	 * @param {Object=} options
	 * @returns {Function}
	 */function n(e,t,a){var i=null,n=0,s,o,d;a||(a={});var r=function(){n=!1===a.leading?0:p(),i=null,d=e.apply(s,o),s=o=null};return function(){var c=p();n||!1!==a.leading||(n=c);var l=t-(c-n);return s=this,o=arguments,0>=l?(clearTimeout(i),i=null,n=c,d=e.apply(s,o),s=o=null):!i&&!1!==a.trailing&&(i=setTimeout(r,l)),d}}var s=t(window),o=[],d=[],r=!1,c=0,l={top:0,right:0,bottom:0,left:0},p=Date.now||function(){return new Date().getTime()};t.scrollSpy=function(e,i){var d=[];e=t(e),e.each(function(e,a){o.push(t(a)),t(a).data("scrollSpy:id",e),t("a[href=\"#"+t(a).attr("id")+"\"]").click(function(a){a.preventDefault();var e=t(this.hash).offset().top+1;t("html, body").animate({scrollTop:e-200},{duration:400,queue:!1,easing:"easeOutCubic"})})}),i=i||{throttle:100},l.top=i.offsetTop||0,l.right=i.offsetRight||0,l.bottom=i.offsetBottom||0,l.left=i.offsetLeft||0;var c=n(a,i.throttle||100),p=function(){t(document).ready(c)};return r||(s.on("scroll",p),s.on("resize",p),r=!0),setTimeout(p,0),e.on("scrollSpy:enter",function(){d=t.grep(d,function(e){return 0!=e.height()});var e=t(this);d[0]?(t("a[href=\"#"+d[0].attr("id")+"\"]").removeClass("active"),e.data("scrollSpy:id")<d[0].data("scrollSpy:id")?d.unshift(t(this)):d.push(t(this))):d.push(t(this)),t("a[href=\"#"+d[0].attr("id")+"\"]").addClass("active")}),e.on("scrollSpy:exit",function(){if(d=t.grep(d,function(e){return 0!=e.height()}),d[0]){t("a[href=\"#"+d[0].attr("id")+"\"]").removeClass("active");var e=t(this);d=t.grep(d,function(t){return t.attr("id")!=e.attr("id")}),d[0]&&t("a[href=\"#"+d[0].attr("id")+"\"]").addClass("active")}}),e},t.winSizeSpy=function(e){return t.winSizeSpy=function(){return s},e=e||{throttle:100},s.on("resize",n(i,e.throttle||100))},t.fn.scrollSpy=function(e){return t.scrollSpy(t(this),e)}})(h);(function(t){t(document).ready(function(){function e(e){var i=e.css("font-family"),n=e.css("font-size");n&&a.css("font-size",n),i&&a.css("font-family",i),"off"===e.attr("wrap")&&a.css("overflow-wrap","normal").css("white-space","pre"),a.text(e.val()+"\n");var s=a.html().replace(/\n/g,"<br>");a.html(s),e.is(":visible")?a.css("width",e.width()):a.css("width",t(window).width()/2),e.css("height",a.height())}Materialize.updateTextFields=function(){t("input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea").each(function(e,a){0<t(a).val().length||a.autofocus||t(this).attr("placeholder")!==void 0||!0===t(a)[0].validity.badInput?t(this).siblings("label, i").addClass("active"):t(this).siblings("label, i").removeClass("active")})};t(document).on("change","input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea",function(){(0!==t(this).val().length||t(this).attr("placeholder")!==void 0)&&t(this).siblings("label").addClass("active"),validate_field(t(this))}),t(document).ready(function(){Materialize.updateTextFields()}),t(document).on("reset",function(a){var e=t(a.target);e.is("form")&&(e.find("input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea").removeClass("valid").removeClass("invalid"),e.find("input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea").each(function(){""===t(this).attr("value")&&t(this).siblings("label, i").removeClass("active")}),e.find("select.initialized").each(function(){var t=e.find("option[selected]").text();e.siblings("input.select-dropdown").val(t)}))}),t(document).on("focus","input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea",function(){t(this).siblings("label, i").addClass("active")}),t(document).on("blur","input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea",function(){var e=t(this);0===e.val().length&&!0!==e[0].validity.badInput&&e.attr("placeholder")===void 0&&e.siblings("label, i").removeClass("active"),0===e.val().length&&!0!==e[0].validity.badInput&&e.attr("placeholder")!==void 0&&e.siblings("i").removeClass("active"),validate_field(e)}),window.validate_field=function(e){var t=e.attr("length")!==void 0,a=parseInt(e.attr("length")),i=e.val().length;0===e.val().length&&!1===e[0].validity.badInput?e.hasClass("validate")&&(e.removeClass("valid"),e.removeClass("invalid")):e.hasClass("validate")&&(e.is(":valid")&&t&&i<=a||e.is(":valid")&&!t?(e.removeClass("invalid"),e.addClass("valid")):(e.removeClass("valid"),e.addClass("invalid")))};t(document).on("keyup.radio","input[type=radio], input[type=checkbox]",function(a){if(9===a.which){t(this).addClass("tabbed");var e=t(this);return void e.one("blur",function(){t(this).removeClass("tabbed")})}});var a=t(".hiddendiv").first();a.length||(a=t("<div class=\"hiddendiv common\"></div>"),t("body").append(a));t(".materialize-textarea").each(function(){var a=t(this);a.val().length&&e(a)}),t("body").on("keyup keydown autoresize",".materialize-textarea",function(){e(t(this))}),t(document).on("change",".file-field input[type=\"file\"]",function(){for(var e=t(this).closest(".file-field"),a=e.find("input.file-path"),n=t(this)[0].files,s=[],o=0;o<n.length;o++)s.push(n[o].name);a.val(s.join(", ")),a.trigger("change")});var i=!1,n;t("input[type=range]").each(function(){var e=t("<span class=\"thumb\"><span class=\"value\"></span></span>");t(this).after(e)});t(document).on("change","input[type=range]",function(){var e=t(this).siblings(".thumb");e.find(".value").html(t(this).val())}),t(document).on("input mousedown touchstart","input[type=range]",function(a){var e=t(this).siblings(".thumb"),s=t(this).outerWidth();0>=e.length&&(e=t("<span class=\"thumb\"><span class=\"value\"></span></span>"),t(this).after(e)),e.find(".value").html(t(this).val()),i=!0,t(this).addClass("active"),e.hasClass("active")||e.velocity({height:"30px",width:"30px",top:"-20px",marginLeft:"-15px"},{duration:300,easing:"easeOutExpo"}),"input"!==a.type&&(n=void 0===a.pageX||null===a.pageX?a.originalEvent.touches[0].pageX-t(this).offset().left:a.pageX-t(this).offset().left,0>n?n=0:n>s&&(n=s),e.addClass("active").css("left",n)),e.find(".value").html(t(this).val())}),t(document).on("mouseup touchend",".range-field",function(){i=!1,t(this).removeClass("active")}),t(document).on("mousemove touchmove",".range-field",function(a){var e=t(this).children(".thumb"),n;if(i){e.hasClass("active")||e.velocity({height:"30px",width:"30px",top:"-20px",marginLeft:"-15px"},{duration:300,easing:"easeOutExpo"}),n=void 0===a.pageX||null===a.pageX?a.originalEvent.touches[0].pageX-t(this).offset().left:a.pageX-t(this).offset().left;var s=t(this).outerWidth();0>n?n=0:n>s&&(n=s),e.addClass("active").css("left",n),e.find(".value").html(e.siblings("input[type=range]").val())}}),t(document).on("mouseout touchleave",".range-field",function(){if(!i){var e=t(this).children(".thumb");e.hasClass("active")&&e.velocity({height:"0",width:"0",top:"10px",marginLeft:"-6px"},{duration:100}),e.removeClass("active")}})}),t.fn.material_select=function(e){function a(e,t,a){var n=e.indexOf(t),s=-1===n;return s?e.push(t):e.splice(n,1),a.siblings("ul.dropdown-content").find("li").eq(t).toggleClass("active"),a.find("option").eq(t).prop("selected",s),i(e,a),s}function i(e,t){for(var a="",n=0,s=e.length,o;n<s;n++)o=t.find("option").eq(e[n]).text(),a+=0==n?o:", "+o;""===a&&(a=t.find("option:disabled").eq(0).text()),t.siblings("input.select-dropdown").val(a)}t(this).each(function(){var n=t(this),s=n.siblings(".select-options"),o=s.length;if(!n.hasClass("browser-default")){var d=!!n.attr("multiple"),r=n.data("select-id");if(r&&(n.parent().find("span.caret").remove(),n.parent().find("input").remove(),n.unwrap(),t("ul#select-options-"+r).remove()),"destroy"===e)return void n.data("select-id",null).removeClass("initialized");var c=Materialize.guid();n.data("select-id",c);var l=t("<div class=\"select-wrapper\"></div>");l.addClass(n.attr("class"));var p=t("<ul id=\"select-options-"+c+"\" class=\"dropdown-content select-dropdown "+(d?"multiple-select-dropdown":"")+"\"></ul>"),u=n.children("option, optgroup"),m=[],g=!1,h=n.find("option:selected")||n.find("option:first"),v;v=h.html();var f=function(e,a,i){var n=a.is(":disabled")?"disabled ":"",d="optgroup-option"===i?"optgroup-option ":"",r;r=o?s.find("[data-value="+a.attr("value")+"]").html()||"<span>"+a.html()+"</span>":"<span>"+a.html()+"</span>";var c=a.data("icon"),l=a.attr("class");if(!!c){var u="";return!l||(u=" class=\""+l+"\""),"multiple"===i?p.append(t("<li class=\""+n+"\"><img src=\""+c+"\""+u+"><span><input type=\"checkbox\""+n+"/><label></label>"+r+"</span></li>")):p.append(t("<li class=\""+n+d+"\"><img src=\""+c+"\""+u+">"+r+"</li>")),!0}"multiple"===i?p.append(t("<li class=\""+n+"\"><span><input type=\"checkbox\""+n+"/><label></label>"+r+"</li>")):p.append(t("<li class=\""+n+d+"\">"+r+"</li>"))};u.length&&u.each(function(){if(t(this).is("option"))d?f(n,t(this),"multiple"):f(n,t(this));else if(t(this).is("optgroup")){var e=t(this).children("option");p.append(t("<li class=\"optgroup\"><span>"+t(this).attr("label")+"</span></li>")),e.each(function(){f(n,t(this),"optgroup-option")})}}),p.find("li:not(.optgroup)").each(function(s){t(this).click(function(i){if(!t(this).hasClass("disabled")&&!t(this).hasClass("optgroup")){var o=!0;d?(t("input[type=\"checkbox\"]",this).prop("checked",function(e,t){return!t}),o=a(m,t(this).index(),n),w.trigger("focus")):(p.find("li").removeClass("active"),t(this).toggleClass("active"),w.val(t(this).text().trim())),C(p,t(this)),n.find("option").eq(s).prop("selected",o),n.trigger("change"),"undefined"!=typeof e&&e()}i.stopPropagation()})}),n.wrap(l);var b=t("<span class=\"caret\">&#9660;</span>");n.is(":disabled")&&b.addClass("disabled");var x=o?v:v.replace(/"/g,"&quot;");var w=t("<input type=\"text\" class=\"select-dropdown\" readonly=\"true\" "+(n.is(":disabled")?"disabled":"")+" data-activates=\"select-options-"+c+"\" value=\""+x+"\"/>");n.before(w),w.before(b),w.after(p),n.is(":disabled")||w.dropdown({hover:!1,closeOnClick:!1}),n.attr("tabindex")&&t(w[0]).attr("tabindex",n.attr("tabindex")),n.addClass("initialized"),w.on({focus:function(){if(t("ul.select-dropdown").not(p[0]).is(":visible")&&t("input.select-dropdown").trigger("close"),!p.is(":visible")){t(this).trigger("open",["focus"]);var e=t(this).val(),a=p.find("li").filter(function(){return t(this).text().toLowerCase()===e.toLowerCase()})[0];C(p,a)}},click:function(t){t.stopPropagation()}}),w.on("blur",function(){d||t(this).trigger("close"),p.find("li.selected").removeClass("selected")}),p.hover(function(){g=!0},function(){g=!1}),t(window).on({click:function(){d&&(g||w.trigger("close"))}}),d&&n.find("option:selected:not(:disabled)").each(function(){var e=t(this).index();a(m,e,n),p.find("li").eq(e).find(":checkbox").prop("checked",!0)});var C=function(e,a){if(a){e.find("li.selected").removeClass("selected");var i=t(a);i.addClass("selected"),p.scrollTo(i)}},S=[],k=function(a){if(9==a.which)return void w.trigger("close");if(40==a.which&&!p.is(":visible"))return void w.trigger("open");if(13!=a.which||p.is(":visible")){a.preventDefault();var e=H(a.which).toLowerCase();if(e&&-1===[9,13,27,38,40].indexOf(a.which)){S.push(e);var i=S.join(""),n=p.find("li").filter(function(){return 0===t(this).text().toLowerCase().indexOf(i)})[0];n&&C(p,n)}if(13==a.which){var s=p.find("li.selected:not(.disabled)")[0];s&&(t(s).trigger("click"),!d&&w.trigger("close"))}40==a.which&&(n=p.find("li.selected").length?p.find("li.selected").next("li:not(.disabled)")[0]:p.find("li:not(.disabled)")[0],C(p,n)),27==a.which&&w.trigger("close"),38==a.which&&(n=p.find("li.selected").prev("li:not(.disabled)")[0],n&&C(p,n)),setTimeout(function(){S=[]},1e3)}};w.on("keydown",k)}})}})(h);(function(e){var t={init:function(t){return t=e.extend({indicators:!0,height:400,transition:500,interval:6e3},t),this.each(function(){function a(e,t){e.hasClass("center-align")?e.velocity({opacity:0,translateY:-100},{duration:t,queue:!1}):e.hasClass("right-align")?e.velocity({opacity:0,translateX:100},{duration:t,queue:!1}):e.hasClass("left-align")&&e.velocity({opacity:0,translateX:-100},{duration:t,queue:!1})}function i(e){e>=o.length?e=0:0>e&&(e=o.length-1),d=s.find(".active").index(),d!=e&&(r=o.eq(d),$caption=r.find(".caption"),r.removeClass("active"),r.velocity({opacity:0},{duration:t.transition,queue:!1,easing:"easeOutQuad",complete:function(){o.not(".active").velocity({opacity:0,translateX:0,translateY:0},{duration:0,queue:!1})}}),a($caption,t.transition),t.indicators&&c.eq(d).removeClass("active"),o.eq(e).velocity({opacity:1},{duration:t.transition,queue:!1,easing:"easeOutQuad"}),o.eq(e).find(".caption").velocity({opacity:1,translateX:0,translateY:0},{duration:t.transition,delay:t.transition,queue:!1,easing:"easeOutQuad"}),o.eq(e).addClass("active"),t.indicators&&c.eq(e).addClass("active"))}var n=e(this),s=n.find("ul.slides").first(),o=s.find("li"),d=s.find(".active").index(),r,c,l;-1!=d&&(r=o.eq(d)),n.hasClass("fullscreen")||(t.indicators?n.height(t.height+40):n.height(t.height),s.height(t.height)),o.find(".caption").each(function(){a(e(this),0)}),o.find("img").each(function(){"data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="!==e(this).attr("src")&&(e(this).css("background-image","url("+e(this).attr("src")+")"),e(this).attr("src","data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="))}),t.indicators&&(c=e("<ul class=\"indicators\"></ul>"),o.each(function(){var a=e("<li class=\"indicator-item\"></li>");a.click(function(){var a=s.parent(),n=a.find(e(this)).index();i(n),clearInterval(l),l=setInterval(function(){d=s.find(".active").index(),o.length==d+1?d=0:d+=1,i(d)},t.transition+t.interval)}),c.append(a)}),n.append(c),c=n.find("ul.indicators").find("li.indicator-item")),r?r.show():(o.first().addClass("active").velocity({opacity:1},{duration:t.transition,queue:!1,easing:"easeOutQuad"}),d=0,r=o.eq(d),t.indicators&&c.eq(d).addClass("active")),r.find("img").each(function(){r.find(".caption").velocity({opacity:1,translateX:0,translateY:0},{duration:t.transition,queue:!1,easing:"easeOutQuad"})}),l=setInterval(function(){d=s.find(".active").index(),i(d+1)},t.transition+t.interval);var p=!1,u=!1,m=!1;n.hammer({prevent_default:!1}).bind("pan",function(t){if("touch"===t.gesture.pointerType){clearInterval(l);var e=t.gesture.direction,a=t.gesture.deltaX,i=t.gesture.velocityX;$curr_slide=s.find(".active"),$curr_slide.velocity({translateX:a},{duration:50,queue:!1,easing:"easeOutQuad"}),4===e&&(a>n.innerWidth()/2||-.65>i)?m=!0:2===e&&(a<-1*n.innerWidth()/2||.65<i)&&(u=!0);var d;u&&(d=$curr_slide.next(),0===d.length&&(d=o.first()),d.velocity({opacity:1},{duration:300,queue:!1,easing:"easeOutQuad"})),m&&(d=$curr_slide.prev(),0===d.length&&(d=o.last()),d.velocity({opacity:1},{duration:300,queue:!1,easing:"easeOutQuad"}))}}).bind("panend",function(a){"touch"===a.gesture.pointerType&&($curr_slide=s.find(".active"),p=!1,curr_index=s.find(".active").index(),(m||u)&&!(1>=o.length)?u?(i(curr_index+1),$curr_slide.velocity({translateX:-1*n.innerWidth()},{duration:300,queue:!1,easing:"easeOutQuad",complete:function(){$curr_slide.velocity({opacity:0,translateX:0},{duration:0,queue:!1})}})):m&&(i(curr_index-1),$curr_slide.velocity({translateX:n.innerWidth()},{duration:300,queue:!1,easing:"easeOutQuad",complete:function(){$curr_slide.velocity({opacity:0,translateX:0},{duration:0,queue:!1})}})):$curr_slide.velocity({translateX:0},{duration:300,queue:!1,easing:"easeOutQuad"}),u=!1,m=!1,clearInterval(l),l=setInterval(function(){d=s.find(".active").index(),o.length==d+1?d=0:d+=1,i(d)},t.transition+t.interval))}),n.on("sliderPause",function(){clearInterval(l)}),n.on("sliderStart",function(){clearInterval(l),l=setInterval(function(){d=s.find(".active").index(),o.length==d+1?d=0:d+=1,i(d)},t.transition+t.interval)}),n.on("sliderNext",function(){d=s.find(".active").index(),i(d+1)}),n.on("sliderPrev",function(){d=s.find(".active").index(),i(d-1)})})},pause:function(){e(this).trigger("sliderPause")},start:function(){e(this).trigger("sliderStart")},next:function(){e(this).trigger("sliderNext")},prev:function(){e(this).trigger("sliderPrev")}};e.fn.slider=function(a){if(t[a])return t[a].apply(this,Array.prototype.slice.call(arguments,1));return"object"!=typeof a&&a?void e.error("Method "+a+" does not exist on jQuery.tooltip"):t.init.apply(this,arguments)}})(h);(function(t){t(document).ready(function(){t(document).on("click.card",".card",function(a){t(this).find("> .card-reveal").length&&(t(a.target).is(t(".card-reveal .card-title"))||t(a.target).is(t(".card-reveal .card-title i"))?t(this).find(".card-reveal").velocity({translateY:0},{duration:225,queue:!1,easing:"easeInOutQuad",complete:function(){t(this).css({display:"none"})}}):(t(a.target).is(t(".card .activator"))||t(a.target).is(t(".card .activator i")))&&(t(a.target).closest(".card").css("overflow","hidden"),t(this).find(".card-reveal").css({display:"block"}).velocity("stop",!1).velocity({translateY:"-100%"},{duration:300,queue:!1,easing:"easeInOutQuad"}))),t(".card-reveal").closest(".card").css("overflow","hidden")})})})(h);(function(e){e(document).ready(function(){e(document).on("click.chip",".chip .material-icons",function(){e(this).parent().remove()})})})(h);(function(e){e.fn.pushpin=function(t){return t=e.extend({top:0,bottom:1/0,offset:0},t),$index=0,this.each(function(){function a(e){e.removeClass("pin-top"),e.removeClass("pinned"),e.removeClass("pin-bottom")}function i(i,n){i.each(function(){t.top<=n&&t.bottom>=n&&!e(this).hasClass("pinned")&&(a(e(this)),e(this).css("top",t.offset),e(this).addClass("pinned")),n<t.top&&!e(this).hasClass("pin-top")&&(a(e(this)),e(this).css("top",0),e(this).addClass("pin-top")),n>t.bottom&&!e(this).hasClass("pin-bottom")&&(a(e(this)),e(this).addClass("pin-bottom"),e(this).css("top",t.bottom-o))})}var n=Materialize.guid(),s=e(this),o=e(this).offset().top;i(s,e(window).scrollTop()),e(window).on("scroll."+n,function(){var a=e(window).scrollTop()+t.offset;i(s,a)})})}})(h);(function(e){e(document).ready(function(){e.fn.reverse=[].reverse,e(document).on("mouseenter.fixedActionBtn",".fixed-action-btn:not(.click-to-toggle)",function(){var a=e(this);t(a)}),e(document).on("mouseleave.fixedActionBtn",".fixed-action-btn:not(.click-to-toggle)",function(){var t=e(this);a(t)}),e(document).on("click.fixedActionBtn",".fixed-action-btn.click-to-toggle > a",function(){var i=e(this),n=i.parent();n.hasClass("active")?a(n):t(n)})}),e.fn.extend({openFAB:function(){t(e(this))},closeFAB:function(){a(e(this))}});var t=function(t){if($this=t,!1===$this.hasClass("active")){var a=$this.hasClass("horizontal"),i,n;!0===a?n=40:i=40,$this.addClass("active"),$this.find("ul .btn-floating").velocity({scaleY:".4",scaleX:".4",translateY:i+"px",translateX:n+"px"},{duration:0});var s=0;$this.find("ul .btn-floating").reverse().each(function(){e(this).velocity({opacity:"1",scaleX:"1",scaleY:"1",translateY:"0",translateX:"0"},{duration:80,delay:s}),s+=40})}},a=function(e){$this=e;var t=$this.hasClass("horizontal"),a,i;!0===t?i=40:a=40,$this.removeClass("active");$this.find("ul .btn-floating").velocity("stop",!0),$this.find("ul .btn-floating").velocity({opacity:"0",scaleX:".4",scaleY:".4",translateY:a+"px",translateX:i+"px"},{duration:80})}})(h);(function(t){Materialize.fadeInImage=function(e){var a=t(e);a.css({opacity:0}),t(a).velocity({opacity:1},{duration:650,queue:!1,easing:"easeOutSine"}),t(a).velocity({opacity:1},{duration:1300,queue:!1,easing:"swing",step:function(e,a){a.start=100;var i=e/100,n=150-(100-e)/1.75;100>n&&(n=100),0<=e&&t(this).css({"-webkit-filter":"grayscale("+i+")brightness("+n+"%)",filter:"grayscale("+i+")brightness("+n+"%)"})}})},Materialize.showStaggeredList=function(e){var a=0;t(e).find("li").velocity({translateX:"-100px"},{duration:0}),t(e).find("li").each(function(){t(this).velocity({opacity:"1",translateX:"0"},{duration:800,delay:a,easing:[60,10]}),a+=120})},t(document).ready(function(){var a=!1,i=!1;t(".dismissable").each(function(){t(this).hammer({prevent_default:!1}).bind("pan",function(n){if("touch"===n.gesture.pointerType){var e=t(this),s=n.gesture.direction,o=n.gesture.deltaX,d=n.gesture.velocityX;e.velocity({translateX:o},{duration:50,queue:!1,easing:"easeOutQuad"}),4===s&&(o>e.innerWidth()/2||-.75>d)&&(a=!0),2===s&&(o<-1*e.innerWidth()/2||.75<d)&&(i=!0)}}).bind("panend",function(n){if(M(n.gesture.deltaX)<t(this).innerWidth()/2&&(i=!1,a=!1),"touch"===n.gesture.pointerType){var e=t(this);if(a||i){var s;s=a?e.innerWidth():-1*e.innerWidth(),e.velocity({translateX:s},{duration:100,queue:!1,easing:"easeOutQuad",complete:function(){e.css("border","none"),e.velocity({height:0,padding:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){e.remove()}})}})}else e.velocity({translateX:0},{duration:100,queue:!1,easing:"easeOutQuad"});a=!1,i=!1}})})})})(h);(function(){Materialize.scrollFire=function(e){var t=!1;window.addEventListener("scroll",function(){t=!0}),setInterval(function(){if(t){t=!1;for(var a=window.pageYOffset+window.innerHeight,n=0;n<e.length;n++){var s=e[n],o=s.selector,d=s.offset,r=s.callback,c=document.querySelector(o);if(null!==c){var l=c.getBoundingClientRect().top+window.pageYOffset;if(a>l+d&&!0!==s.done){if("function"==typeof r)r.call(this);else if("string"==typeof r){var p=new Function(r);p()}s.done=!0}}}}},100)}})(h);(function(e){Materialize.DefaultDatePicker=e(h)})(function(e){function t(s,d,l,p){function u(){return t._.node("div",t._.node("div",t._.node("div",t._.node("div",A.component.nodes(x.open),C.box),C.wrap),C.frame),C.holder)}function m(){S.data(d,A).addClass(C.input).attr("tabindex",-1).val(S.data("value")?A.get("select",w.format):s.value),w.editable||S.on("focus."+x.id+" click."+x.id,function(e){e.preventDefault(),A.$root.eq(0).focus()}).on("keydown."+x.id,v),n(s,{haspopup:!0,expanded:!1,readonly:!1,owns:s.id+"_root"})}function g(){A.$root.on({keydown:v,focusin:function(e){A.$root.removeClass(C.focused),e.stopPropagation()},"mousedown click":function(t){var a=t.target;a!=A.$root.children()[0]&&(t.stopPropagation(),"mousedown"==t.type&&!e(a).is("input, select, textarea, button, option")&&(t.preventDefault(),A.$root.eq(0).focus()))}}).on({focus:function(){S.addClass(C.target)},blur:function(){S.removeClass(C.target)}}).on("focus.toOpen",f).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var t=e(this),a=t.data(),i=t.hasClass(C.navDisabled)||t.hasClass(C.disabled),n=o();n=n&&(n.type||n.href),(i||n&&!e.contains(A.$root[0],n))&&A.$root.eq(0).focus(),!i&&a.nav?A.set("highlight",A.component.item.highlight,{nav:a.nav}):!i&&"pick"in a?A.set("select",a.pick):a.clear?A.clear().close(!0):a.close&&A.close(!0)}),n(A.$root[0],"hidden",!0)}function h(){var t;!0===w.hiddenName?(t=s.name,s.name=""):(t=["string"==typeof w.hiddenPrefix?w.hiddenPrefix:"","string"==typeof w.hiddenSuffix?w.hiddenSuffix:"_submit"],t=t[0]+s.name+t[1]),A._hidden=e("<input type=hidden name=\""+t+"\""+(S.data("value")||s.value?" value=\""+A.get("select",w.formatSubmit)+"\"":"")+">")[0],S.on("change."+x.id,function(){A._hidden.value=s.value?A.get("select",w.formatSubmit):""}),w.container?e(w.container).append(A._hidden):S.after(A._hidden)}function v(e){var t=e.keyCode,a=/^(8|46)$/.test(t);return 27==t?(A.close(),!1):void((32==t||a||!x.open&&A.component.key[t])&&(e.preventDefault(),e.stopPropagation(),a?A.clear().close():A.open()))}function f(e){e.stopPropagation(),"focus"==e.type&&A.$root.addClass(C.focused),A.open()}if(!s)return t;var b=!1,x={id:s.id||"P"+M(~~(Math.random()*new Date))},w=l?e.extend(!0,{},l.defaults,p):p||{},C=e.extend({},t.klasses(),w.klass),S=e(s),k=function(){return this.start()},A=k.prototype={constructor:k,$node:S,start:function(){return x&&x.start?A:(x.methods={},x.start=!0,x.open=!1,x.type=s.type,s.autofocus=s==o(),s.readOnly=!w.editable,s.id=s.id||x.id,"text"!=s.type&&(s.type="text"),A.component=new l(A,w),A.$root=e(t._.node("div",u(),C.picker,"id=\""+s.id+"_root\" tabindex=\"0\"")),g(),w.formatSubmit&&h(),m(),w.container?e(w.container).append(A.$root):S.after(A.$root),A.on({start:A.component.onStart,render:A.component.onRender,stop:A.component.onStop,open:A.component.onOpen,close:A.component.onClose,set:A.component.onSet}).on({start:w.onStart,render:w.onRender,stop:w.onStop,open:w.onOpen,close:w.onClose,set:w.onSet}),b=a(A.$root.children()[0]),s.autofocus&&A.open(),A.trigger("start").trigger("render"))},render:function(e){return e?A.$root.html(u()):A.$root.find("."+C.box).html(A.component.nodes(x.open)),A.trigger("render")},stop:function(){return x.start?(A.close(),A._hidden&&A._hidden.parentNode.removeChild(A._hidden),A.$root.remove(),S.removeClass(C.input).removeData(d),setTimeout(function(){S.off("."+x.id)},0),s.type=x.type,s.readOnly=!1,A.trigger("stop"),x.methods={},x.start=!1,A):A},open:function(a){return x.open?A:(S.addClass(C.active),n(s,"expanded",!0),setTimeout(function(){A.$root.addClass(C.opened),n(A.$root[0],"hidden",!1)},0),!1!==a&&(x.open=!0,b&&c.css("overflow","hidden").css("padding-right","+="+i()),A.$root.eq(0).focus(),r.on("click."+x.id+" focusin."+x.id,function(e){var t=e.target;t!=s&&t!=document&&3!=e.which&&A.close(t===A.$root.children()[0])}).on("keydown."+x.id,function(a){var i=a.keyCode,n=A.component.key[i],s=a.target;27==i?A.close(!0):s==A.$root[0]&&(n||13==i)?(a.preventDefault(),n?t._.trigger(A.component.key.go,A,[t._.trigger(n)]):!A.$root.find("."+C.highlighted).hasClass(C.disabled)&&A.set("select",A.component.item.highlight).close()):e.contains(A.$root[0],s)&&13==i&&(a.preventDefault(),s.click())})),A.trigger("open"))},close:function(e){return(e&&(A.$root.off("focus.toOpen").eq(0).focus(),setTimeout(function(){A.$root.on("focus.toOpen",f)},0)),S.removeClass(C.active),n(s,"expanded",!1),setTimeout(function(){A.$root.removeClass(C.opened+" "+C.focused),n(A.$root[0],"hidden",!0)},0),!x.open)?A:(x.open=!1,b&&c.css("overflow","").css("padding-right","-="+i()),r.off("."+x.id),A.trigger("close"))},clear:function(e){return A.set("clear",null,e)},set:function(t,a,i){var n=e.isPlainObject(t),s=n?t:{},o,d;if(i=n&&e.isPlainObject(a)?a:i||{},t){for(o in n||(s[t]=a),s)d=s[o],o in A.component.item&&(void 0===d&&(d=null),A.component.set(o,d,i)),("select"==o||"clear"==o)&&S.val("clear"==o?"":A.get(o,w.format)).trigger("change");A.render()}return i.muted?A:A.trigger("set",s)},get:function(e,a){if(e=e||"value",null!=x[e])return x[e];if("valueSubmit"==e){if(A._hidden)return A._hidden.value;e="value"}if("value"==e)return s.value;if(e in A.component.item){if("string"==typeof a){var i=A.component.get(e);return i?t._.trigger(A.component.formats.toString,A.component,[a,i]):""}return A.component.get(e)}},on:function(t,a,i){var n=e.isPlainObject(t),s=n?t:{},o,d;if(t)for(o in n||(s[t]=a),s)d=s[o],i&&(o="_"+o),x.methods[o]=x.methods[o]||[],x.methods[o].push(d);return A},off:function(){var e=arguments,t,a;for(t=0,namesCount=e.length;t<namesCount;t+=1)a=e[t],a in x.methods&&delete x.methods[a];return A},trigger:function(e,a){var i=function(e){var i=x.methods[e];i&&i.map(function(e){t._.trigger(e,A,[a])})};return i("_"+e),i(e),A}};return new k}function a(e){var t;return e.currentStyle?t=e.currentStyle.position:window.getComputedStyle&&(t=getComputedStyle(e).position),"fixed"==t}function i(){if(c.height()<=d.height())return 0;var t=e("<div style=\"visibility:hidden;width:100px\" />").appendTo("body"),a=t[0].offsetWidth;t.css("overflow","scroll");var i=e("<div style=\"width:100%\" />").appendTo(t),n=i[0].offsetWidth;return t.remove(),a-n}function n(t,a,i){if(e.isPlainObject(a))for(var n in a)s(t,n,a[n]);else s(t,a,i)}function s(e,t,a){e.setAttribute(("role"==t?"":"aria-")+t,a)}function o(){try{return document.activeElement}catch(e){}}var d=e(window),r=e(document),c=e(document.documentElement);return t.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},t._={group:function(e){for(var a="",i=t._.trigger(e.min,e),n;i<=t._.trigger(e.max,e,[i]);i+=e.i)n=t._.trigger(e.item,e,[i]),a+=t._.node(e.node,n[0],n[1],n[2]);return a},node:function(t,a,i,n){return a?(a=e.isArray(a)?a.join(""):a,i=i?" class=\""+i+"\"":"",n=n?" "+n:"","<"+t+i+n+">"+a+"</"+t+">"):""},lead:function(e){return(10>e?"0":"")+e},trigger:function(e,t,a){return"function"==typeof e?e.apply(t,a||[]):e},digits:function(e){return /\d/.test(e[1])?2:1},isDate:function(e){return-1<{}.toString.call(e).indexOf("Date")&&this.isInteger(e.getDate())},isInteger:function(e){return-1<{}.toString.call(e).indexOf("Number")&&0==e%1},ariaAttr:function(t,a){for(var i in e.isPlainObject(t)||(t={attribute:a}),a="",t){var n=("role"==i?"":"aria-")+i,s=t[i];a+=null==s?"":n+"=\""+t[i]+"\""}return a}},t.extend=function(a,i){e.fn[a]=function(n,s){var o=this.data(a);return"picker"==n?o:o&&"string"==typeof n?t._.trigger(o[n],o,[s]):this.each(function(){var s=e(this);s.data(a)||new t(this,a,i,n)})},e.fn[a].defaults=i.defaults},t});(function(e){e(Materialize.DefaultDatePicker,h)})(function(e,t){function a(e,t){var a=this,i=e.$node[0],n=i.value,s=e.$node.data("value"),o=s||n,d=s?t.formatSubmit:t.format,r=function(){return i.currentStyle?"rtl"==i.currentStyle.direction:"rtl"==getComputedStyle(e.$root[0]).direction};a.settings=t,a.$node=e.$node,a.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse navigate create validate",view:"parse create validate viewset",disable:"deactivate",enable:"activate"},a.item={},a.item.clear=null,a.item.disable=(t.disable||[]).slice(0),a.item.enable=-function(e){return!0===e[0]?e.shift():-1}(a.item.disable),a.set("min",t.min).set("max",t.max).set("now"),o?a.set("select",o,{format:d}):a.set("select",null).set("highlight",a.item.now),a.key={40:7,38:-7,39:function(){return r()?-1:1},37:function(){return r()?1:-1},go:function(e){var t=a.item.highlight,i=new Date(t.year,t.month,t.date+e);a.set("highlight",i,{interval:e}),this.render()}},e.on("render",function(){e.$root.find("."+t.klass.selectMonth).on("change",function(){var a=this.value;a&&(e.set("highlight",[e.get("view").year,a,e.get("highlight").date]),e.$root.find("."+t.klass.selectMonth).trigger("focus"))}),e.$root.find("."+t.klass.selectYear).on("change",function(){var a=this.value;a&&(e.set("highlight",[a,e.get("view").month,e.get("highlight").date]),e.$root.find("."+t.klass.selectYear).trigger("focus"))})},1).on("open",function(){var i="";a.disabled(a.get("now"))&&(i=":not(."+t.klass.buttonToday+")"),e.$root.find("button"+i+", select").attr("disabled",!1)},1).on("close",function(){e.$root.find("button, select").attr("disabled",!0)},1)}var i=e._;a.prototype.set=function(e,t,a){var i=this,n=i.item;return null===t?("clear"==e&&(e="select"),n[e]=t,i):(n["enable"==e?"disable":"flip"==e?"enable":e]=i.queue[e].split(" ").map(function(n){return t=i[n](e,t,a),t}).pop(),"select"==e?i.set("highlight",n.select,a):"highlight"==e?i.set("view",n.highlight,a):e.match(/^(flip|min|max|disable|enable)$/)&&(n.select&&i.disabled(n.select)&&i.set("select",n.select,a),n.highlight&&i.disabled(n.highlight)&&i.set("highlight",n.highlight,a)),i)},a.prototype.get=function(e){return this.item[e]},a.prototype.create=function(e,a,n){var s=this,o;return a=void 0===a?e:a,a==-Infinity||a==1/0?o=a:t.isPlainObject(a)&&i.isInteger(a.pick)?a=a.obj:t.isArray(a)?(a=new Date(a[0],a[1],a[2]),a=i.isDate(a)?a:s.create().obj):i.isInteger(a)||i.isDate(a)?a=s.normalize(new Date(a),n):a=s.now(e,a,n),{year:o||a.getFullYear(),month:o||a.getMonth(),date:o||a.getDate(),day:o||a.getDay(),obj:o||a,pick:o||a.getTime()}},a.prototype.createRange=function(e,a){var n=this,s=function(e){return!0===e||t.isArray(e)||i.isDate(e)?n.create(e):e};return i.isInteger(e)||(e=s(e)),i.isInteger(a)||(a=s(a)),i.isInteger(e)&&t.isPlainObject(a)?e=[a.year,a.month,a.date+e]:i.isInteger(a)&&t.isPlainObject(e)&&(a=[e.year,e.month,e.date+a]),{from:s(e),to:s(a)}},a.prototype.withinRange=function(e,t){return e=this.createRange(e.from,e.to),t.pick>=e.from.pick&&t.pick<=e.to.pick},a.prototype.overlapRanges=function(e,t){var a=this;return e=a.createRange(e.from,e.to),t=a.createRange(t.from,t.to),a.withinRange(e,t.from)||a.withinRange(e,t.to)||a.withinRange(t,e.from)||a.withinRange(t,e.to)},a.prototype.now=function(e,t,a){return t=new Date,a&&a.rel&&t.setDate(t.getDate()+a.rel),this.normalize(t,a)},a.prototype.navigate=function(e,a,i){var n=t.isArray(a),s=t.isPlainObject(a),o=this.item.view,d,r,c,l;if(n||s){for(s?(r=a.year,c=a.month,l=a.date):(r=+a[0],c=+a[1],l=+a[2]),i&&i.nav&&o&&o.month!==c&&(r=o.year,c=o.month),d=new Date(r,c+(i&&i.nav?i.nav:0),1),r=d.getFullYear(),c=d.getMonth();new Date(r,c,l).getMonth()!==c;)l-=1;a=[r,c,l]}return a},a.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},a.prototype.measure=function(e,t){var a=this;return t?"string"==typeof t?t=a.parse(e,t):i.isInteger(t)&&(t=a.now(e,t,{rel:t})):t="min"==e?-Infinity:1/0,t},a.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},a.prototype.validate=function(e,a,n){var s=this,o=a,d=n&&n.interval?n.interval:1,r=-1===s.item.enable,c=s.item.min,l=s.item.max,p=r&&s.item.disable.filter(function(e){if(t.isArray(e)){var n=s.create(e).pick;n<a.pick?u=!0:n>a.pick&&(m=!0)}return i.isInteger(e)}).length,u,m,g,h;if((!n||!n.nav)&&(!r&&s.disabled(a)||r&&s.disabled(a)&&(p||u||m)||!r&&(a.pick<=c.pick||a.pick>=l.pick)))for(r&&!p&&(!m&&0<d||!u&&0>d)&&(d*=-1);s.disabled(a)&&(1<M(d)&&(a.month<o.month||a.month>o.month)&&(a=o,d=0<d?1:-1),a.pick<=c.pick?(g=!0,d=1,a=s.create([c.year,c.month,c.date+(a.pick===c.pick?0:-1)])):a.pick>=l.pick&&(h=!0,d=-1,a=s.create([l.year,l.month,l.date+(a.pick===l.pick?0:1)])),!(g&&h));)a=s.create([a.year,a.month,a.date+d]);return a},a.prototype.disabled=function(e){var a=this,n=a.item.disable.filter(function(n){return i.isInteger(n)?e.day===(a.settings.firstDay?n:n-1)%7:t.isArray(n)||i.isDate(n)?e.pick===a.create(n).pick:t.isPlainObject(n)?a.withinRange(n,e):void 0});return n=n.length&&!n.filter(function(e){return t.isArray(e)&&"inverted"==e[3]||t.isPlainObject(e)&&e.inverted}).length,-1===a.item.enable?!n:n||e.pick<a.item.min.pick||e.pick>a.item.max.pick},a.prototype.parse=function(e,t,a){var n=this,s={};return t&&"string"==typeof t?(a&&a.format||(a=a||{},a.format=n.settings.format),n.formats.toArray(a.format).map(function(e){var a=n.formats[e],o=a?i.trigger(a,n,[t,s]):e.replace(/^!/,"").length;a&&(s[e]=t.substr(0,o)),t=t.substr(o)}),[s.yyyy||s.yy,+(s.mm||s.m)-1,s.dd||s.d]):t},a.prototype.formats=function(){function e(e,t,a){var i=e.match(/\w+/)[0];return a.mm||a.m||(a.m=t.indexOf(i)+1),i.length}function t(e){return e.match(/\w+/)[0].length}return{d:function(e,t){return e?i.digits(e):t.date},dd:function(e,t){return e?2:i.lead(t.date)},ddd:function(e,a){return e?t(e):this.settings.weekdaysShort[a.day]},dddd:function(e,a){return e?t(e):this.settings.weekdaysFull[a.day]},m:function(e,t){return e?i.digits(e):t.month+1},mm:function(e,t){return e?2:i.lead(t.month+1)},mmm:function(t,a){var i=this.settings.monthsShort;return t?e(t,i,a):i[a.month]},mmmm:function(t,a){var i=this.settings.monthsFull;return t?e(t,i,a):i[a.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(e,t){var a=this;return a.formats.toArray(e).map(function(e){return i.trigger(a.formats[e],a,[0,t])||e.replace(/^!/,"")}).join("")}}}(),a.prototype.isDateExact=function(e,a){var n=this;return i.isInteger(e)&&i.isInteger(a)||"boolean"==typeof e&&"boolean"==typeof a?e===a:(i.isDate(e)||t.isArray(e))&&(i.isDate(a)||t.isArray(a))?n.create(e).pick===n.create(a).pick:!!(t.isPlainObject(e)&&t.isPlainObject(a))&&n.isDateExact(e.from,a.from)&&n.isDateExact(e.to,a.to)},a.prototype.isDateOverlap=function(e,a){var n=this,s=n.settings.firstDay?1:0;return i.isInteger(e)&&(i.isDate(a)||t.isArray(a))?(e=e%7+s,e===n.create(a).day+1):i.isInteger(a)&&(i.isDate(e)||t.isArray(e))?(a=a%7+s,a===n.create(e).day+1):!!(t.isPlainObject(e)&&t.isPlainObject(a))&&n.overlapRanges(e,a)},a.prototype.flipEnable=function(e){var t=this.item;t.enable=e||(-1==t.enable?1:-1)},a.prototype.deactivate=function(e,a){var n=this,s=n.item.disable.slice(0);return"flip"==a?n.flipEnable():!1===a?(n.flipEnable(1),s=[]):!0===a?(n.flipEnable(-1),s=[]):a.map(function(e){for(var a=0,o;a<s.length;a+=1)if(n.isDateExact(e,s[a])){o=!0;break}!o&&(i.isInteger(e)||i.isDate(e)||t.isArray(e)||t.isPlainObject(e)&&e.from&&e.to)&&s.push(e)}),s},a.prototype.activate=function(e,a){var n=this,s=n.item.disable,o=s.length;return"flip"==a?n.flipEnable():!0===a?(n.flipEnable(1),s=[]):!1===a?(n.flipEnable(-1),s=[]):a.map(function(e){var a,d,r,c;for(r=0;r<o;r+=1)if(d=s[r],n.isDateExact(d,e)){a=s[r]=null,c=!0;break}else if(n.isDateOverlap(d,e)){t.isPlainObject(e)?(e.inverted=!0,a=e):t.isArray(e)?(a=e,!a[3]&&a.push("inverted")):i.isDate(e)&&(a=[e.getFullYear(),e.getMonth(),e.getDate(),"inverted"]);break}if(a)for(r=0;r<o;r+=1)if(n.isDateExact(s[r],e)){s[r]=null;break}if(c)for(r=0;r<o;r+=1)if(n.isDateOverlap(s[r],e)){s[r]=null;break}a&&s.push(a)}),s.filter(function(e){return null!=e})},a.prototype.nodes=function(e){var t=this,a=t.settings,n=t.item,s=n.now,o=n.select,d=n.highlight,r=n.view,c=n.disable,l=n.min,p=n.max,u=function(e,t){return a.firstDay&&(e.push(e.shift()),t.push(t.shift())),i.node("thead",i.node("tr",i.group({min:0,max:6,i:1,node:"th",item:function(i){return[e[i],a.klass.weekdays,"scope=col title=\""+t[i]+"\""]}})))}((a.showWeekdaysFull?a.weekdaysFull:a.weekdaysLetter).slice(0),a.weekdaysFull.slice(0)),m=function(e){return i.node("div"," ",a.klass["nav"+(e?"Next":"Prev")]+(e&&r.year>=p.year&&r.month>=p.month||!e&&r.year<=l.year&&r.month<=l.month?" "+a.klass.navDisabled:""),"data-nav="+(e||-1)+" "+i.ariaAttr({role:"button",controls:t.$node[0].id+"_table"})+" title=\""+(e?a.labelMonthNext:a.labelMonthPrev)+"\"")},g=function(n){var s=a.showMonthsShort?a.monthsShort:a.monthsFull;return"short_months"==n&&(s=a.monthsShort),a.selectMonths&&null==n?i.node("select",i.group({min:0,max:11,i:1,node:"option",item:function(e){return[s[e],0,"value="+e+(r.month==e?" selected":"")+(r.year==l.year&&e<l.month||r.year==p.year&&e>p.month?" disabled":"")]}}),a.klass.selectMonth+" browser-default",(e?"":"disabled")+" "+i.ariaAttr({controls:t.$node[0].id+"_table"})+" title=\""+a.labelMonthSelect+"\""):"short_months"==n?null==o?i.node("div",s[r.month]):i.node("div",s[o.month]):i.node("div",s[r.month],a.klass.month)},h=function(n){var s=r.year,o=!0===a.selectYears?5:~~(a.selectYears/2);if(o){var d=l.year,c=p.year,u=s-o,m=s+o;if(d>u&&(m+=d-u,u=d),c<m){var g=u-d,h=m-c;u-=g>h?h:g,m=c}if(a.selectYears&&null==n)return i.node("select",i.group({min:u,max:m,i:1,node:"option",item:function(e){return[e,0,"value="+e+(s==e?" selected":"")]}}),a.klass.selectYear+" browser-default",(e?"":"disabled")+" "+i.ariaAttr({controls:t.$node[0].id+"_table"})+" title=\""+a.labelYearSelect+"\"")}return"raw"==n?i.node("div",s):i.node("div",s,a.klass.year)};return createDayLabel=function(){return null==o?i.node("div",s.date):i.node("div",o.date)},createWeekdayLabel=function(){var e=null==o?s.day:o.day;var t=a.weekdaysFull[e];return t},i.node("div",i.node("div",createWeekdayLabel(),a.klass.weekday_display)+i.node("div",g("short_months"),a.klass.month_display)+i.node("div",createDayLabel(),a.klass.day_display)+i.node("div",h("raw"),a.klass.year_display),a.klass.date_display)+i.node("div",i.node("div",(a.selectYears?g()+h():g()+h())+m()+m(1),a.klass.header)+i.node("table",u+i.node("tbody",i.group({min:0,max:5,i:1,node:"tr",item:function(e){var n=a.firstDay&&0===t.create([r.year,r.month,1]).day?-7:0;return[i.group({min:7*e-r.day+n+1,max:function(){return this.min+7-1},i:1,node:"td",item:function(e){e=t.create([r.year,r.month,e+(a.firstDay?1:0)]);var n=o&&o.pick==e.pick,u=d&&d.pick==e.pick,m=c&&t.disabled(e)||e.pick<l.pick||e.pick>p.pick,g=i.trigger(t.formats.toString,t,[a.format,e]);return[i.node("div",e.date,function(t){return t.push(r.month==e.month?a.klass.infocus:a.klass.outfocus),s.pick==e.pick&&t.push(a.klass.now),n&&t.push(a.klass.selected),u&&t.push(a.klass.highlighted),m&&t.push(a.klass.disabled),t.join(" ")}([a.klass.day]),"data-pick="+e.pick+" "+i.ariaAttr({role:"gridcell",label:g,selected:!!(n&&t.$node.val()===g)||null,activedescendant:!!u||null,disabled:!!m||null})),"",i.ariaAttr({role:"presentation"})]}})]}})),a.klass.table,"id=\""+t.$node[0].id+"_table\" "+i.ariaAttr({role:"grid",controls:t.$node[0].id,readonly:!0})),a.klass.calendar_container)+i.node("div",i.node("button",a.today,a.klass.buttonToday,"type=button data-pick="+s.pick+(e&&!t.disabled(s)?"":" disabled")+" "+i.ariaAttr({controls:t.$node[0].id}))+i.node("button",a.clear,a.klass.buttonClear,"type=button data-clear=1"+(e?"":" disabled")+" "+i.ariaAttr({controls:t.$node[0].id}))+i.node("button",a.close,a.klass.buttonClose,"type=button data-close=true "+(e?"":" disabled")+" "+i.ariaAttr({controls:t.$node[0].id})),a.klass.footer)},a.defaults=function(e){return{labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysLetter:["S","M","T","W","T","F","S"],today:"Today",clear:"Clear",close:"Close",format:"d mmmm, yyyy",klass:{table:e+"table",header:e+"header",date_display:e+"date-display",day_display:e+"day-display",month_display:e+"month-display",year_display:e+"year-display",calendar_container:e+"calendar-container",navPrev:e+"nav--prev",navNext:e+"nav--next",navDisabled:e+"nav--disabled",month:e+"month",year:e+"year",selectMonth:e+"select--month",selectYear:e+"select--year",weekdays:e+"weekday",day:e+"day",disabled:e+"day--disabled",selected:e+"day--selected",highlighted:e+"day--highlighted",now:e+"day--today",infocus:e+"day--infocus",outfocus:e+"day--outfocus",footer:e+"footer",buttonClear:e+"button--clear",buttonToday:e+"button--today",buttonClose:e+"button--close"}}}(e.klasses().picker+"__"),e.extend("pickadate",a)});(function(e){function t(){var t=+e(this).attr("length"),a=+e(this).val().length;e(this).parent().find("span[class=\"character-counter\"]").html(a+"/"+t),n(a<=t,e(this))}function a(t){var a=t.parent().find("span[class=\"character-counter\"]");a.length||(a=e("<span/>").addClass("character-counter").css("float","right").css("font-size","12px").css("height",1),t.parent().append(a))}function i(){e(this).parent().find("span[class=\"character-counter\"]").html("")}function n(e,t){var a=t.hasClass("invalid");e&&a?t.removeClass("invalid"):!e&&!a&&(t.removeClass("valid"),t.addClass("invalid"))}e.fn.characterCounter=function(){return this.each(function(){var n=e(this),s=n.parent().find("span[class=\"character-counter\"]");if(!s.length){var o=void 0!==n.attr("length");o&&(n.on("input",t),n.on("focus",t),n.on("blur",i),a(n))}})},e(document).ready(function(){e("input, textarea").characterCounter()})})(h);(function(t){var e={init:function(a){return a=t.extend({time_constant:200,dist:-100,shift:0,padding:0,full_width:!1},a),this.each(function(){function i(t){return t.targetTouches&&1<=t.targetTouches.length?t.targetTouches[0].clientX:t.clientX}function n(t){return t.targetTouches&&1<=t.targetTouches.length?t.targetTouches[0].clientY:t.clientY}function s(e){return e>=C?e%C:0>e?s(C+e%C):e}function o(e){var t,n,o,d,r,c,l;for(h="number"==typeof e?e:h,v=B((h+w/2)/w),o=h-v*w,d=0>o?1:-1,r=2*(-d*o)/w,a.full_width?l="translateX(0)":(l="translateX("+(m[0].clientWidth-item_width)/2+"px) ",l+="translateY("+(m[0].clientHeight-item_width)/2+"px)"),c=g[s(v)],c.style[I]=l+" translateX("+-o/2+"px) translateX("+d*a.shift*r*t+"px) translateZ("+a.dist*r+"px)",c.style.zIndex=0,tweenedOpacity=a.full_width?1:1-.2*r,c.style.opacity=tweenedOpacity,n=C>>1,t=1;t<=n;++t)a.full_width?(zTranslation=a.dist,tweenedOpacity=t===n&&0>o?1-r:1):(zTranslation=a.dist*(2*t+r*d),tweenedOpacity=1-.2*(2*t+r*d)),c=g[s(v+t)],c.style[I]=l+" translateX("+(a.shift+(w*t-o)/2)+"px) translateZ("+zTranslation+"px)",c.style.zIndex=-t,c.style.opacity=tweenedOpacity,a.full_width?(zTranslation=a.dist,tweenedOpacity=t===n&&0<o?1-r:1):(zTranslation=a.dist*(2*t-r*d),tweenedOpacity=1-.2*(2*t-r*d)),c=g[s(v-t)],c.style[I]=l+" translateX("+(-a.shift+(-w*t-o)/2)+"px) translateZ("+zTranslation+"px)",c.style.zIndex=-t,c.style.opacity=tweenedOpacity;c=g[s(v)],c.style[I]=l+" translateX("+-o/2+"px) translateX("+d*a.shift*r+"px) translateZ("+a.dist*r+"px)",c.style.zIndex=0,tweenedOpacity=a.full_width?1:1-.2*r,c.style.opacity=tweenedOpacity}function d(){var e,t,a,i;e=Date.now(),t=e-R,R=e,a=h-N,N=h,i=1e3*a/(1+t),E=.8*i+.2*E}function r(){var e,t;A&&(e=Date.now()-R,t=A*f(-e/a.time_constant),2<t||-2>t?(o(T-t),requestAnimationFrame(r)):o(T))}function c(i){if(P)return i.preventDefault(),i.stopPropagation(),!1;if(!a.full_width){var e=t(i.target).closest(".carousel-item").index(),n=v%C-e;0>n?M(n+C)<M(n)&&(n+=C):0<n&&M(n-C)<n&&(n-=C),0>n?t(this).trigger("carouselNext",[M(n)]):0<n&&t(this).trigger("carouselPrev",[n])}}function l(t){b=!0,P=!1,j=!1,S=i(t),k=n(t),E=A=0,N=h,R=Date.now(),clearInterval(O),O=setInterval(d,100)}function p(t){var e,a,s;if(b)if(e=i(t),y=n(t),a=S-e,s=M(k-y),30>s&&!j)(2<a||-2>a)&&(P=!0,S=e,o(h+a));else{if(P)return t.preventDefault(),t.stopPropagation(),!1;j=!0}return P?(t.preventDefault(),t.stopPropagation(),!1):void 0}function u(t){return b=!1,clearInterval(O),T=h,(10<E||-10>E)&&(A=.9*E,T=h+A),T=L(T/w)*w,A=T-h,R=Date.now(),requestAnimationFrame(r),t.preventDefault(),t.stopPropagation(),!1}var m=t(this),g,h,v,b,w,C,S,k,A,T,E,I,N,R,O,P,j;return!!m.hasClass("initialized")||void(a.full_width&&(a.dist=0,imageHeight=m.find(".carousel-item img").first().load(function(){m.css("height",t(this).height())})),m.addClass("initialized"),b=!1,h=T=0,g=[],item_width=m.find(".carousel-item").first().innerWidth(),w=2*item_width+a.padding,m.find(".carousel-item").each(function(){g.push(t(this)[0])}),C=g.length,I="transform",["webkit","Moz","O","ms"].every(function(t){var a=t+"Transform";return"undefined"==typeof document.body.style[a]||(I=a,!1)}),window.onresize=o,function(){"undefined"!=typeof window.ontouchstart&&(m[0].addEventListener("touchstart",l),m[0].addEventListener("touchmove",p),m[0].addEventListener("touchend",u)),m[0].addEventListener("mousedown",l),m[0].addEventListener("mousemove",p),m[0].addEventListener("mouseup",u),m[0].addEventListener("click",c)}(),o(h),t(this).on("carouselNext",function(t,e){void 0===e&&(e=1),T=h+w*e,h!==T&&(A=T-h,R=Date.now(),requestAnimationFrame(r))}),t(this).on("carouselPrev",function(t,e){void 0===e&&(e=1),T=h-w*e,h!==T&&(A=T-h,R=Date.now(),requestAnimationFrame(r))}))})},next:function(e){t(this).trigger("carouselNext",[e])},prev:function(e){t(this).trigger("carouselPrev",[e])}};t.fn.carousel=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));return"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on jQuery.carousel"):e.init.apply(this,arguments)}})(h)}),function d(c,e,t){function a(i,s){if(!e[i]){if(!c[i]){var o="function"==typeof require&&require;if(!s&&o)return o(i,!0);if(n)return n(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var p=e[i]={exports:{}};c[i][0].call(p.exports,function(t){var e=c[i][1][t];return a(e?e:t)},p,p.exports,d,c,e,t)}return e[i].exports}for(var n="function"==typeof require&&require,i=0;i<t.length;i++)a(t[i]);return a}({1:[function(e,t){'use strict';function a(e){e.fn.perfectScrollbar=function(e){return this.each(function(){if("object"==typeof e||"undefined"==typeof e){n.get(this)||i.initialize(this,e)}else{var t=e;"update"===t?i.update(this):"destroy"===t&&i.destroy(this)}})}}var i=e("../main"),n=e("../plugin/instances");if("function"==typeof define&&define.amd)define("perfectScrollbarJQuery",["jquery"],a);else{var s=window.jQuery?window.jQuery:window.$;"undefined"!=typeof s&&a(s)}t.exports=a},{"../main":7,"../plugin/instances":18}],2:[function(e,t,a){'use strict';function i(e,t){var a=e.className.split(" ");0>a.indexOf(t)&&a.push(t),e.className=a.join(" ")}function n(e,t){var a=e.className.split(" "),i=a.indexOf(t);0<=i&&a.splice(i,1),e.className=a.join(" ")}a.add=function(e,t){e.classList?e.classList.add(t):i(e,t)},a.remove=function(e,t){e.classList?e.classList.remove(t):n(e,t)},a.list=function(e){return e.classList?Array.prototype.slice.apply(e.classList):e.className.split(" ")}},{}],3:[function(e,t){'use strict';function a(e,t){return window.getComputedStyle(e)[t]}function i(e,t,a){return"number"==typeof a&&(a=a.toString()+"px"),e.style[t]=a,e}function n(e,t){for(var a in t){var i=t[a];"number"==typeof i&&(i=i.toString()+"px"),e.style[a]=i}return e}var s={};s.e=function(e,t){var a=document.createElement(e);return a.className=t,a},s.appendTo=function(e,t){return t.appendChild(e),e},s.css=function(e,t,s){return"object"==typeof t?n(e,t):"undefined"==typeof s?a(e,t):i(e,t,s)},s.matches=function(e,t){if("undefined"!=typeof e.matches)return e.matches(t);return"undefined"==typeof e.matchesSelector?"undefined"==typeof e.webkitMatchesSelector?"undefined"==typeof e.mozMatchesSelector?"undefined"==typeof e.msMatchesSelector?void 0:e.msMatchesSelector(t):e.mozMatchesSelector(t):e.webkitMatchesSelector(t):e.matchesSelector(t)},s.remove=function(e){"undefined"==typeof e.remove?e.parentNode&&e.parentNode.removeChild(e):e.remove()},s.queryChildren=function(e,t){return Array.prototype.filter.call(e.childNodes,function(e){return s.matches(e,t)})},t.exports=s},{}],4:[function(e,t){'use strict';var a=function(e){this.element=e,this.events={}};a.prototype.bind=function(e,t){"undefined"==typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),this.element.addEventListener(e,t,!1)},a.prototype.unbind=function(e,t){this.events[e]=this.events[e].filter(function(a){return!!("undefined"!=typeof t&&a!==t)||(this.element.removeEventListener(e,a,!1),!1)},this)},a.prototype.unbindAll=function(){for(var e in this.events)this.unbind(e)};var i=function(){this.eventElements=[]};i.prototype.eventElement=function(e){var t=this.eventElements.filter(function(t){return t.element===e})[0];return"undefined"==typeof t&&(t=new a(e),this.eventElements.push(t)),t},i.prototype.bind=function(e,t,a){this.eventElement(e).bind(t,a)},i.prototype.unbind=function(e,t,a){this.eventElement(e).unbind(t,a)},i.prototype.unbindAll=function(){for(var e=0;e<this.eventElements.length;e++)this.eventElements[e].unbindAll()},i.prototype.once=function(e,t,a){var i=this.eventElement(e),n=function(s){i.unbind(t,n),a(s)};i.bind(t,n)},t.exports=i},{}],5:[function(e,t){'use strict';t.exports=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}()},{}],6:[function(e,t,a){'use strict';var n=e("./class"),s=e("./dom"),o=a.toInt=function(e){return parseInt(e,10)||0},d=a.clone=function(e){if(!e)return null;if(e.constructor===Array)return e.map(d);if("object"==typeof e){var t={};for(var a in e)t[a]=d(e[a]);return t}return e};a.extend=function(e,t){var a=d(e);for(var i in t)a[i]=d(t[i]);return a},a.isEditable=function(e){return s.matches(e,"input,[contenteditable]")||s.matches(e,"select,[contenteditable]")||s.matches(e,"textarea,[contenteditable]")||s.matches(e,"button,[contenteditable]")},a.removePsClasses=function(e){for(var t=n.list(e),a=0,s;a<t.length;a++)s=t[a],0===s.indexOf("ps-")&&n.remove(e,s)},a.outerWidth=function(e){return o(s.css(e,"width"))+o(s.css(e,"paddingLeft"))+o(s.css(e,"paddingRight"))+o(s.css(e,"borderLeftWidth"))+o(s.css(e,"borderRightWidth"))},a.startScrolling=function(e,t){n.add(e,"ps-in-scrolling"),"undefined"==typeof t?(n.add(e,"ps-x"),n.add(e,"ps-y")):n.add(e,"ps-"+t)},a.stopScrolling=function(e,t){n.remove(e,"ps-in-scrolling"),"undefined"==typeof t?(n.remove(e,"ps-x"),n.remove(e,"ps-y")):n.remove(e,"ps-"+t)},a.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":2,"./dom":3}],7:[function(e,t){'use strict';var a=e("./plugin/destroy"),i=e("./plugin/initialize"),n=e("./plugin/update");t.exports={initialize:i,update:n,destroy:a}},{"./plugin/destroy":9,"./plugin/initialize":17,"./plugin/update":21}],8:[function(e,t){'use strict';t.exports={handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default"}},{}],9:[function(e,t){'use strict';var a=e("../lib/helper"),n=e("../lib/dom"),s=e("./instances");t.exports=function(e){var t=s.get(e);t&&(t.event.unbindAll(),n.remove(t.scrollbarX),n.remove(t.scrollbarY),n.remove(t.scrollbarXRail),n.remove(t.scrollbarYRail),a.removePsClasses(e),s.remove(e))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18}],10:[function(e,t){'use strict';function a(t,a){function i(e){return e.getBoundingClientRect()}var n=function(t){t.stopPropagation()};a.event.bind(a.scrollbarY,"click",n),a.event.bind(a.scrollbarYRail,"click",function(n){var e=n.pageY-window.pageYOffset-i(a.scrollbarYRail).top,d=e>a.scrollbarYTop?1:-1;o(t,"top",t.scrollTop+d*a.containerHeight),s(t),n.stopPropagation()}),a.event.bind(a.scrollbarX,"click",n),a.event.bind(a.scrollbarXRail,"click",function(n){var e=n.pageX-window.pageXOffset-i(a.scrollbarXRail).left,d=e>a.scrollbarXLeft?1:-1;o(t,"left",t.scrollLeft+d*a.containerWidth),s(t),n.stopPropagation()})}var n=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=n.get(e);a(e,t)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],11:[function(e,t){'use strict';var s=Math.max;function a(t,a){function i(e){var i=n+e*a.railXRatio,d=s(0,a.scrollbarXRail.getBoundingClientRect().left)+a.railXRatio*(a.railXWidth-a.scrollbarXWidth);a.scrollbarXLeft=0>i?0:i>d?d:i;var r=o.toInt(a.scrollbarXLeft*(a.contentWidth-a.containerWidth)/(a.containerWidth-a.railXRatio*a.scrollbarXWidth))-a.negativeScrollAdjustment;l(t,"left",r)}var n=null,r=null,p=function(a){i(a.pageX-r),c(t),a.stopPropagation(),a.preventDefault()},u=function(){o.stopScrolling(t,"x"),a.event.unbind(a.ownerDocument,"mousemove",p)};a.event.bind(a.scrollbarX,"mousedown",function(i){r=i.pageX,n=o.toInt(d.css(a.scrollbarX,"left"))*a.railXRatio,o.startScrolling(t,"x"),a.event.bind(a.ownerDocument,"mousemove",p),a.event.once(a.ownerDocument,"mouseup",u),i.stopPropagation(),i.preventDefault()})}function n(t,a){function i(e){var i=n+e*a.railYRatio,d=s(0,a.scrollbarYRail.getBoundingClientRect().top)+a.railYRatio*(a.railYHeight-a.scrollbarYHeight);a.scrollbarYTop=0>i?0:i>d?d:i;var r=o.toInt(a.scrollbarYTop*(a.contentHeight-a.containerHeight)/(a.containerHeight-a.railYRatio*a.scrollbarYHeight));l(t,"top",r)}var n=null,r=null,p=function(a){i(a.pageY-r),c(t),a.stopPropagation(),a.preventDefault()},u=function(){o.stopScrolling(t,"y"),a.event.unbind(a.ownerDocument,"mousemove",p)};a.event.bind(a.scrollbarY,"mousedown",function(i){r=i.pageY,n=o.toInt(d.css(a.scrollbarY,"top"))*a.railYRatio,o.startScrolling(t,"y"),a.event.bind(a.ownerDocument,"mousemove",p),a.event.once(a.ownerDocument,"mouseup",u),i.stopPropagation(),i.preventDefault()})}var o=e("../../lib/helper"),d=e("../../lib/dom"),r=e("../instances"),c=e("../update-geometry"),l=e("../update-scroll");t.exports=function(e){var t=r.get(e);a(e,t),n(e,t)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],12:[function(e,t){'use strict';function a(t,a){function s(e,i){var n=t.scrollTop;if(0===e){if(!a.scrollbarYActive)return!1;if(0===n&&0<i||n>=a.contentHeight-a.containerHeight&&0>i)return!a.settings.wheelPropagation}var s=t.scrollLeft;if(0===i){if(!a.scrollbarXActive)return!1;if(0===s&&0>e||s>=a.contentWidth-a.containerWidth&&0<e)return!a.settings.wheelPropagation}return!0}var r=!1;a.event.bind(t,"mouseenter",function(){r=!0}),a.event.bind(t,"mouseleave",function(){r=!1});var c=!1;a.event.bind(a.ownerDocument,"keydown",function(l){if(!(l.isDefaultPrevented&&l.isDefaultPrevented()||l.defaultPrevented)){var e=n.matches(a.scrollbarX,":focus")||n.matches(a.scrollbarY,":focus");if(r||e){var p=document.activeElement?document.activeElement:a.ownerDocument.activeElement;if(p){if("IFRAME"===p.tagName)p=p.contentDocument.activeElement;else for(;p.shadowRoot;)p=p.shadowRoot.activeElement;if(i.isEditable(p))return}var u=0,m=0;switch(l.which){case 37:u=l.metaKey?-a.contentWidth:l.altKey?-a.containerWidth:-30;break;case 38:m=l.metaKey?a.contentHeight:l.altKey?a.containerHeight:30;break;case 39:u=l.metaKey?a.contentWidth:l.altKey?a.containerWidth:30;break;case 40:m=l.metaKey?-a.contentHeight:l.altKey?-a.containerHeight:-30;break;case 33:m=90;break;case 32:m=l.shiftKey?90:-90;break;case 34:m=-90;break;case 35:m=l.ctrlKey?-a.contentHeight:-a.containerHeight;break;case 36:m=l.ctrlKey?t.scrollTop:a.containerHeight;break;default:return;}d(t,"top",t.scrollTop-m),d(t,"left",t.scrollLeft+u),o(t),c=s(u,m),c&&l.preventDefault()}}})}var i=e("../../lib/helper"),n=e("../../lib/dom"),s=e("../instances"),o=e("../update-geometry"),d=e("../update-scroll");t.exports=function(e){var t=s.get(e);a(e,t)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],13:[function(e,t){'use strict';function a(t,a){function i(e,i){var n=t.scrollTop;if(0===e){if(!a.scrollbarYActive)return!1;if(0===n&&0<i||n>=a.contentHeight-a.containerHeight&&0>i)return!a.settings.wheelPropagation}var s=t.scrollLeft;if(0===i){if(!a.scrollbarXActive)return!1;if(0===s&&0>e||s>=a.contentWidth-a.containerWidth&&0<e)return!a.settings.wheelPropagation}return!0}function n(t){var e=t.deltaX,a=-1*t.deltaY;return("undefined"==typeof e||"undefined"==typeof a)&&(e=-1*t.wheelDeltaX/6,a=t.wheelDeltaY/6),t.deltaMode&&1===t.deltaMode&&(e*=10,a*=10),e!==e&&a!==a&&(e=0,a=t.wheelDelta),t.shiftKey?[-a,-e]:[e,a]}function d(e,a){var i=t.querySelector("textarea:hover, select[multiple]:hover, .ps-child:hover");if(i){if(!window.getComputedStyle(i).overflow.match(/(scroll|auto)/))return!1;var n=i.scrollHeight-i.clientHeight;if(0<n&&!(0===i.scrollTop&&0<a)&&!(i.scrollTop===n&&0>a))return!0;var s=i.scrollLeft-i.clientWidth;if(0<s&&!(0===i.scrollLeft&&0>e)&&!(i.scrollLeft===s&&0<e))return!0}return!1}function r(r){var e=n(r),l=e[0],p=e[1];d(l,p)||(c=!1,a.settings.useBothWheelAxes?a.scrollbarYActive&&!a.scrollbarXActive?(p?o(t,"top",t.scrollTop-p*a.settings.wheelSpeed):o(t,"top",t.scrollTop+l*a.settings.wheelSpeed),c=!0):a.scrollbarXActive&&!a.scrollbarYActive&&(l?o(t,"left",t.scrollLeft+l*a.settings.wheelSpeed):o(t,"left",t.scrollLeft-p*a.settings.wheelSpeed),c=!0):(o(t,"top",t.scrollTop-p*a.settings.wheelSpeed),o(t,"left",t.scrollLeft+l*a.settings.wheelSpeed)),s(t),c=c||i(l,p),c&&(r.stopPropagation(),r.preventDefault()))}var c=!1;"undefined"==typeof window.onwheel?"undefined"!=typeof window.onmousewheel&&a.event.bind(t,"mousewheel",r):a.event.bind(t,"wheel",r)}var n=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=n.get(e);a(e,t)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],14:[function(e,t){'use strict';function a(e,t){t.event.bind(e,"scroll",function(){s(e)})}var n=e("../instances"),s=e("../update-geometry");t.exports=function(e){var t=n.get(e);a(e,t)}},{"../instances":18,"../update-geometry":19}],15:[function(e,t){'use strict';function a(t,a){function e(){var e=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===e.toString().length?null:e.getRangeAt(0).commonAncestorContainer}function d(){c||(c=setInterval(function(){return n.get(t)?void(o(t,"top",t.scrollTop+l.top),o(t,"left",t.scrollLeft+l.left),s(t)):void clearInterval(c)},50))}function r(){c&&(clearInterval(c),c=null),i.stopScrolling(t)}var c=null,l={top:0,left:0},p=!1;a.event.bind(a.ownerDocument,"selectionchange",function(){t.contains(e())?p=!0:(p=!1,r())}),a.event.bind(window,"mouseup",function(){p&&(p=!1,r())}),a.event.bind(window,"keyup",function(){p&&(p=!1,r())}),a.event.bind(window,"mousemove",function(a){if(p){var e={x:a.pageX,y:a.pageY},n={left:t.offsetLeft,right:t.offsetLeft+t.offsetWidth,top:t.offsetTop,bottom:t.offsetTop+t.offsetHeight};e.x<n.left+3?(l.left=-5,i.startScrolling(t,"x")):e.x>n.right-3?(l.left=5,i.startScrolling(t,"x")):l.left=0,e.y<n.top+3?(l.top=5>n.top+3-e.y?-5:-20,i.startScrolling(t,"y")):e.y>n.bottom-3?(l.top=5>e.y-n.bottom+3?5:20,i.startScrolling(t,"y")):l.top=0,0===l.top&&0===l.left?r():d()}})}var i=e("../../lib/helper"),n=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=n.get(e);a(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],16:[function(e,t){'use strict';var n=Math.abs;function a(e,t,a,i){function s(a,i){var s=e.scrollTop,o=e.scrollLeft,d=n(a),r=n(i);if(r>d){if(0>i&&s===t.contentHeight-t.containerHeight||0<i&&0===s)return!t.settings.swipePropagation;}else if(d>r&&(0>a&&o===t.contentWidth-t.containerWidth||0<a&&0===o))return!t.settings.swipePropagation;return!0}function c(t,a){r(e,"top",e.scrollTop-a),r(e,"left",e.scrollLeft-t),d(e)}function l(){C=!0}function p(){C=!1}function u(t){return t.targetTouches?t.targetTouches[0]:t}function m(t){return!!(t.targetTouches&&1===t.targetTouches.length)||!!(t.pointerType&&"mouse"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE)}function g(t){if(m(t)){S=!0;var e=u(t);f.pageX=e.pageX,f.pageY=e.pageY,b=new Date().getTime(),null!==w&&clearInterval(w),t.stopPropagation()}}function h(a){if(!S&&t.settings.swipePropagation&&g(a),!C&&S&&m(a)){var e=u(a),i={pageX:e.pageX,pageY:e.pageY},n=i.pageX-f.pageX,o=i.pageY-f.pageY;c(n,o),f=i;var d=new Date().getTime(),r=d-b;0<r&&(x.x=n/r,x.y=o/r,b=d),s(n,o)&&(a.stopPropagation(),a.preventDefault())}}function v(){!C&&S&&(S=!1,clearInterval(w),w=setInterval(function(){return o.get(e)?x.x||x.y?.01>n(x.x)&&.01>n(x.y)?void clearInterval(w):void(c(30*x.x,30*x.y),x.x*=.8,x.y*=.8):void clearInterval(w):void clearInterval(w)},10))}var f={},b=0,x={},w=null,C=!1,S=!1;a?(t.event.bind(window,"touchstart",l),t.event.bind(window,"touchend",p),t.event.bind(e,"touchstart",g),t.event.bind(e,"touchmove",h),t.event.bind(e,"touchend",v)):i&&(window.PointerEvent?(t.event.bind(window,"pointerdown",l),t.event.bind(window,"pointerup",p),t.event.bind(e,"pointerdown",g),t.event.bind(e,"pointermove",h),t.event.bind(e,"pointerup",v)):window.MSPointerEvent&&(t.event.bind(window,"MSPointerDown",l),t.event.bind(window,"MSPointerUp",p),t.event.bind(e,"MSPointerDown",g),t.event.bind(e,"MSPointerMove",h),t.event.bind(e,"MSPointerUp",v)))}var s=e("../../lib/helper"),o=e("../instances"),d=e("../update-geometry"),r=e("../update-scroll");t.exports=function(e){if(s.env.supportsTouch||s.env.supportsIePointer){var t=o.get(e);a(e,t,s.env.supportsTouch,s.env.supportsIePointer)}}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],17:[function(e,t){'use strict';var a=e("../lib/helper"),n=e("../lib/class"),s=e("./instances"),o=e("./update-geometry"),d={"click-rail":e("./handler/click-rail"),"drag-scrollbar":e("./handler/drag-scrollbar"),keyboard:e("./handler/keyboard"),wheel:e("./handler/mouse-wheel"),touch:e("./handler/touch"),selection:e("./handler/selection")},r=e("./handler/native-scroll");t.exports=function(e,t){t="object"==typeof t?t:{},n.add(e,"ps-container");var c=s.add(e);c.settings=a.extend(c.settings,t),n.add(e,"ps-theme-"+c.settings.theme),c.settings.handlers.forEach(function(t){d[t](e)}),r(e),o(e)}},{"../lib/class":2,"../lib/helper":6,"./handler/click-rail":10,"./handler/drag-scrollbar":11,"./handler/keyboard":12,"./handler/mouse-wheel":13,"./handler/native-scroll":14,"./handler/selection":15,"./handler/touch":16,"./instances":18,"./update-geometry":19}],18:[function(e,t,a){'use strict';function i(e){function t(){r.add(e,"ps-focus")}function a(){r.remove(e,"ps-focus")}var n=this;n.settings=d.clone(c),n.containerWidth=null,n.containerHeight=null,n.contentWidth=null,n.contentHeight=null,n.isRtl="rtl"===l.css(e,"direction"),n.isNegativeScroll=function(){var t=e.scrollLeft,a=null;return e.scrollLeft=-1,a=0>e.scrollLeft,e.scrollLeft=t,a}(),n.negativeScrollAdjustment=n.isNegativeScroll?e.scrollWidth-e.clientWidth:0,n.event=new p,n.ownerDocument=e.ownerDocument||document,n.scrollbarXRail=l.appendTo(l.e("div","ps-scrollbar-x-rail"),e),n.scrollbarX=l.appendTo(l.e("div","ps-scrollbar-x"),n.scrollbarXRail),n.scrollbarX.setAttribute("tabindex",0),n.event.bind(n.scrollbarX,"focus",t),n.event.bind(n.scrollbarX,"blur",a),n.scrollbarXActive=null,n.scrollbarXWidth=null,n.scrollbarXLeft=null,n.scrollbarXBottom=d.toInt(l.css(n.scrollbarXRail,"bottom")),n.isScrollbarXUsingBottom=n.scrollbarXBottom===n.scrollbarXBottom,n.scrollbarXTop=n.isScrollbarXUsingBottom?null:d.toInt(l.css(n.scrollbarXRail,"top")),n.railBorderXWidth=d.toInt(l.css(n.scrollbarXRail,"borderLeftWidth"))+d.toInt(l.css(n.scrollbarXRail,"borderRightWidth")),l.css(n.scrollbarXRail,"display","block"),n.railXMarginWidth=d.toInt(l.css(n.scrollbarXRail,"marginLeft"))+d.toInt(l.css(n.scrollbarXRail,"marginRight")),l.css(n.scrollbarXRail,"display",""),n.railXWidth=null,n.railXRatio=null,n.scrollbarYRail=l.appendTo(l.e("div","ps-scrollbar-y-rail"),e),n.scrollbarY=l.appendTo(l.e("div","ps-scrollbar-y"),n.scrollbarYRail),n.scrollbarY.setAttribute("tabindex",0),n.event.bind(n.scrollbarY,"focus",t),n.event.bind(n.scrollbarY,"blur",a),n.scrollbarYActive=null,n.scrollbarYHeight=null,n.scrollbarYTop=null,n.scrollbarYRight=d.toInt(l.css(n.scrollbarYRail,"right")),n.isScrollbarYUsingRight=n.scrollbarYRight===n.scrollbarYRight,n.scrollbarYLeft=n.isScrollbarYUsingRight?null:d.toInt(l.css(n.scrollbarYRail,"left")),n.scrollbarYOuterWidth=n.isRtl?d.outerWidth(n.scrollbarY):null,n.railBorderYWidth=d.toInt(l.css(n.scrollbarYRail,"borderTopWidth"))+d.toInt(l.css(n.scrollbarYRail,"borderBottomWidth")),l.css(n.scrollbarYRail,"display","block"),n.railYMarginHeight=d.toInt(l.css(n.scrollbarYRail,"marginTop"))+d.toInt(l.css(n.scrollbarYRail,"marginBottom")),l.css(n.scrollbarYRail,"display",""),n.railYHeight=null,n.railYRatio=null}function n(e){return e.getAttribute("data-ps-id")}function s(e,t){e.setAttribute("data-ps-id",t)}function o(e){e.removeAttribute("data-ps-id")}var d=e("../lib/helper"),r=e("../lib/class"),c=e("./default-setting"),l=e("../lib/dom"),p=e("../lib/event-manager"),u=e("../lib/guid"),m={};a.add=function(e){var t=u();return s(e,t),m[t]=new i(e),m[t]},a.remove=function(e){delete m[n(e)],o(e)},a.get=function(e){return m[n(e)]}},{"../lib/class":2,"../lib/dom":3,"../lib/event-manager":4,"../lib/guid":5,"../lib/helper":6,"./default-setting":8}],19:[function(e,t){'use strict';var s=Math.min,o=Math.max;function a(e,t){return e.settings.minScrollbarLength&&(t=o(t,e.settings.minScrollbarLength)),e.settings.maxScrollbarLength&&(t=s(t,e.settings.maxScrollbarLength)),t}function n(e,t){var a={width:t.railXWidth};a.left=t.isRtl?t.negativeScrollAdjustment+e.scrollLeft+t.containerWidth-t.contentWidth:e.scrollLeft,t.isScrollbarXUsingBottom?a.bottom=t.scrollbarXBottom-e.scrollTop:a.top=t.scrollbarXTop+e.scrollTop,c.css(t.scrollbarXRail,a);var i={top:e.scrollTop,height:t.railYHeight};t.isScrollbarYUsingRight?t.isRtl?i.right=t.contentWidth-(t.negativeScrollAdjustment+e.scrollLeft)-t.scrollbarYRight-t.scrollbarYOuterWidth:i.right=t.scrollbarYRight-e.scrollLeft:t.isRtl?i.left=t.negativeScrollAdjustment+e.scrollLeft+2*t.containerWidth-t.contentWidth-t.scrollbarYLeft-t.scrollbarYOuterWidth:i.left=t.scrollbarYLeft+e.scrollLeft,c.css(t.scrollbarYRail,i),c.css(t.scrollbarX,{left:t.scrollbarXLeft,width:t.scrollbarXWidth-t.railBorderXWidth}),c.css(t.scrollbarY,{top:t.scrollbarYTop,height:t.scrollbarYHeight-t.railBorderYWidth})}var d=e("../lib/helper"),r=e("../lib/class"),c=e("../lib/dom"),l=e("./instances"),p=e("./update-scroll");t.exports=function(e){var t=l.get(e);t.containerWidth=e.clientWidth,t.containerHeight=e.clientHeight,t.contentWidth=e.scrollWidth,t.contentHeight=e.scrollHeight;var i;e.contains(t.scrollbarXRail)||(i=c.queryChildren(e,".ps-scrollbar-x-rail"),0<i.length&&i.forEach(function(e){c.remove(e)}),c.appendTo(t.scrollbarXRail,e)),e.contains(t.scrollbarYRail)||(i=c.queryChildren(e,".ps-scrollbar-y-rail"),0<i.length&&i.forEach(function(e){c.remove(e)}),c.appendTo(t.scrollbarYRail,e)),!t.settings.suppressScrollX&&t.containerWidth+t.settings.scrollXMarginOffset<t.contentWidth?(t.scrollbarXActive=!0,t.railXWidth=t.containerWidth-t.railXMarginWidth,t.railXRatio=t.containerWidth/t.railXWidth,t.scrollbarXWidth=a(t,d.toInt(t.railXWidth*t.containerWidth/t.contentWidth)),t.scrollbarXLeft=d.toInt((t.negativeScrollAdjustment+e.scrollLeft)*(t.railXWidth-t.scrollbarXWidth)/(t.contentWidth-t.containerWidth))):t.scrollbarXActive=!1,!t.settings.suppressScrollY&&t.containerHeight+t.settings.scrollYMarginOffset<t.contentHeight?(t.scrollbarYActive=!0,t.railYHeight=t.containerHeight-t.railYMarginHeight,t.railYRatio=t.containerHeight/t.railYHeight,t.scrollbarYHeight=a(t,d.toInt(t.railYHeight*t.containerHeight/t.contentHeight)),t.scrollbarYTop=d.toInt(e.scrollTop*(t.railYHeight-t.scrollbarYHeight)/(t.contentHeight-t.containerHeight))):t.scrollbarYActive=!1,t.scrollbarXLeft>=t.railXWidth-t.scrollbarXWidth&&(t.scrollbarXLeft=t.railXWidth-t.scrollbarXWidth),t.scrollbarYTop>=t.railYHeight-t.scrollbarYHeight&&(t.scrollbarYTop=t.railYHeight-t.scrollbarYHeight),n(e,t),t.scrollbarXActive?r.add(e,"ps-active-x"):(r.remove(e,"ps-active-x"),t.scrollbarXWidth=0,t.scrollbarXLeft=0,p(e,"left",0)),t.scrollbarYActive?r.add(e,"ps-active-y"):(r.remove(e,"ps-active-y"),t.scrollbarYHeight=0,t.scrollbarYTop=0,p(e,"top",0))}},{"../lib/class":2,"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-scroll":20}],20:[function(e,t){'use strict';var a=e("./instances"),n=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!0),t},s,o;t.exports=function(e,t,d){if("undefined"==typeof e)throw"You must provide an element to the update-scroll function";if("undefined"==typeof t)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof d)throw"You must provide a value to the update-scroll function";"top"===t&&0>=d&&(e.scrollTop=d=0,e.dispatchEvent(n("ps-y-reach-start"))),"left"===t&&0>=d&&(e.scrollLeft=d=0,e.dispatchEvent(n("ps-x-reach-start")));var r=a.get(e);"top"===t&&d>=r.contentHeight-r.containerHeight&&(d=r.contentHeight-r.containerHeight,1>=d-e.scrollTop?d=e.scrollTop:e.scrollTop=d,e.dispatchEvent(n("ps-y-reach-end"))),"left"===t&&d>=r.contentWidth-r.containerWidth&&(d=r.contentWidth-r.containerWidth,1>=d-e.scrollLeft?d=e.scrollLeft:e.scrollLeft=d,e.dispatchEvent(n("ps-x-reach-end"))),s||(s=e.scrollTop),o||(o=e.scrollLeft),"top"===t&&d<s&&e.dispatchEvent(n("ps-scroll-up")),"top"===t&&d>s&&e.dispatchEvent(n("ps-scroll-down")),"left"===t&&d<o&&e.dispatchEvent(n("ps-scroll-left")),"left"===t&&d>o&&e.dispatchEvent(n("ps-scroll-right")),"top"===t&&(e.scrollTop=s=d,e.dispatchEvent(n("ps-scroll-y"))),"left"===t&&(e.scrollLeft=o=d,e.dispatchEvent(n("ps-scroll-x")))}},{"./instances":18}],21:[function(e,t){'use strict';var a=e("../lib/helper"),n=e("../lib/dom"),s=e("./instances"),o=e("./update-geometry"),d=e("./update-scroll");t.exports=function(e){var t=s.get(e);t&&(t.negativeScrollAdjustment=t.isNegativeScroll?e.scrollWidth-e.clientWidth:0,n.css(t.scrollbarXRail,"display","block"),n.css(t.scrollbarYRail,"display","block"),t.railXMarginWidth=a.toInt(n.css(t.scrollbarXRail,"marginLeft"))+a.toInt(n.css(t.scrollbarXRail,"marginRight")),t.railYMarginHeight=a.toInt(n.css(t.scrollbarYRail,"marginTop"))+a.toInt(n.css(t.scrollbarYRail,"marginBottom")),n.css(t.scrollbarXRail,"display","none"),n.css(t.scrollbarYRail,"display","none"),o(e),d(e,"top",e.scrollTop),d(e,"left",e.scrollLeft),n.css(t.scrollbarXRail,"display",""),n.css(t.scrollbarYRail,"display",""))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-geometry":19,"./update-scroll":20}]},{},[1]),define("xabber-dependencies",["backbone","underscore","jquery","moment","wavesurfer","slug","magnific-popup","strophe","strophe.disco","strophe.ping","strophe.rsm","strophe.caps","strophe.pubsub","backbone.localsync","sha1_hasher","materialize","perfectScrollbarJQuery"],function(e,t,a,i,n,s,o,d){return t.extend({$:a,_:t,moment:i,WaveSurfer:n,slug:s,magnificPopup:o,Strophe:d},d)});var constants={DEBUG:!1,STORAGE_NAME:"xabber-storage",STORAGE_VERSION:"v8",FAVICON_DEFAULT:"images/favicon.png",FAVICON_MESSAGE:"images/favicon-message.png",CHAT_ICONS:{GROUP_CHAT_ICON:"images/circle-group-chat-icon.svg",BOT_CHAT_ICON:"images/circle-bot-icon.png",PRIVATE_CHAT_ICON:"images/circle-private-chat-icon.png",INCOGNITO_CHAT_ICON:"images/circle-incognito-chat-icon.png"},CONTACT_ICONS:{GROUP_CHAT_ICON:"images/circle-group-contact-icon.png",BOT_CHAT_ICON:"images/circle-bot-contact-icon.png",PRIVATE_CHAT_ICON:"images/circle-private-contact-icon.png",INCOGNITO_CHAT_ICON:"images/circle-incognito-contact-icon.png"},WIDTH_MEDIUM:1420,WIDTH_NARROW:1280,WIDTH_TINY:1152,LOG_LEVEL_NONE:-1,LOG_LEVEL_ERROR:1,LOG_LEVEL_WARN:2,LOG_LEVEL_INFO:3,LOG_LEVEL_DEBUG:4,LOG_LEVEL:"ERROR",KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_ESCAPE:27,KEY_SPACE:32,KEY_ARROW_LEFT:37,KEY_ARROW_UP:38,KEY_ARROW_RIGHT:39,KEY_ARROW_DOWN:40,KEY_DELETE:46,KEY_FORWARD_SLASH:47,KEY_AT:50,VOICE_MSG_TIME:120,PASSWORD_DOT:String.fromCharCode(8226),CONNECTION_URL:null,CONN_STATUSES:{0:"ERROR",1:"CONNECTING",2:"CONNFAIL",3:"AUTHENTICATING",4:"AUTHFAIL",5:"CONNECTED",6:"DISCONNECTED",7:"DISCONNECTING",8:"ATTACHED",9:"REDIRECT",10:"CONNTIMEOUT"},BAD_CONN_STATUSES:[0,2,4,6,10],RECONNECTION_TIMEOUTS:[5e3,1e4,15e3],STATUSES:{chat:"Ready for chat",online:"Online",away:"Away",xa:"Away for long time",dnd:"Busy",offline:"Offline",unavailable:"Unavailable"},STATUS_WEIGHTS:{chat:1,online:2,away:3,xa:4,dnd:5,offline:6,unavailable:7},CHATSTATE_INTERVAL_COMPOSING_AUDIO:5e3,CHATSTATE_TIMEOUT_PAUSED:5e3,CHATSTATE_TIMEOUT_STOPPED:5e3,CHATSTATE_TIMEOUT_PAUSED_AUDIO:1e4,JINGLE_MSG_PROPOSE:0,JINGLE_MSG_REJECT:1,JINGLE_MSG_ACCEPT:2,MSG_ERROR:-1,MSG_PENDING:0,MSG_SENT:1,MSG_DELIVERED:2,MSG_DISPLAYED:3,MSG_ARCHIVED:4,RSM_ATTRIBUTES:["max","first","last","after","before","index","count"],MAM_ATTRIBUTES:["with","start","end"],GENERAL_GROUP_ID:1,NON_ROSTER_GROUP_ID:2,ACCOUNT_COLORS:["red","green","blue","deep-purple","orange","lime","pink","purple","indigo","light-blue","cyan","teal","light-green","amber","deep-orange","brown","blue-grey"],MAX_AVATAR_FILE_SIZE:2e7,AVATAR_PRIORITIES:{VCARD_AVATAR:0,PUBSUB_AVATAR:1},AVATAR_SIZES:{TOOLBAR_ACCOUNT_ITEM:32,SETTINGS_ACCOUNT_ITEM:32,XABBER_ACCOUNT:32,SYNCHRONIZE_ACCOUNT_ITEM:36,MENTION_ITEM:36,ACCOUNT_SETTINGS_LEFT:96,ACCOUNT_VCARD_EDIT:80,ROSTER_RIGHT_ACCOUNT_ITEM:38,ROSTER_LEFT_ACCOUNT_ITEM:40,PARTICIPANT_DETAILS_ITEM:48,CONTACT_RIGHT_ITEM:32,GROUPCHAT_MEMBER_ITEM:32,CONTACT_LEFT_ITEM:32,CONTACT_BLOCKED_ITEM:32,CONTACT_DETAILS:192,GROUP_SETTINGS:96,CHAT_ITEM:40,CHAT_HEAD:40,CHAT_MESSAGE:32,CHAT_BOTTOM:48,XABBER_VOICE_CALL_VIEW:128},SOUNDS:{beep_up:"sounds/beep_up.ogg",tiny_noize:"sounds/tiny_noize.ogg",retro_game:"sounds/retro_game.ogg",pixel_beep:"sounds/pixel_beep.ogg",beep_positive:"sounds/beep_positive.ogg",good_chime:"sounds/good_chime.ogg",cellular_click:"sounds/cellular_click.ogg",bleep:"sounds/bleep.ogg",mono_u:"sounds/mono_u.ogg",plop:"sounds/plop.ogg",ether:"sounds/ether.ogg",pop:"sounds/pop.ogg",computer_chime:"sounds/computer_chime.ogg",beep_a:"sounds/beep_a.ogg",call:"sounds/marching-band-dave-girtsman.mp3",connecting:"sounds/alien-bomb-timer.wav",busy:"sounds/phone_busy.wav"},SYNC_WAY_DATA:{no:{tip:"Settings are already synchronized",icon:"mdi-cloud-check"},from_server:{tip:"Settings will be downloaded from the cloud",icon:"mdi-cloud-download"},to_server:{tip:"Local settings will be uploaded to cloud",icon:"mdi-cloud-upload"},delete:{tip:"Local account will be deleted",icon:"mdi-delete"},off_local:{tip:"Local account",icon:"mdi-cloud-outline-off"},off_remote:{tip:"Remote account",icon:"mdi-cloud-outline-off"}},SYNCED_STATUS_DATA:{off:{tip:"Synchronization disabled",icon:"mdi-cloud-outline-off"},yes:{tip:"Settings are synchronized",icon:"mdi-cloud-check"},no:{tip:"Settings are not synchronized with cloud",icon:"mdi-cloud"}},QUOTE_MARKER:"&gt;",MIME_TYPES:{image:["image/gif","image/jpeg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/vnd.microsoft.icon","image/vnd.wap.wbmp","image/webp"],audio:["audio/basic","audio/L24","audio/mp4","audio/aac","audio/mpeg","audio/ogg","audio/ogg; codecs=opus","audio/vorbis","audio/x-ms-wma","audio/x-ms-wax","audio/vnd.rn-realaudio","audio/vnd.wave","audio/webm","audio/x-wav"],video:["video/mpeg","video/mp4","video/ogg","video/quicktime","video/webm","video/x-ms-wmv","video/x-flv","video/3gpp","video/3gpp2"],document:["text/cmd","text/css","text/csv","text/html","text/javascript (Obsolete)","text/plain","text/php","text/xml","text/markdown","text/cache-manifestapplication/json","application/xml","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.graphics","application/msword"],pdf:["application/pdf"],table:["application/vnd.oasis.opendocument.spreadsheet","application/vnd.ms-excel"],archive:["application/zip","application/gzip","application/x-rar-compressed","application/x-tar","application/x-7z-compressed"],presentation:["application/vnd.ms-powerpoint","application/vnd.oasis.opendocument.presentation"]},PARTICIPANT_ROLES:["Member","Admin","Owner"],XABBER_ACCOUNT_URL:"https://www.xabber.com/account",API_SERVICE_URL:"https://api.xabber.com/api/v2",USE_SOCIAL_AUTH:!0,CHECK_VERSION:!0,DEFAULT_LOGIN_SCREEN:"xmpp",GCM_SENDER_ID:"868637702480",GCM_API_KEY:"AIzaSyC1JCBB3LLf_4DG_vRWMEEe0I4X5msEU-M",MESSAGE_ARCHIVE_DB_NAME:"MessageArchive"};constants.JINGLE_MSG_STATE={},constants.JINGLE_MSG_STATE[constants.JINGLE_MSG_RETRACT]="retract",constants.JINGLE_MSG_STATE[constants.JINGLE_MSG_REJECT]="reject",constants.JINGLE_MSG_STATE[constants.JINGLE_MSG_PROPOSE]="propose",constants.JINGLE_MSG_STATE[constants.JINGLE_MSG_ACCEPT]="accept",constants.JINGLE_MSG_VERBOSE_STATE={},constants.JINGLE_MSG_VERBOSE_STATE[constants.JINGLE_MSG_RETRACT]="retract",constants.JINGLE_MSG_VERBOSE_STATE[constants.JINGLE_MSG_PROPOSE]="Calling...",constants.MSG_STATE={},constants.MSG_STATE[constants.MSG_ERROR]="error",constants.MSG_STATE[constants.MSG_PENDING]="pending",constants.MSG_STATE[constants.MSG_SENT]="sent",constants.MSG_STATE[constants.MSG_DELIVERED]="delivered",constants.MSG_STATE[constants.MSG_DISPLAYED]="displayed",constants.MSG_STATE[constants.MSG_ARCHIVED]="archived",constants.MSG_VERBOSE_STATE={},constants.MSG_VERBOSE_STATE[constants.MSG_ERROR]="Message error",constants.MSG_VERBOSE_STATE[constants.MSG_PENDING]="Message not sent",constants.MSG_VERBOSE_STATE[constants.MSG_SENT]="Message sent",constants.MSG_VERBOSE_STATE[constants.MSG_DELIVERED]="Message delivered to user",constants.MSG_VERBOSE_STATE[constants.MSG_DISPLAYED]="Message read",constants.MSG_VERBOSE_STATE[constants.MSG_ARCHIVED]="Message from archive","function"==typeof define&&define("xabber-constants",[],function(){return constants});/**
 * @license text 2.0.15 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/text/LICENSE
 */define("text",["module"],function(e){'use strict';function t(e,t){return void 0===e||""===e?t:e}function a(e,a,i,n){if(a===n)return!0;if(e===i){if("http"===e)return t(a,"80")===t(n,"80");if("https"===e)return t(a,"443")===t(n,"443")}return!1}var n=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,r=d&&location.protocol&&location.protocol.replace(/\:/,""),c=d&&location.hostname,l=d&&(location.port||void 0),p={},u=e.config&&e.config()||{},m,g,i,h,v;return m={version:"2.0.15",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:u.createXhr||function(){var e,t,a;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){a=n[t];try{e=new ActiveXObject(a)}catch(t){}if(e){n=[a];break}}return e},parseName:function(e){var t=!1,a=e.lastIndexOf("."),i=0===e.indexOf("./")||0===e.indexOf("../"),n,s,o;return-1!==a&&(!i||1<a)?(n=e.substring(0,a),s=e.substring(a+1)):n=e,o=s||n,a=o.indexOf("!"),-1!==a&&(t="strip"===o.substring(a+1),o=o.substring(0,a),s?s=o:n=o),{moduleName:n,ext:s,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,i,n){var s=m.xdRegExp.exec(e),o,d,r;return!s||(o=s[2],d=s[3],d=d.split(":"),r=d[1],d=d[0],(!o||o===t)&&(!d||d.toLowerCase()===i.toLowerCase())&&(!r&&!d||a(o,r,t,n)))},finishLoad:function(e,t,a,i){a=t?m.strip(a):a,u.isBuild&&(p[e]=a),i(a)},load:function(e,t,a,i){if(i&&i.isBuild&&!i.inlineText)return void a();u.isBuild=i&&i.isBuild;var n=m.parseName(e),s=n.moduleName+(n.ext?"."+n.ext:""),o=t.toUrl(s),p=u.useXhr||m.useXhr;return 0===o.indexOf("empty:")?void a():void(!d||p(o,r,c,l)?m.get(o,function(t){m.finishLoad(e,n.strip,t,a)},function(e){a.error&&a.error(e)}):t([s],function(e){m.finishLoad(n.moduleName+"."+n.ext,n.strip,e,a)}))},write:function(e,t,a){if(p.hasOwnProperty(t)){var i=m.jsEscape(p[t]);a.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,a,i,n){var s=m.parseName(t),o=s.ext?"."+s.ext:"",d=s.moduleName+o,r=a.toUrl(s.moduleName+o)+".js";m.load(d,a,function(){var t=function(e){return i(r,e)};t.asModule=function(e,t){return i.asModule(e,r,t)},m.write(e,d,t,n)},n)}},"node"!==u.env&&(u.env||"undefined"==typeof process||!process.versions||!process.versions.node||process.versions["node-webkit"]||process.versions["atom-shell"])?"xhr"===u.env||!u.env&&m.createXhr()?m.get=function(e,t,a,i){var n=m.createXhr(),s;if(n.open("GET",e,!0),i)for(s in i)i.hasOwnProperty(s)&&n.setRequestHeader(s.toLowerCase(),i[s]);u.onXhr&&u.onXhr(n,e),n.onreadystatechange=function(){var i,s;4===n.readyState&&(i=n.status||0,399<i&&600>i?(s=new Error(e+" HTTP status: "+i),s.xhr=n,a&&a(s)):t(n.responseText),u.onXhrComplete&&u.onXhrComplete(n,e))},n.send(null)}:"rhino"!==u.env&&(u.env||"undefined"==typeof Packages||"undefined"==typeof java)?("xpconnect"===u.env||!u.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,h=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),v="@mozilla.org/windows-registry-key;1"in i,m.get=function(e,t){var a={},n,s,o;v&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(h.nsIFileInputStream),n.init(o,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(h.nsIConverterInputStream),s.init(n,"utf-8",n.available(),h.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),a),s.close(),n.close(),t(a.value)}catch(t){throw new Error((o&&o.path||"")+": "+t)}}):m.get=function(e,t){var a=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),"utf-8")),s="",o,d;try{for(o=new java.lang.StringBuffer,d=n.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&o.append(d);null!==(d=n.readLine());)o.append(i),o.append(d);s=o.toString()+""}finally{n.close()}t(s)}:(g=require.nodeRequire("fs"),m.get=function(e,t,a){try{var i=g.readFileSync(e,"utf8");"\uFEFF"===i[0]&&(i=i.substring(1)),t(i)}catch(t){a&&a(t)}}),m}),define("text!templates/base/dialog.html",[],function(){return"<div class=\"modal dialog-modal\">\n    <div class=\"modal-header\">\n        <div class=\"panel-header black-text\">{{header}}</div>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"dialog-text\">{{text}}</div>\n        <div class=\"dialog-options-wrap\">\n        {[ for (var idx in dialog_options) { var option = dialog_options[idx]; ]}\n            <div class=\"dialog-option\" data-name=\"{{option.name}}\">\n                <input type=\"checkbox\" class=\"filled-in\" id=\"dialog_option_{{option.name}}\" {[ if (option.checked) { ]}checked=\"checked\"{[ } ]}/>\n                <label for=\"dialog_option_{{option.name}}\">{{option.text}}</label>\n            </div>\n        {[ } ]}\n        </div>\n        <div class=\"container-for-img hidden\"><img class=\"img-from-clipboard\"></div>\n    </div>\n    <div class=\"modal-footer\">\n        {[ if (ok_button) { ]}\n        <button class=\"ok-button btn-flat btn-main\" data-option=true>{{ok_button.text}}</button>\n        {[ } ]}\n        {[ if (cancel_button) { ]}\n        <button class=\"cancel-button btn-flat btn-main btn-dark btn-cancel\" data-option=false>{{cancel_button.text}}</button>\n        {[ } ]}\n        {[ for (var idx in optional_buttons) { var button = optional_buttons[idx]; ]}\n        <button class=\"optional-button btn-flat btn-main btn-dark\" data-option=\"{{button.value}}\">{{button.name}}</button>\n        {[ } ]}\n    </div>\n</div>\n"}),define("text!templates/base/jingle_message_calling.html",[],function(){return"<i class=\"mdi mdi-phone btn-collapse\"></i>\n<div class=\"call-header\">\n    Xabber voice call\n    <div class=\"calling-status\"/>\n</div>\n<div class=\"contact-info\">\n    <div class=\"name one-line\"/>\n    <div class=\"calling-status\"/>\n</div>\n<div class=\"video-wrap\">\n    <audio autoplay class=\"webrtc-remote-audio hidden\"/>\n    <video autoplay muted class=\"webrtc-local-video collapsed hidden\"/>\n    <div class=\"default-screen\">\n        <div class=\"circle-avatar\"/>\n        <div class=\"name one-line\"/>\n    </div>\n</div>\n<div class=\"buttons-panel\">\n    <div class=\"buttons-wrap\">\n        <svg class=\"btn-collapse mdi-24px\" viewBox=\"0 0 24 24\">\n            <path d=\"M19.5,3.09L15,7.59V4H13V11H20V9H16.41L20.91,4.5L19.5,3.09M4,13V15H7.59L3.09,19.5L4.5,20.91L9,16.41V20H11V13H4Z\"/>\n        </svg>\n        <svg class=\"btn-full-screen mdi-24px\" viewBox=\"0 0 24 24\">\n            <path d=\"M11,21H3V13H5V17.59L17.59,5H13V3H21V11H19V6.41L6.41,19H11V21Z\" />\n        </svg>\n        <i class=\"btn-volume mdi mdi-24px mdi-volume-high\"/>\n        <i class=\"btn-microphone mdi mdi-24px mdi-microphone\"/>\n        <i class=\"btn-video mdi mdi-24px mdi-video\"/>\n        <i class=\"btn-share-screen mdi mdi-24px mdi-monitor\"/>\n        <i class=\"btn-accept mdi mdi-24px mdi-phone\"/>\n        <i class=\"btn-cancel mdi mdi-24px mdi-phone-hangup\"/>\n    </div>\n</div>\n<div class=\"contact-info\"><div class=\"jid one-line\"/></div>\n"}),define("text!templates/base/input_widget.html",[],function(){return"<div class=\"input-widget-wrap {{field_name}}-wrap\">\n    <div class=\"{{field_name}} field-text one-line\"></div>\n    <div class=\"{{field_name}}-input-wrap\">\n        <input class=\"{{field_name}}-input field-input hidden\" type=\"{{field_type}}\" placeholder=\"{{placeholder}}\">\n    </div>\n</div>\n"}),define("text!templates/base/toolbar.html",[],function(){return"<div class=\"toolbar-item all-chats active\" title=\"All chats\">\n    <div class=\"border\"></div>\n    <img class=\"logo\" src=\"images/xabber-logo.png\">\n    <span class=\"all-msg-indicator\"></span>\n</div>\n\n<div class=\"toolbar-item chats\" title=\"Chats\">\n    <div class=\"border\"></div>\n    <i class=\"toolbar-icon mdi mdi-24px mdi-message-text\"></i>\n    <span class=\"msg-indicator\"></span>\n</div>\n\n<div class=\"toolbar-item group-chats\" title=\"Group chats\">\n    <div class=\"border\"></div>\n    <svg class=\"toolbar-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"message-group\"></svg>\n    <span class=\"group-msg-indicator\"></span>\n</div>\n\n<div class=\"toolbar-item mentions\" title=\"Mentions\">\n    <div class=\"border\"></div>\n    <svg class=\"toolbar-icon mdi mdi-24px mdi-svg-template\" viewBox=\"0 0 24 24\" data-svgname=\"ic-at\"></svg>\n    <span class=\"mentions-indicator\"></span>\n</div>\n\n<div class=\"toolbar-item archive-chats\" title=\"Archive chats\">\n    <div class=\"border\"></div>\n    <i class=\"toolbar-icon mdi mdi-24px mdi-archive\"></i>\n    <span class=\"archive-msg-indicator hidden\"></span>\n</div>\n\n<div class=\"toolbar-item contacts\" title=\"Contacts\">\n    <div class=\"border\"></div>\n    <i class=\"toolbar-icon mdi mdi-24px mdi-account-multiple\"></i>\n</div>\n\n<div class=\"toolbar-item search\" title=\"Search\">\n    <div class=\"border\"></div>\n    <svg class=\"toolbar-icon mdi mdi-24px mdi-svg-template\" viewBox=\"0 0 24 24\" data-svgname=\"ic-searching\"></svg>\n</div>\n\n<div class=\"add-something-wrap\">\n    <div class=\"toolbar-item dropdown-button add-something\" data-activates=\"{{view.cid}}-add\" title=\"Add group chat, contact or account\">\n        <i class=\"toolbar-icon mdi mdi-24px mdi-plus\"></i>\n    </div>\n\n    <div id=\"{{view.cid}}-add\" class=\"add-variants dropdown-content noselect\">\n        <div class=\"add-variant groupchat\">\n            <i class=\"mdi mdi-20px mdi-account-multiple-plus\"></i>\n            <span class=\"text\">Create group chat</span>\n        </div>\n        <div class=\"add-variant contact\">\n            <i class=\"mdi mdi-20px mdi-account-plus\"></i>\n            <span class=\"text\">Add contact</span>\n        </div>\n        <div class=\"add-variant account\">\n            <i class=\"mdi mdi-20px mdi-account-circle\"></i>\n            <span class=\"text\">Add account</span>\n        </div>\n    </div>\n</div>\n\n<div class=\"divider noselect\"></div>\n\n<div class=\"accounts-wrap\">\n    <div class=\"accounts\">\n    </div>\n</div>\n\n<div class=\"toolbar-bottom\">\n    <div class=\"toolbar-item about\" title=\"About\">\n        <div class=\"border\"></div>\n        <i class=\"toolbar-icon mdi mdi-24px mdi-information\"></i>\n    </div>\n    <div class=\"toolbar-item settings\" title=\"Settings\">\n        <div class=\"border\"></div>\n        <i class=\"toolbar-icon mdi mdi-24px mdi-settings\"></i>\n    </div>\n</div>\n"}),define("text!templates/base/settings.html",[],function(){return"    <div class=\"left-column noselect\">\n        <div class=\"main-info-wrap xabber-info-wrap\">\n            <div class=\"picture-wrap\">\n                <img class=\"logo\" src=\"images/xabber-logo-96.png\"/>\n            </div>\n            <div class=\"name\">Xabber for Web</div>\n            <div class=\"version\"></div>\n        </div>\n        <div class=\"settings-tabs-wrap\">\n            <div class=\"settings-tab xabber-account-tab offline\" data-block-name=\"xabber-account\">\n                <svg class=\"mdi mdi-24px mdi-svg-template xabber-offline-icon\" data-svgname=\"xabber-offline\"></svg>\n                <svg class=\"mdi mdi-24px mdi-svg-template xabber-online-icon\" data-svgname=\"xabber-online\"></svg>\n                <div class=\"settings-block-name one-line\">Xabber Account</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"xmpp-accounts\">\n                <i class=\"mdi mdi-24px mdi-settings\"/>\n                <div class=\"settings-block-name one-line\">XMPP Accounts</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"keyboard\">\n                <i class=\"mdi mdi-24px mdi-keyboard\"></i>\n                <div class=\"settings-block-name one-line\">Keyboard</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"contact-list\">\n                <i class=\"mdi mdi-24px mdi-account-multiple\"></i>\n                <div class=\"settings-block-name one-line\">Contact list</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"notifications\">\n                <i class=\"mdi mdi-24px mdi-bell\"></i>\n                <div class=\"settings-block-name one-line\">Notifications</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"sounds\">\n                <i class=\"mdi mdi-24px mdi-volume-high\"></i>\n                <div class=\"settings-block-name one-line\">Sounds</div>\n            </div>\n            {[if (xabber.env.constants.PERSONAL_AREA_URL) {]}\n            <a href=\"{{xabber.env.constants.PERSONAL_AREA_URL.url}}\" target=\"_blank\"><div class=\"link-button settings-tab\" data-block-name=\"{{xabber.env.constants.PERSONAL_AREA_URL.label}}\">\n                <i class=\"mdi mdi-24px mdi-{{xabber.env.constants.PERSONAL_AREA_URL.icon_name}}\"></i>\n                <div class=\"settings-block-name one-line\">{{xabber.env.constants.PERSONAL_AREA_URL.label}}</div>\n            </div>\n            </a>\n            {[}]}\n        </div>\n        <div class=\"settings-tabs-bottom-wrap\">\n            <div class=\"settings-tab delete-all-accounts\">\n                <i class=\"mdi mdi-24px mdi-logout-variant\"></i>\n                <div class=\"settings-block-name\">Quit Xabber Web</div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"right-column noselect\">\n        <div class=\"settings-panel-head\">\n            <span>Settings</span>\n        </div>\n\n        <div class=\"panel-content-wrap\">\n            <div class=\"panel-content\">\n                <div class=\"settings-block-wrap xabber-account\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Xabber account</span>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap xmpp-accounts\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">XMPP accounts</span>\n                    </div>\n                    <div class=\"setting xmpp-account-list\">\n                        <div class=\"accounts-head-wrap\">\n                            <div class=\"accounts-head xmppid-head\">XMPP ID</div>\n                            <div class=\"accounts-head sync-head\">Sync</div>\n                            <div class=\"accounts-head enabled-head\">Enabled</div>\n                        </div>\n                        <span class=\"no-accounts-tip\">No accounts</span>\n                        <div class=\"move-account-to-bottom droppable\"></div>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap keyboard\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Keyboard</span>\n                    </div>\n\n                    <div class=\"setting hotkeys radio-button field-wrap\">\n                        <div class=\"field radio-field clickable-field\">\n                            <form action=\"#\">\n                                <p>\n                                    <input class=\"with-gap\" name=\"hotkeys\" value=\"enter\" type=\"radio\" id=\"{{view.cid}}-enter\" />\n                                    <label for=\"{{view.cid}}-enter\">Send message on Enter</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"hotkeys\" value=\"ctrlenter\" type=\"radio\" id=\"{{view.cid}}-ctrlenter\" />\n                                    <label for=\"{{view.cid}}-ctrlenter\">Send message on Ctrl+Enter</label>\n                                </p>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap contact-list\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Contact list</span>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap notifications\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Notifications</span>\n                    </div>\n\n                    <div class=\"setting notifications field-wrap\">\n                        <div class=\"field clickable-field switch small\">\n                            <span class=\"field-name\">Desktop notifications</span>\n                            <label class=\"field-value\">\n                                <input type=\"checkbox\" name=\"notifications\">\n                                <span class=\"lever\"></span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"setting message-preview field-wrap\">\n                        <div class=\"field clickable-field switch small\">\n                            <span class=\"field-name\">Message preview</span>\n                            <label class=\"field-value\">\n                                <input type=\"checkbox\" name=\"message-preview\">\n                                <span class=\"lever\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap sounds\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Sounds</span>\n                    </div>\n                    <div class=\"setting sound radio-button field-wrap\">\n                        <div class=\"field radio-field clickable-field\">\n                            <form action=\"#\">\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"\" type=\"radio\" id=\"{{view.cid}}-sound-no\" />\n                                    <label for=\"{{view.cid}}-sound-no\">No sound</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"beep_up\" type=\"radio\" id=\"{{view.cid}}-sound-beep-up\" />\n                                    <label for=\"{{view.cid}}-sound-beep-up\">Beep Up</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"tiny_noize\" type=\"radio\" id=\"{{view.cid}}-sound-tiny-noize\" />\n                                    <label for=\"{{view.cid}}-sound-tiny-noize\">Tiny Noize</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"retro_game\" type=\"radio\" id=\"{{view.cid}}-sound-retro-game\" />\n                                    <label for=\"{{view.cid}}-sound-retro-game\">Retro Game</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"pixel_beep\" type=\"radio\" id=\"{{view.cid}}-sound-pixel-beep\" />\n                                    <label for=\"{{view.cid}}-sound-pixel-beep\">Pixel Beep</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"beep_positive\" type=\"radio\" id=\"{{view.cid}}-sound-beep-positive\" />\n                                    <label for=\"{{view.cid}}-sound-beep-positive\">Beep Positive</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"good_chime\" type=\"radio\" id=\"{{view.cid}}-sound-good-chime\" />\n                                    <label for=\"{{view.cid}}-sound-good-chime\">Good Chime</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"cellular_click\" type=\"radio\" id=\"{{view.cid}}-sound-cellular-click\" />\n                                    <label for=\"{{view.cid}}-sound-cellular-click\">Cellular Click</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"bleep\" type=\"radio\" id=\"{{view.cid}}-sound-bleep\" />\n                                    <label for=\"{{view.cid}}-sound-bleep\">Bleep</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"mono_u\" type=\"radio\" id=\"{{view.cid}}-sound-mono-u\" />\n                                    <label for=\"{{view.cid}}-sound-mono-u\">Mono U</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"plop\" type=\"radio\" id=\"{{view.cid}}-sound-plop\" />\n                                    <label for=\"{{view.cid}}-sound-plop\">Plop</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"ether\" type=\"radio\" id=\"{{view.cid}}-sound-ether\" />\n                                    <label for=\"{{view.cid}}-sound-ether\">Ether</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"pop\" type=\"radio\" id=\"{{view.cid}}-sound-pop\" />\n                                    <label for=\"{{view.cid}}-sound-pop\">Pop</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"computer_chime\" type=\"radio\" id=\"{{view.cid}}-sound-computer-chime\" />\n                                    <label for=\"{{view.cid}}-sound-computer-chime\">Computer Chime</label>\n                                </p>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/base/about.html",[],function(){return"    <div class=\"left-column noselect\">\n        <div class=\"main-info-wrap xabber-info-wrap\">\n            <div class=\"picture-wrap\">\n                <img class=\"logo\" src=\"images/xabber-logo-96.png\"/>\n            </div>\n            <div class=\"name\">Xabber for Web</div>\n            <div class=\"version\"></div>\n        </div>\n    </div>\n\n    <div class=\"right-column noselect\">\n        <div class=\"settings-panel-head\">\n            <span>About</span>\n        </div>\n\n        <div class=\"panel-content-wrap\">\n            <div class=\"panel-content\">\n                <div class=\"settings-block-wrap about\">\n                    <div class=\"block-content\">\n                        Xabber is an open source XMPP messenger for Android, iOS and Web platforms. It is build around open standards, interoperability, design and great user experience. Versions of Xabber for every platform are built to provide a continuous chat experience between them.\n                    </div>\n                    <div class=\"block-content\">\n                        You will find more information on our official website <a href=\"https://www.xabber.com\" target=\"_blank\">https://www.xabber.com</a>\n                    </div>\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">XMPP protocol</span>\n                    </div>\n                    <div class=\"block-content\">\n                        Extensible Messaging and Presence Protocol (XMPP) is a communications protocol for message-oriented middleware based on XML (Extensible Markup Language). It enables the near-real-time exchange of structured yet extensible data between any two or more network entities. The protocol was originally named Jabber, and was developed by the Jabber open-source community in 1999 for near real-time instant messaging (IM),presence information, and contact list maintenance.\n                    </div>\n\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">XMPP Extension Protocols</span>\n                    </div>\n                    <div class=\"block-content\">\n                        XMPP is highly extensible, via extensions known as XEPs (XMPP Extension Protocol). Xabber supports a number of popular XEPs that are essential to providing great chat experience for our users.\n                    </div>\n\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Developers</span>\n                    </div>\n                    <div class=\"block-content\">\n                        Xabber for Android was originally developed by <a href=\"http://redsolution.com\" target=\"_blank\">Redsolution</a> \u2014 an international software and services company currently based in Estonia. Since then, a number of individuals joined Xabber as developers, testers and translators.\n                    </div>\n                    <div class=\"block-content\">\n                        Our goal is to create a stable, reliable, interoperable and user friendly ecosystem for instant messaging that does not rely on proprietary services and data silos. We welcome anyone who believes in open standards and free information interchange to take part in moving Xabber forward.\n                    </div>\n                    <div class=\"block-content\">\n                        Follow us on Twitter and Github.\n                    </div>\n                    <div class=\"block-content flex-content\">\n                        <img class=\"logo\" src=\"images/redsolution-logo.png\"/>\n                        <a href=\"https://twitter.com/Xabber_XMPP\" target=\"_blank\"><div class=\"btn-social twitter-color\">\n                            <i class=\"mdi mdi-28px mdi-twitter\"></i>\n                        </div></a>\n                        <a href=\"https://github.com/redsolution/xabber-web\" target=\"_blank\"><img class=\"btn-social github-logo\" src=\"images/ic_github.png\"/></a>\n                    </div>\n\n\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Translators</span>\n                    </div>\n                    <div class=\"block-content\">\n                        Xabber is available in multiple languages thanks to many fine people from all over the world. We have created a special page on our website to acknowledge their efforts.\n                    </div>\n                    <div class=\"block-content\">\n                        You may join their ranks and help us improve translation quality by contributing your translations to <a href=\"https://crowdin.com/project/xabber\" target=\"_blank\">Xabber project</a>\n                    </div>\n\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">License</span>\n                    </div>\n                    <div class=\"block-content\">\n                        Xabber for Web source code is licensed under GNU AGPL v.3 license and is available on <a href=\"https://github.com/redsolution/xabber-web\" target=\"_blank\">GitHub</a>\n                    </div>\n                    <div class=\"block-content\">\n                        Graphical images are licensed under Creative Commons Attribution Share-Alike (CC BY-SA) license.\n                    </div>\n                    <div class=\"block-content\">\n                        Xabber & Redsolution logo are property of <a href=\"https://redsolution.com\" target=\"_blank\">Redsolution, O\xDC</a>\n                    </div>\n                    <div class=\"block-content\">\n                        View Xabber for Web <a href=\"https://github.com/redsolution/xabber-web/blob/master/LICENSE\" target=\"_blank\">license file</a> for more information.\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/api_service/xabber_login.html",[],function(){return"<div class=\"login-panel\">\n    <div class=\"login-panel-head noselect\">\n        <img src=\"images/xabber-logo.png\" class=\"client-logo\">\n        <span class=\"client-name\">Xabber</span>\n    </div>\n    <div class=\"login-panel-form xmpp-login-form noselect\">\n        <div class=\"btn-escape\">\n            <i class=\"mdi mdi-24px mdi-close\"></i>\n        </div>\n        <div class=\"login-form-header\">Email Login</div>\n        <div class=\"input-field email-name\">\n            <input id=\"username\" type=\"text\" name=\"username\">\n            <label for=\"username\">Email</label>\n            <span class=\"errors fixed one-line\"></span>\n        </div>\n        <div class=\"input-field\">\n            <input id=\"password\" type=\"password\" name=\"password\">\n            <label for=\"password\">Password</label>\n            <span class=\"errors fixed one-line\"></span>\n        </div>\n        <div class=\"input-field buttons-wrap\">\n            <a href=\"{{XABBER_ACCOUNT_URL}}/auth/forgot-password/\" target=\"_blank\" class=\"btn-flat btn-main btn-forgot-password\">Forgot password?</a>\n            <button class=\"btn btn-flat btn-main-filled btn-log-in\">Log In</button>\n        </div>\n        <div class=\"social-auth-wrap\"><div class=\"social-header\">\n            <div class=\"divider\"></div>\n            <div class=\"social-header-tip\">New Account</div>\n        </div></div>\n        <div class=\"registration-footer\">\n            <div class=\"registration-tip-wrap\">\n                <span class=\"registration-tip\">No XMPP account?</span>\n                <a href=\"{{XABBER_ACCOUNT_URL}}/auth/signup/?source=Xabber Web\" target=\"_blank\" class=\"btn-flat btn-main btn-registration\">Registration</a>\n            </div>\n        </div>\n        <div class=\"clearfix\"></div>\n    </div>\n    <div class=\"login-panel-footer\">\n        <div class=\"footer-text clearfix\">Connection to XMPP server is done via auxiliary websocket server maintained by <a class=\"redsolution-src\" href=\"http://www.redsolution.com\" target=\"_blank\"><span class=\"red-part\">red</span>solution</a>. Theoretically we can intercept your XMPP passwords, however, we don\u2019t do that. This won\u2019t be a problem when more servers will support OAuth2 authentication and allow token-based connectivity.</div>\n    </div>\n</div>\n"}),define("text!templates/api_service/xabber_login_by_email.html",[],function(){return"<div class=\"login-panel-form xmpp-login-form noselect\">\n    <div class=\"login-form-header\">Email Login</div>\n    <div class=\"input-field email-name\">\n        <input id=\"username\" type=\"text\" name=\"username\">\n        <label for=\"username\">Email</label>\n        <span class=\"errors fixed one-line\"></span>\n    </div>\n    <div class=\"input-field\">\n        <input id=\"password\" type=\"password\" name=\"password\">\n        <label for=\"password\">Password</label>\n        <span class=\"errors fixed one-line\"></span>\n    </div>\n    <div class=\"login-panel-footer buttons-wrap\"><button class=\"btn btn-flat btn-main-filled btn-log-in\">Log In</button><button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button></div>\n</div>"}),define("text!templates/api_service/xabber_account.html",[],function(){return"<div class=\"xabber-account-content-wrap\">\n    <div class=\"account-info-wrap\">\n        <div class=\"circle-avatar noselect\">\n            <img>\n        </div>\n        <div class=\"text-info-wrap\">\n            <div class=\"name-wrap\">\n                <div class=\"name text-color-red-700 one-line\"></div>\n            </div>\n            <div class=\"last-sync-info\"></div>\n        </div>\n    </div>\n    <div class=\"sync-wrap\">\n        <div class=\"btn-sync\">\n            <div class=\"preloader-wrapper preloader-20px active\">\n                <div class=\"spinner-layer\">\n                    <div class=\"circle-clipper left\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"gap-patch\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"circle-clipper right\">\n                        <div class=\"circle\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class=\"buttons-wrap\">\n        <button class=\"btn-flat btn-main btn-login\">Log in</button>\n        <div class=\"chat-tool btn-more dropdown-button\" data-activates=\"account-action-more\">\n            <i class=\"mdi mdi-20px mdi-dots-vertical\"></i>\n        </div>\n        <ul id=\"account-action-more\" class=\"xabber-account-menu dropdown-content noselect\">\n            <li class=\"btn-sync btn-sync-settings\">\n                <span class=\"one-line\">Synchronize</span>\n            </li>\n            <li class=\"btn-set-password\">\n                <span class=\"one-line\">Set password</span>\n            </li>\n            <li class=\"btn-logout\">\n                <span class=\"one-line\">Quit</span>\n            </li>\n        </ul>\n    </div>\n</div>\n<div class=\"xabber-account-tip\">Xabber account lets you easily sync your settings and connected XMPP accounts between various devices.</div>\n<div class=\"linked-social-accounts-and-emails\">\n    <div class=\"social-linked-header\"><div class=\"chevron-icon\"><i class=\"arrow mdi mdi-20px\"></i></div><div class=\"social-linked-header-text\">Linked social accounts and emails</div></div>\n    <div class=\"social-linked-wrap\">\n        <div id='google' class=\"not-linked social-account social-linked-item-wrap google-linked\"><div class=\"google-color social-icon\"><i class=\"mdi mdi-24px mdi-google-plus\"></i></div><div class=\"synced-info\">Not linked</div><div class=\"btn-main btn-flat btn-link\">link</div></div>\n        <div id='facebook' class=\"not-linked social-account social-linked-item-wrap facebook-linked\"><div class=\"facebook-color social-icon\"><i class=\"mdi mdi-24px mdi-facebook\"></i></div><div class=\"synced-info\">Not linked</div><div class=\"btn-main btn-flat btn-link\">link</div></div>\n        <div id='twitter' class=\"not-linked social-account social-linked-item-wrap twitter-linked\"><div class=\"twitter-color social-icon\"><i class=\"mdi mdi-24px mdi-twitter\"></i></div><div class=\"synced-info\">Not linked</div><div class=\"btn-main btn-flat btn-link\">link</div></div>\n        <div id='email' class=\"not-linked social-linked-item-wrap\"><div class=\"email-color social-icon\"><svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n            <path fill=\"#FFF\" d=\"M3,4C1.89,4 1,4.89 1,6V18A2,2 0 0,0 3,20H14.09C14.03,19.67 14,19.34 14,19A6,6 0 0,1 20,13C20.34,13 20.67,13.03 21,13.09V6C21,4.89 20.1,4 19,4H3M3,6L11,11L19,6V8L11,13L3,8V6M19,15V18H16V20H19V23H21V20H24V18H21V15H19Z\" />\n        </svg></div><div class=\"synced-info\">Link email account</div><div class=\"btn-main btn-flat btn-link\">link</div></div>\n    </div>\n    <span class=\"errors\"></span>\n</div>"}),define("text!templates/api_service/linked_email_item.html",[],function(){return"<div data-id=\"{{email_id}}\" data-email=\"{{email}}\" class=\"{[if (!verified){]}not-linked {[}]}social-linked-item-wrap email-linked\"><div style=\"background-color:{{color}}\" class=\"social-icon\">{[if (verified){]}<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n    <path fill=\"#FFF\" d=\"M21,13.34C20.37,13.12 19.7,13 19,13A6,6 0 0,0 13,19C13,19.34 13.03,19.67 13.08,20H3A2,2 0 0,1 1,18V6C1,4.89 1.89,4 3,4H19A2,2 0 0,1 21,6V13.34M23.5,17L18.5,22L15,18.5L16.5,17L18.5,19L22,15.5L23.5,17M3,6V8L11,13L19,8V6L11,11L3,6Z\" />\n</svg>{[} else {]}<i class=\"mdi mdi-24px mdi-email\"></i>{[}]}</div><div class=\"synced-info\"><div class=\"name one-line\">{{email}}</div><div class=\"verified-status one-line\">{{verified_status}} email address</div></div>{[if (!verified){]}<div class=\"btn-main btn-flat btn-verify-email\">verify</div>{[}]}<div class=\"btn-main btn-flat btn-link btn-unlink\">unlink</div></div>"}),define("text!templates/api_service/add_xabber_account.html",[],function(){return"<div class=\"modal main-modal add-xabber-account-modal\">\n\n<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Xabber Login</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row account-field\">\n            <div class=\"multiple-acc\">\n                <div class=\"account-dropdown-wrap\">\n                    <div class=\"dropdown-button\" data-activates=\"select-account-for-add-contact\">\n                        <div class=\"account-item-wrap\">\n                        </div>\n                        <div class=\"caret\">\n                            <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                        </div>\n                    </div>\n                    <div id=\"select-account-for-add-contact\" class=\"dropdown-content noselect\">\n                    </div>\n                </div>\n            </div>\n            <div class=\"single-acc\">\n                <div class=\"dropdown-button\">\n                    <div class=\"account-item-wrap\">\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"row social-auth-wrap\">\n            <div class=\"social-header\">\n                <div class=\"divider\"></div>\n                <div class=\"social-header-tip\">Social Sign In</div>\n            </div>\n            <div class=\"social-buttons\">\n                <div class=\"btn-social google-color\" data-provider=\"google\">\n                    <i class=\"mdi mdi-28px mdi-google-plus\"></i>\n                </div>\n                <div class=\"btn-social facebook-color\" data-provider=\"facebook\">\n                    <i class=\"mdi mdi-28px mdi-facebook\"></i>\n                </div>\n                <div class=\"btn-social twitter-color\" data-provider=\"twitter\">\n                    <i class=\"mdi mdi-28px mdi-twitter\"></i>\n                </div>\n                <div class=\"btn-social xabber-color\" data-provider=\"email\">\n                    <i class=\"mdi mdi-28px mdi-at\"></i>\n                </div>\n            </div>\n        </div>\n\n    </div>\n    <div class=\"modal-footer\">\n        <!--<button class=\"btn-flat btn-main btn-add\">Log in</button>-->\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n\n</div>\n\n    <div class=\"login-panel-footer\">\n        <div class=\"registration-footer\">\n            <div class=\"registration-tip-wrap\">\n                <span class=\"registration-tip\">No Xabber account?</span>\n                <a href=\"{{XABBER_ACCOUNT_URL}}/auth/signup/\" target=\"_blank\" class=\"btn-flat btn-main btn-registration\">Registration</a>\n            </div>\n        </div>\n        <div class=\"footer-text clearfix\">Xabber account lets you easily sync your settings and connected XMPP accounts between various devices. Visit Xabber.com for more details.</div>\n    </div>\n"}),define("text!templates/api_service/sync_settings.html",[],function(){return"<div class=\"modal-content-wrap settings-panel\">\n    <div class=\"modal-header\">\n        <span>Synchronization</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row\">\n            <div class=\"setting sync-all-wrap field-wrap\">\n                <div class=\"field clickable-field switch normal\">\n                    <span class=\"field-name\">Synchronize all</span>\n                    <label class=\"field-value\">\n                       <input type=\"checkbox\" class=\"sync-all\">\n                       <span class=\"lever\"></span>\n                    </label>\n                </div>\n            </div>\n            <div class=\"accounts-wrap\">\n            </div>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-sync\">Synchronize</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/api_service/sync_settings_account_item.html",[],function(){return"<div class=\"account-wrap\" data-jid=\"{{jid}}\">\n    <div class=\"account-info-wrap\">\n        <i class=\"sync-icon mdi mdi-24px\" data-mdiclass=\"\"></i>\n        <div class=\"text-info-wrap\">\n            <div class=\"name text-color-grey-900 one-line\">{{jid}}</div>\n            <div class=\"sync-tip text-color-grey-500 one-line\"></div>\n        </div>\n    </div>\n    <div class=\"input-field checkbox-field sync-one-wrap no-padding\">\n        <input type=\"checkbox\" class=\"filled-in sync-one\" id=\"{{view.cid}}_sync_{{jid}}\"/>\n        <label for=\"{{view.cid}}_sync_{{jid}}\"></label>\n    </div>\n</div>\n"}),define("text!templates/accounts/xmpp_login.html",[],function(){return"    <div class=\"login-panel-head noselect\">\n        <img src=\"images/xabber-logo.png\" class=\"client-logo\">\n        <span class=\"client-name\">Xabber</span>\n    </div>\n    <div class=\"login-panel-form xmpp-login-form noselect\">\n        <div class=\"input-field\">\n            <input id=\"jid\" type=\"text\" name=\"jid\">\n            <label for=\"jid\">XMPP ID</label>\n            <span class=\"errors fixed one-line\"></span>\n        </div>\n        <div class=\"input-field\">\n            <input id=\"password\" type=\"password\" name=\"password\">\n            <label for=\"password\">Password</label>\n            <span class=\"errors fixed one-line\"></span>\n        </div>\n        <div class=\"input-field buttons-wrap\">\n            <a href=\"{{XABBER_ACCOUNT_URL}}/auth/signup/\" target=\"_blank\" class=\"btn-flat btn-main btn-forgot-password\">Register an XMPP account</a>\n            <button class=\"btn btn-flat btn-main-filled btn-log-in\">Log In</button>\n        </div>\n        <div class=\"clearfix\"></div>\n        <div class=\"social-auth-wrap\">\n            <div class=\"social-header\">\n                <div class=\"divider\"></div>\n                <div class=\"social-header-tip\">Social Login</div>\n            </div>\n            <div class=\"social-buttons\">\n                <div class=\"btn-social google-color\" data-provider=\"google\">\n                    <i class=\"mdi mdi-28px mdi-google-plus\"></i>\n                </div>\n                <div class=\"btn-social facebook-color\" data-provider=\"facebook\">\n                    <i class=\"mdi mdi-28px mdi-facebook\"></i>\n                </div>\n                <div class=\"btn-social twitter-color\" data-provider=\"twitter\">\n                    <i class=\"mdi mdi-28px mdi-twitter\"></i>\n                </div>\n                <div class=\"btn-social xabber-color\" data-provider=\"email\">\n                    <i class=\"mdi mdi-28px mdi-at\"></i>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class=\"login-panel-footer\">\n        <div class=\"footer-text\">Connection to XMPP server is done via auxiliary websocket server maintained by <a class=\"redsolution-src\" href=\"http://www.redsolution.com\" target=\"_blank\"><span class=\"red-part\">red</span>solution</a>. Theoretically we can intercept your XMPP passwords, however, we don\u2019t do that. This won\u2019t be a problem when more servers will support OAuth2 authentication and allow token-based connectivity.</div>\n    </div>\n"}),define("text!templates/accounts/add_account.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Add new account</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row login-form-field\">\n            <div class=\"input-field\">\n                <input id=\"jid\" type=\"text\" name=\"jid\">\n                <label for=\"jid\">Username</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n            <div class=\"input-field\">\n                <input id=\"password\" type=\"password\" name=\"password\">\n                <label for=\"password\">Password</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n        </div>\n        <div class=\"sync-option\">\n            <input type=\"checkbox\" class=\"filled-in\" id=\"{{view.cid}}_sync_acc\"/>\n            <label for=\"{{view.cid}}_sync_acc\">Synchronize with Xabber account</label>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-add\">Add</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/accounts/change_password.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Set password</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row login-form-field\">\n            <div class=\"input-field\">\n                <input id=\"jid\" type=\"text\" name=\"jid\" readonly>\n                <label for=\"jid\">Username</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n            <div class=\"input-field\">\n                <input id=\"password\" type=\"password\" name=\"password\">\n                <label for=\"password\">Password</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-change\">Set</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/accounts/toolbar_item.html",[],function(){return"<div class=\"border\"></div>\n<div class=\"dropdown-button circle-avatar border-color ground-color-700 noselect\">\n    <img>\n</div>\n<div class=\"status\"></div>\n<i class=\"auth-failed mdi mdi-16px mdi-close\"></i>\n<div class=\"account-actions-panel\">\n    <div class=\"filter-chats\">\n        <i class=\"mdi mdi-filter mdi-20px\"></i>\n        <div class=\"text\">Filter chats</div>\n    </div>\n</div>"}),define("text!templates/accounts/settings_left.html",[],function(){return"    <div class=\"left-column ground-color-900 noselect\">\n        <div class=\"main-info-wrap account-main-info-wrap\">\n            <!--<i title=\"Back to settings\" class=\"mdi mdi-arrow-left mdi-28px back-to-settings\"></i>-->\n            <div class=\"picture-wrap\">\n                <div class=\"avatar-wrap\">\n                    <div class=\"circle-avatar\">\n                        <img/>\n                        <input type=\"file\"/>\n                        <svg class=\"set-groupchat-avatar\" viewBox=\"0 0 24 24\">\n                            <path d=\"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z\" />\n                        </svg>\n                        <div class=\"preloader-wrap\"><div class=\"preloader-wrapper preloader-32px visible\">\n                            <div class=\"spinner-layer\">\n                                <div class=\"circle-clipper left\">\n                                    <div class=\"circle\"></div>\n                                </div>\n                                <div class=\"gap-patch\">\n                                    <div class=\"circle\"></div>\n                                </div>\n                                <div class=\"circle-clipper right\">\n                                    <div class=\"circle\"></div>\n                                </div>\n                            </div>\n                        </div>\n                        </div>\n                    </div>\n                    <div class=\"status\"></div>\n                </div>\n            </div>\n            <div class=\"name-wrap\">\n                <div class=\"name\"></div>\n            </div>\n            <div class=\"status-wrap\"></div>\n        </div>\n        <div class=\"settings-tabs-wrap\">\n            <div class=\"settings-tab\" data-block-name=\"connection\">\n                <i class=\"mdi mdi-24px mdi-settings\"></i>\n                <div class=\"settings-block-name one-line\">Connection settings</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"tokens\">\n                <i class=\"mdi mdi-24px mdi-key\"></i>\n                <div class=\"settings-block-name one-line\">Active sessions</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"synchronization\">\n                <i class=\"mdi mdi-24px mdi-sync\"></i>\n                <div class=\"settings-block-name one-line\">Synchronization</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"color-scheme\">\n                <i class=\"mdi mdi-24px mdi-palette\"></i>\n                <div class=\"settings-block-name one-line\">Color scheme</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"xmpp-resources\">\n                <svg class=\"mdi mdi-24px mdi-svg-template\" data-svgname=\"ic-jabber\"></svg>\n                <div class=\"settings-block-name one-line\">XMPP Resources</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"vcard\">\n                <i class=\"mdi mdi-24px mdi-account-card-details\"></i>\n                <div class=\"settings-block-name one-line\">vCard</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"server-info\">\n                <i class=\"mdi mdi-24px mdi-information\"></i>\n                <div class=\"settings-block-name one-line\">Server information</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"blocklist-info\">\n                <i class=\"mdi mdi-24px mdi-block-helper\"></i>\n                <div class=\"settings-block-name one-line\">Blocked contacts</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"groups-info\">\n                <i class=\"mdi mdi-24px mdi-account-multiple\"></i>\n                <div class=\"settings-block-name one-line\">Groups</div>\n            </div>\n        </div>\n        <div class=\"settings-tabs-bottom-wrap ground-color-900\">\n            <div class=\"settings-tab delete-account\">\n                <i class=\"mdi mdi-24px mdi-logout-variant\"></i>\n                <div class=\"settings-block-name\">Quit account</div>\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/accounts/settings_right.html",[],function(){return"<div class=\"right-column noselect\">\n    <div class=\"settings-panel-head\">\n        <span>Account settings</span>\n        <div class=\"field enabled-state switch normal\">\n            <label class=\"field-value\">\n                <input type=\"checkbox\">\n                <span class=\"lever\"></span>\n            </label>\n        </div>\n    </div>\n\n    <div class=\"panel-content-wrap\">\n        <div class=\"panel-content details-panel\">\n\n            <div class=\"settings-block-wrap connection\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Connection settings</span>\n                </div>\n                <div class=\"connection-wrap\">\n                    <div class=\"readonly-setting\">\n                        <i class=\"details-icon mdi mdi-24px mdi-account\"></i>\n                        <div class=\"setting-wrap account-name\">\n                            <div class=\"value one-line\"></div>\n                            <div class=\"label conn-status\"></div>\n                        </div>\n                    </div>\n                    <div class=\"buttons-wrap\">\n                        <button class=\"btn-change-password btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300\">Set password</button>\n                        <button class=\"btn-reconnect btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300\">Reconnect</button>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap tokens\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Active sessions</span>\n                </div>\n                <div class=\"tokens-wrap\">\n                    <div class=\"current-token-wrap\">\n                        <div class=\"sessions-wrap current-session selectable-text\"></div>\n                        <div class=\"buttons-wrap\">\n                            <p class=\"btn-revoke-all-tokens hover-text-color-500 text-color-700\">Terminate all others sessions</p>\n                        </div>\n                    </div>\n                    <div class=\"all-sessions-wrap\">\n                        <div class=\"sessions-wrap all-sessions selectable-text\"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap synchronization\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Synchronization</span>\n                </div>\n                <div class=\"synchronization-wrap\">\n                    <div class=\"readonly-setting\">\n                        <i class=\"details-icon sync-status-icon mdi mdi-24px\" data-mdiclass=\"\"></i>\n                        <div class=\"setting-wrap account-name\">\n                            <div class=\"value one-line\"></div>\n                            <div class=\"label sync-status\"></div>\n                        </div>\n                    </div>\n                    <div class=\"xabber-account-features-wrap\">\n                        <div class=\"sync-enable-wrap\">\n                            <input type=\"checkbox\" class=\"filled-in sync-account\" id=\"{{view.cid}}_sync_account\"/>\n                            <label for=\"{{view.cid}}_sync_account\">Enable synchronization</label>\n                        </div>\n                        <div class=\"buttons-wrap\">\n                            <button class=\"btn-delete-settings btn-flat btn-main btn-dark ground-color-grey-100 hover-ground-color-grey-300\">Delete settings</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap color-scheme\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Color scheme</span>\n                </div>\n                <div class=\"color-scheme-wrap\">\n                    <div class=\"account-color\">\n                        <div class=\"current-color-name text-color-700\"></div>\n                        <div class=\"dropdown-button\" data-activates=\"select-color-{{view.cid}}\">\n                            <i class=\"mdi mdi-24px mdi-menu-down\"></i>\n                        </div>\n                        <ul id=\"select-color-{{view.cid}}\" class=\"color-values dropdown-content noselect\">\n                            <li class=\"color-value\" data-value=\"red\">\n                                <div class=\"color-name text-color-red-700\">red</div>\n                                <div class=\"color-pattern ground-color-red-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"pink\">\n                                <div class=\"color-name text-color-pink-700\">pink</div>\n                                <div class=\"color-pattern ground-color-pink-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"purple\">\n                                <div class=\"color-name text-color-purple-700\">purple</div>\n                                <div class=\"color-pattern ground-color-purple-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"deep-purple\">\n                                <div class=\"color-name text-color-deep-purple-700\">deep purple</div>\n                                <div class=\"color-pattern ground-color-deep-purple-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"indigo\">\n                                <div class=\"color-name text-color-indigo-700\">indigo</div>\n                                <div class=\"color-pattern ground-color-indigo-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"blue\">\n                                <div class=\"color-name text-color-blue-700\">blue</div>\n                                <div class=\"color-pattern ground-color-blue-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"light-blue\">\n                                <div class=\"color-name text-color-light-blue-700\">light blue</div>\n                                <div class=\"color-pattern ground-color-light-blue-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"cyan\">\n                                <div class=\"color-name text-color-cyan-700\">cyan</div>\n                                <div class=\"color-pattern ground-color-cyan-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"teal\">\n                                <div class=\"color-name text-color-teal-700\">teal</div>\n                                <div class=\"color-pattern ground-color-teal-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"green\">\n                                <div class=\"color-name text-color-green-700\">green</div>\n                                <div class=\"color-pattern ground-color-green-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"light-green\">\n                                <div class=\"color-name text-color-light-green-700\">light green</div>\n                                <div class=\"color-pattern ground-color-light-green-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"lime\">\n                                <div class=\"color-name text-color-lime-700\">lime</div>\n                                <div class=\"color-pattern ground-color-lime-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"amber\">\n                                <div class=\"color-name text-color-amber-700\">amber</div>\n                                <div class=\"color-pattern ground-color-amber-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"orange\">\n                                <div class=\"color-name text-color-orange-700\">orange</div>\n                                <div class=\"color-pattern ground-color-orange-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"deep-orange\">\n                                <div class=\"color-name text-color-deep-orange-700\">deep orange</div>\n                                <div class=\"color-pattern ground-color-deep-orange-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"brown\">\n                                <div class=\"color-name text-color-brown-700\">brown</div>\n                                <div class=\"color-pattern ground-color-brown-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"blue-grey\">\n                                <div class=\"color-name text-color-blue-grey-700\">blue grey</div>\n                                <div class=\"color-pattern ground-color-blue-grey-700\"></div>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap xmpp-resources\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">XMPP Resources</span>\n                </div>\n                <div class=\"resources-wrap\">\n                    <div class=\"resource-wrap main-resource\">\n                        <svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"ic-jabber\"></svg>\n                        <div class=\"info status-info\">\n                            <div class=\"label\">Status:</div>\n                            <div class=\"value status-message one-line\"></div>\n                            <div class=\"status\"></div>\n                        </div>\n                        <div class=\"info client-info\">\n                            <div class=\"label\">Client:</div>\n                            <div class=\"value client one-line\"></div>\n                        </div>\n                        <div class=\"info resource-info\">\n                            <div class=\"label\">Resource:</div>\n                            <div class=\"value resource one-line\"></div>\n                            <div class=\"device-indicator text-color-700\">(this device)</div>\n                        </div>\n                        <div class=\"info priority-info\">\n                            <div class=\"label\">Priority:</div>\n                            <div class=\"value priority\"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap vcard\">\n            </div>\n\n            <div class=\"settings-block-wrap server-info\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Server capabilities</span>\n                </div>\n                <div class=\"capabilities-wrap\">\n                    <div class=\"capabilities\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap blocklist-info\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Blocked contacts</span>\n                </div>\n                <div class=\"blocklist-wrap\">\n                    <div class=\"blocked-contacts\">\n                        <div class=\"placeholder\">No blocked contacts yet</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap groups-info\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Groups</span>\n                </div>\n                <div class=\"groups-wrap\">\n                    <div class=\"groups\">\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/accounts/existing_groupchat_item.html",[],function(){return"<div class=\"existing-chat-wrap\" data-name=\"{{name}}\" data-jid=\"{{jid}}\">\n    <div class=\"circle-avatar\">\n        <img>\n    </div>\n    <div class=\"existing-chat-item\">\n        <div class=\"name one-line\">{{name}}</div>\n        <div class=\"jid one-line\">{{jid}}</div>\n    </div>\n    <button class=\"btn-join-existing-chat btn-flat btn-dark btn-main\">join</button>\n</div>"}),define("text!templates/accounts/resource.html",[],function(){return"    <svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"ic-jabber\"></svg>\n    <div class=\"info status-info\">\n        <div class=\"label\">Status:</div>\n        <div class=\"value status-message one-line\"></div>\n        <div class=\"status\"></div>\n    </div>\n    <div class=\"info client-info\">\n        <div class=\"label\">Client:</div>\n        <div class=\"value client one-line\"></div>\n    </div>\n    <div class=\"info resource-info\">\n        <div class=\"label\">Resource:</div>\n        <div class=\"value resource one-line\"></div>\n    </div>\n    <div class=\"info priority-info\">\n        <div class=\"label\">Priority:</div>\n        <div class=\"value priority\"></div>\n    </div>\n"}),define("text!templates/accounts/global_settings_item.html",[],function(){return"<div class=\"move-account-to-this droppable\"></div>\n<div class=\"account-info-wrap\">\n    <i class=\"drag-item drag-handle mdi mdi-28px mdi-drag-vertical\"></i>\n    <div class=\"circle-avatar noselect\">\n        <img>\n    </div>\n    <div class=\"text-info-wrap\">\n        <div class=\"jid-wrap\">\n            <div class=\"jid text-color-700 one-line\"></div>\n        </div>\n        <div class=\"conn-status one-line\"></div>\n    </div>\n</div>\n<div class=\"sync-marker-wrap hidden\">\n    <i class=\"sync-marker mdi mdi-20px mdi-cloud-check\"></i>\n</div>\n<div class=\"field clickable-field enabled-state switch normal\">\n    <label class=\"field-value\">\n        <input type=\"checkbox\">\n        <span class=\"lever\"></span>\n    </label>\n</div>\n"}),define("text!templates/accounts/change_status.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Set status</span>\n    </div>\n    <ul class=\"status-values noselect\">\n        <li data-value=\"chat\">\n            <span class=\"status-value one-line\">Ready for chat</span>\n            <span class=\"status-bulb\" data-status=\"chat\"></span>\n        </li>\n        <li data-value=\"online\">\n            <span class=\"status-value one-line\">Online</span>\n            <span class=\"status-bulb\" data-status=\"online\"></span>\n        </li>\n        <li data-value=\"away\">\n            <span class=\"status-value one-line\">Away</span>\n            <span class=\"status-bulb\" data-status=\"away\"></span>\n        </li>\n        <li data-value=\"xa\">\n            <span class=\"status-value one-line\">Away for long time</span>\n            <span class=\"status-bulb\" data-status=\"xa\"></span>\n        </li>\n        <li data-value=\"dnd\">\n            <span class=\"status-value one-line\">Busy</span>\n            <span class=\"status-bulb\" data-status=\"dnd\"></span>\n        </li>\n        <li data-value=\"offline\">\n            <span class=\"status-value one-line\">Offline</span>\n            <span class=\"status-bulb\" data-status=\"offline\"></span>\n        </li>\n    </ul>\n    <div class=\"modal-content\">\n        <div class=\"row\">\n            <div class=\"input-field status-message-wrap\">\n                <span class=\"static-label\">Custom status message</span>\n                <input type=\"text\" class=\"status-message\">\n                <i class=\"clear-input mdi mdi-20px mdi-close\"></i>\n            </div>\n            <div class=\"input-field checkbox-field no-padding\">\n                <input type=\"checkbox\" class=\"filled-in apply-to-all\" id=\"{{view.cid}}_apply_to_all\"/>\n                <label for=\"{{view.cid}}_apply_to_all\">Apply to all accounts</label>\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/accounts/token_item.html",[],function(){return"<div class=\"token-wrap\" data-token-uid=\"{{token_uid}}\">\n    <div class=\"client one-line\">{{client}}</div>\n    <div class=\"device one-line\">{{device}}</div>\n    <div class=\"ip-address\">{{ip}}</div>\n    <div class=\"last-auth\">{{last_auth}}</div>\n    <i class=\"btn-revoke-token mdi mdi-24px mdi-close\"></i>\n</div>"}),define("text!templates/accounts/current_token_item.html",[],function(){return"<div class=\"token-wrap\" data-token-uid=\"{{token_uid}}\">\n    <div class=\"client one-line\">{{client}}</div>\n    <div class=\"device one-line\">{{device}}</div>\n    <div class=\"ip-address\">{{ip}}</div>\n    <div class=\"last-auth text-color-700\">Online</div>\n    <div class=\"token-indicator\">this device</div>\n</div>"}),define("text!templates/vcard/vcard.html",[],function(){return"<div class=\"block-header\">\n    <span class=\"block-name\"></span>\n    <div class=\"btn-vcard-refresh\">\n        <div class=\"button\">\n            <i class=\"mdi mdi-20px mdi-refresh\"></i>\n        </div>\n        <div class=\"preloader-wrapper preloader-20px active\">\n            <div class=\"spinner-layer\">\n                <div class=\"circle-clipper left\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"gap-patch\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"circle-clipper right\">\n                    <div class=\"circle\"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class=\"vcard-wrap\">\n    <div class=\"info-wrap jid-info-wrap hidden\">\n        <div class=\"details-icon-wrap\" title=\"Click to copy\"><svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"xmpp\"></svg></div>\n        <div class=\"info jabber-id\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Jabber ID</div>\n        </div>\n    </div>\n    <div class=\"info-wrap personal-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-account-box-outline\"></i>\n        <div class=\"info nickname\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Nickname</div>\n        </div>\n        <div class=\"info fullname\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Full name</div>\n        </div>\n        <div class=\"info first-name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Name</div>\n        </div>\n        <div class=\"info middle-name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Middle name</div>\n        </div>\n        <div class=\"info last-name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Surname</div>\n        </div>\n    </div>\n    <div class=\"info-wrap birthday-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-cake-variant\"></i>\n        <div class=\"info birthday\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Birthday</div>\n        </div>\n    </div>\n    <div class=\"info-wrap job-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-briefcase\"></i>\n        <div class=\"info job-title\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Job title</div>\n        </div>\n        <div class=\"info org-name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Company</div>\n        </div>\n        <div class=\"info org-unit\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Unit</div>\n        </div>\n    </div>\n    <div class=\"info-wrap site-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-web\"></i>\n        <div class=\"info url\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Site</div>\n        </div>\n    </div>\n    <div class=\"info-wrap description-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-file-document-box\"></i>\n        <div class=\"info description\">\n            <div class=\"value\"></div>\n            <div class=\"label\">Some description</div>\n        </div>\n    </div>\n    <div class=\"info-wrap phone-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-phone\"></i>\n        <div class=\"info phone-work\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Work</div>\n        </div>\n        <div class=\"info phone-home\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Home</div>\n        </div>\n        <div class=\"info phone-mobile\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Mobile</div>\n        </div>\n        <div class=\"info phone-default\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Phone</div>\n        </div>\n    </div>\n    <div class=\"info-wrap email-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-email\"></i>\n        <div class=\"info email-work\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Work</div>\n        </div>\n        <div class=\"info email-home\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Home</div>\n        </div>\n        <div class=\"info email-default\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Email</div>\n        </div>\n    </div>\n    <div class=\"info-wrap address-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-map-marker\"></i>\n        <div class=\"info address-work\">\n            <div class=\"extadd value one-line\"></div>\n            <div class=\"street value one-line\"></div>\n            <div class=\"locality value one-line\"></div>\n            <div class=\"region value one-line\"></div>\n            <div class=\"pcode value one-line\"></div>\n            <div class=\"country value one-line\"></div>\n            <div class=\"label\">Work</div>\n        </div>\n        <div class=\"info address-home\">\n            <div class=\"extadd value one-line\"></div>\n            <div class=\"street value one-line\"></div>\n            <div class=\"locality value one-line\"></div>\n            <div class=\"region value one-line\"></div>\n            <div class=\"pcode value one-line\"></div>\n            <div class=\"country value one-line\"></div>\n            <div class=\"label\">Home</div>\n        </div>\n        <div class=\"info address-default\">\n            <div class=\"extadd value one-line\"></div>\n            <div class=\"street value one-line\"></div>\n            <div class=\"locality value one-line\"></div>\n            <div class=\"region value one-line\"></div>\n            <div class=\"pcode value one-line\"></div>\n            <div class=\"country value one-line\"></div>\n            <div class=\"label\">Address</div>\n        </div>\n    </div>\n    <button class=\"btn-vcard-edit btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300 hidden\">Edit</button>\n</div>\n"}),define("text!templates/vcard/vcard_edit.html",[],function(){return"    <div class=\"right-column noselect\">\n        <div class=\"settings-panel-head\">\n            <span>Edit vCard</span>\n        </div>\n\n        <div class=\"panel-content-wrap\">\n            <div class=\"panel-content details-panel\">\n\n                <div class=\"settings-block-wrap vcard\">\n                    <div class=\"vcard-edit-wrap\">\n                        <div class=\"info-wrap personal-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-account-box-outline\"></i>\n                            <div class=\"input-field nickname\">\n                                <input id=\"{{view.cid}}-nickname\" type=\"text\" name=\"nickname\">\n                                <label for=\"{{view.cid}}-nickname\">Nickname</label>\n                            </div>\n                            <div class=\"input-field fullname\">\n                                <input id=\"{{view.cid}}-fullname\" type=\"text\" name=\"fullname\">\n                                <label for=\"{{view.cid}}-fullname\">Full name</label>\n                            </div>\n                            <div class=\"input-field first-name\">\n                                <input id=\"{{view.cid}}-first-name\" type=\"text\" name=\"first_name\">\n                                <label for=\"{{view.cid}}-first-name\">First name</label>\n                            </div>\n                            <div class=\"input-field middle-name\">\n                                <input id=\"{{view.cid}}-middle-name\" type=\"text\" name=\"middle_name\">\n                                <label for=\"{{view.cid}}-middle-name\">Middle name</label>\n                            </div>\n                            <div class=\"input-field last-name\">\n                                <input id=\"{{view.cid}}-last-name\" type=\"text\" name=\"last_name\">\n                                <label for=\"{{view.cid}}-last-name\">Last name</label>\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap avatar-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-camera\"></i>\n                            <div class=\"circle-avatar circle-image-fix\">\n                                <img/>\n                                <input type=\"file\"/>\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap birthday-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-cake-variant\"></i>\n                            <div class=\"input-field birthday\">\n                                <input id=\"{{view.cid}}-birthday\" type=\"text\" class=\"datepicker\">\n                                <label for=\"{{view.cid}}-birthday\">Birthdate</label>\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap job-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-briefcase\"></i>\n                            <div class=\"input-field job-title\">\n                                <input id=\"{{view.cid}}-job-title\" type=\"text\" name=\"job_title\">\n                                <label for=\"{{view.cid}}-job-title\">Job title</label>\n                            </div>\n                            <div class=\"input-field org-name\">\n                                <input id=\"{{view.cid}}-org-name\" type=\"text\" name=\"org_name\">\n                                <label for=\"{{view.cid}}-org-name\">Company</label>\n                            </div>\n                            <div class=\"input-field org-unit\">\n                                <input id=\"{{view.cid}}-org-unit\" type=\"text\" name=\"org_unit\">\n                                <label for=\"{{view.cid}}-org-unit\">Unit</label>\n                            </div>\n                        </div>\n                        <div class=\"info-wrap site-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-web\"></i>\n                            <div class=\"input-field url\">\n                                <input id=\"{{view.cid}}-url\" type=\"text\" name=\"url\">\n                                <label for=\"{{view.cid}}-url\">Site</label>\n                            </div>\n                        </div>\n                        <div class=\"info-wrap description-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-file-document-box\"></i>\n                            <div class=\"input-field description\">\n                                <textarea id=\"{{view.cid}}-description\" type=\"text\" cols=\"30\" rows=\"10\" class=\"text-field materialize-textarea\" name=\"description\"></textarea>\n                                <label for=\"{{view.cid}}-description\">Description</label>\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap phone-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-phone\"></i>\n                            <div class=\"input-field phone-work\">\n                                <input id=\"{{view.cid}}-phone-work\" type=\"text\" name=\"phone_work\">\n                                <label for=\"{{view.cid}}-phone-work\">Phone (work)</label>\n                            </div>\n                            <div class=\"input-field phone-home\">\n                                <input id=\"{{view.cid}}-phone-home\" type=\"text\" name=\"phone_home\">\n                                <label for=\"{{view.cid}}-phone-home\">Phone (home)</label>\n                            </div>\n                            <div class=\"input-field phone-mobile\">\n                                <input id=\"{{view.cid}}-phone-mobile\" type=\"text\" name=\"phone_mobile\">\n                                <label for=\"{{view.cid}}-phone-mobile\">Phone (mobile)</label>\n                            </div>\n                        </div>\n                        <div class=\"info-wrap email-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-email\"></i>\n                            <div class=\"input-field email-work\">\n                                <input id=\"{{view.cid}}-email-work\" type=\"text\" name=\"email_work\">\n                                <label for=\"{{view.cid}}-email-work\">Email (work)</label>\n                            </div>\n                            <div class=\"input-field email-home\">\n                                <input id=\"{{view.cid}}-email-home\" type=\"text\" name=\"email_home\">\n                                <label for=\"{{view.cid}}-email-home\">Email (home)</label>\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap address-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-map-marker\"></i>\n                            <div class=\"input-wrap address-wrap address-work-wrap\">\n                                <div class=\"input-label\">Address (work)</div>\n                                <div class=\"input-field extadd\">\n                                    <input id=\"{{view.cid}}-addr-work-extadd\" type=\"text\" name=\"addr_work_extadd\">\n                                    <label for=\"{{view.cid}}-addr-work-extadd\">Extended address</label>\n                                </div>\n                                <div class=\"input-field street\">\n                                    <input id=\"{{view.cid}}-addr-work-street\" type=\"text\" name=\"addr_work_street\">\n                                    <label for=\"{{view.cid}}-addr-work-street\">Street</label>\n                                </div>\n                                <div class=\"input-field locality\">\n                                    <input id=\"{{view.cid}}-addr-work-locality\" type=\"text\" name=\"addr_work_locality\">\n                                    <label for=\"{{view.cid}}-addr-work-locality\">Locality</label>\n                                </div>\n                                <div class=\"input-field region\">\n                                    <input id=\"{{view.cid}}-addr-work-region\" type=\"text\" name=\"addr_work_region\">\n                                    <label for=\"{{view.cid}}-addr-work-region\">Region</label>\n                                </div>\n                                <div class=\"input-field pcode\">\n                                    <input id=\"{{view.cid}}-addr-work-pcode\" type=\"text\" name=\"addr_work_pcode\">\n                                    <label for=\"{{view.cid}}-addr-work-pcode\">Post code</label>\n                                </div>\n                                <div class=\"input-field country\">\n                                    <input id=\"{{view.cid}}-addr-work-country\" type=\"text\" name=\"addr_work_country\">\n                                    <label for=\"{{view.cid}}-addr-work-country\">Country</label>\n                                </div>\n                            </div>\n                            <div class=\"input-wrap address-wrap address-home-wrap\">\n                                <div class=\"input-label\">Address (home)</div>\n                                <div class=\"input-field extadd\">\n                                    <input id=\"{{view.cid}}-addr-home-extadd\" type=\"text\" name=\"addr_home_extadd\">\n                                    <label for=\"{{view.cid}}-addr-home-extadd\">Extended address</label>\n                                </div>\n                                <div class=\"input-field street\">\n                                    <input id=\"{{view.cid}}-addr-home-street\" type=\"text\" name=\"addr_home_street\">\n                                    <label for=\"{{view.cid}}-addr-home-street\">Street</label>\n                                </div>\n                                <div class=\"input-field locality\">\n                                    <input id=\"{{view.cid}}-addr-home-locality\" type=\"text\" name=\"addr_home_locality\">\n                                    <label for=\"{{view.cid}}-addr-home-locality\">Locality</label>\n                                </div>\n                                <div class=\"input-field region\">\n                                    <input id=\"{{view.cid}}-addr-home-region\" type=\"text\" name=\"addr_home_region\">\n                                    <label for=\"{{view.cid}}-addr-home-region\">Region</label>\n                                </div>\n                                <div class=\"input-field pcode\">\n                                    <input id=\"{{view.cid}}-addr-home-pcode\" type=\"text\" name=\"addr_home_pcode\">\n                                    <label for=\"{{view.cid}}-addr-home-pcode\">Post code</label>\n                                </div>\n                                <div class=\"input-field country\">\n                                    <input id=\"{{view.cid}}-addr-home-country\" type=\"text\" name=\"addr_home_country\">\n                                    <label for=\"{{view.cid}}-addr-home-country\">Country</label>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n        <div class=\"panel-footer noselect\">\n            <div class=\"buttons-wrap\">\n                <button class=\"btn-vcard-save btn-flat btn-main\">Save</button>\n                <button class=\"btn-vcard-back btn-flat btn-main btn-dark\">Cancel</button>\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/searching/searching_wide.html",[],function(){return"<div class=\"searching-panel\">\n    <div class=\"search-form\">\n        <div class=\"account-indicator ground-color-500\"></div>\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search by domain\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n    <div class=\"searching-properties-field\">\n        <div class=\"dropdown-button\" data-visible=\"false\">\n            <i class=\"mdi mdi-24px mdi-chevron-down arrow\"></i>\n        </div>\n    </div>\n    <ul id=\"select-searching-properties\" class=\"selectable-text\">\n        <div class=\"account-property\">\n            <p class=\"property-name\">Account</p>\n            <div class=\"account-field\">\n                <div class=\"multiple-acc\">\n                    <div class=\"account-dropdown-wrap\">\n                        <div class=\"dropdown-button\" data-activates=\"select-account-for-searching\">\n                            <div class=\"account-item-wrap\">\n                            </div>\n                            <div class=\"caret\">\n                                <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                            </div>\n                        </div>\n                        <div id=\"select-account-for-searching\" class=\"dropdown-content\">\n                        </div>\n                    </div>\n                </div>\n                <div class=\"single-acc\">\n                    <div class=\"dropdown-button\">\n                        <div class=\"account-item-wrap\">\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"title-property\">\n            <p class=\"property-name\">Title</p>\n            <div class=\"input-field\">\n                <input id=\"searching_property_title\" type=\"text\" name=\"title\">\n            </div>\n        </div>\n        <div class=\"sorting-property\">\n            <p class=\"property-name\">Sort by</p>\n            <div class=\"input-field\">\n                <input id=\"searching_property_sort_by\" type=\"text\" name=\"title\">\n            </div>\n        </div>\n        <button class=\"btn-search btn btn-main-filled ground-color-700\">Search</button>\n    </ul>\n</div>\n<div class=\"searching-result-wrap\">\n    <div class=\"chats-list-wrap\">\n        <div class=\"result-string\"></div>\n        <div class=\"preloader-wrapper preloader-17px active\">\n            <div class=\"spinner-layer\">\n                <div class=\"circle-clipper left\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"gap-patch\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"circle-clipper right\">\n                    <div class=\"circle\"></div>\n                </div>\n            </div></div>\n        <div class=\"chats-list\"></div></div>\n    <div class=\"searching-more\"></div>\n</div>"}),define("text!templates/searching/searching_account_item.html",[],function(){return"<div class=\"account-item-wrap\" data-jid=\"{{jid}}\">\n    <div class=\"name one-line\">{{jid}}</div>\n</div>"}),define("text!templates/searching/existing_groupchat_item.html",[],function(){return"<div class=\"existing-chat-wrap\" data-name=\"{{name}}\" data-jid=\"{{jid}}\">\n    <div class=\"account-indicator ground-color-{{color}}-500\"></div>\n    <div class=\"circle-avatar\">\n        <img>\n    </div>\n    <div class=\"existing-chat-item\">\n        <div class=\"name one-line\">{{name}}</div>\n        <div class=\"jid one-line\">{{jid}}</div>\n    </div>\n</div>"}),define("text!templates/searching/existing_groupchat_details_view.html",[],function(){return"<div class=\"block-header\">\n    <span class=\"block-name\">Chat properties</span>\n</div>\n<div class=\"chat-properties-wrap selectable-text\">\n    <div class=\"info-wrap jid-info-wrap\">\n        <svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"xmpp\"></svg>\n        <div class=\"info jabber-id\">\n            <div class=\"value one-line\">{{jid}}</div>\n            <div class=\"label\">Jabber ID</div>\n        </div>\n    </div>\n    <div class=\"info-wrap name-info-wrap\">\n        <i class=\"details-icon mdi mdi-24px mdi-account-box-outline\"></i>\n        <div class=\"info name\">\n            <div class=\"value one-line\">{{name}}</div>\n            <div class=\"label\">Name</div>\n        </div>\n    </div>\n    <div class=\"info-wrap description-info-wrap\">\n        <i class=\"details-icon mdi mdi-24px mdi-file-document-box\"></i>\n        <div class=\"info description\">\n            <div class=\"value one-line\">{{description}}</div>\n            <div class=\"label\">Description</div>\n        </div>\n    </div>\n    <div class=\"info-wrap anonymous-info-wrap\">\n        <i class=\"details-icon mdi mdi-24px mdi-comment-question-outline\"></i>\n        <div class=\"info anonymous\">\n            <div class=\"value one-line\">{{anonymous}}</div>\n            <div class=\"label\">Anonymous</div>\n        </div>\n    </div>\n    <div class=\"info-wrap model-info-wrap\">\n        <i class=\"details-icon mdi mdi-24px mdi-lock-open-outline\"></i>\n        <div class=\"info model\">\n            <div class=\"value one-line\">{{membership}}</div>\n            <div class=\"label\">Membership</div>\n        </div>\n    </div>\n</div>\n<button class=\"btn-join-chat btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300\">Join</button>\n"}),define("text!templates/contacts/roster_right.html",[],function(){return"<div class=\"contacts-panel noselect\">\n    <div class=\"collapsed-wrap\">\n        <i class=\"collapsed-contacts-icon mdi mdi-24px mdi-account-multiple\"></i>\n        <div class=\"all-contacts-counter\"></div>\n    </div>\n    <div class=\"expanded-wrap\">\n        <div class=\"roster-head panel-head\">\n            <div class=\"contacts-header\">Contacts</div>\n            <div class=\"roster-button btn-pin\"></div>\n        </div>\n\n        <div class=\"contact-list-wrap\">\n            <div class=\"contact-list\">\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/contacts/roster_left.html",[],function(){return"<div class=\"contacts-panel noselect\">\n    <div class=\"contacts-search-form search-form panel-head\">\n        <div class=\"account-indicator\"></div>\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n\n    <div class=\"contact-list-wrap left-panel-list-wrap\">\n        <div class=\"contact-list item-list\">\n        </div>\n        <div class=\"searched-lists-wrap\">\n            <div class=\"chats-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"chats-title\">Chats</div>\n                <div class=\"chats-list roster-left-container\"></div>\n            </div>\n            <div class=\"contacts-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"contacts-title\">Contacts</div>\n                <div class=\"contacts-list roster-left-container\"></div>\n            </div>\n            <div class=\"messages-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"messages-title\">Messages</div>\n                <div class=\"messages-list roster-left-container\"></div>\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/contacts/account_roster_right.html",[],function(){return"<div class=\"roster-account-info-wrap\">\n    <div class=\"roster-account-info\">\n        <div class=\"circle-avatar border-color ground-color-700 noselect\">\n            <img>\n        </div>\n        <div class=\"text-info-wrap\">\n            <p class=\"name text-color-700 one-line\"></p>\n            <p class=\"status-message text-color-700 one-line\"></p>\n            <div class=\"roster-info\">\n                <i class=\"mdi mdi-account-multiple-outline\"></i>\n                <span class=\"counter\"></span>\n            </div>\n        </div>\n    </div>\n    <div class=\"status-button\">\n        <div class=\"status\"></div>\n    </div>\n    <div class=\"roster-account-shrank-footer1\"></div>\n    <div class=\"roster-account-shrank-footer2\"></div>\n</div>\n"}),define("text!templates/contacts/account_roster_left.html",[],function(){return"<div class=\"roster-account-info-wrap\">\n    <div class=\"roster-account-info ground-color-100\">\n        <div class=\"account-indicator ground-color-700\"></div>\n        <div class=\"circle-avatar noselect\">\n            <img>\n        </div>\n        <div class=\"text-info-wrap\">\n            <p class=\"name text-color-900 one-line\"></p>\n            <p class=\"jid one-line\"></p>\n        </div>\n        <div class=\"button-divider\"></div>\n    </div>\n    <div class=\"status-button\">\n        <div class=\"status\"></div>\n    </div>\n    <div class=\"roster-account-shrank-footer1 ground-color-50\">\n        <div class=\"account-indicator ground-color-300\"></div>\n    </div>\n    <div class=\"roster-account-shrank-footer2 ground-color-50\">\n        <div class=\"account-indicator ground-color-300\"></div>\n    </div>\n</div>\n"}),define("text!templates/contacts/group_right.html",[],function(){return"<div class=\"group-head\">\n    <i class=\"arrow mdi mdi-20px\"></i>\n    <div class=\"group-title\">\n        <span class=\"group-name one-line\"></span>\n        <span class=\"member-counter one-line\"></span>\n    </div>\n    <i class=\"group-icon mdi mdi-20px hidden\"></i>\n</div>\n"}),define("text!templates/contacts/group_left.html",[],function(){return"<div class=\"account-indicator ground-color-700\"></div>\n<div class=\"group-head\">\n    <i class=\"arrow mdi mdi-20px\"></i>\n    <div class=\"group-title\">\n        <span class=\"group-name one-line\"></span>\n        <span class=\"member-counter one-line\"></span>\n    </div>\n    <i class=\"group-icon mdi mdi-20px hidden\"></i>\n</div>\n"}),define("text!templates/contacts/add_contact.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Add new contact</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row account-field\">\n            <div class=\"field-header\">Account</div>\n            <div class=\"multiple-acc\">\n                <div class=\"account-dropdown-wrap\">\n                    <div class=\"dropdown-button\" data-activates=\"select-account-for-add-contact\">\n                        <div class=\"account-item-wrap\">\n                        </div>\n                        <div class=\"caret\">\n                            <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                        </div>\n                    </div>\n                    <div id=\"select-account-for-add-contact\" class=\"dropdown-content noselect\">\n                    </div>\n                </div>\n            </div>\n            <div class=\"single-acc\">\n                <div class=\"dropdown-button\">\n                    <div class=\"account-item-wrap\">\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row name-field\">\n            <div class=\"input-field\">\n                <input id=\"new_contact_username\" type=\"text\" name=\"username\">\n                <label for=\"new_contact_username\">Contact JID</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n            <div class=\"input-field\">\n                <input id=\"new_contact_name\" type=\"text\" name=\"contact_name\" required>\n                <label for=\"new_contact_name\">Contact name</label>\n            </div>\n            <span class=\"add-contact-feedback red-text\"></span>\n        </div>\n        <div class=\"row groups-field\">\n            <div class=\"field-header\">Groups</div>\n            <div class=\"groups checkbox-list\">\n            </div>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-add\">Add</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/contacts/contact_right_item.html",[],function(){return"<div class=\"circle-avatar noselect\"></div>\n<div class=\"text-info-wrap\">\n    <p class=\"name one-line\"></p>\n    <p class=\"jid one-line hidden\"></p>\n    <p class=\"status-message one-line\"></p>\n</div>\n<div class=\"status hide-offline\"></div>\n<div class=\"chat-icon hidden\"><img></div>\n"}),define("text!templates/contacts/contact_left_item.html",[],function(){return"<div class=\"circle-avatar noselect\"></div>\n<div class=\"text-info-wrap\">\n    <div class=\"name-wrap\">\n        <p class=\"name one-line\"></p>\n        <svg class=\"muted-icon mdi mdi-12px mdi-svg-template\" data-svgname=\"volume-off-variant\" viewBox=\"0 0 13 16\"></svg>\n    </div>\n    <p class=\"jid one-line\"></p>\n</div>\n<div class=\"status hide-offline\"></div>\n<div class=\"chat-icon hidden\"><img></div>\n<i class=\"blocked-indicator mdi mdi-14px mdi-block-helper\"></i>\n"}),define("text!templates/contacts/contact_blocked_item.html",[],function(){return"<div class=\"circle-avatar noselect\">\n    <img>\n</div>\n<div class=\"text-info-wrap\">\n    <p class=\"jid one-line\"></p>\n    <p class=\"btn-unblock text-color-700 hover-text-color-900 one-line\">Unblock</p>\n</div>\n\n"}),define("text!templates/contacts/contact_details.html",[],function(){return"<div class=\"panel-content-wrap noselect\">\n    <div class=\"main-info\">\n        <div class=\"avatar-wrap\">\n            <div class=\"circle-avatar\"><img></div>\n            <div class=\"status hide-offline\"></div>\n        </div>\n        <div class=\"text-info\">\n            <div class=\"name-wrap\"></div>\n            <div class=\"status-message one-line\"></div>\n        </div>\n        <div class=\"btn-escape\">\n            <i class=\"mdi mdi-24px mdi-close\"></i>\n            <span class=\"btn-text\">Esc</span>\n        </div>\n        <div class=\"btn-more  dropdown-button\" data-activates=\"{{view.cid}}-buttons-wrap\">\n            <i class=\"mdi mdi-24px mdi-dots-vertical\"></i>\n        </div>\n        <ul class=\"buttons-menu-wrap dropdown-content noselect\" id=\"{{view.cid}}-buttons-wrap\">\n            <li class=\"btn-auth-request\"><span class=\"one-line\">Request authorization</span></li>\n            <li class=\"btn-add\"><span class=\"one-line\">Add contact</span></li>\n            <li class=\"btn-delete\"><span class=\"one-line\">Delete contact</span></li>\n            <li class=\"btn-block\"><span class=\"one-line\">Block contact</span></li>\n            <li class=\"btn-unblock\"><span class=\"one-line\">Unblock contact</span></li>\n        </ul>\n        <div class=\"buttons-wrap\">\n            <div class=\"button-wrap btn-chat-wrap\">\n                <i class=\"mdi mdi-24px mdi-message-text btn-chat\"></i>\n                <div class=\"btn-name\">Chat</div>\n            </div>\n            <div class=\"button-wrap btn-voice-call-wrap\">\n                <i class=\"mdi mdi-24px mdi-phone btn-voice-call\"></i>\n                <div class=\"btn-name\">Voice Call</div>\n            </div>\n            <div class=\"button-wrap btn-video-call-wrap\">\n                <i class=\"mdi mdi-24px mdi-video btn-video-call\"></i>\n                <div class=\"btn-name\">Video Call</div>\n            </div>\n            <div class=\"button-wrap btn-mute-wrap\">\n                <i class=\"mdi mdi-24px mdi-bell btn-mute\"></i>\n                <div class=\"btn-name\">Mute</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"panel-content private-chat\">\n        <div class=\"left-column\">\n            <div class=\"block-wrap vcard\">\n            </div>\n        </div>\n        <div class=\"right-column\">\n            <div class=\"block-wrap resources-block-wrap hidden\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Connected devices</span>\n                </div>\n                <div class=\"resources-wrap\">\n                </div>\n            </div>\n            <div class=\"block-wrap groups-block-wrap\"></div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/roster_settings.html",[],function(){return"    <div class=\"setting-name\">Show offline contacts</div>\n    <div class=\"setting offline-contacts radio-button field-wrap\">\n        <div class=\"field radio-field clickable-field\">\n            <form action=\"#\">\n                <p>\n                    <input class=\"with-gap\" name=\"offline-contacts\" value=\"yes\" type=\"radio\" id=\"{{view.cid}}-show\" />\n                    <label for=\"{{view.cid}}-show\">Always show</label>\n                </p>\n                <p>\n                    <input class=\"with-gap\" name=\"offline-contacts\" value=\"no\" type=\"radio\" id=\"{{view.cid}}-hide\" />\n                    <label for=\"{{view.cid}}-hide\">Always hide</label>\n                </p>\n            </form>\n        </div>\n    </div>\n    <div class=\"setting-name\">Sorting contacts</div>\n    <div class=\"setting sorting-contacts radio-button field-wrap\">\n        <div class=\"field radio-field clickable-field\">\n            <form action=\"#\">\n                <p>\n                    <input class=\"with-gap\" name=\"sorting-contacts\" value=\"online-first\" type=\"radio\" id=\"{{view.cid}}-online-first\" />\n                    <label for=\"{{view.cid}}-online-first\">Online first</label>\n                </p>\n                <p>\n                    <input class=\"with-gap\" name=\"sorting-contacts\" value=\"by-alphabet\" type=\"radio\" id=\"{{view.cid}}-by-alphabet\" />\n                    <label for=\"{{view.cid}}-by-alphabet\">Alphabet order (A -> Z)</label>\n                </p>\n            </form>\n        </div>\n    </div>\n"}),define("text!templates/contacts/group_settings.html",[],function(){return"<div class=\"modal-content-wrap settings-panel\">\n    <div class=\"modal-header\">\n        <span>Group settings</span>\n    </div>\n\n    <div class=\"modal-content\">\n            <div class=\"field-wrap group-name\">\n                <div class=\"input-field\">\n                    <input id=\"{{view.cid}}-group-name\" type=\"text\" name=\"group_name\">\n                    <label for=\"{{view.cid}}-group-name\">Name</label>\n                    <span class=\"errors fixed\"></span>\n                </div>\n            </div>\n\n            <div class=\"setting-name\">Offline contacts</div>\n            <div class=\"setting-wrap\">\n                <div class=\"setting offline radio-button field-wrap\">\n                    <div class=\"field radio-field clickable-field\">\n                        <form action=\"#\">\n                            <p>\n                                <input class=\"with-gap\" name=\"offline\" value=\"yes\" type=\"radio\" id=\"{{view.cid}}-show\" />\n                                <label for=\"{{view.cid}}-show\">Always show</label>\n                            </p>\n                            <p>\n                                <input class=\"with-gap\" name=\"offline\" value=\"no\" type=\"radio\" id=\"{{view.cid}}-hide\" />\n                                <label for=\"{{view.cid}}-hide\">Always hide</label>\n                            </p>\n                            <p>\n                                <input class=\"with-gap\" name=\"offline\" value=\"default\" type=\"radio\" id=\"{{view.cid}}-show-offline-default\" />\n                                <label for=\"{{view.cid}}-show-offline-default\">Use common settings</label>\n                            </p>\n                        </form>\n                    </div>\n                </div>\n            </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-dark btn-delete left\">Delete</button>\n        <button class=\"btn-flat btn-main btn-apply\">Apply</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/contacts/groups_checkbox_list.html",[],function(){return"{[ for (var i = 0; i < groups.length; i++) { var name = groups[i].name, checked = groups[i].checked, group_id = groups[i].id; ]}\n    <div class=\"input-field checkbox-field existing-group-field\">\n        <input type=\"checkbox\" class=\"filled-in\" id=\"{{group_id}}\" data-groupname=\"{{name}}\" {[ if (checked) { ]}checked=\"checked\"{[ } ]} />\n        <label for=\"{{group_id}}\">{{name}}</label>\n    </div>\n{[ } ]}\n    <div class=\"new-group-field-wrap\">\n        <div class=\"input-field checkbox-field new-group-checkbox hidden\">\n            <input type=\"checkbox\" class=\"filled-in\" id=\"new_group_checkbox\"/>\n            <label for=\"new_group_checkbox\">.</label>\n        </div>\n        <div class=\"input-field new-group-name\">\n            <input class=\"xabber-input\" id=\"new-group-name\" type=\"text\" name=\"new_group_name\" placeholder=\"Create new group\">\n        </div>\n    </div>\n"}),define("text!templates/contacts/add_contact_account_item.html",[],function(){return"<div class=\"account-item-wrap\" data-jid=\"{{jid}}\">\n    <div class=\"circle-avatar noselect\">\n        <img>\n    </div>\n    <div class=\"name one-line\">{{jid}}</div>\n</div>\n"}),define("text!templates/contacts/contact_placeholder.html",[],function(){return"<div class=\"text\">Please select a contact to view details</div>\n"}),define("text!templates/contacts/groups.html",[],function(){return"<div class=\"groups-header block-header\">\n    <span class=\"block-name\">Groups</span>\n</div>\n<div class=\"groups-wrap\">\n    <div class=\"groups checkbox-list\">\n    </div>\n</div>"}),define("text!templates/contacts/preloader.html",[],function(){return"<div class=\"preloader-wrapper preloader-17px active visible\">\n    <div class=\"spinner-layer\">\n        <div class=\"circle-clipper left\">\n            <div class=\"circle\"></div>\n        </div>\n        <div class=\"gap-patch\">\n            <div class=\"circle\"></div>\n        </div>\n        <div class=\"circle-clipper right\">\n            <div class=\"circle\"></div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/group_chat_properties.html",[],function(){return"<div class=\"block-header\">\n    <span class=\"block-name\">Chat properties</span>\n</div>\n<div class=\"group-chat-properties vcard\">\n    <div class=\"info-wrap jid-info-wrap\">\n        <div title=\"Click to copy\" class=\"details-icon-wrap\">\n            <svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"xmpp\"></svg>\n        </div>\n        <div class=\"info jabber-id\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Jabber ID</div>\n        </div>\n    </div>\n    <div class=\"info-wrap name-info-wrap\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-account-box-outline\"></i>\n        <div class=\"info name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Name</div>\n        </div>\n    </div>\n    <div class=\"info-wrap description-info-wrap\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-file-document-box\"></i>\n        <div class=\"info description\">\n            <div class=\"value\"></div>\n            <div class=\"label\">Description</div>\n        </div>\n    </div>\n    <div class=\"info-wrap searchable-info-wrap\">\n        <svg class=\"details-icon toolbar-icon mdi mdi-24px\" viewBox=\"0 0 24 24\">\n            <path title=\"Click to copy\" d=\"M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M19.35,8.03C21.95,8.22 24,10.36 24,13C24,14.64 23.21,16.1 22,17V16.5A6.5,6.5 0 0,0 15.5,10A6.5,6.5 0 0,0 9,16.5C9,17 9.06,17.5 9.17,18H6A6,6 0 0,1 0,12C0,8.9 2.34,6.36 5.35,6.03C6.6,3.64 9.11,2 12,2C15.64,2 18.67,4.59 19.35,8.03Z\"></path>\n        </svg>\n        <div class=\"info searchable\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Indexed</div>\n        </div>\n    </div>\n    <div class=\"info-wrap anonymous-info-wrap\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-incognito\"></i>\n        <div class=\"info anonymous\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Anonymous</div>\n        </div>\n    </div>\n    <div class=\"info-wrap model-info-wrap\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-lock\"></i>\n        <div class=\"info model\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Membership</div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/group_chat_details.html",[],function(){return"<div class=\"panel-content-wrap noselect\">\n    <div class=\"main-info\">\n        <div class=\"avatar-wrap\">\n            <div class=\"circle-avatar\">\n                <input title=\"Change avatar\" type=\"file\"/>\n                <img>\n                <svg class=\"set-groupchat-avatar\" viewBox=\"0 0 24 24\">\n                    <path d=\"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z\" />\n                </svg>\n                <div class=\"preloader-wrap\"><div class=\"preloader-wrapper preloader-32px visible\">\n                    <div class=\"spinner-layer\">\n                        <div class=\"circle-clipper left\">\n                            <div class=\"circle\"></div>\n                        </div>\n                        <div class=\"gap-patch\">\n                            <div class=\"circle\"></div>\n                        </div>\n                        <div class=\"circle-clipper right\">\n                            <div class=\"circle\"></div>\n                        </div>\n                    </div>\n                </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"text-info\">\n            <div class=\"name-wrap\"></div>\n            <div class=\"status-message one-line\"></div>\n        </div>\n        <div class=\"btn-more  dropdown-button\" data-activates=\"{{view.cid}}-buttons-wrap\">\n            <i class=\"mdi mdi-24px mdi-dots-vertical\"></i>\n        </div>\n        <ul class=\"buttons-menu-wrap dropdown-content noselect\" id=\"{{view.cid}}-buttons-wrap\">\n            <li class=\"btn-join\"><span class=\"one-line\">Join group chat</span></li>\n            <li class=\"btn-delete\"><span class=\"one-line\">Delete group chat</span></li>\n            <li class=\"btn-block\"><span class=\"one-line\">Block group chat</span></li>\n            <li class=\"btn-unblock\"><span class=\"one-line\">Unlock group chat</span></li>\n        </ul>\n        <div class=\"btn-escape\">\n            <i class=\"mdi mdi-24px mdi-close\"></i>\n            <span class=\"btn-text\">Esc</span>\n        </div>\n        <div class=\"buttons-wrap\">\n            <div class=\"button-wrap btn-invite-wrap\">\n                <i class=\"mdi mdi-24px mdi-account-multiple-plus btn-invite\"></i>\n                <div class=\"btn-name\">Invite</div>\n            </div>\n            <div class=\"button-wrap btn-settings-wrap\">\n                <i class=\"mdi mdi-24px mdi-settings btn-settings\"></i>\n                <div class=\"btn-name\">Settings</div>\n            </div>\n            <div class=\"button-wrap btn-default-restrictions-wrap\">\n                <i class=\"mdi mdi-24px mdi-sign-caution btn-default-restrictions\"></i>\n                <div class=\"btn-name\">Default restrictions</div>\n            </div>\n            <div class=\"button-wrap btn-leave-wrap\">\n                <div class=\"btn-leave\"><svg viewBox=\"0 0 24 24\">\n                    <path d=\"M13.34,8.17C12.41,8.17 11.65,7.4 11.65,6.47A1.69,1.69 0 0,1 13.34,4.78C14.28,4.78 15.04,5.54 15.04,6.47C15.04,7.4 14.28,8.17 13.34,8.17M10.3,19.93L4.37,18.75L4.71,17.05L8.86,17.9L10.21,11.04L8.69,11.64V14.5H7V10.54L11.4,8.67L12.07,8.59C12.67,8.59 13.17,8.93 13.5,9.44L14.36,10.79C15.04,12 16.39,12.82 18,12.82V14.5C16.14,14.5 14.44,13.67 13.34,12.4L12.84,14.94L14.61,16.63V23H12.92V17.9L11.14,16.21L10.3,19.93M21,23H19V3H6V16.11L4,15.69V1H21V23M6,23H4V19.78L6,20.2V23Z\" />\n                </svg>\n                </div>\n                <div class=\"btn-name\">Leave</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"panel-content\">\n        <div class=\"left-column\">\n            <div class=\"select-users-list-wrap lists-dropdown-wrap\">\n                <div class=\"dropdown-button\" data-activates=\"select-users-list\">\n                    <div class=\"list-item-wrap\"><div data-value=\"participants\" class=\"list-value\">Participants</div></div>\n                    <div class=\"caret\">\n                        <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                    </div>\n                </div>\n                <div id=\"select-users-list\" class=\"dropdown-content noselect\">\n                    <div data-value=\"participants\" class=\"list-variant\">Participants</div>\n                    <div data-value=\"invitations\" class=\"list-variant\">Invitations</div>\n                    <div data-value=\"blocked\" class=\"list-variant\">Blocked</div>\n                </div>\n            </div>\n            <div class=\"block-wrap participants-wrap\"></div>\n            <div class=\"block-wrap participant-wrap\"></div>\n        </div>\n        <div class=\"right-column\">\n            <div class=\"block-wrap group-chat-properties-wrap\"></div>\n            <div class=\"block-wrap groups-block-wrap\"></div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/contacts/group_chats/invitation.html",[],function(){return"    <div class=\"panel-content-wrap noselect\">\n        <div class=\"main-info\">\n            <div class=\"circle-avatar\"><img></div>\n            <div class=\"text-info\">\n                <div class=\"name-wrap one-line\"></div>\n                <div class=\"jid one-line\"></div>\n            </div>\n            <div class=\"btn-escape\">\n                <i class=\"mdi mdi-24px mdi-close\"></i>\n                <span class=\"btn-text\">Esc</span>\n            </div>\n        </div>\n\n        <div class=\"panel-content\">\n            <div class=\"invite-msg\"><p class=\"invite-msg-text\"></p></div>\n            <div class=\"panel-footer noselect\">\n                <div class=\"buttons-wrap\">\n                    <button class=\"btn-accept btn-flat btn-main\">Accept</button>\n                    <button class=\"btn-join btn-flat btn-main hidden\">Join</button>\n                    <button class=\"btn-decline btn-flat btn-main\">Decline</button>\n                    <button class=\"btn-decline-all btn-flat btn-main\">Decline all</button>\n                    <button class=\"btn-block btn-flat btn-main\">Block</button>\n                    <button class=\"btn-chat btn-flat btn-main hidden\">Chat</button>\n                </div>\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/contacts/group_chats/group_chat_properties_edit.html",[],function(){return"<div class=\"modal-header\"><div class=\"panel-header black-text\">Group chat properties</div></div>\n<div class=\"modal-content group-chat-properties-wrap selectable-text\">\n    <div class=\"property-wrap jid-info-wrap\">\n        <div class=\"property-header\">XMPP ID</div>\n        <div class=\"jabber-id\">\n            <div class=\"value one-line\"></div>\n        </div>\n        <p id=\"anonymous-public\" class=\"property-description hidden\">Public group chat. Participants can see real XMPP IDs of other participants</p>\n        <p id=\"anonymous-incognito\" class=\"property-description hidden\">Incognito group chat. Participants can not see real XMPP IDs of other participants</p>\n    </div>\n    <div class=\"property-wrap name-field\">\n        <div class=\"property-header\">Chat Name</div>\n        <div class=\"input-field input-group-chat-name\">\n            <input id=\"new_name_value\" type=\"text\" name=\"chat_name\" placeholder=\"Input Chat Name\" class=\"text-field\">\n        </div>\n    </div>\n    <div class=\"property-wrap description-field\">\n        <div class=\"property-header\">Description</div>\n        <textarea placeholder=\"Input description\" id=\"\" cols=\"30\" rows=\"10\" class=\"text-field materialize-textarea\"></textarea>\n    </div>\n    <div class=\"property-wrap global-field\">\n        <div class=\"property-header\">Indexation</div>\n        <div class=\"property-radio\">\n            <input id=\"indexation-none\" name=\"groupchatIndexation\" type=\"radio\" class=\"with-gap\" required=\"\">\n            <label class=\"property-radio-label\" for=\"indexation-none\">Not indexed</label>\n        </div>\n        <div class=\"property-radio\">\n            <input id=\"indexation-local\" name=\"groupchatIndexation\" type=\"radio\" class=\"with-gap\" required=\"\">\n            <label class=\"property-radio-label\" for=\"indexation-local\">Local index</label>\n        </div>\n        <div class=\"property-radio\">\n            <input id=\"indexation-global\" name=\"groupchatIndexation\" type=\"radio\" class=\"with-gap\" required=\"\">\n            <label class=\"property-radio-label\" for=\"indexation-global\">Global index</label>\n        </div>\n        <p class=\"property-description\">Locally indexed chats can be discovered by searching host server. Globally indexed chats can be discovered by searching global index</p>\n    </div>\n    <div class=\"property-wrap membership-field\">\n        <div class=\"property-header\">Membership</div>\n        <div id=\"membership-header\" class=\"membership-field\">\n            <div class=\"property-radio\">\n                <input id=\"membership-open\" name=\"groupchatMembership\" type=\"radio\" class=\"with-gap\" required=\"\">\n                <label class=\"property-radio-label\" for=\"membership-open\">Open</label>\n            </div>\n            <div class=\"property-radio\">\n                <input id=\"membership-member-only\" name=\"groupchatMembership\" type=\"radio\" class=\"with-gap\" required=\"\">\n                <label class=\"property-radio-label\" for=\"membership-member-only\">Member only</label>\n            </div>\n        </div>\n        <p class=\"property-description\">Member only chats can be joined by invitation</p>\n    </div>\n</div>\n<div class=\"modal-footer\">\n    <div class=\"buttons-wrap\">\n        <button class=\"btn-save btn-flat btn-main non-active\">Save</button>\n        <button class=\"btn-cancel btn-flat btn-dark btn-main\">Cancel</button>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/default_restrictions.html",[],function(){return"<div class=\"modal-header\"><div class=\"panel-header black-text\">Default restrictions</div></div>\n<div class=\"modal-content\">\n    <div class=\"default-restrictions-list-wrap\"></div>\n    <p class=\"default-restrictions-info\">These restrictions will be automatically applied to all new group chat participants</p>\n</div>\n<div class=\"modal-footer\">\n    <div class=\"buttons-wrap\">\n        <button class=\"btn-default-restrictions-save btn-flat btn-main non-active\">Save</button>\n        <button class=\"btn-default-restrictions-cancel btn-flat btn-main btn-dark\">Cancel</button>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/group_member_item.html",[],function(){return"<div class=\"list-item group-chat-participant\" data-id=\"{{id}}\" data-jid=\"{{jid}}\" data-role=\"{{role}}\">\n    <div class=\"member-item\">\n        <div class=\"circle-avatar\"><!--<img>--></div>\n        <div class=\"participant-info\"><div class=\"top-line\"><div title=\"{{nickname}}\" class=\"nickname one-line\">{{nickname}}</div>{[if (badge) {]}<div class=\"badge one-line\">{{badge}}</div>{[}]}</div>{[if (jid) {]}<p title=\"{{jid}}\" class=\"jid hidden one-line\">{{jid}}</p>{[} else {]}<p title=\"{{id}}\" class=\"id hidden one-line\">{{id}}</p>{[}]}\n        <div class=\"last-seen one-line\" {[if (present === 'now') { ]} data-present=\"true\">Online{[} else {]}>Last seen: {{present}}{[}]}</div></div>\n        {[ if (role == 'Owner') {]}<div title=\"Owner\" class=\"role-star\"><i class=\"mdi mdi-20px mdi-star\"></i></div>{[}]}\n        {[ if (role == 'Admin') {]}<div title=\"Admin\" class=\"role-star\"><i class=\"mdi mdi-20px mdi-star-outline\"></i></div>{[}]}\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/invited_member_item.html",[],function(){return"<div class=\"list-item {{status}}-user\" data-jid=\"{{jid}}\">\n    <div class=\"member-item\">\n        <div class=\"circle-avatar\">\n            <img>\n        </div>\n        <p title=\"{{jid}}\" class=\"one-line\">{{jid}}</p>\n        {[if (status == 'invitations') {]}<div title=\"Revoke invitation\" class=\"revoke-invitation\"><i class=\"mdi mdi-20px mdi-undo\"></i></div>{[}]}\n        {[if (status == 'blocked') {]}<div title=\"Unblock user\" class=\"unblock-user\"><i class=\"mdi mdi-20px mdi-block-helper\"></i></div>{[}]}\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/participant_rights.html",[],function(){return"<div class=\"header\">\n</div>\n<div class=\"modal-content\">\n    <div class=\"dialog-restrictions-edit\">\n        <div class=\"restrictions-header\">Restrictions</div>\n        <div class=\"restrictions-wrap\"></div>\n    </div>\n    <div class=\"dialog-permissions-edit\">\n        <div class=\"permissions-header\">Permissions</div>\n        <div class=\"permissions-wrap\"></div>\n    </div>\n</div>\n<div class=\"modal-footer noselect\">\n    <div class=\"buttons-wrap\">\n        <button class=\"btn-save-user-rights non-active btn-flat btn-main\">Save</button>\n        <button class=\"btn-cancel-changes btn-flat btn-main btn-dark\">Cancel</button>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/restriction_item.html",[],function(){return"<div class=\"right-item restriction restriction-{{name}}\">\n    <div class=\"right-name\">{{pretty_name}}</div>\n    <div class=\"field clickable-field restriction-{{name}}-state switch normal\">\n        <input type=\"checkbox\" class=\"filled-in\" id=\"{{name}}\">\n        <label for=\"{{name}}\"></label>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/permission_item.html",[],function(){return"<div class=\"right-item permission permission-{{name}}\">\n    <div class=\"right-name\">{{pretty_name}}</div>\n    <div class=\"field clickable-field permission-{{name}}-state switch normal\">\n        <input type=\"checkbox\" class=\"filled-in\" id=\"{{name}}\">\n        <label for=\"{{name}}\"></label>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/right_expire_variants.html",[],function(){return"<div class=\"select-timer\">\n    <div class=\"dropdown-button\" data-activates=\"select-timer-{{right_name}}\">\n        <div class=\"timer-item-wrap\"><div data-value=\"never\" class=\"default-value property-value\">set timer</div></div>\n    </div>\n    <div id=\"select-timer-{{right_name}}\" class=\"dropdown-content noselect\">\n        <div data-value=\"5 minutes\" class=\"property-variant\">5 minutes</div>\n        <div data-value=\"15 minutes\" class=\"property-variant\">15 minutes</div>\n        <div data-value=\"30 minutes\" class=\"property-variant\">30 minutes</div>\n        <div data-value=\"1 hour\" class=\"property-variant\">1 hour</div>\n        <div data-value=\"1 day\" class=\"property-variant\">1 day</div>\n        <div data-value=\"1 week\" class=\"property-variant\">1 week</div>\n        <div data-value=\"1 month\" class=\"property-variant\">1 month</div>\n        <div data-value=\"never\" class=\"property-variant\">Forever</div>\n    </div>\n</div>\n"}),define("text!templates/contacts/group_chats/pinned_message.html",[],function(){return"<svg class=\"pin\" viewBox=\"0 0 24 24\">\n    <path fill=\"#757575\" d=\"M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z\" />\n</svg>\n<div class=\"msg-wrap\">\n    <div class=\"chat-msg-author-wrap\">\n        <div class=\"chat-msg-author text-color-700 one-line\">{{author}}</div>{[if (fwd_author){]}<svg class=\"fwd-chevron\" viewBox=\"0 0 24 24\"><path fill=\"#9E9E9E\" d=\"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z\"/></svg><div class=\"chat-msg-author text-color-700 one-line\">{{fwd_author}}</div>{[}]}\n        <div class=\"msg-time\">{{time}}</div>\n    </div>\n    <div class=\"chat-msg-content chat-text-content one-line\">\n        {{message}}\n    </div>\n</div>\n<svg title=\"Unpin\" class=\"close\" viewBox=\"0 0 24 24\">\n    <path class=\"close\" fill=\"#9E9E9E\" d=\"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z\" />\n</svg>"}),define("text!templates/contacts/group_chats/participant_details_item.html",[],function(){return"<div class=\"participant-details-item\" data-id=\"{{id}}\" data-jid=\"{{jid}}\" data-role=\"{{role}}\">\n        <div class=\"circle-avatar\">\n            <input title=\"Change avatar\" type=\"file\">\n            <img>\n            <svg class=\"set-groupchat-avatar\" viewBox=\"0 0 24 24\">\n                <path d=\"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z\" />\n            </svg>\n            <div class=\"preloader-wrap\"><div class=\"preloader-wrapper preloader-16px visible\">\n                <div class=\"spinner-layer\">\n                    <div class=\"circle-clipper left\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"gap-patch\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"circle-clipper right\">\n                        <div class=\"circle\"></div>\n                    </div>\n                </div>\n            </div>\n            </div>\n        </div>\n        <div class=\"participant-info\">\n            <div id=\"edit-nickname\" class=\"rich-textarea\" tabindex=\"1\" contenteditable></div>\n            <div title=\"{{nickname}}\" class=\"nickname one-line\">{{nickname}}</div>\n            <div class=\"badge one-line {[if (!badge) {]}hidden{[}]}\">{{badge}}</div>\n            {[if (jid) {]}<p title=\"{{jid}}\" class=\"jid selectable-text one-line\">{{jid}}</p>{[} else {]}<p title=\"{{id}}\" class=\"id selectable-text one-line\">{{id}}</p>{[}]}\n        </div>\n    <div class=\"buttons-wrap\">\n        {[if (incognito_chat) {]}\n        <div class=\"button-wrap non-active btn-chat-wrap\">\n            <i class=\"mdi mdi-24px mdi-incognito btn-chat\"></i>\n            <div class=\"btn-name\">Private chat</div>\n        </div>\n        {[} else {]}\n        <div class=\"button-wrap non-active btn-chat-wrap\">\n            <i class=\"mdi mdi-24px mdi-message-text btn-chat\"></i>\n            <div class=\"btn-name\">Direct chat</div>\n        </div>\n        {[}]}\n        <div class=\"button-wrap btn-participant-messages-wrap\">\n            <i class=\"mdi mdi-24px mdi-view-list btn-participant-messages\"></i>\n            <div class=\"btn-name\">Messages</div>\n        </div>\n        <div class=\"button-wrap btn-set-badge-wrap\">\n            <svg class=\"btn-set-badge\" viewBox=\"0 0 24 24\">\n                <path d=\"M17,3H14V6H10V3H7A2,2 0 0,0 5,5V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V5A2,2 0 0,0 17,3M12,8A2,2 0 0,1 14,10A2,2 0 0,1 12,12A2,2 0 0,1 10,10A2,2 0 0,1 12,8M16,16H8V15C8,13.67 10.67,13 12,13C13.33,13 16,13.67 16,15V16M13,5H11V1H13V5M16,19H8V18H16V19M12,21H8V20H12V21Z\" />\n            </svg>\n            <div class=\"btn-name\">Set badge</div>\n        </div>\n        <div class=\"button-wrap btn-block-participant-wrap\">\n            <i class=\"mdi mdi-24px mdi-account-off btn-block-participant\"></i>\n            <div class=\"btn-name\">Block</div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/participant_placeholder.html",[],function(){return"<div class=\"default-screen-wrap\">\n    <div class=\"default-image-wrap\"><img src=\"images/astronaut@2x.png\" class=\"image-select-participant\"></div>\n    <p class=\"text-select-participant\">Select chat participant</p>\n</div>"}),define("text!templates/contacts/group_chats/participants.html",[],function(){return"<div class=\"participants-search-form search-form\">\n    <svg class=\"search-icon\" viewBox=\"0 0 24 24\">\n        <path d=\"M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M10,4A4,4 0 0,1 14,8C14,8.91 13.69,9.75 13.18,10.43C12.32,10.75 11.55,11.26 10.91,11.9L10,12A4,4 0 0,1 6,8A4,4 0 0,1 10,4M2,20V18C2,15.88 5.31,14.14 9.5,14C9.18,14.78 9,15.62 9,16.5C9,17.79 9.38,19 10,20H2Z\" />\n    </svg>\n    <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search participant\">\n    <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n</div>\n<div class=\"members-list-wrap\">\n    <div class=\"owners\"></div>\n    <div class=\"admins\"></div>\n    <div class=\"members\"></div>\n</div>\n<div class=\"preloader-wrapper preloader-17px active\">\n    <div class=\"spinner-layer\">\n        <div class=\"circle-clipper left\">\n            <div class=\"circle\"></div>\n        </div>\n        <div class=\"gap-patch\">\n            <div class=\"circle\"></div>\n        </div>\n        <div class=\"circle-clipper right\">\n            <div class=\"circle\"></div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/badge_edit_view.html",[],function(){return"\n    <div class=\"modal-content\">\n        <div class=\"rich-textarea badge-text\" tabindex=\"1\" contenteditable></div>\n        <div class=\"error\"></div>\n    </div>\n    <div class=\"panel-footer noselect\">\n        <div class=\"buttons-wrap\">\n            <div class=\"insert-emoticon\">\n                <i class=\"mdi mdi-24px mdi-emoticon hover-text-color-500\"></i>\n            </div>\n            <div class=\"emoticons-panel-wrap\">\n                <div class=\"emoticons-panel\"></div>\n            </div>\n            <button class=\"btn-save btn-flat btn-main\">Save</button>\n            <button class=\"btn-cancel btn-flat btn-main btn-dark\">Cancel</button>\n        </div>\n    </div>"}),define("text!templates/contacts/group_chats/private_participant_details.html",[],function(){return"<div class=\"participant-details-item\" data-id=\"{{id}}\" data-jid=\"{{jid}}\" data-role=\"{{role}}\">\n    <div class=\"circle-avatar\">\n        {[ if (is_myself) {]}\n        <input title=\"Change avatar\" type=\"file\">\n        {[}]}\n        <img>\n        {[ if (is_myself) {]}\n        <svg class=\"set-groupchat-avatar\" viewBox=\"0 0 24 24\">\n            <path d=\"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z\" />\n        </svg>\n        <div class=\"preloader-wrap\"><div class=\"preloader-wrapper preloader-16px visible\">\n            <div class=\"spinner-layer\">\n                <div class=\"circle-clipper left\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"gap-patch\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"circle-clipper right\">\n                    <div class=\"circle\"></div>\n                </div>\n            </div>\n        </div>\n        </div>\n        {[}]}\n    </div>\n    <div class=\"participant-info\">\n        {[ if (is_myself) {]}\n        <div id=\"edit-nickname\" class=\"rich-textarea\" tabindex=\"1\" contenteditable></div>\n        {[}]}\n        <div title=\"{{nickname}}\" class=\"{{is_myself && 'is-myself'}} nickname one-line\">{{nickname}}</div>\n        <div class=\"badge one-line {[if (!badge) {]}hidden{[}]}\">{{badge}}</div>\n    </div>\n</div>"}),define("text!templates/chats/chats_panel.html",[],function(){return"<div class=\"recent-chats-panel noselect\">\n    <div class=\"chats-search-form search-form panel-head\">\n        <div class=\"account-indicator\"></div>\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n    <div class=\"chat-list-wrap left-panel-list-wrap\">\n        <div class=\"chat-list item-list\">\n        </div>\n        <div class=\"searched-lists-wrap\">\n            <div class=\"chats-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"chats-title\">Chats</div>\n                <div class=\"chats-list roster-left-container\"></div>\n            </div>\n            <div class=\"contacts-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"contacts-title\">Contacts</div>\n                <div class=\"contacts-list roster-left-container\"></div>\n            </div>\n            <div class=\"messages-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"messages-title\">Messages</div>\n                <div class=\"messages-list roster-left-container\"></div>\n            </div>\n        </div>\n        <div class=\"load-chats-feedback hidden\">Loading...</div>\n    </div>\n</div>\n"}),define("text!templates/chats/add_chat_account_item.html",[],function(){return"<div class=\"account-item-wrap\" data-jid=\"{{jid}}\">\n    <div class=\"name one-line\">{{jid}}</div>\n</div>\n"}),define("text!templates/chats/chat_item.html",[],function(){return"<div class=\"account-indicator ground-color-700\"></div>\n<div class=\"circle-avatar\"></div>\n<div class=\"status hide-offline\"></div>\n<div class=\"chat-icon hidden\"><img></div>\n<div class=\"recent-chat-info\">\n    <div class=\"chat-title-wrap\">\n        <p class=\"chat-title one-line\"></p>\n        <svg class=\"muted-icon mdi mdi-12px mdi-svg-template\" data-svgname=\"volume-off-variant\" viewBox=\"0 0 13 16\"></svg>\n    </div>\n    <p class=\"last-msg one-line\"></p>\n    <p class=\"last-msg-date\"></p>\n    <i class=\"msg-delivering-state mdi mdi-12px hidden\"></i>\n    <i class=\"blocked-indicator mdi mdi-14px mdi-block-helper\"></i>\n    <span class=\"msg-counter hidden\"></span>\n</div>\n"}),define("text!templates/chats/chat_head.html",[],function(){return"    <div class=\"circle-avatar\">\n        <img>\n    </div>\n    <div class=\"contact-status hide-offline\"></div>\n    <div class=\"chat-icon hidden\"><img></div>\n    <div class=\"contact-info\">\n        <p class=\"contact-name one-line\"></p>\n        <p class=\"contact-status-message one-line\"></p>\n    </div>\n    <div class=\"chat-tools-wrap\">\n        <div class=\"chat-tool btn-jingle-message\">\n            <i class=\"mdi mdi-phone mdi-20px\"></i>\n            </div>\n        <div class=\"chat-tool btn-search-messages\">\n            <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        </div>\n        <div class=\"chat-tool btn-archive-chat\">\n            <i class=\"mdi mdi-20px mdi-package-down\"></i>\n        </div>\n        <div class=\"chat-tool btn-notifications\">\n            <i class=\"no-muted mdi mdi-20px mdi-volume-medium\"></i>\n            <svg class=\"muted mdi mdi-16px mdi-svg-template\" data-svgname=\"volume-off-variant\" viewBox=\"0 0 13 16\"></svg>\n        </div>\n        <div class=\"chat-tool btn-more dropdown-button\" data-activates=\"{{view.cid}}-more\">\n            <i class=\"mdi mdi-20px mdi-dots-vertical\"></i>\n        </div>\n        <ul id=\"{{view.cid}}-more\" class=\"chat-head-menu dropdown-content noselect\">\n            <li class=\"btn-contact-details\">\n                <span class=\"one-line\">Contact info</span>\n            </li>\n            <li class=\"btn-clear-history\">\n                <span class=\"one-line\">Clear message history</span>\n            </li>\n            <li class=\"btn-invite-users\">\n                <span class=\"one-line\">Invite users</span>\n            </li>\n            <li class=\"btn-retract-own-messages\">\n                <span class=\"one-line\">Retract own messages</span>\n            </li>\n            <li class=\"btn-close-chat\">\n                <span class=\"one-line\">Delete chat</span>\n            </li>\n        </ul>\n    </div>\n"}),define("text!templates/chats/chat_content.html",[],function(){return"<div class=\"search-form-header\">\n    <div class=\"messages-search-form search-form\">\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search messages\" autofocus>\n    </div>\n    <div class=\"text-color-700 btn-cancel-searching\">cancel</div>\n</div>\n<div class=\"pinned-message\"></div>\n<div class=\"chat-day-indicator fixed-day-indicator-wrap hidden\"><div class=\"fixed-day-indicator\"></div></div>\n<div class=\"load-history-feedback hidden\"></div>\n<div class=\"participant-messages-header hidden\"><div class=\"messages-by-header\">Messages by <div class=\"participant-nickname text-color-700\"></div></div><div class=\"text-color-700 btn-cancel-selection\">cancel</div><div class=\"btn-retract-messages\">delete all</div></div>\n<div class=\"chat-content\">\n</div>\n<i class=\"mdi mdi-36px back-to-bottom mdi-chevron-down\"></i>\n<div class=\"chat-notification hidden one-line\"></div>"}),define("text!templates/chats/chat_bottom.html",[],function(){return"    <div class=\"message-input-panel noselect\">\n        <div class=\"my-avatar circle-avatar circle-image-fix\">\n            <img>\n        </div>\n        <div class=\"message-form\">\n            <div class=\"fwd-messages-preview noselect hidden\">\n                <div class=\"msg-border ground-color-700\">\n                </div>\n                <div class=\"msg-content\">\n                    <p class=\"msg-author text-color-700 one-line\"></p>\n                    <p class=\"msg-text one-line\"></p>\n                </div>\n                <div class=\"close-forward\">\n                    <i class=\"mdi mdi-20px mdi-close hover-text-color-500\"></i>\n                </div>\n            </div>\n            <div class=\"input-field input-message\">\n                <div class=\"mentions-list\"></div>\n                <div class=\"rich-textarea-wrap\">\n                    <!--<div class=\"rich-textarea\" tabindex=\"2\" contenteditable></div>\n                    <div class=\"placeholder\">Write a message...</div>-->\n                </div>\n                <div class=\"scrollbar-cover\"></div>\n                <div class=\"insert-emoticon\">\n                    <i class=\"mdi mdi-24px mdi-emoticon hover-text-color-500\"></i>\n                </div>\n                <div class=\"emoticons-panel-wrap\">\n                    <div class=\"emoticons-panel\"></div>\n                </div>\n            </div>\n            <div class=\"input-voice-message\">\n                <div class=\"voice-visualizer\"></div>\n                <div class=\"timer\">0:00</div>\n                <div class=\"voice-msg-status\">Release outside this form to cancel</div>\n            </div>\n            <div class=\"input-toolbar\">\n                <div class=\"attach attach-file\">\n                    <input type=\"file\" title=\"Send file\" multiple>\n                    <i class=\"mdi mdi-24px mdi-paperclip\"></i>\n                </div>\n                <div title=\"Format text\" class=\"format-text\">\n                    <i class=\"mdi mdi-24px mdi-format-text\"></i>\n                </div>\n                <div class=\"last-emoticons\">\n                </div>\n                <div class=\"account-jid text-color-700\"></div><div class=\"account-role ground-color-700\"></div><div class=\"account-badge\"></div><div class=\"account-nickname text-color-700\"></div>\n            </div>\n        </div>\n        <div class=\"send-area\">\n            <button class=\"btn-save btn-flat btn-main text-color-700 hidden\">Save</button>\n            <i class=\"send-message mdi mdi-28px mdi-send text-color-700 hover-text-color-500 hidden\"></i>\n            <i class=\"mdi mdi-28px mdi-microphone attach-voice-message text-color-700 hover-text-color-500\"></i>\n        </div>\n    </div>\n    <div class=\"message-actions-panel noselect hidden\">\n        <div class=\"button-wrap reply-message-wrap\">\n            <i class=\"action-button reply-message mdi ground-color-700 mdi-reply mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">R</span>eply</div>\n        </div>\n        <div class=\"button-wrap forward-message-wrap\">\n            <i class=\"action-button forward-message mdi ground-color-700 mdi-forward mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">F</span>orward</div>\n        </div>\n        <div class=\"button-wrap copy-message-wrap\">\n            <i class=\"action-button copy-message mdi ground-color-700 mdi-content-copy mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">C</span>opy</div>\n        </div>\n        <div class=\"button-wrap delete-message-wrap\">\n            <i class=\"action-button delete-message mdi ground-color-700 mdi-delete mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">D</span>elete</div>\n        </div>\n        <div class=\"button-wrap edit-message-wrap\">\n            <i class=\"action-button edit-message mdi ground-color-700 mdi-pencil mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">E</span>dit</div>\n        </div>\n        <div class=\"button-wrap pin-message-wrap\">\n            <svg class=\"action-button pin-message ground-color-700\" viewBox=\"0 0 24 24\">\n                <path fill=\"#FFF\" d=\"M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z\"/>\n            </svg>\n            <div class=\"button-name\"><span class=\"text-color-500\">P</span>in</div>\n        </div>\n        <div class=\"button-wrap cancel-message-wrap\">\n            <i class=\"action-button close-message-panel mdi mdi-close mdi-24px\"></i>\n            <div class=\"button-name\">Cancel</div>\n        </div>\n    </div>\n"}),define("text!templates/chats/forward_panel.html",[],function(){return"<div class=\"modal-header noselect\">\n    <div class=\"panel-header\">\n        <span class=\"header\">Forward message</span>\n    </div>\n</div>\n<div class=\"modal-content noselect\">\n    <div class=\"chats-search-form search-form\">\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" placeholder=\"Search\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n    <div class=\"chat-list-wrap\">\n    </div>\n    <div class=\"error hidden\">No matches</div>\n</div>\n"}),define("text!templates/chats/chat_placeholder.html",[],function(){return"<div class=\"text\">Please select a chat to start messaging</div>\n"}),define("text!templates/chats/message_item.html",[],function(){return"<div class=\"account-indicator ground-color-700\"></div>\n<div class=\"circle-avatar\"></div>\n<div class=\"chat-icon hidden\"><img></div>\n<div class=\"recent-chat-info\">\n    <div class=\"chat-title-wrap\">\n        <p class=\"chat-title one-line\"></p>\n    </div>\n    <p class=\"last-msg one-line\"></p>\n    <p class=\"last-msg-date\"></p>\n</div>\n"}),define("text!templates/chats/messages/main.html",[],function(){return"<div class=\"chat-message main {{classlist}}\"  {[if (avatar_id) {]} data-avatar=\"{{avatar_id}}\" {[}]} data-time=\"{{timestamp}}\" data-msgid=\"{{msgid}}\" {[if (from_id) {]} data-from-id=\"{{from_id}}\" {[}]} data-from=\"{{from_jid}}\">\n    <div class=\"left-side noselect\">\n        <div class=\"circle-avatar\"></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-author-wrap\">\n            <div class=\"chat-msg-author text-color-700 one-line\">{{username}}</div>\n            {[if (badge) {]} <div class=\"chat-msg-author-badge one-line\">{{badge}}</div>\n            {[ } if (role && (role != 'Member')) {]} <div class=\"chat-msg-author-role ground-color-700 one-line\">{{role}}</div> {[}]}\n            <div class=\"edited-info one-line hidden\"></div>\n        </div>\n        <div class=\"fwd-msgs-block\"></div>\n        <div class=\"chat-msg-content chat-text-content\">{{message}}</div>\n        <div class=\"chat-msg-media-content\"></div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n        {[ if (is_sender) { ]}\n            <i class=\"msg-delivering-state mdi mdi-14px\" data-state=\"{{state}}\" title=\"{{verbose_state}}\" data-activates=\"retry-send-msg-{{msgid}}\"></i>\n            <div id=\"retry-send-msg-{{msgid}}\" class=\"dropdown-content retry-send-message noselect\"><div class=\"btn-retry-send-message\">retry</div></div>\n        {[ } ]}\n        <div class=\"msg-copy-link\" title=\"Copy link\"><i class=\"mdi mdi-link-variant\" data-image=\"{{is_image}}\"></i></div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/forwarded.html",[],function(){return"<div class=\"fwd-message\" data-time=\"{{timestamp}}\" data-msgid=\"{{msgid}}\" {[if (avatar_id) {]} data-avatar=\"{{avatar_id}}\" {[}]} data-from-id=\"{{from_id}}\" data-from=\"{{from_jid}}\">\n    <div class=\"fwd-left-side noselect\">\n        <div class=\"circle-avatar\"><!--<img>--></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"fwd-msg-author-wrap\">\n            <div class=\"fwd-msg-author text-color-700 one-line\">{{username}}</div>\n            {[if (badge) {]} <div class=\"chat-msg-author-badge one-line\">{{badge}}</div>\n            {[ } if ((role)&&(role != 'Member')) {]} <div class=\"chat-msg-author-role ground-color-700 one-line\">{{role}}</div> {[}]}\n            <div class=\"msg-time selectable-text one-line\" title=\"{{time}}\">{{short_time}}</div>\n        </div>\n        <div class=\"fwd-msgs-block\"></div>\n        <div class=\"chat-msg-content chat-text-content\">{{message}}</div>\n        <div class=\"chat-msg-media-content\"></div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/system.html",[],function(){return"<div class=\"chat-message system\"  data-time=\"{{timestamp}}\" data-msgid=\"{{msgid}}\" data-from=\"{{from_jid}}\">\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-content chat-text-content\">{{message}}</div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/file_upload.html",[],function(){return"<div class=\"chat-message file-upload noselect\" {[if (avatar_id) {]} data-avatar=\"{{avatar_id}}\" {[}]} data-time=\"{{timestamp}}\" data-from=\"{{from_jid}}\" data-msgid=\"{{msgid}}\">\n    <div class=\"left-side noselect\">\n        <div class=\"circle-avatar\"><!--<img>--></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-author-wrap\">\n            <div class=\"chat-msg-author text-color-700 one-line\">{{username}}</div>\n            {[if (badge) {]} <div class=\"chat-msg-author-badge one-line\">{{badge}}</div>\n            {[ } if (role && (role != 'Member')) {]} <div class=\"chat-msg-author-role ground-color-700 one-line\">{{role}}</div> {[}]}\n        </div>\n        <div class=\"chat-msg-content chat-file-content\">\n            <div class=\"chat-file-info\">\n                <div class=\"filename text-color-700 one-line\">{{files[0].name}}</div>\n                <div class=\"filesize grey-text one-line\"></div>\n                <div class=\"status-area\">\n                    <div class=\"status one-line text-color-700\" style=\"display: none\"></div>\n                    <div class=\"repeat-upload text-color-700\" style=\"display: none;\">Resend</div>\n                </div>\n                <div class=\"progress-area\">\n                    <div class=\"progress ground-color-100\">\n                        <div class=\"determinate ground-color-700\" style=\"width: 0%\"></div>\n                    </div>\n                    <div class=\"cancel-upload text-color-700\">Cancel</div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n        <i class=\"msg-delivering-state mdi mdi-14px\" data-state=\"pending\" title=\"{{verbose_state}}\" data-activates=\"retry-send-msg-{{msgid}}\"></i>\n        <div id=\"retry-send-msg-{{msgid}}\" class=\"dropdown-content retry-send-message noselect\"><div class=\"btn-retry-send-message\">retry</div></div>\n        <div class=\"msg-copy-link\" title=\"Copy link\"><i class=\"mdi mdi-link-variant\" data-image=\"{{is_image}}\"></i></div>\n    </div>\n</div>"}),define("text!templates/chats/messages/file.html",[],function(){return"<div class=\"one-file-wrap link-file\">\n    <i class=\"mdi {{mdi_icon}}\"></i>\n    <div class=\"file-container\">\n        <div class=\"file-info one-line\">\n            <span class=\"file-name\">{{name}}</span>{[ if (is_audio && duration) { ]}, {{duration}}{[ } ]},  <span class=\"file-size\">{{size}}</span>\n        </div>\n        <a href=\"{{url}}\" class=\"file-link-download\">Download</a>\n    </div>\n</div>"}),define("text!templates/chats/messages/audio_file.html",[],function(){return"<div class=\"one-file-wrap link-file\">\n    <i class=\"mdi mdi-play no-uploaded\"></i>\n    <i class=\"mdi mdi-pause\"></i>\n    <div class=\"file-container\">\n        <div class=\"file-info one-line\">\n            <span class=\"file-name\">{{name}}</span>{[ if (duration) { ]}, {{duration}}{[ } ]},  <span class=\"file-size\">{{size}}</span>\n        </div>\n        <a href=\"{{url}}\" class=\"file-link-download\">Download</a>\n        <a class=\"voice-message-play\">Play</a>\n    </div>\n</div>"}),define("text!templates/chats/messages/audio_file_waveform.html",[],function(){return"<div class=\"waveform\" id=\"{{waveform_id}}\"></div>\n<div class=\"audio-control-panel\">\n    <span class=\"voice-msg-current-time\">0:00</span> /\n    <span class=\"voice-msg-total-time\">0:00</span>\n    <input value=\"50\" type=\"range\" class=\"voice-message-volume\">\n</div>"}),define("text!templates/chats/messages/auth_request.html",[],function(){return"<div class=\"chat-message system auth-request\" data-time=\"{{timestamp}}\" data-msgid=\"{{msgid}}\" data-from=\"{{from_jid}}\">\n    <div class=\"left-side noselect\">\n        <div class=\"circle-avatar\"><img></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-author-wrap\">\n            <div class=\"chat-msg-author text-color-700 one-line\">{{username}}</div>\n        </div>\n        <div class=\"chat-msg-content chat-text-content\">{{message}}<span class=\"accept-request\">Accept</span><span class=\"decline-request\">Decline</span><span class=\"block-request\">Block</span></div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/group_request.html",[],function(){return"<div class=\"chat-message system auth-request\" data-time=\"{{timestamp}}\" data-msgid=\"{{msgid}}\" data-from=\"{{from_jid}}\">\n    <div class=\"left-side noselect\">\n        <div class=\"circle-avatar\"><img></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-author-wrap\">\n            <div class=\"chat-msg-author text-color-700 one-line\">{{username}}</div>\n        </div>\n        <div class=\"chat-msg-content chat-text-content\">{{message}}<div><span class=\"accept-request-group\">Accept</span><span class=\"decline-request-group\">Decline</span><span class=\"block-request-group\">Block</span></div></div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/template-for-2.html",[],function(){return"<div class=\"image-collection zoom-gallery\"><div class=\"img-content-template template-for-2\"><img src=\"{{images[0].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].url}}\"></div>\n<div class=\"img-content-template template-for-2\"><img src=\"{{images[1].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].url}}\"></div></div>\n\n"}),define("text!templates/chats/messages/template-for-3.html",[],function(){return"<div class=\"image-collection zoom-gallery\"><div class=\"img-content-template template-for-3 main\"><img src=\"{{images[0].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].url}}\"></div>\n<div class=\"template-for-3 minor-images\"><div class=\"img-content-template template-for-3 minor\"><img src=\"{{images[1].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].url}}\"></div>\n<div class=\"img-content-template template-for-3 minor\"><img src=\"{{images[2].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[2].url}}\"></div></div></div>"}),define("text!templates/chats/messages/template-for-4.html",[],function(){return"<div class=\"image-collection zoom-gallery\"><div class=\"img-content-template template-for-4 main\"><img src=\"{{images[0].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].url}}\"></div><div class=\"template-for-4 minor-images\">\n<div class=\"img-content-template template-for-4 minor\"><img src=\"{{images[1].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].url}}\"></div>\n<div class=\"img-content-template template-for-4 minor\"><img src=\"{{images[2].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[2].url}}\"></div>\n<div class=\"img-content-template template-for-4 minor\"><img src=\"{{images[3].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[3].url}}\"></div></div></div>"}),define("text!templates/chats/messages/template-for-5.html",[],function(){return"<div class=\"image-collection zoom-gallery template-for-5\"><div class=\"img-content-wrap template-for-5 main\"><div class=\"img-content-template template-for-5\"><img src=\"{{images[0].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].url}}\"></div><div class=\"img-content-template template-for-5\"><img src=\"{{images[1].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].url}}\"></div></div>\n<div class=\"img-content-wrap template-for-5 minor-images\"><div class=\"img-content-template template-for-5\"><img src=\"{{images[2].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[2].url}}\"></div>\n<div class=\"img-content-template template-for-5\"><img src=\"{{images[3].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[3].url}}\"></div>\n<div class=\"img-content-template template-for-5\"><img src=\"{{images[4].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[4].url}}\"></div></div></div>"}),define("text!templates/chats/messages/template-for-6.html",[],function(){return"<div class=\"image-collection zoom-gallery template-for-6\"><div class=\"img-content-wrap template-for-6 main-row\"><div class=\"img-content-template template-for-6 main\"><img src=\"{{images[0].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].url}}\"></div><div class=\"template-for-6 minor-1\"><div class=\"img-content-template template-for-6\"><img src=\"{{images[1].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].url}}\"></div>\n<div class=\"img-content-template template-for-6\"><img src=\"{{images[2].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[2].url}}\"></div></div></div>\n<div class=\"template-for-6 minor-2\"><div class=\"img-content-template template-for-6\"><img src=\"{{images[3].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[3].url}}\"></div>\n<div class=\"img-content-template template-for-6\"><img src=\"{{images[4].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[4].url}}\"></div>\n<div class=\"img-content-template template-for-6 last-image\"><img src=\"{{images[5].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[5].url}}\">\n{[ if (images.length > 6) { ]}<span class=\"image-counter\"></span>{[ for (var i=6; i < images.length; i++) {]} <div class=\"img-content-template hidden\"><img src=\"{{images[i].url}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[i].url}}\"></div> {[}} ]}</div></div></div>\n"}),define("text!templates/chats/archive_placeholder.html",[],function(){return"<div class=\"text\">Archive chats are not implemented yet</div>"}),define("text!templates/chats/group_chats/pinned_message_panel.html",[],function(){return"<div class=\"modal-content full-pinned-message\">\n</div>\n"}),define("text!templates/chats/group_chats/add_group_chat.html",[],function(){return"<div class=\"modal-header\">\n    <div class=\"panel-header black-text\">Create group chat</div>\n</div>\n<div class=\"modal-content\">\n    <div class=\"row account-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-account-circle\"></i>\n        <div class=\"multiple-acc\">\n            <div class=\"account-dropdown-wrap\">\n                <div class=\"dropdown-button\" data-activates=\"select-account-for-creating-groupchat\">\n                    <div class=\"account-item-wrap\">\n                    </div>\n                    <div class=\"caret\">\n                        <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                    </div>\n                </div>\n                <div id=\"select-account-for-creating-groupchat\" class=\"dropdown-content noselect\">\n                </div>\n            </div>\n        </div>\n        <div class=\"single-acc\">\n            <div class=\"dropdown-button\">\n                <div class=\"account-item-wrap\">\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class=\"row name-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-pencil\"></i>\n        <div class=\"input-field input-group-chat-name\">\n            <input id=\"new_chat_name\" type=\"text\" name=\"chat_name\" placeholder=\"Edit group chat name\" required>\n        </div>\n    </div>\n    <div class=\"row jid-field\">\n        <svg class=\"field-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"xmpp\"></svg>\n        <div class=\"property-field xmpp-server-dropdown-wrap\">\n            <div class=\"select-xmpp-server\">\n                <div data-activates=\"select-xmpp-server\" class=\"xmpp-server-item-wrap property-wrap\"><div class=\"jid-at\">@</div><div class=\"field-jid one-line property-value\"></div></div>\n                <div class=\"input-field input-group-chat-domain hidden\">\n                    <input id=\"new_chat_domain\" type=\"text\" placeholder=\"domain\" name=\"chat_domain\">\n                </div>\n                <div data-activates=\"select-xmpp-server\" class=\"caret\">\n                    <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                </div>\n            </div>\n            <div id=\"select-xmpp-server\" class=\"dropdown-content noselect\">\n                <div class=\"property-variant set-custom-domain\">custom server...</div>\n            </div>\n        </div>\n        <div class=\"input-field input-group-chat-jid\">\n            <input id=\"new_chat_jid\" type=\"text\" placeholder=\"jid\" name=\"chat_jid\">\n        </div>\n    </div>\n    <div class=\"row incognito-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-incognito\"></i>\n        <div class=\"property-field incognito-dropdown-wrap\">\n            <div class=\"dropdown-button\" data-activates=\"select-incognito\">\n                <div class=\"incognito-item-wrap property-wrap\"><div data-value=\"public\" class=\"property-value\">Public</div></div>\n                <div class=\"caret\">\n                    <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                </div>\n            </div>\n            <div id=\"select-incognito\" class=\"dropdown-content noselect\">\n                <div data-value=\"public\" class=\"property-variant default-value\">Public</div>\n                <div data-value=\"incognito\" class=\"property-variant\">Incognito</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"row global-field\">\n        <svg class=\"field-icon toolbar-icon mdi mdi-24px\" viewBox=\"0 0 24 24\">\n            <path d=\"M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M19.35,8.03C21.95,8.22 24,10.36 24,13C24,14.64 23.21,16.1 22,17V16.5A6.5,6.5 0 0,0 15.5,10A6.5,6.5 0 0,0 9,16.5C9,17 9.06,17.5 9.17,18H6A6,6 0 0,1 0,12C0,8.9 2.34,6.36 5.35,6.03C6.6,3.64 9.11,2 12,2C15.64,2 18.67,4.59 19.35,8.03Z\"></path>\n        </svg>\n        <div class=\"property-field global-dropdown-wrap\">\n            <div class=\"dropdown-button\" data-activates=\"select-global\">\n                <div class=\"global-item-wrap property-wrap\"><div data-value=\"none\" class=\"property-value\">Not indexed</div></div>\n                <div class=\"caret\">\n                    <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                </div>\n            </div>\n            <div id=\"select-global\" class=\"dropdown-content noselect\">\n                <div data-value=\"none\" class=\"property-variant default-value\">Not indexed</div>\n                <div data-value=\"local\" class=\"property-variant\">Local index</div>\n                <div data-value=\"global\" class=\"property-variant\">Global index</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"row membership-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-lock\"></i>\n        <div class=\"property-field membership-dropdown-wrap\">\n            <div class=\"dropdown-button\" data-activates=\"select-membership\">\n                <div class=\"membership-item-wrap property-wrap\"><div data-value=\"open\" class=\"property-value\">Open membership</div></div>\n                <div class=\"caret\">\n                    <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                </div>\n            </div>\n            <div id=\"select-membership\" class=\"dropdown-content noselect\">\n                <div data-value=\"open\" class=\"property-variant default-value\">Open membership</div>\n                <div data-value=\"member-only\" class=\"property-variant\">Member-only</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"row description-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-sort-variant\"></i>\n        <div class=\"input-field input-message\">\n            <div class=\"rich-textarea-wrap\">\n                <div class=\"rich-textarea\" tabindex=\"2\" contenteditable=\"\"></div>\n                <div class=\"placeholder\">Write a description...</div>\n            </div>\n        </div>\n    </div>\n</div>\n</div>\n<div class=\"modal-footer\">\n    <span class=\"errors\"></span>\n    <button class=\"btn-flat btn-main text-color-700 non-active btn-add\">Create</button>\n    <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n</div>"}),define("text!templates/chats/group_chats/invitation_panel_view.html",[],function(){return"    <div class=\"modal-header noselect\">\n        <div class=\"panel-header\">\n            <span class=\"header\">Invite users</span>\n        </div>\n    </div>\n    <div class=\"modal-content noselect\">\n        <div class=\"chats-search-form search-form\">\n            <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n            <input type=\"text\" class=\"search-input simple-input-field\" placeholder=\"Search\">\n            <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n        </div>\n        <div class=\"contacts-list-wrap\">\n        </div>\n        <div class=\"error hidden\">No matches</div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-add\"><span class=\"counter hidden\"></span>Invite</button>\n        <button class=\"btn-flat btn-dark btn-main btn-cancel\">Cancel</button>\n        <span class=\"errors\"></span>\n    </div>"}),define("text!templates/chats/group_chats/mention_item.html",[],function(){return"<div class=\"list-item mention-item\" data-id=\"{{id}}\" data-nickname=\"{{nickname}}\">\n    <div class=\"circle-avatar\"><img></div>\n    <div class=\"participant-info\">\n        <span class=\"one-line nickname\">{{nickname}}</span>\n        <span class=\"one-line jid\">{{jid}}</span>\n    </div>\n</div>"}),define("text!templates/mentions/mentions_panel.html",[],function(){return"<div class=\"mentions-panel noselect\">\n    <div class=\"chats-search-form search-form panel-head\">\n        <div class=\"account-indicator\"></div>\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n    <div class=\"mentions-list-wrap left-panel-list-wrap\">\n        <div class=\"mentions-list item-list\">\n        </div>\n        <div class=\"searched-lists-wrap\">\n            <div class=\"chats-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"chats-title\">Chats</div>\n                <div class=\"chats-list roster-left-container\"></div>\n            </div>\n            <div class=\"contacts-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"contacts-title\">Contacts</div>\n                <div class=\"contacts-list roster-left-container\"></div>\n            </div>\n            <div class=\"messages-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"messages-title\">Messages</div>\n                <div class=\"messages-list roster-left-container\"></div>\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/mentions/mentions_placeholder.html",[],function(){return"<div class=\"text\">Please select mention to view in chat</div>"}),define("text!templates/mentions/mention_item.html",[],function(){return"<div class=\"group-chat-title-wrap hidden\">\n    <div class=\"account-indicator ground-color-700\"></div>\n    <div class=\"contact-icon\">\n        <img class=\"server-icon hidden\" src=\"./images/BotIcon20x20@2x.png\">\n        <img class=\"group-chat-icon hidden\" src=\"./images/GroupchatIcon20x20@2x.png\">\n    </div>\n    <div class=\"group-chat-name one-line\"></div>\n</div>\n<div class=\"mention-info-wrap\">\n<div class=\"account-indicator ground-color-700\"></div>\n<div class=\"circle-avatar\"></div>\n<div class=\"mention-info\">\n    <div class=\"chat-title-wrap\">\n        <p class=\"chat-title one-line\"></p>\n    </div>\n    <p class=\"last-msg one-line\"></p>\n    <p class=\"last-msg-date\"></p>\n    <span class=\"msg-counter hidden\"></span>\n</div>\n</div>"}),define("text!templates/svg/ic-jabber.html",[],function(){return"<path\n     style=\"fill-rule:evenodd\"\n     inkscape:connector-curvature=\"0\"\n     id=\"path5\"\n     d=\"m 5.2462478,6.4309194 c 0,0 0.2534497,0.5323027 1.6195791,-0.2126538 C 9.2126105,5.0708821 11.67437,4.0095 14.785441,5.5382202 17.009904,6.7924 17.27733,10.360371 13.864368,13.369134 c -1.679464,1.609494 -1.887868,4.226006 -1.825254,4.993295 -0.128246,1.561168 0.259655,1.837265 0.594912,1.938246 0.335257,0.100981 1.461445,-0.04379 1.305934,-1.000087 -0.193265,-1.461227 -0.06192,-2.413209 0.855267,-4.044829 0.758763,-1.162942 2.123721,-1.871086 3.273016,-4.211889 C 18.840748,9.1444158 18.891207,6.503336 17.479328,4.894053 16.152845,3.3821059 14.670099,2.4131656 12.422552,2.4210559 9.8716741,2.446853 8.13424,2.8374168 6.751418,3.5206351 4.5012489,4.730324 4.2973099,4.8714754 5.2462478,6.4309194 z\"\n     clip-rule=\"evenodd\"\n     sodipodi:nodetypes=\"cccccscccsccc\" />\n<path\n     style=\"fill-rule:evenodd\"\n     inkscape:connector-curvature=\"0\"\n     id=\"path7\"\n     d=\"M 10.393116,10.546893 C 10.179036,9.8582024 9.6418168,9.5037588 9.1268128,9.5037588 c -0.686671,0 -1.6386388,0.1373222 -1.6546508,1.5832442 0,0 0.5308711,2.944458 1.5235151,2.93234 0.364542,-0.004 0.7403587,-0.28287 0.017892,-1.856769 0,0 -0.4395592,-0.974022 -0.1380497,-1.193301 0.5440269,-0.394487 0.5911749,0.418754 0.9156116,1.069105 0.674692,0.328471 1.06244,-0.702948 1.201092,-0.722298 1.026124,-0.142524 -0.130551,1.372622 -0.2386,1.539241 -0.467844,0.515308 -1.3020963,1.251877 -0.614252,1.612091 0.864686,0.205725 1.292561,-0.492065 1.464229,-0.658684 0.2663,-0.37565 0.549622,-0.820112 0.721289,-1.133153 0.877971,-1.468145 0.834305,-2.8722146 -0.558429,-2.9011876 -0.515004,0 -0.814918,0.2302366 -1.373344,0.7725056 z\"\n     clip-rule=\"evenodd\"\n     sodipodi:nodetypes=\"cscccccccccccc\" />\n<path\n     sodipodi:nodetypes=\"cssccsccccssccssc\"\n     style=\"fill-rule:evenodd\"\n     inkscape:connector-curvature=\"0\"\n     id=\"path9\"\n     d=\"m 6.8360046,14.735541 c -0.2526865,-0.134842 -0.341246,-0.148685 -0.556785,-0.125105 -0.4758127,0.05205 -0.712045,0.475393 -0.6165306,0.901178 0.2727696,1.215955 1.0359093,1.641989 2.25985,2.132257 1.2530682,0.41756 2.475738,0.396638 3.398493,-0.0757 0.298412,-0.05064 0.287556,-0.683612 0.292618,-1.034981 0.006,-0.414484 -0.327129,-0.528727 -0.651454,-0.493243 -0.82369,0.222079 -0.891361,0.338578 -1.882259,0.248554 -1.1996954,-0.369888 -1.6284239,-0.589257 -2.2439324,-1.55296 z m -0.596727,2.884244 c -0.1641271,-0.121 -0.2921232,-0.08347 -0.442594,-0.06701 -0.3893935,0.0426 -0.727761,0.382603 -0.6463412,0.81143 0.2795655,1.472433 3.2776659,2.179707 4.6014193,2.113323 1.0831623,-0.05044 1.6865703,-0.273231 1.7646093,-1.16247 -0.03364,-0.366114 -0.266964,-0.659232 -0.720411,-0.609623 -0.432095,0.04727 -0.373883,0.118182 -1.0438868,0.191485 C 8.563559,19.026954 7.5842504,18.723225 6.2392776,17.619785 z\"\n     clip-rule=\"evenodd\" />\n"}),define("text!templates/svg/xmpp.html",[],function(){return"<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 17.765357,5.9248618 c 0.009,0.1518861 -0.206601,0.1119764 -0.206601,0.2652514 0,4.4595198 -5.17314,11.2012628 -10.3933633,12.5152538 v 0.136731 C 14.101125,18.204712 21.825325,11.114777 22,4.2839629 l -4.233831,1.6413619 z\"\n     id=\"path4-5\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 15.907561,6.3610856 c 0.009,0.1518861 0.014,0.3045804 0.014,0.4578554 0,4.459522 -3.55133,10.468554 -8.7715528,11.783009 v 0.189367 C 13.982554,18.349079 19.389945,11.500913 19.389945,6.1592263 c 0,-0.2747361 -0.01446,-0.5470438 -0.04292,-0.8162264 l -3.439122,1.017508 z\"\n     id=\"path6\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 6.2332547,5.9248618 c -0.00886,0.1518861 0.2067174,0.1119764 0.2067174,0.2652514 0,4.4595198 5.3857609,11.2631498 10.6063279,12.5777208 V 18.95743 C 10.11103,18.318886 2.1746761,11.11443 2,4.2836157 l 4.2337177,1.6413618 z\"\n     id=\"path8\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"M 8.3307389,6.473525 C 8.3219828,6.6254111 8.31686,6.7777591 8.31686,6.9312646 c 0,4.4595214 3.551213,10.4685544 8.771549,11.7830104 v 0.189596 C 10.258286,18.581129 4.8484667,11.613351 4.8484667,6.2717814 c 0,-0.2747361 0.014805,-0.5470427 0.042915,-0.8162284 l 3.4391228,1.0177415 z\"\n     id=\"path10\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 4.8583007,5.3920472 0.8811221,0.3148763 c -0.00473,0.111283 -0.00765,0.2607395 -0.00765,0.3730642 0,4.7681513 4.3114542,11.3600893 10.0954942,12.3914783 0.375377,0.125857 0.871982,0.240263 1.264595,0.339052 V 19 C 9.5433961,18.356828 4.2400023,10.686651 4.857725,5.3915852 z\"\n     id=\"path12\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 19.390639,5.2968432 -0.906108,0.3036565 c 0.0047,0.1113977 0.02208,0.2548387 0.02208,0.3670476 0,4.7681497 -4.311569,11.3602047 -10.0957226,12.3914777 -0.3751445,0.125972 -0.8719856,0.240267 -1.2643666,0.33917 v 0.189596 C 15.052467,17.886018 20.00767,10.591448 19.389946,5.2967275 z\"\n     id=\"path14\" />\n"}),define("text!templates/svg/ic-at.html",[],function(){return"<path fill=\"#9E9E9E\" d=\"M12,15C12.81,15 13.5,14.7 14.11,14.11C14.7,13.5 15,12.81 15,12C15,11.19 14.7,10.5 14.11,9.89C13.5,9.3 12.81,9 12,9C11.19,9 10.5,9.3 9.89,9.89C9.3,10.5 9,11.19 9,12C9,12.81 9.3,13.5 9.89,14.11C10.5,14.7 11.19,15 12,15M12,2C14.75,2 17.1,3 19.05,4.95C21,6.9 22,9.25 22,12V13.45C22,14.45 21.65,15.3 21,16C20.3,16.67 19.5,17 18.5,17C17.3,17 16.31,16.5 15.56,15.5C14.56,16.5 13.38,17 12,17C10.63,17 9.45,16.5 8.46,15.54C7.5,14.55 7,13.38 7,12C7,10.63 7.5,9.45 8.46,8.46C9.45,7.5 10.63,7 12,7C13.38,7 14.55,7.5 15.54,8.46C16.5,9.45 17,10.63 17,12V13.45C17,13.86 17.16,14.22 17.46,14.53C17.76,14.84 18.11,15 18.5,15C18.92,15 19.27,14.84 19.57,14.53C19.87,14.22 20,13.86 20,13.45V12C20,9.81 19.23,7.93 17.65,6.35C16.07,4.77 14.19,4 12,4C9.81,4 7.93,4.77 6.35,6.35C4.77,7.93 4,9.81 4,12C4,14.19 4.77,16.07 6.35,17.65C7.93,19.23 9.81,20 12,20H17V22H12C9.25,22 6.9,21 4.95,19.05C3,17.1 2,14.75 2,12C2,9.25 3,6.9 4.95,4.95C6.9,3 9.25,2 12,2Z\" />"}),define("text!templates/svg/ic-searching.html",[],function(){return"<path fill=\"#9E9E9E\" d=\"M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M19.35,8.03C21.95,8.22 24,10.36 24,13C24,14.64 23.21,16.1 22,17V16.5A6.5,6.5 0 0,0 15.5,10A6.5,6.5 0 0,0 9,16.5C9,17 9.06,17.5 9.17,18H6A6,6 0 0,1 0,12C0,8.9 2.34,6.36 5.35,6.03C6.6,3.64 9.11,2 12,2C15.64,2 18.67,4.59 19.35,8.03Z\" />"}),define("text!templates/svg/volume-off-variant.html",[],function(){return"<g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <g id=\"Mobile-Portrait\" transform=\"translate(-41.000000, -4.000000)\">\n        <g id=\"volume-off-variant\" transform=\"translate(34.000000, 0.000000)\">\n            <rect id=\"Bounds\" x=\"0\" y=\"0\" width=\"24\" height=\"24\"></rect>\n            <polygon id=\"Path-2\" points=\"7 9 7 15 11 15 16 20 16 16.5 8.5 9\"></polygon>\n            <polygon id=\"Path-3\" points=\"7 6 18.5 17.5 19.5 16.5 16 13 16 4 11.5 8.5 8 5\"></polygon>\n        </g>\n    </g>\n</g>\n"}),define("text!templates/svg/message-group.html",[],function(){return"<g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <g id=\"message-group-variant2\" fill=\"#000000\">\n        <path d=\"M14.2526206,6 L21.4947588,6 C22.3260806,6 23,6.6752491 23,7.49824524 L23,24 L19,20 L8.50524116,20 C7.67391942,20 7,19.3247509 7,18.5017548 L7,17 L17.0005775,17 C18.6556493,17 20,15.6542582 20,13.9942017 L20,6 L14.2526206,6 Z\" id=\"Message2\"></path>\n        <path d=\"M1,2.49824524 C1,1.67078724 1.66642015,1 2.50863659,1 L16.4913634,1 C17.3245604,1 18,1.6752491 18,2.49824524 L18,13.5017548 C18,14.3292128 17.3335799,15 16.4913634,15 L5,15 L1,19 L1,2.49824524 Z M4,10 L4,12 L12,12 L12,10 L4,10 Z M4,7 L4,9 L15,9 L15,7 L4,7 Z M4,4 L4,6 L15,6 L15,4 L4,4 Z\" id=\"Combined-Shape\"></path>\n    </g>\n</g>\n"}),define("text!templates/svg/xabber-offline.html",[],function(){return"<g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <g id=\"Xabber-Offline\" fill=\"#000000\">\n        <path d=\"M13.4146471,22.5 L14.009222,22.5 C14.5490248,22.5 15,22.0522847 15,21.5 C15,20.9438648 14.5564136,20.5 14.009222,20.5 L9.99077797,20.5 C9.45097518,20.5 9,20.9477153 9,21.5 C9,22.0561352 9.44358641,22.5 9.99077797,22.5 L10.5853529,22.5 C10.7912711,23.0825962 11.3468906,23.5 12,23.5 C12.6531094,23.5 13.2087289,23.0825962 13.4146471,22.5 Z\" id=\"Base\"></path>\n        <rect id=\"Middle-base\" x=\"8\" y=\"17.75\" width=\"8\" height=\"2\" rx=\"1\"></rect>\n        <path d=\"M17.5099945,14.8015103 L17.5099945,14.8015103 C17.1966102,15.1049344 17.0013821,15.5296633 17,16 C17,16.5522847 16.5443356,17 16.0046024,17 L7.99539757,17 C7.44565467,17 7,16.5561352 6.99998649,16 C6.99861167,15.5296664 6.80338616,15.10494 6.49000549,14.8015163 L6.49000549,14.8000192 C4.95622884,13.3424727 4,11.282906 4,9 C4,4.581722 7.581722,1 12,1 C16.418278,1 20,4.581722 20,9 C20,11.282906 19.0437712,13.3424727 17.5099945,14.8000192 L17.5099945,14.8015103 Z M8.86088543,15 L15.1391084,15 C15.3021338,14.4253123 15.6014858,13.895093 16,13.472213 C17.2274987,12.3735719 18,10.7769996 18,9 C18,5.6862915 15.3137085,3 12,3 C8.6862915,3 6,5.6862915 6,9 C6,10.7769996 6.77250128,12.3735719 8,13.472213 C8.39851111,13.8950917 8.69786083,14.4253152 8.86088543,15 Z\" id=\"Bulb-shape\"></path>\n    </g>\n</g>\n"}),define("text!templates/svg/xabber-online.html",[],function(){return"<g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <g id=\"Xabber-Online\" fill=\"#000000\">\n        <path d=\"M13.4146471,22.5 L14.009222,22.5 C14.5490248,22.5 15,22.0522847 15,21.5 C15,20.9438648 14.5564136,20.5 14.009222,20.5 L9.99077797,20.5 C9.45097518,20.5 9,20.9477153 9,21.5 C9,22.0561352 9.44358641,22.5 9.99077797,22.5 L10.5853529,22.5 C10.7912711,23.0825962 11.3468906,23.5 12,23.5 C12.6531094,23.5 13.2087289,23.0825962 13.4146471,22.5 Z\" id=\"Base\"></path>\n        <rect id=\"Middle-base\" x=\"8\" y=\"17.75\" width=\"8\" height=\"2\" rx=\"1\"></rect>\n        <path d=\"M17.5099945,14.8015103 L17.5099945,14.8000192 C19.0437712,13.3424727 20,11.282906 20,9 C20,4.581722 16.418278,1 12,1 C7.581722,1 4,4.581722 4,9 C4,11.282906 4.95622884,13.3424727 6.49000549,14.8000192 L6.49000549,14.8015163 C6.80338616,15.10494 6.99861167,15.5296664 6.99998649,16 C7,16.5561352 7.44565467,17 7.99539757,17 L16.0046024,17 C16.5443356,17 17,16.5522847 17,16 C17.0013821,15.5296633 17.1966102,15.1049344 17.5099945,14.8015103 L17.5099945,14.8015103 Z\" id=\"Bulb-shape\"></path>\n    </g>\n</g>\n"}),define("xabber-templates",["underscore","jquery","text!templates/base/dialog.html","text!templates/base/jingle_message_calling.html","text!templates/base/input_widget.html","text!templates/base/toolbar.html","text!templates/base/settings.html","text!templates/base/about.html","text!templates/api_service/xabber_login.html","text!templates/api_service/xabber_login_by_email.html","text!templates/api_service/xabber_account.html","text!templates/api_service/linked_email_item.html","text!templates/api_service/add_xabber_account.html","text!templates/api_service/sync_settings.html","text!templates/api_service/sync_settings_account_item.html","text!templates/accounts/xmpp_login.html","text!templates/accounts/add_account.html","text!templates/accounts/change_password.html","text!templates/accounts/toolbar_item.html","text!templates/accounts/settings_left.html","text!templates/accounts/settings_right.html","text!templates/accounts/existing_groupchat_item.html","text!templates/accounts/resource.html","text!templates/accounts/global_settings_item.html","text!templates/accounts/change_status.html","text!templates/accounts/token_item.html","text!templates/accounts/current_token_item.html","text!templates/vcard/vcard.html","text!templates/vcard/vcard_edit.html","text!templates/searching/searching_wide.html","text!templates/searching/searching_account_item.html","text!templates/searching/existing_groupchat_item.html","text!templates/searching/existing_groupchat_details_view.html","text!templates/contacts/roster_right.html","text!templates/contacts/roster_left.html","text!templates/contacts/account_roster_right.html","text!templates/contacts/account_roster_left.html","text!templates/contacts/roster_left.html","text!templates/contacts/group_right.html","text!templates/contacts/group_left.html","text!templates/contacts/add_contact.html","text!templates/contacts/contact_right_item.html","text!templates/contacts/contact_left_item.html","text!templates/contacts/contact_blocked_item.html","text!templates/contacts/contact_details.html","text!templates/contacts/roster_settings.html","text!templates/contacts/group_settings.html","text!templates/contacts/groups_checkbox_list.html","text!templates/contacts/add_contact_account_item.html","text!templates/contacts/contact_placeholder.html","text!templates/contacts/groups.html","text!templates/contacts/preloader.html","text!templates/contacts/group_chats/group_chat_properties.html","text!templates/contacts/group_chats/group_chat_details.html","text!templates/contacts/group_chats/invitation.html","text!templates/contacts/group_chats/group_chat_properties_edit.html","text!templates/contacts/group_chats/default_restrictions.html","text!templates/contacts/group_chats/group_member_item.html","text!templates/contacts/group_chats/invited_member_item.html","text!templates/contacts/group_chats/participant_rights.html","text!templates/contacts/group_chats/restriction_item.html","text!templates/contacts/group_chats/permission_item.html","text!templates/contacts/group_chats/right_expire_variants.html","text!templates/contacts/group_chats/pinned_message.html","text!templates/contacts/group_chats/participant_details_item.html","text!templates/contacts/group_chats/participant_placeholder.html","text!templates/contacts/group_chats/participants.html","text!templates/contacts/group_chats/badge_edit_view.html","text!templates/contacts/group_chats/private_participant_details.html","text!templates/chats/chats_panel.html","text!templates/chats/add_chat_account_item.html","text!templates/chats/chat_item.html","text!templates/chats/chat_head.html","text!templates/chats/chat_content.html","text!templates/chats/chat_bottom.html","text!templates/chats/forward_panel.html","text!templates/chats/chat_placeholder.html","text!templates/chats/message_item.html","text!templates/chats/messages/main.html","text!templates/chats/messages/forwarded.html","text!templates/chats/messages/system.html","text!templates/chats/messages/file_upload.html","text!templates/chats/messages/file.html","text!templates/chats/messages/audio_file.html","text!templates/chats/messages/audio_file_waveform.html","text!templates/chats/messages/auth_request.html","text!templates/chats/messages/group_request.html","text!templates/chats/messages/template-for-2.html","text!templates/chats/messages/template-for-3.html","text!templates/chats/messages/template-for-4.html","text!templates/chats/messages/template-for-5.html","text!templates/chats/messages/template-for-6.html","text!templates/chats/archive_placeholder.html","text!templates/chats/group_chats/pinned_message_panel.html","text!templates/chats/group_chats/add_group_chat.html","text!templates/chats/group_chats/invitation_panel_view.html","text!templates/chats/group_chats/mention_item.html","text!templates/mentions/mentions_panel.html","text!templates/mentions/mentions_placeholder.html","text!templates/mentions/mention_item.html","text!templates/svg/ic-jabber.html","text!templates/svg/xmpp.html","text!templates/svg/ic-at.html","text!templates/svg/ic-searching.html","text!templates/svg/volume-off-variant.html","text!templates/svg/message-group.html","text!templates/svg/xabber-offline.html","text!templates/svg/xabber-online.html"],function(e,t){e.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g};var a={},i=function(e){var i=t("<div/>").html(e);return i.find(".mdi-svg-template").each(function(){var e=t(this),i=e.data("svgname");e.removeClass("mdi-svg-template").addClass("mdi-"+i).attr("data-svgname",null),e.html(a.svg[i]())}),i.html()},n=function(t,n){n||(n={});var s=t.split("."),o=e.template(require("text!templates/"+s.join("/")+".html")),d=s.pop(),r=a;e.each(s,function(e){r[e]||(r[e]={}),r=r[e]}),r[d]=n.is_svg?o:function(e){return i(o(e))}},s=function(e){n(e,{is_svg:!1})},o=function(e){n(e,{is_svg:!0})};return s("base.dialog"),s("base.jingle_message_calling"),s("base.input_widget"),s("base.toolbar"),s("base.settings"),s("base.about"),s("api_service.xabber_login"),s("api_service.xabber_login_by_email"),s("api_service.add_xabber_account"),s("api_service.xabber_account"),s("api_service.linked_email_item"),s("api_service.sync_settings"),s("api_service.sync_settings_account_item"),s("accounts.xmpp_login"),s("accounts.add_account"),s("accounts.change_password"),s("accounts.toolbar_item"),s("accounts.settings_left"),s("accounts.settings_right"),s("accounts.existing_groupchat_item"),s("accounts.resource"),s("accounts.global_settings_item"),s("accounts.change_status"),s("accounts.token_item"),s("accounts.current_token_item"),s("vcard.vcard"),s("vcard.vcard_edit"),s("searching.searching_wide"),s("searching.searching_account_item"),s("searching.existing_groupchat_item"),s("searching.existing_groupchat_details_view"),s("contacts.roster_right"),s("contacts.roster_left"),s("contacts.account_roster_right"),s("contacts.account_roster_left"),s("contacts.group_right"),s("contacts.group_left"),s("contacts.add_contact"),s("contacts.contact_right_item"),s("contacts.contact_left_item"),s("contacts.contact_blocked_item"),s("contacts.contact_details"),s("contacts.roster_settings"),s("contacts.group_settings"),s("contacts.groups_checkbox_list"),s("contacts.add_contact_account_item"),s("contacts.contact_placeholder"),s("contacts.groups"),s("contacts.preloader"),s("contacts.group_chats.group_chat_properties"),s("contacts.group_chats.group_chat_details"),s("contacts.group_chats.invitation"),s("contacts.group_chats.group_chat_properties_edit"),s("contacts.group_chats.default_restrictions"),s("contacts.group_chats.group_member_item"),s("contacts.group_chats.invited_member_item"),s("contacts.group_chats.participant_rights"),s("contacts.group_chats.restriction_item"),s("contacts.group_chats.permission_item"),s("contacts.group_chats.right_expire_variants"),s("contacts.group_chats.pinned_message"),s("contacts.group_chats.participant_details_item"),s("contacts.group_chats.participant_placeholder"),s("contacts.group_chats.participants"),s("contacts.group_chats.badge_edit_view"),s("contacts.group_chats.private_participant_details"),s("chats.chats_panel"),s("chats.add_chat_account_item"),s("chats.chat_item"),s("chats.chat_head"),s("chats.chat_content"),s("chats.chat_bottom"),s("chats.forward_panel"),s("chats.chat_placeholder"),s("chats.message_item"),s("chats.messages.main"),s("chats.messages.forwarded"),s("chats.messages.system"),s("chats.messages.file_upload"),s("chats.messages.file"),s("chats.messages.audio_file"),s("chats.messages.audio_file_waveform"),s("chats.messages.auth_request"),s("chats.messages.group_request"),s("chats.messages.template-for-2"),s("chats.messages.template-for-3"),s("chats.messages.template-for-4"),s("chats.messages.template-for-5"),s("chats.messages.template-for-6"),s("chats.archive_placeholder"),s("chats.group_chats.pinned_message_panel"),s("chats.group_chats.add_group_chat"),s("chats.group_chats.invitation_panel_view"),s("chats.group_chats.mention_item"),s("mentions.mentions_panel"),s("mentions.mentions_placeholder"),s("mentions.mention_item"),o("svg.ic-jabber"),o("svg.xmpp"),o("svg.ic-at"),o("svg.ic-searching"),o("svg.volume-off-variant"),o("svg.message-group"),o("svg.xabber-offline"),o("svg.xabber-online"),a}),define("xabber-emoji-utils",["jquery","underscore"],function(e,t){var a=String.prototype,i=String.fromCharCode,n=[{code:128516,x:0,y:0},{code:128515,x:1,y:0},{code:128512,x:2,y:0},{code:128522,x:3,y:0},{code:9786,x:4,y:0},{code:128521,x:5,y:0},{code:128525,x:6,y:0},{code:128536,x:7,y:0},{code:128538,x:8,y:0},{code:128535,x:9,y:0},{code:128537,x:10,y:0},{code:128540,x:11,y:0},{code:128541,x:12,y:0},{code:128539,x:13,y:0},{code:128563,x:14,y:0},{code:128513,x:15,y:0},{code:128532,x:16,y:0},{code:128524,x:17,y:0},{code:128530,x:18,y:0},{code:128542,x:19,y:0},{code:128547,x:20,y:0},{code:128546,x:21,y:0},{code:128514,x:22,y:0},{code:128557,x:23,y:0},{code:128554,x:24,y:0},{code:128549,x:25,y:0},{code:128560,x:26,y:0},{code:128517,x:0,y:1},{code:128531,x:1,y:1},{code:128553,x:2,y:1},{code:128555,x:3,y:1},{code:128552,x:4,y:1},{code:128561,x:5,y:1},{code:128544,x:6,y:1},{code:128545,x:7,y:1},{code:128548,x:8,y:1},{code:128534,x:9,y:1},{code:128518,x:10,y:1},{code:128523,x:11,y:1},{code:128567,x:12,y:1},{code:128526,x:13,y:1},{code:128564,x:14,y:1},{code:128565,x:15,y:1},{code:128562,x:16,y:1},{code:128543,x:17,y:1},{code:128550,x:18,y:1},{code:128551,x:19,y:1},{code:128520,x:20,y:1},{code:128127,x:21,y:1},{code:128558,x:22,y:1},{code:128556,x:23,y:1},{code:128528,x:24,y:1},{code:128533,x:25,y:1},{code:128559,x:26,y:1},{code:128566,x:0,y:2},{code:128519,x:1,y:2},{code:128527,x:2,y:2},{code:128529,x:3,y:2},{code:128114,x:4,y:2},{code:128115,x:5,y:2},{code:128110,x:6,y:2},{code:128119,x:7,y:2},{code:128130,x:8,y:2},{code:128118,x:9,y:2},{code:128102,x:10,y:2},{code:128103,x:11,y:2},{code:128104,x:12,y:2},{code:128105,x:13,y:2},{code:128116,x:14,y:2},{code:128117,x:15,y:2},{code:128113,x:16,y:2},{code:128124,x:17,y:2},{code:128120,x:18,y:2},{code:128570,x:19,y:2},{code:128568,x:20,y:2},{code:128571,x:21,y:2},{code:128573,x:22,y:2},{code:128572,x:23,y:2},{code:128576,x:24,y:2},{code:128575,x:25,y:2},{code:128569,x:26,y:2},{code:128574,x:0,y:3},{code:128121,x:1,y:3},{code:128122,x:2,y:3},{code:128584,x:3,y:3},{code:128585,x:4,y:3},{code:128586,x:5,y:3},{code:128128,x:6,y:3},{code:128125,x:7,y:3},{code:128169,x:8,y:3},{code:128293,x:9,y:3},{code:10024,x:10,y:3},{code:127775,x:11,y:3},{code:128171,x:12,y:3},{code:128165,x:13,y:3},{code:128162,x:14,y:3},{code:128166,x:15,y:3},{code:128167,x:16,y:3},{code:128164,x:17,y:3},{code:128168,x:18,y:3},{code:128066,x:19,y:3},{code:128064,x:20,y:3},{code:128067,x:21,y:3},{code:128069,x:22,y:3},{code:128068,x:23,y:3},{code:128077,x:24,y:3},{code:128078,x:25,y:3},{code:128076,x:26,y:3},{code:128074,x:0,y:4},{code:9994,x:1,y:4},{code:9996,x:2,y:4},{code:128075,x:3,y:4},{code:9995,x:4,y:4},{code:128080,x:5,y:4},{code:128070,x:6,y:4},{code:128071,x:7,y:4},{code:128073,x:8,y:4},{code:128072,x:9,y:4},{code:128588,x:10,y:4},{code:128591,x:11,y:4},{code:9757,x:12,y:4},{code:128079,x:13,y:4},{code:128170,x:14,y:4},{code:128694,x:15,y:4},{code:127939,x:16,y:4},{code:128131,x:17,y:4},{code:128107,x:18,y:4},{code:128106,x:19,y:4},{code:128108,x:20,y:4},{code:128109,x:21,y:4},{code:128143,x:22,y:4},{code:128145,x:23,y:4},{code:128111,x:24,y:4},{code:128582,x:25,y:4},{code:128581,x:26,y:4},{code:128129,x:0,y:5},{code:128587,x:1,y:5},{code:128134,x:2,y:5},{code:128135,x:3,y:5},{code:128133,x:4,y:5},{code:128112,x:5,y:5},{code:128590,x:6,y:5},{code:128589,x:7,y:5},{code:128583,x:8,y:5},{code:127913,x:9,y:5},{code:128081,x:10,y:5},{code:128082,x:11,y:5},{code:128095,x:12,y:5},{code:128094,x:13,y:5},{code:128097,x:14,y:5},{code:128096,x:15,y:5},{code:128098,x:16,y:5},{code:128085,x:17,y:5},{code:128084,x:18,y:5},{code:128090,x:19,y:5},{code:128087,x:20,y:5},{code:127933,x:21,y:5},{code:128086,x:22,y:5},{code:128088,x:23,y:5},{code:128089,x:24,y:5},{code:128188,x:25,y:5},{code:128092,x:26,y:5},{code:128093,x:0,y:6},{code:128091,x:1,y:6},{code:128083,x:2,y:6},{code:127872,x:3,y:6},{code:127746,x:4,y:6},{code:128132,x:5,y:6},{code:128155,x:6,y:6},{code:128153,x:7,y:6},{code:128156,x:8,y:6},{code:128154,x:9,y:6},{code:10084,x:10,y:6},{code:128148,x:11,y:6},{code:128151,x:12,y:6},{code:128147,x:13,y:6},{code:128149,x:14,y:6},{code:128150,x:15,y:6},{code:128158,x:16,y:6},{code:128152,x:17,y:6},{code:128140,x:18,y:6},{code:128139,x:19,y:6},{code:128141,x:20,y:6},{code:128142,x:21,y:6},{code:128100,x:22,y:6},{code:128101,x:23,y:6},{code:128172,x:24,y:6},{code:128099,x:25,y:6},{code:128173,x:26,y:6}],s=function(e){if(65536>e)return i(e);var t=e-65536;return i(55296+(t>>10))+i(56320+(1023&t))},o={},d=[];t.each(n,function(e){var t=s(e.code);o[t]=e,d.push(t)});var r=function(e){return i(e)},c=["["+r(9728)+"-"+r(10239)+"]",r(55356)+"["+r(57088)+"-"+r(57343)+"]",r(55357)+"["+r(56320)+"-"+r(56911)+"]",r(55357)+"["+r(56960)+"-"+r(57087)+"]"],l=new RegExp(c.join("|"),"g");return a.emojify=function(e){e||(e={});var t=e.tag_name||"span",a="img"===t?" src=\"images/emoji/blank.gif\"":"",i=e.emoji_size||18;return this.replace(l,function(e){var n=o[e];return n?"<"+t+a+" class=\"emoji emoji-w"+i+" emoji-spritesheet-0\" alt=\""+e+"\" style=\"background-position: -"+i*n.x+"px -"+i*n.y+"px;\" data-emoji=\""+e+"\"/>":e})},a.removeEmoji=function(){return this.replace(l,function(e){var t=o[e];return t?"":e})},a.replaceEmoji=function(){return this.replace(l,function(e){var t=o[e];return t?" ":e})},e.fn.emojify=function(t,a){return this.find(t).each(function(){var t=e(this).html();e(this).html(t.emojify(a))}),this},{all:d,get:s,getByIndex:function(e){return s(n[e].code)}}}),define("xabber-image-utils",["xabber-dependencies"],function(e){var t=Math.floor,a=e._,i=e.$,n=e.SHA1.b64_sha1,s={},o=["#1abc9c","#16a085","#f1c40f","#f39c12","#2ecc71","#27ae60","#e67e22","#d35400","#3498db","#2980b9","#e74c3c","#c0392b","#9b59b6","#8e44ad","#bdc3c7","#34495e","#2c3e50","#95a5a6","#7f8c8d","#ec87bf","#d870ad","#f69785","#9ba37e","#b49255","#a94136"],d=function(e,t,a){t=t||"",a=a||512;for(var n=atob(e),s=[],o=0;o<n.length;o+=a){for(var d=n.slice(o,o+a),r=Array(d.length),c=0;c<d.length;c++)r[c]=d.charCodeAt(c);var l=new Uint8Array(r);s.push(l)}var p=new Blob(s,{type:t});return p},r=function(e){return this.url=window.URL.createObjectURL(d(e)),s[e]=this,this},c=function(e){return e instanceof r?e:s[e]||new r(e)},l=function(e){var a=e?e.trim():"",i=t(n(a).charCodeAt(0)%o.length);return o[i]},p=function(e,t){return e.width>e.height?e.width>t&&(e.height*=t/e.width,e.width=t):e.height>t&&(e.width*=t/e.height,e.height=t),e},u=function(e,t){var a=i(e),n={backgroundImage:"url(\""+t.url+"\")",backgroundSize:"cover",backgroundColor:"#FFF"};a.css(n)};return i.fn.setAvatar=function(e,t){var a=c(e);u(this,a,t)},{getCachedImage:c,getBlobImage:d,getDefaultAvatar:function(e){var t=document.createElement("canvas"),a=t.getContext("2d"),i=e?e.trim():"",n=i.split(" ",2),s,o,d,r;s=n[0],o=1<n.length?n[1]:"",d=s[0]||"",r=o?o[0]:1<s.length?s[1]:"",t.width=256,t.height=256,a.rect(0,0,256,256),a.fillStyle=l(e),a.fill(),a.font="bold 100px sans-serif",a.fillStyle="#FFF",a.textAlign="center",a.fillText(d.toUpperCase()+r.toUpperCase(),128,160);var c=t.toDataURL().replace(/^data:image\/(png|jpg|jpeg);base64,/,"");return c},getAvatarFromFile:function(e){var t=new Image,a=window.URL.createObjectURL(e),n=new i.Deferred;return t.onload=function(){t.onload=null;var e=document.createElement("canvas"),i=e.getContext("2d"),s=t.naturalWidth,o=t.naturalHeight,d=p({width:s,height:o},256),r,c;e.width=d.width,e.height=d.height,i.drawImage(t,0,0,e.width,e.height),r=e.toDataURL("image/jpeg").replace(/^data:image\/(png|jpg|jpeg);base64,/,""),window.URL.revokeObjectURL(a),e.toBlob(e=>{var t=new FileReader;t.onload=function(){r=t.result.replace(/^data:image\/(png|jpg|jpeg);base64,/,"");let e=atob(r),a=new Uint8Array(e.length);for(let t=0;t<e.length;t++)a[t]=e.charCodeAt(t);c=sha1(a),n.resolve(r,c,e.length)}.bind(this),t.readAsDataURL(e)},"image/jpeg",.8)},t.onerror=function(){t.onerror=null,window.URL.revokeObjectURL(a),n.resolve(!1,!1,!1)},t.src=a,n.promise()},getDefaultColor:l,compressImage:function(e){var t=new Image,a=window.URL.createObjectURL(e),n=new i.Deferred;return t.onload=function(){t.onload=null;var i=document.createElement("canvas"),s=i.getContext("2d"),o=t.naturalWidth,d=t.naturalHeight,r=e.type,c=e.name,l=p({width:o,height:d},1280);i.width=l.width,i.height=l.height,s.drawImage(t,0,0,l.width,l.height),i.toBlob(e=>{const t=new File([e],c,{type:r,lastModified:Date.now()});n.resolve(t)},r,.8),window.URL.revokeObjectURL(a)},t.onerror=function(){t.onerror=null,window.URL.revokeObjectURL(a),n.resolve(!1)},t.src=a,n.promise()}}}),define("xabber-modal-utils",["xabber-dependencies","xabber-templates"],function(e,t){var a=e._,i=e.$,n=i("<div>").attr("id","modals").appendTo("body"),s=[],o=function(e,t){this.$modal=e instanceof Function?i(e()):i(e),this.options=t||{},this.closed=new i.Deferred};return a.extend(o.prototype,{open:function(){return this.options.use_queue?(s.push(this),1===s.length&&this.throw()):this.throw(),document.addEventListener("keyup",this.clickHandler.bind(this)),this.closed.promise()},throw:function(){this.$modal.appendTo(n).prop("modal",this);var e=a.omit(this.options,["use_queue"]);a.extend(e,{is_default_complete:!0,complete_data:null}),this.options.use_queue&&this.$modal.one("modal_close",function(e,t){this.$modal.detach(),this.closed.resolve(t.value),s.shift(),s.length&&s[0].throw()}.bind(this)),this.$modal._openModal(e)},close:function(e){var t=a.omit(e,["use_queue","is_default_complete","complete_data"]);a.extend(t,{complete:function(){if(this.options.use_queue){var t=a.isUndefined(e.complete_data)?null:e.complete_data;this.complete(t)}e.is_default_complete?"function"==typeof this.options.complete&&this.options.complete():(this.options.use_queue&&this.complete(),"function"==typeof e.complete&&e.complete())}.bind(this)}),this.$modal.prop("modal",null),this.$modal._closeModal(t)},complete:function(e){document.removeEventListener("keyup",this.clickHandler),this.$modal.trigger("modal_close",{value:e})},clickHandler:function(e){13===e.keyCode&&(this.$modal.find(".modal-footer button.ok-button").click(),e.preventDefault())}}),i.fn._openModal=i.fn.openModal,i.fn.openModal=function(e){var t=new o(this,e);return t.open()},i.fn._closeModal=i.fn.closeModal,i.fn.closeModal=function(e){var t=this.prop("modal");t?t.close(e):this._closeModal(e)},{Modal:o,dialogs:{common:function(e,n,s,d){var r=new o(function(){s||(s={}),d||(d=[]);var a=s.ok_button,i=s.cancel_button,o=(s.optional_buttons||[]).reverse();return a&&(a={text:a.text||"Ok"}),i&&(i={text:i.text||"Cancel"}),t.base.dialog({header:e,text:n,ok_button:a,cancel_button:i,optional_buttons:o,dialog_options:d})},{use_queue:!0});return d.blob_image_from_clipboard&&(r.$modal.find(".dialog-options-wrap").html(""),r.$modal.find(".img-from-clipboard").get(0).src=d.blob_image_from_clipboard,r.$modal.find(".container-for-img").removeClass("hidden")),(d.input_placeholder_value||d.input_value)&&r.$modal.find(".dialog-options-wrap").html(i("<input type=\"text\" placeholder=\""+d.input_placeholder_value+"\" id=\"user_value\"/>").val(d.input_value)),r.$modal.find(".modal-footer button").click(function(e){var t=i(e.target).data("option"),n=r.$modal.find(".dialog-option"),s=r.$modal.find("#user_value");if(t&&n.length){var o={};a.each(n,function(e){var t=i(e);o[t.data("name")]=t.find("input").prop("checked")}),r.close({complete_data:o})}else if(!s.length)r.close({complete_data:t});else if(i(e.target).hasClass("btn-cancel"))r.close({complete_data:!1});else if(i(e.target).hasClass("optional-button"))r.close({complete_data:t});else{var d=s.val();r.close({complete_data:d})}}),r.open()},warning:function(e,t){return this.common("Warning",e,{ok_button:!0},t)},error:function(e,t){return this.common("Error",e,{ok_button:!0},t)},ask:function(e,t,a,i){var n;return i&&(n=i.ok_button_text),this.common(e,t,{ok_button:{text:n},cancel_button:!0},a)},ask_enter_value:function(e,t,a,i){var n,s;return i&&(n=i.ok_button_text,s=!!i.resend_button_text&&[{value:i.resend_to,name:i.resend_button_text}]),this.common(e,t,{ok_button:{text:n},optional_buttons:s,cancel_button:!0},a)},notify:function(e,t){return this.common(e,t,{ok_button:!0})}}}}),define("xabber-textarea-utils",["xabber-dependencies"],function(e){var t=e._,a=e.$;return a.fn.placeCaretAtEnd=function(){if(!this.length)return this;var e=this[0];if(e.focus(),!t.isUndefined(window.getSelection)&&!t.isUndefined(document.createRange)){var a=document.createRange();a.selectNodeContents(e),a.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(a)}else if(!t.isUndefined(document.body.createTextRange)){var n=document.body.createTextRange();n.moveToElementText(e),n.collapse(!1),n.select()}return this},a.fn.updateRichTextarea=function(){var e=this.getTextFromRichTextarea();return e||this.html(""),this},a.fn.flushRichTextarea=function(){return this.html(""),this},a.fn.getTextFromRichTextarea=function(){var e=a("<div>").html(this.html());return e.find("p").each(function(){a(this).replaceWith(a(this).html()+"\n")}),e.find(".emoji").each(function(){a(this).replaceWith(a(this).data("emoji"))}),e.find("span").each(function(){a(this).replaceWith(a(this).html())}),e.find("div").each(function(){var e=a(this);e.find("br").remove();var t=e.html();e.replaceWith("\n"+t)}),e.text()},null}),define("xabber-utils",["xabber-dependencies","xabber-emoji-utils","xabber-image-utils","xabber-modal-utils","xabber-constants","xabber-textarea-utils"],function(e,t,a,i,n){var s=Math.trunc,o=Math.floor,d=e.$,r=e._,c=e.moment;d.fn.switchClass=function(e,t){return 1===arguments.length&&(t=!this.hasClass(e)),t?this.addClass(e):this.removeClass(e),this},d.fn.showIf=function(e){return this.switchClass("hidden",!e)},d.fn.hideIf=function(e){return this.switchClass("hidden",e)};var l=function(e){var t=0===e.indexOf("http://")||0===e.indexOf("https://")?"":"http://",a=encodeURI(decodeURI(e)).replace(/[!'()]/g,escape).replace(/\*/g,"%2A");return"<a target='_blank' class='msg-hyperlink' href='"+t+a+"'>"+e+"</a>"};d.fn.hyperlinkify=function(e){e||(e={});var t=e.selector?this.find(e.selector):this;return t.each(function(e,t){var a=d(t),n="",s=/(((ftp|http|https):\/\/)|(www\.))(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g;a[0].childNodes.forEach(function(t){let a=d(t),i=t.outerHTML;if("A"===t.tagName)return void(n+=i);else{"#text"===t.nodeName&&(i=r.escape(a.text()));let o=i&&i.match(s);if(!o)return void(n+=i);if(1===o.length&&o[0]===i)n+=l(i);else{for(e=0;e<o.length;e++)i=i.replace(o[e],l(o[e]));n+=i}}}.bind(this)),a.html(n)}),this};var p={uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),a="x"==e?t:8|3&t;return a.toString(16)})},utoa:function(e){return window.btoa(unescape(encodeURIComponent(e)))},atou:function(e){return decodeURIComponent(escape(window.atob(e)))},now:function(){return o(c.now()/1e3)},pretty_time:function(e){var t=e?c(e):c();return t.format("HH:mm:ss")},pretty_date:function(e){var t=e?c(e):c();return t.format("dddd, MMMM D, YYYY")},pretty_datetime:function(e){var t=e?c(e):c();return t.format("MMMM D, YYYY HH:mm:ss")},pretty_short_datetime:function(e){var t=e?c(e):c(),a=c(t).startOf("day"),i=c(t).startOf("year");return a.isSame(c().startOf("day"))?t.format("HH:mm:ss"):i.isSame(c().startOf("year"))?t.format("MMM D"):t.format("DD/MM/gg")},pretty_short_month_date:function(e){var t=e?c(e):c(),a=c(t).startOf("day"),i=c(t).startOf("year");return a.isSame(c().startOf("day"))?t.format("HH:mm:ss"):i.isSame(c().startOf("year"))?t.format("MMM D, YYYY HH:mm:ss"):t.format("DD/MM/gg, HH:mm:ss")},pretty_timedelta:function(e){return 60>e?"just now":3600>e?o(e/60)+" minutes ago":86400>e?o(e/3600)+" hours ago":o(e/86400)+" days ago"},file_type_icon:function(e){let t=p.pretty_file_type(e);return"image"===t?"mdi-image":"audio"===t?"mdi-music-note":"video"===t?"mdi-filmstrip":"document"===t?"mdi-file-document-box":"presentation"===t?"mdi-presentation":"archive"===t?"mdi-zip-box":"file"===t?"mdi-file":"pdf"===t?"mdi-file-pdf":"mdi-file"},pretty_file_type:function(e){return n.MIME_TYPES.image.includes(e)?"image":n.MIME_TYPES.audio.includes(e)?"audio":n.MIME_TYPES.video.includes(e)?"video":n.MIME_TYPES.document.includes(e)?"document":n.MIME_TYPES.pdf.includes(e)?"pdf":n.MIME_TYPES.presentation.includes(e)?"presentation":n.MIME_TYPES.archive.includes(e)?"archive":n.MIME_TYPES.table.includes(e)?"electronic table":"file"},pretty_file_type_with_article:function(e){let t=p.pretty_file_type(e);return"pdf"===t&&(t="document"),["a","e","i","o","u"].includes(t[0])?"an "+t:"a "+t},pretty_size:function(e){return e?1024>e?e+" B":1048576>e?(e/1024).toFixed(2)+" KB":1073741824>e?(e/1048576).toFixed(2)+" MB":(e/1073741824).toFixed(2)+" GB":""},pretty_last_seen:function(e){return 0<=e&&60>e?"last seen just now":60<e&&3600>e?"last seen "+s(e/60)+(120>e?" minute ago":" minutes ago"):3600<=e&&7200>e?"last seen hour ago":345600<=e?"last seen "+c().subtract(e,"seconds").format("LL"):"last seen "+c().subtract(e,"seconds").calendar().toLowerCase()},pretty_duration:function(e){return r.isUndefined(e)?void 0:10>e?"0:0"+e:60>e?"0:"+e:60<e?s(e/60)+":"+(10>e%60?"0"+e%60:e%60):void 0},pretty_name:function(e){return e?e[0].toUpperCase()+e.replace(/-/," ").substr(1).toLowerCase():""},slice_string:function(e,t,a){return a=r.isNumber(a)?a:[...e].length,e.length===[...e].length?e.slice(t,a):Array.from(e).slice(t,a).join("")},slice_pretty_body:function(t,a){t=t||"";let i=Array.from(e.Strophe.xmlescape(t));return a&&a.forEach(function(e){for(let t=e.start;t<=e.end;t++)i[t]=""}.bind(this)),e.Strophe.xmlunescape(i.join(""))},markupBodyMessage:function(t,a){let i=r.clone(t.attributes),n=i.mentions||[],s=i.markups||[],o=i.legacy_content||[],d=i.blockquotes||[],c=o.length?i.original_message:i.message,l=Array.from(e.Strophe.xmlescape(c));return a||(a="span"),n.concat(s).forEach(function(e){let t=e.start,i=e.end,n=e.markups||[],s="uri"!==e.type&&e.uri||"";if(n.length){let e="",a="";n.forEach(function(t){e="<"+t[0].toLowerCase()+">"+e,a+="</"+t[0].toLowerCase()+">"}.bind(this)),l[t]=e+l[t],l[i]+=a}else s?(l[t]="<"+a+" data-id=\""+(-1<s.lastIndexOf("?id=")?s.slice(s.lastIndexOf("?id=")+4):s)+"\" class=\"mention ground-color-100\">"+l[t],l[i]+="</"+a+">"):"uri"===e.type&&(l[t]="<a target=\"_blank\" class=\"msg-hyperlink\" href=\""+e.uri+"\">"+l[t],l[i]+="</a>")}.bind(this)),o.forEach(function(e){for(let t=e.start;t<=e.end;t++)l[t]=""}.bind(this)),d.forEach(function(e){for(let t=e.start;t<e.start+e.marker.length;t++)l[t]="";for(let t=e.start;t<e.end;t++)if("\n"===l[t]){for(let a=t+1;a<=t+e.marker.length;a++)l[a]="";t+=e.marker.length-1}l[e.start]="<div class=\"quote\">",l[e.end]+="</div>"}.bind(this)),l.join("")},copyTextToClipboard:function(e,t,a){window.navigator.clipboard&&window.navigator.clipboard.writeText(e).then(function(){if(t){this.callback_popup_message(t,1500)}}.bind(this),function(){if(a){this.callback_popup_message(a,1500)}}.bind(this))},callback_popup_message:function(e,t){let a=d(document.body),i=d("<div class=\"callback-popup-message\"/>").text(e);a.find(".callback-popup-message").remove(),a.append(i),setTimeout(function(){i.remove()},t)},openWindow:function(e,t){let a=window.open(e,"_blank");a?a.focus():t&&t()},clearSelection:function(){var e=window.getSelection();e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges()},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}},emoji:t,images:a,modals:i,dialogs:i.dialogs};return p}),define("xabber-version",[],function(){return JSON.parse("{\"version_number\":\"1.0.171\",\"version_description\":\"\"}")}),define("xabber-environment",["xabber-dependencies","xabber-constants","xabber-templates","xabber-utils","xabber-version"],function(e,t,a,i,n){return _.extend({constants:t,templates:a,utils:i,uuid:i.uuid},n,e)}),function(e,t){define("xabber-core",["xabber-environment"],function(e){return t(e)})}(this,function(e){var t=e.constants,a=e._,i=e.$,n=e.uuid,s=e.utils,o=Backbone.Model.extend({defaults:{version_number:e.version_number,actual_version_number:e.version_number,client_id:n().substring(0,8),client_name:"Xabber for Web "+e.version_number},initialize:function(){this.env=e,this.fetchURLParams(),this.cleanUpStorage(),this._settings=new this.Settings({id:"settings"},{storage_name:this.getStorageName(),fetch:"before"}),this.settings=this._settings.attributes,this._cache=new Backbone.ModelWithStorage({id:"cache"},{storage_name:this.getStorageName(),fetch:"before"}),this.cache=this._cache.attributes,this.check_config=new i.Deferred,this.on("change:actual_version_number",this.throwNewVersion,this),this.on("quit",this.onQuit,this),this._version_interval=setInterval(this.readActualVersion.bind(this),6e5)},error:function(e){t.LOG_LEVEL>=t.LOG_LEVEL_ERROR&&console.error(e)},warn:function(e){t.LOG_LEVEL>=t.LOG_LEVEL_WARN&&console.warn(e)},info:function(e){t.LOG_LEVEL>=t.LOG_LEVEL_INFO&&console.log(e)},debug:function(e){t.LOG_LEVEL>=t.LOG_LEVEL_DEBUG&&console.log(e)},readActualVersion:function(){var e=new XMLHttpRequest;e.open("GET","version.js?"+n(),!0),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){e.onreadystatechange=null;try{var t=e.responseText,a=JSON.parse(t.split("\n")[1].slice(1,-1))}catch(t){return}this.set({actual_version_number:a.version_number,version_description:a.version_description})}}.bind(this),e.send()},onQuit:function(){window.localStorage.clear()},throwNewVersion:function(){if(t.CHECK_VERSION){var e=this.get("actual_version_number"),a=this.get("version_description");s.dialogs.common("Update Xabber Web","New version "+e+" is available. <div class=\"new-version-description\">"+a+"</div> Reload page to fetch this changes?",{ok_button:{text:"yes"},cancel_button:{text:"not now"}}).done(function(e){e&&window.location.reload(!0)})}},Settings:Backbone.ModelWithStorage.extend({defaults:{max_connection_retries:-1,notifications:!0,message_preview:!1,sound:!0,sound_on_message:"beep_up",sound_on_auth_request:"beep_a",hotkeys:"enter",load_history:!0,mam_requests_limit:200,mam_messages_limit_start:1,mam_messages_limit:20,ping_interval:60,reconnect_interval:120}}),start:function(){this.check_config.done(function(e){this.check_config=void 0,e&&this.trigger("start")}.bind(this))},configure:function(i){a.extend(t,a.pick(i,["CONNECTION_URL","XMPP_SERVER_GROUPCHATS","PERSONAL_AREA_URL","LOG_LEVEL","DEBUG","XABBER_ACCOUNT_URL","API_SERVICE_URL","USE_SOCIAL_AUTH","CHECK_VERSION","DEFAULT_LOGIN_SCREEN","STORAGE_NAME_ENDING","DISABLE_LOOKUP_WS"]));var n=t["LOG_LEVEL_"+t.LOG_LEVEL];if(t.LOG_LEVEL=n||t.LOG_LEVEL_ERROR,t.DEBUG&&(window.xabber=this,a.extend(window,e)),s.isMobile.any()){var o;return o=s.isMobile.iOS()?"Sorry, but Xabber for Web does not support iOS browsers. Go to <a href=\"www.xabber.com\">Xabber site</a> for more details.":s.isMobile.Android()?"Sorry, but Xabber for Web may not work correctly on your device. You should use Xabber for Android client.":"Sorry, but Xabber for Web may not work correctly on your device. Go to <a href=\"www.xabber.com\">Xabber site</a> for more details.",s.dialogs.error(o),void this.check_config.resolve(!1)}if(!t.CONNECTION_URL)return s.dialogs.error("Missing connection URL!"),void this.check_config.resolve(!1);var d=this;Backbone.useLocalStorage||this.cache.ignore_localstorage_warning||s.dialogs.warning("Your web browser does not support storing data locally. In Safari, the most common cause of this is using \"Private Browsing Mode\". So, you will need log in after page refresh again.",[{name:"ignore",text:"Don't show this message again"}]).done(function(e){e&&e.ignore&&d._cache.save("ignore_localstorage_warning",!0)}),this.requestNotifications().done(function(e){d._cache.save("notifications",e),e&&"serviceWorker"in navigator&&"PushManager"in window?d.setUpPushNotifications().done(function(e){!0!==e&&s.dialogs.error("Could not enable push notifications! "+e),d.check_config.resolve(!0)}):(e&&!d.cache.ignore_push_warning&&s.dialogs.warning("Push notifications are not supported",[{name:"ignore",text:"Don't show this message again"}]).done(function(e){e&&e.ignore&&d._cache.save("ignore_push_warning",!0)}),d._cache.save("endpoint_key",void 0),d.check_config.resolve(!0))})},fetchURLParams:function(){var e=window.location.href.split(/[?#]/);if(this.url_params={},1<e.length){var t=e[1].split("&"),a,i;for(a=0;a<t.length;a++)i=t[a].split("="),this.url_params[i[0]]=1===i.length?null:i[1]}window.history.pushState(null,null,window.location.pathname)},getStorageName:function(){var e=t.STORAGE_NAME+"-"+t.STORAGE_VERSION;return t.STORAGE_NAME_ENDING&&(e=e+"-"+t.STORAGE_NAME_ENDING),e},cleanUpStorage:function(){var e=t.STORAGE_NAME+"-"+t.STORAGE_VERSION;for(var a in window.localStorage)a.startsWith("xabber")&&!a.startsWith(e)&&window.localStorage.removeItem(a)},requestNotifications:function(){var e=new i.Deferred,t=this;return window.Notification?"granted"===window.Notification.permission?e.resolve(!0):window.Notification.requestPermission(function(a){"granted"===a||t.cache.ignore_push_warning||s.dialogs.warning("You should allow popup notifications for this site if you want to receive popups on new messages and some important push notifications.",[{name:"ignore",text:"Don't show this message again"}]).done(function(e){e&&e.ignore&&t._cache.save("ignore_push_warning",!0)}),e.resolve("granted"===a)}):(!t.cache.ignore_notifications_warning&&s.dialogs.warning("Notifications are not supported.",[{name:"ignore",text:"Don't show this message again"}]).done(function(e){e&&e.ignore&&t._cache.save("ignore_notifications_warning",!0)}),e.resolve(!1)),e.promise()},setUpPushNotifications:function(){var e=new i.Deferred,a=this;return firebase.initializeApp({apiKey:t.GCM_API_KEY,messagingSenderId:t.GCM_SENDER_ID}),navigator.serviceWorker.register("./firebase-messaging-sw.js").then(i=>{firebase.messaging().useServiceWorker(i),a.messaging=firebase.messaging(),a.messaging.requestPermission().then(function(){a.messaging.getToken().then(function(t){a._cache.save("endpoint_key",t||void 0),e.resolve(!!t||"No Instance ID token available.")}).catch(function(t){e.resolve(t)}),a.messaging.onTokenRefresh(function(){a.messaging.getToken().then(function(e){a._cache.save("endpoint_key",e)}).catch(function(){})}),navigator.serviceWorker.addEventListener("message",function(e){var i=e.data;if("push-msg-received"===i["firebase-messaging-msg-type"]){var n=i["firebase-messaging-msg-data"];if(n&&n.data&&n.from===t.GCM_SENDER_ID){var s;try{s=JSON.parse(atob(n.data.body))}catch(t){s=n.data}a.trigger("push_message",s)}}})}).catch(function(t){e.resolve({error:t})})}),e.promise()},extendWith:function(){return a.reduce(arguments,function(e,t){return t(e)},this)}});return new o}),define("xabber-views",[],function(){var e=Math.abs;return function(t){var a=t.env,i=a.constants,n=a.templates.base,s=a.utils,o=a.$,d=a._;return t.ViewPath=function(e){this.path=e.split("."),this.applyTo=function(e){for(var t=e,a=0;a<this.path.length;a++)if(!(t=d.result(t,this.path[a])))return null;return t}},t.BasicView=Backbone.View.extend({template:function(){return""},initialize:function(e){e||(e={}),this.parent=e.parent,this.vname=e.vname,this.children={},this.$el.addClass(e.classlist),e.el||this.$el.html(this.template(d.extend({view:this},i))),d.isUndefined(this.ps_selector)||(this.ps_container=this.$(this.ps_selector),this.ps_container.length&&this.ps_container.perfectScrollbar(d.extend(this.ps_settings||{},t.ps_settings))),this.data=new Backbone.Model({visible:!1}),this.data.on("change:visible",this.onChangedVisibility,this),t.on("update_css",function(e){this.updateCSS&&this.updateCSS(),e&&e.size_changed&&this.windowResized&&this.windowResized()},this),this._initialize&&this._initialize(e),this.__initialize&&this.__initialize(e)},isVisible:function(){return this.data.get("visible")},onChangedVisibility:function(){},show:function(){this.onShow.apply(this,arguments),this.data.set("visible",!0),this.trigger("after_show",this),this.updateScrollBar()},hide:function(){this.trigger("before_hide",this),this.data.set("visible",!1),this.onHide.apply(this,arguments)},onShow:function(){this.render.apply(this,arguments),d.each(this.children,function(e){e.render.apply(e,arguments)})},onHide:function(){d.each(this.children,function(e){e.onHide.apply(e,arguments)})},detach:function(){this.$el.detach()},child:function(e){return this.children[e]},addChild:function(e,t,a){var i;return t instanceof Backbone.View?(i=t,i.parent=this):i=new t(d.extend({parent:this,vname:e},a)),this.children[e]=i,i},removeChild:function(e,t){t||(t={});var a=this.children[e];a&&(delete this.children[e],t.soft?a.detach():a.remove())},removeChildren:function(){d.each(d.keys(this.children),function(e){this.removeChild(e)}.bind(this))},setCustomCss:function(e){this.$el.css(e)},removeCustomCss:function(){this.$el.removeAttr("style")},saveScrollBarOffset:function(){if(this.ps_container&&this.isVisible()){var e=this.data.get("scroll_top");"undefined"==typeof e&&this.data.set("scroll_top",this.getScrollTop())}},updateScrollBar:function(){if(this.ps_container&&this.isVisible()){let e=this.data.get("scroll_top");"undefined"==typeof e?this.ps_container.perfectScrollbar("update"):(this.data.set("scroll_top",void 0),this.scrollTo(e))}return this},scrollTo:function(e){this.ps_container[0].scrollTop=e,this.ps_container.perfectScrollbar("update")},scrollToTop:function(){this.scrollTo(0)},scrollToBottom:function(){var e=this.ps_container[0].scrollHeight,t=this.ps_container[0].offsetHeight;this.scrollTo(e-t)},scrollToChild:function(e){var t=d.reduce(e.prevAll(),function(e,t){return e+t.offsetHeight+2},0);this.scrollTo(t)},getScrollTop:function(){return this.ps_container[0].scrollTop},getScrollBottom:function(){let e=this.ps_container[0].scrollTop,t=this.ps_container[0].scrollHeight,a=this.ps_container[0].offsetHeight;return t-(e+a)},getPercentScrolled:function(){if(this.isScrolledToTop())return 0;var e=this.ps_container[0].scrollTop,t=this.ps_container[0].scrollHeight,a=this.ps_container[0].offsetHeight;return e/(t-a)},isScrolledToTop:function(){return 0===this.getScrollTop()},isScrolledToBottom:function(){var e=this.ps_container[0].scrollTop,t=this.ps_container[0].scrollHeight,a=this.ps_container[0].offsetHeight;return t===e+a}}),t.NodeView=t.BasicView.extend({onShow:function(e,t){return d.each(this.children,function(e){e.hide()}),this.$el.children().detach(),t=this.patchTree(t,e)||t,d.each(this.children,function(a,i){d.has(t,i)&&(this.$el.append(a.$el),a.show(e,t[i]))}.bind(this)),this.render(e)},onHide:function(e){d.each(this.children,function(t){t.hide(e)})},patchTree:function(){}}),t.Container=t.BasicView.extend({className:"container",render:function(e,t){var a=t.applyTo(e);return this.$el.children().detach(),this.view!==a&&this.onHide(e),this.view=a,this.view&&(this.$el.append(this.view.$el),this.view.show(e)),this},onHide:function(e){this.view&&this.view.hide(e),this.view=null}}),t.SearchView=t.BasicView.extend({events:{"keydown .search-input":"keyUpOnSearch","focusout .search-input":"clearSearchSelection","click .close-search-icon":"clearSearch","click .list-item":"onClickItem"},keyUpOnSearch:function(e){e.stopPropagation(),this.ids=this.$(".list-item:not(.hidden)").map(function(){return o(this).data("id")}).toArray();var t=this.getSelectedItem();if(e.keyCode===i.KEY_ARROW_DOWN)return this.selectNextItem();if(e.keyCode===i.KEY_ARROW_UP)return this.selectPreviousItem();if(e.keyCode===i.KEY_ENTER&&t.length)return e.preventDefault(),this.onEnterPressed(t);if(e.keyCode===i.KEY_ESCAPE){if(e.preventDefault(),o(e.target).val())return this.clearSearch();this.close()}this.updateSearch()},getSelectedItem:function(){return this.$(".list-item[data-id=\""+this.selection_id+"\"]")},selectItem:function(e,t){if(e){this.clearSearchSelection();var a=this.$(".list-item[data-id=\""+e+"\"]");a.length?this.selection_id=e:(this.ps_container[0].scrollTop=0,a=this.$(".list-item:visible").first(),this.selection_id=a.data("id")),"down"===t&&(a[0].clientHeight+a[0].offsetTop>=this.ps_container[0].clientHeight+this.ps_container[0].scrollTop||a[0].clientHeight+a[0].offsetTop<this.ps_container[0].scrollTop)&&(this.ps_container[0].scrollTop=a[0].offsetTop),"up"===t&&(a[0].offsetTop<=this.ps_container[0].scrollTop||a[0].offsetTop>this.ps_container[0].scrollTop+this.ps_container[0].clientHeight)&&(this.ps_container[0].scrollTop=a[0].offsetTop),a.addClass("selected")}},selectNextItem:function(){this.selectItem(this.ids[this.ids.indexOf(this.selection_id)+1],"down")},selectPreviousItem:function(){this.selectItem(this.ids[this.ids.indexOf(this.selection_id)-1],"up")},updateSearch:function(){if(!this._update_search_timeout){var e=this.$(".search-input").val();this.$(".search-form").switchClass("active",e),this.clearSearchSelection(),e?this.search(e.toLowerCase()):(this.$(".list-item").removeClass("hidden"),this.onEmptyQuery()),this.updateScrollBar(),this.query=!1,this._update_search_timeout=setTimeout(function(){this._update_search_timeout=null,this.query&&this.updateSearch()}.bind(this),150)}else this.query=!0},clearSearch:function(e){e&&e.preventDefault(),this.$(".search-input").val(""),this.updateSearch()},clearSearchSelection:function(){this.selection_id=null,this.$(".list-item.selected").removeClass("selected")},searchAll:function(){this.$(".list-item").removeClass("hidden")},keyUpOnSearchWithQuery:function(){},close:function(){},search:function(){},onEnterPressed:function(){},onEmptyQuery:function(){},onClickItem:function(){}}),t.SearchPanelView=t.SearchView.extend({keyUpOnSearch:function(e){if(e.stopPropagation(),o(e.target).val())return void this.keyUpOnSearchWithQuery(e);this.ids=this.$(".list-item:not(.hidden)").map(function(){return o(this).data("id")}).toArray();var t=this.getSelectedItem();if(e.keyCode===i.KEY_ARROW_DOWN)return this.selectNextItem();if(e.keyCode===i.KEY_ARROW_UP)return this.selectPreviousItem();if(e.keyCode===i.KEY_ENTER&&t.length)return e.preventDefault(),this.onEnterPressed(t);if(e.keyCode===i.KEY_ESCAPE){if(e.preventDefault(),o(e.target).val())return this.clearSearch();this.close()}this.updateSearch()},onScrollY:function(e){if(t.all_searched_messages&&t.all_searched_messages.length&&this.queryid&&!this._loading_messages&&!this._messages_loaded&&this.isScrolledToBottom()){this._loading_messages=!0,e=e||{},this.queryid=uuid(),e.query_id=this.queryid;let a=t.accounts.connected;a.forEach(function(a){let i=t.all_searched_messages.find(e=>e.account.get("jid")===a.get("jid"));!i||a.searched_msgs_loaded||(e.account=a,e.before=i.get("archive_id"),this.MAMRequest(this.query_text,e,function(i){d.each(i,function(i){let n=a.chats.receiveChatMessage(i,d.extend({is_searched:!0},e)),s=t.all_searched_messages.indexOf(n),o;n&&(o=new t.MessageItemView({model:n}),0===s?o.$el.appendTo(this.$(".messages-list-wrap .messages-list")):o.$el.insertBefore(this.$(".messages-list-wrap .message-item").eq(-s)))}.bind(this)),this.$(".messages-list-wrap").switchClass("hidden",!this.$(".messages-list").children().length),this.updateScrollBar(),this._loading_messages=!1}.bind(this)))}.bind(this)),a.filter(e=>e.searched_msgs_loaded).length===a.length&&(this._messages_loaded=!0)}},onScroll:function(){},keyUpOnSearchWithQuery:function(e){e.stopPropagation(),this.ids=this.$(".searched-lists-wrap .list-item:not(.hidden)").map(function(){return o(this).data("id")}).toArray();var t=this.getSelectedItemWithQuery();if(e.keyCode===i.KEY_ARROW_DOWN)return this.selectNextItemWithQuery();if(e.keyCode===i.KEY_ARROW_UP)return this.selectPreviousItemWithQuery();if(e.keyCode===i.KEY_ENTER&&t.length)return e.preventDefault(),this.onEnterPressed(t);if(e.keyCode===i.KEY_ESCAPE){if(e.preventDefault(),o(e.target).val())return this.clearSearch();this.close()}this.updateSearch()},getSelectedItemWithQuery:function(){return this.$(".searched-lists-wrap .list-item[data-id=\""+this.selection_id+"\"]")},selectItemWithQuery:function(e,t){if(!e)return void(this.isScrolledToBottom()&&this.onScrollY());this.clearSearchSelection();var a=this.$(".searched-lists-wrap .list-item[data-id=\""+e+"\"]");a.length?this.selection_id=e:(this.ps_container[0].scrollTop=0,a=this.$(".searched-lists-wrap .list-item:visible").first(),this.selection_id=a.data("id")),"down"===t&&(a[0].clientHeight+a[0].offsetTop+a.parent().parent()[0].offsetTop>=this.ps_container[0].clientHeight+this.ps_container[0].scrollTop||a[0].clientHeight+a[0].offsetTop+a.parent().parent()[0].offsetTop<this.ps_container[0].scrollTop)&&(this.ps_container[0].scrollTop=a[0].offsetTop+a.parent().parent()[0].offsetTop),"up"===t&&(a[0].offsetTop+a.parent().parent()[0].offsetTop<=this.ps_container[0].scrollTop||a[0].offsetTop+a.parent().parent()[0].offsetTop>this.ps_container[0].scrollTop+this.ps_container[0].clientHeight)&&(this.ps_container[0].scrollTop=a[0].offsetTop+a.parent().parent()[0].offsetTop),a.addClass("selected")},selectNextItemWithQuery:function(){this.selectItemWithQuery(this.ids[this.ids.indexOf(this.selection_id)+1],"down")},selectPreviousItemWithQuery:function(){this.selectItemWithQuery(this.ids[this.ids.indexOf(this.selection_id)-1],"up")},search:function(e){this.$(this.main_container).addClass("hidden"),clearTimeout(this.keyup_timeout),this.keyup_timeout=null,this.query_text=e,this.$(".contacts-list").html(""),this.$(".chats-list").html("");let a=d.clone(t.chats);a.comparator="timestamp",a.sort("timestamp").forEach(function(a){let i=a.get("jid").toLowerCase(),n=a.contact.get("roster_name")||a.contact.get("name");if(n&&(n=n.toLowerCase()),(-1<n.indexOf(e)||-1<i.indexOf(e))&&a.get("timestamp")){let e=t.chats_view.child(a.get("id"));e&&(e=e.$el.clone()),e&&(this.$(".chats-list-wrap").removeClass("hidden"),this.$(".chats-list").prepend(e),this.updateChatItem(e),e.click(function(){this.$(".list-item.active").removeClass("active"),t.chats_view.openChat(a.item_view,{screen:t.body.screen.get("name")}),e.addClass("active")}.bind(this)))}}.bind(this)),t.accounts.each(function(a){a.contacts.each(function(i){let n=i.get("jid").toLowerCase(),s=i.get("roster_name")||i.get("name"),d=a.chats.get(i.hash_id),r=d&&d.id;if(s&&(s=s.toLowerCase()),(!r||r&&!this.$(".chat-item[data-id=\""+r+"\"]").length)&&(-1<s.indexOf(e)||-1<n.indexOf(e))){let e=t.contacts_view.$(".account-roster-wrap[data-jid=\""+a.get("jid")+"\"] .list-item[data-jid=\""+n+"\"]").clone().data("account-jid",a.get("jid"));e.attr({"data-color":a.settings.get("color"),"data-account":a.get("jid")}).prepend(o("<div class=\"account-indicator ground-color-700\"/>")),this.$(".contacts-list").append(e),e.click(function(){this.$(".list-item.active").removeClass("active");let n=a.chats.get(i.hash_id);n&&t.chats_view.openChat(n.item_view,{clear_search:!1,screen:t.body.screen.get("name")}),e.addClass("active")}.bind(this))}}.bind(this))}.bind(this)),this.$(".chats-list-wrap").switchClass("hidden",!this.$(".chats-list").children().length),this.$(".contacts-list-wrap").switchClass("hidden",!this.$(".contacts-list").children().length),this.$(".messages-list-wrap").addClass("hidden").find(".messages-list").html(""),2<=e.length&&(this.keyup_timeout=setTimeout(function(){this.queryid=uuid(),this.searchMessages(e,{query_id:this.queryid})}.bind(this),1e3))},updateChatItem:function(e){var t=e.find(".last-msg-date").width();e.find(".chat-title-wrap").css("padding-right",t+5);var a=e.find(".chat-title-wrap").width();e.find(".chat-title").css("max-width",a)},searchMessages:function(e,a){this._loading_messages=!0,this._messages_loaded=!1,a=a||{},a.max||(a.max=t.settings.mam_messages_limit),a.before||(a.before=""),t.all_searched_messages=new t.SearchedMessages;let i=t.accounts.connected;i.forEach(function(i){i.searched_msgs_loaded=!1,a.account=i,this.MAMRequest(e,a,function(e){d.each(e,function(e){let n=i.chats.receiveChatMessage(e,d.extend({is_searched:!0},a)),s=t.all_searched_messages.indexOf(n),o;n&&(o=new t.MessageItemView({model:n}),0===s?o.$el.appendTo(this.$(".messages-list-wrap .messages-list")):o.$el.insertBefore(this.$(".messages-list-wrap .message-item").eq(-s)))}.bind(this)),this.$(".messages-list-wrap").switchClass("hidden",!this.$(".messages-list").children().length),this.updateScrollBar(),this._loading_messages=!1}.bind(this))}.bind(this)),i.filter(e=>e.searched_msgs_loaded).length===i.length&&(this._messages_loaded=!0)},MAMRequest:function(e,t,i,n){let s=[],d=t.account,r=uuid(),c=$iq({from:d.get("jid"),type:"set"}).c("query",{xmlns:Strophe.NS.MAM,queryid:r}).c("x",{xmlns:Strophe.NS.XDATA,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up().c("field",{var:"withtext"}).c("value").t(e).up().up().up().cnode(new Strophe.RSM(t).toXML()),l=d.connection.addHandler(function(e){let a=o(e);return a.find("result").attr("queryid")===r&&t.query_id===this.queryid&&s.push(e),!0}.bind(this),a.Strophe.NS.MAM);d.sendIQ(c,function(e){d.connection.deleteHandler(l);var t=o(e).find("fin[xmlns=\""+Strophe.NS.MAM+"\"]");if(t.length&&t.attr("queryid")===r){var a="true"===t.attr("complete");a&&(d.searched_msgs_loaded=!0)}i&&i(s)},function(){d.connection.deleteHandler(l),n&&n()})},clearSearch:function(e){e&&e.preventDefault(),this.$(".search-input").val(""),this.updateSearch(),this.onEmptyQuery()},onEmptyQuery:function(){t.accounts.forEach(function(e){e.searched_msgs_loaded=!1}),this.query_text=null,this.queryid=null,this._messages_loaded=!1,this._loading_messages=!1,this.$(this.main_container).removeClass("hidden"),this.$(".chats-list-wrap").addClass("hidden"),this.$(".contacts-list-wrap").addClass("hidden"),this.$(".messages-list-wrap").addClass("hidden")}}),t.InputWidget=Backbone.View.extend({field_type:"text",template:n.input_widget,events:{"click .field-text":"showInput","keydown .field-input":"keyDown","keyup .field-input":"keyUp","focusout .field-input":"changeValue"},initialize:function(){this.$el.html(this.template({field_name:this.field_name,field_type:this.field_type,placeholder:this.placeholder})),this.$value=this.$(".field-text"),this.$input=this.$(".field-input"),this.updateValue(),this.data=new Backbone.Model({input_mode:!1}),this.data.on("change:input_mode",this.onChangedInputMode,this),this.bindModelEvents()},bindModelEvents:function(){this.model.on("change:"+this.model_field,this.updateValue,this)},showInput:function(){this.data.set("input_mode",!0),this.updateValue()},onChangedInputMode:function(){var e=this.data.get("input_mode");this.$value.hideIf(e),this.$input.showIf(e).focus()},keyDown:function(e){e.stopPropagation();var t=this.getValue();e.keyCode===i.KEY_ENTER?this.changeValue():e.keyCode===i.KEY_ESCAPE&&(this.$input.removeClass("changed").val(t),this.data.set("input_mode",!1))},keyUp:function(){var e=this.getValue();this.$input.switchClass("changed",this.$input.val()!==e)},getValue:function(){return this.model.get(this.model_field)},setValue:function(e){this.model.save(this.model_field,e)},changeValue:function(){var e=this.getValue(),t=this.$input.removeClass("changed").val();t!==e&&this.setValue(t),this.data.set("input_mode",!1)},updateValue:function(){var e=this.getValue();this.$value.text(e),this.$input.val(e)}}),t.Body=t.NodeView.extend({className:"client-body-wrap",_initialize:function(){this.vname="body",this.data.set("visible",!0),this.screen=new Backbone.Model,this.screen_map=new Backbone.Model,this.screen.on("change",this.update,this),this.screen_map.on("change",this.onScreenMapChanged,this),o("body").append(this.$el)},addScreen:function(e,t){this.screen_map.set(e,t)},setScreen:function(e,t,a){var i={stamp:d.uniqueId()};e&&!this.isScreen(e)&&(i.name=e),this.screen.set(d.extend(i,t),a)},isScreen:function(e){return this.screen.get("name")===e},onScreenMapChanged:function(){var e=this.screen.get("name");d.has(this.screen_map.changed,e)&&this.update()},update:function(){var e=this.screen.attributes,t=this.screen_map.get(e.name);"undefined"!=typeof t&&(this.onShow(e,t),this.model.trigger("update_screen",this.screen.get("name")),this.model.trigger("update_layout",{screen_changed:e.name}))}}),t.ToolbarView=t.BasicView.extend({className:"toolbar noselect",ps_selector:".accounts",ps_settings:{theme:"item-list"},template:n.toolbar,events:{"click .all-chats":"showAllChats","click .chats":"showChats","click .group-chats":"showGroupChats","click .contacts":"showContacts","click .search":"showSearch","click .archive-chats":"showArchive","click .mentions":"showMentions","click .settings":"showSettings","click .add-variant.contact":"showAddContactView","click .add-variant.account":"showAddAccountView","click .add-variant.groupchat":"showAddGroupChatView","click .about":"showAbout"},_initialize:function(){var e=o("<div class=\"lean-overlay toolbar-menu\"></div>");this.$(".add-something").on("change_state",function(t,a){o(this).switchClass("active",a).find(".mdi").switchClass("mdi-close",a).switchClass("mdi-plus",!a),a?e.appendTo("body"):e.detach()}),t.on("update_screen",this.onUpdatedScreen,this),this.data.on("change:add_menu_state",this.onChangedAddMenuState,this),this.data.on("change:all_msg_counter",this.onChangedAllMessageCounter,this),this.data.on("change:group_msg_counter",this.onChangedGroupMessageCounter,this),this.data.on("change:mentions_counter",this.onChangedMentionsCounter,this),this.data.on("change:msg_counter",this.onChangedMessageCounter,this),this.data.set({msg_counter:0}),this.data.set({group_msg_counter:0}),this.data.set({all_msg_counter:0}),this.data.set({mentions_counter:0})},render:function(){this.$(".add-something").dropdown({inDuration:50,outDuration:50,constrainWidth:!1,hover:!1,alignment:"left"})},onUpdatedScreen:function(e){"account_settings"===e||"all-chats"===e&&(this.$(".toolbar-item.all-chats").hasClass("active")||this.$(".toolbar-item.group-chats").hasClass("active")||this.$(".toolbar-item.chats").hasClass("active")||this.$(".toolbar-item.account-item").hasClass("active")||this.$(".toolbar-item.archive-chats").hasClass("active"))||(this.$(".toolbar-item").removeClass("active"),d.contains(["all-chats","contacts","mentions","settings","search","about"],e)&&this.$(".toolbar-item."+e).addClass("active"))},showAllChats:function(){this.$(".toolbar-item").removeClass("active").filter(".all-chats").addClass("active"),t.body.setScreen("all-chats",{right:null})},showChats:function(){this.$(".toolbar-item").removeClass("active").filter(".chats").addClass("active"),t.body.setScreen("all-chats",{right:null}),t.trigger("show_chats")},showGroupChats:function(){this.$(".toolbar-item").removeClass("active").filter(".group-chats").addClass("active"),t.body.setScreen("all-chats",{right:null}),t.trigger("show_group_chats")},showArchive:function(){this.$(".toolbar-item").removeClass("active").filter(".archive-chats").addClass("active"),t.body.setScreen("all-chats",{right:null}),t.trigger("show_archive_chats")},showChatsByAccount:function(e){this.$(".toolbar-item").removeClass("active").filter(".account-item[data-jid=\""+e.get("jid")+"\"]").addClass("active"),t.body.setScreen("all-chats",{right:null}),t.trigger("show_account_chats",[e])},showSearch:function(){t.body.setScreen("search")},showContacts:function(){t.body.setScreen("contacts")},showMentions:function(){t.body.setScreen("mentions")},showSettings:function(){t.body.setScreen("settings")},showAddContactView:function(){t.trigger("add_contact",{right:null})},showAddAccountView:function(){t.trigger("add_account",{right:null})},showAddGroupChatView:function(){t.trigger("add_group_chat",{right:null})},showAbout:function(){t.body.setScreen("about")},setAllMessageCounter:function(){var e=0,a=0,i=0,n=0;return t.accounts.each(function(t){t.chats.each(function(t){t.contact.get("muted")||(a+=t.get("unread")+t.get("const_unread"),t.contact.get("group_chat")?i+=t.get("unread")+t.get("const_unread"):e+=t.get("unread")+t.get("const_unread"))}.bind(this)),n+=t.unreaded_mentions.length}.bind(this)),{msgs:e,all_msgs:a,group_msgs:i,mentions:n}},recountAllMessageCounter:function(){let e=this.setAllMessageCounter();this.data.set("all_msg_counter",e.all_msgs),this.data.set("msg_counter",e.msgs),this.data.set("group_msg_counter",e.group_msgs),this.data.set("mentions_counter",e.mentions)},onChangedMessageCounter:function(){var e=this.data.get("msg_counter");this.$(".msg-indicator").switchClass("unread",e).text()},onChangedGroupMessageCounter:function(){var e=this.data.get("group_msg_counter");this.$(".group-msg-indicator").switchClass("unread",e).text()},onChangedMentionsCounter:function(){var e=this.data.get("mentions_counter");this.$(".mentions-indicator").switchClass("unread",e).text()},onChangedAllMessageCounter:function(){var e=this.data.get("all_msg_counter");this.$(".all-msg-indicator").switchClass("unread",e).text(e)}}),t.JingleMessageView=t.BasicView.extend({className:"modal main-modal jingle-message-view",template:n.jingle_message_calling,avatar_size:i.AVATAR_SIZES.XABBER_VOICE_CALL_VIEW,events:{click:"clickOnWindow","click .btn-accept":"accept","click .btn-share-screen":"shareScreen","click .btn-microphone":"toggleMicrophone","click .btn-video":"videoCall","click .btn-volume":"toggleVolume","click .btn-collapse":"collapse","click .btn-cancel":"cancel","click .btn-full-screen":"setFullScreen"},_initialize:function(e){this.model=e.model,this.model.on("destroy",this.onDestroy,this),this.contact=this.model.contact,this.account=this.contact.account,this.model.on("change:volume_on",this.updateButtons,this),this.model.on("change:video",this.updateButtons,this),this.model.on("change:video_live",this.updateButtons,this),this.model.on("change:video_in",this.updateCollapsedWindow,this),this.model.on("change:audio",this.updateButtons,this)},render:function(e){e=e||{},this.updateName(),this.updateCallingStatus(e.status),"in"===e.status&&this.updateStatusText("Calling..."),this.updateAccountJid(),this.updateButtons(),this.$el.openModal({dismissible:!1,ready:function(){this.updateAvatar()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)})},setFullScreen:function(){let e=this.$el.find(".webrtc-remote-video")[0],t=this.$el.find(".webrtc-local-video")[0],a=this.$el.find(".buttons-panel")[0];e&&(e.requestFullScreen?(e.requestFullScreen(),t.requestFullScreen(),a.requestFullScreen()):e.webkitRequestFullScreen?(e.webkitRequestFullScreen(),t.webkitRequestFullScreen(),a.webkitRequestFullScreen()):e.mozRequestFullScreen?(e.mozRequestFullScreen(),t.mozRequestFullScreen(),a.mozRequestFullScreen()):e.msRequestFullScreen&&(e.msRequestFullScreen(),t.msRequestFullScreen(),a.msRequestFullScreen()))},cancelFullScreen:function(){if(document.exitFullscreen){let e=document.fullscreenElement;e&&document.exitFullscreen().then(function(){document.fullscreenElement&&this.cancelFullScreen()}.bind(this))}else if(document.mozCancelFullScreen){let e=document.mozFullScreenElement;e&&document.mozCancelFullScreen(),document.mozFullScreenElement&&this.cancelFullScreen()}else if(document.webkitExitFullscreen){let e=document.webkitCurrentFullScreenElement;e&&document.webkitExitFullscreen(),document.webkitCurrentFullScreenElement&&this.cancelFullScreen()}else if(document.msExitFullscreen){let e=document.msFullscreenElement;e&&document.msExitFullscreen(),document.msFullscreenElement&&this.cancelFullScreen()}},windowResized:function(){this.$el.hasClass("collapsed")&&this.$el.css("right",parseInt(t.main_panel.$el.css("margin-right"))+8+"px")},updateButtons:function(){this.$(".btn-video .video").switchClass("hidden",!this.model.get("video")),this.$(".btn-full-screen").switchClass("hidden",!this.model.get("video_in")),this.$(".btn-video").switchClass("mdi-video",this.model.get("video_live")).switchClass("mdi-video-off",!this.model.get("video_live")),this.$(".btn-volume").switchClass("mdi-volume-high",this.model.get("volume_on")).switchClass("mdi-volume-off",!this.model.get("volume_on")),this.$(".btn-microphone").switchClass("mdi-microphone",this.model.get("audio")).switchClass("mdi-microphone-off",!this.model.get("audio"))},updateAvatar:function(){let e=this.contact.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateCallingStatus:function(e){this.$(".buttons-wrap").switchClass("incoming","in"===e),this.$(".contact-info").switchClass("hidden","in"===e||e===i.JINGLE_MSG_PROPOSE),this.$(".default-screen .name").switchClass("hidden","in"!==e&&e!==i.JINGLE_MSG_PROPOSE),this.$(".call-header").switchClass("hidden","in"!==e&&e!==i.JINGLE_MSG_PROPOSE)},updateStatusText:function(e){this.$(".calling-status").text(e||"")},updateName:function(){this.$(".name").text(this.contact.get("name"))},updateAccountJid:function(){this.$(".modal-footer .contact-info .jid").text(this.contact.get("jid"))},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},shareScreen:function(){this.model.set("video_screen",!this.model.get("video_screen"))},isFullScreen:function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement||!!document.mozFullScreenElement},accept:function(){this.model.accept(),this.updateCallingStatus(i.JINGLE_MSG_ACCEPT),this.model.initSession()},clickOnWindow:function(){this.$el.hasClass("collapsed")&&this.$el.hasClass("collapsed-video")&&this.collapse()},collapse:function(e){if(e&&e.stopPropagation(),this.isFullScreen())return void this.cancelFullScreen();let t=this.$el.closest("#modals").siblings("#"+this.$el.data("overlayId"));t.toggle(),this.$el.children().toggle(),this.$el.toggleClass("collapsed"),this.$el.hasClass("collapsed")?(this.model.get("video")||this.model.get("video_in"))&&this.$el.addClass("collapsed-video"):this.$el.css("right",""),this.windowResized()},updateCollapsedWindow:function(){this.updateButtons(),this.$el.hasClass("collapsed")&&this.$el.switchClass("collapsed-video",this.model.get("video")||this.model.get("video_in"))},toggleMicrophone:function(){this.model.set("audio",!this.model.get("audio"))},onDestroy:function(){this.close(),this.$el.detach()},videoCall:function(){this.model.set("video_live",!this.model.get("video_live"))},toggleVolume:function(e){let t=o(e.target);t.switchClass(this.model.set("volume_on",!this.model.get("volume_on")))},cancel:function(){this.model.reject(),this.close()}}),t.SettingsView=t.BasicView.extend({className:"settings-panel",template:n.settings,ps_selector:".panel-content",events:{"click .settings-tabs-wrap .settings-tab":"jumpToBlock","mousedown .setting.notifications label":"setNotifications","mousedown .setting.message-preview label":"setMessagePreview","change .sound input[type=radio][name=sound]":"setSound","change .hotkeys input[type=radio][name=hotkeys]":"setHotkeys","click .settings-tab.delete-all-accounts":"deleteAllAccounts"},_initialize:function(){this.$(".xabber-info-wrap .version").text(t.get("version_number"))},render:function(){var e=this.model.attributes;this.$(".notifications input[type=checkbox]").prop({checked:e.notifications}),this.$(".message-preview input[type=checkbox]").prop({checked:e.message_preview});var t=e.sound?e.sound_on_message:"";return this.$(".sound input[type=radio][name=sound][value=\""+t+"\"]").prop("checked",!0),this.$(".hotkeys input[type=radio][name=hotkeys][value="+e.hotkeys+"]").prop("checked",!0),this},jumpToBlock:function(e){var t=o(e.target).closest(".settings-tab"),a=this.$(".settings-block-wrap."+t.data("block-name"));return t.hasClass("link-button")?(t.parent().siblings().removeClass("active"),void this.scrollTo(0)):void(t.addClass("active").siblings().removeClass("active"),this.scrollToChild(a))},setNotifications:function(e){var t=!this.model.get("notifications");this.model.save("notifications",t),e.preventDefault(),o(e.target).closest("input").prop("checked",t)},setMessagePreview:function(e){var t=!this.model.get("message_preview");this.model.save("message_preview",t),e.preventDefault(),o(e.target).closest("input").prop("checked",t)},setSound:function(e){var a=e.target.value;a?(t.playAudio(a),this.model.save({sound:!0,sound_on_message:a})):this.model.save("sound",!1)},setHotkeys:function(e){this.model.save("hotkeys",e.target.value)},deleteAllAccounts:function(){s.dialogs.ask("Quit Xabber Web","Do you really want to quit Xabber? You will quit from all currently logged in XMPP accounts.",null,{ok_button_text:"quit"}).done(function(e){e&&t.trigger("quit")})}}),t.AboutView=t.BasicView.extend({className:"settings-panel about-panel",template:n.about,ps_selector:".panel-content",_initialize:function(){this.$(".xabber-info-wrap .version").text(this.model.get("version_number"))},render:function(){}}),t.DragManager=Backbone.Model.extend({initialize:function(){window.document.onmousedown=this.onMouseDown.bind(this),window.document.onmousemove=this.onMouseMove.bind(this),window.document.onmouseup=this.onMouseUp.bind(this)},onMouseDown:function(e){if(1==e.which){var t=e.target.closest(".drag-handle"),a=t&&t.closest(".draggable");return a?void this.set({elem:a,draghandle_elem:t,downX:e.pageX,downY:e.pageY}):this.resetElem()}},onMouseMove:function(t){if(this.get("elem")){var a=this.get("avatar");if(!a){if(3>e(t.pageX-this.get("downX"))&&3>e(t.pageY-this.get("downY")))return;if(a=this.createAvatar(t),!a)return this.resetElem();this.set("avatar",a);var i=this.getCoords(a);this.set({shiftX:this.get("downX")-i.left,shiftY:this.get("downY")-i.top}),this.startDrag(t)}a.style.left=t.pageX-this.get("shiftX")+"px",a.style.top=t.pageY-this.get("shiftY")+"px";var n=this.findDropElem(t);this.updateDropElem(n)}},onMouseUp:function(e){var t=document.querySelector(".recording");return t?void o(t).removeClass("recording"):void(this.get("avatar")&&this.finishDrag(e),this.resetElem())},resetElem:function(){this.set({elem:null,draghandle_elem:null,avatar:null})},getCoords:function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}},createAvatar:function(){var e=this.get("elem"),t=o(e),a=this.get("draghandle_elem"),i={parent:e.parentNode,nextSibling:e.nextSibling,position:e.position||"",left:e.left||"",top:e.top||"",zIndex:e.zIndex||"",avatar_cursor:e.style.cursor||"",draghandle_elem_cursor:a.style.cursor||""};return t.addClass("dragging"),e.style.cursor="-webkit-grabbing",a.style.cursor="-webkit-grabbing",e.rollback=function(){i.parent.insertBefore(e,i.nextSibling),t.removeClass("dragging"),e.style.position=i.position,e.style.left=i.left,e.style.top=i.top,e.style.zIndex=i.zIndex,e.style.cursor=i.avatar_cursor,a.style.cursor=i.draghandle_elem_cursor},e},startDrag:function(){var e=this.get("avatar");window.document.body.appendChild(e),e.style.zIndex=9999,e.style.position="absolute"},finishDrag:function(e){var t=this.get("elem"),a=this.get("avatar"),i=this.findDropElem(e);a.rollback(),this.updateDropElem(null),t&&i&&(o(t).trigger("drag_to",i),o(i).trigger("drag_from",t))},findDropElem:function(e){var t=this.get("avatar");t.hidden=!0;var a=window.document.elementFromPoint(e.clientX,e.clientY);return t.hidden=!1,a?a.closest(".droppable"):null},updateDropElem:function(e){var t=this.get("drop_elem");this.set("drop_elem",e),t&&o(t).removeClass("drag-on"),e&&o(e).addClass("drag-on")}}),d.extend(t,{modal_settings:{open:{in_duration:50,out_duration:100,opacity:.4},close:{out_duration:100}},ps_settings:{minScrollbarLength:40,suppressScrollX:!0,wheelSpeed:.5},startBlinkingFavicon:function(){this._blink_interval||(this._blink_interval=setInterval(function(){var e=o("link[rel='shortcut icon']");e.attr("href")===i.FAVICON_DEFAULT?e.attr("href",i.FAVICON_MESSAGE):e.attr("href",i.FAVICON_DEFAULT)},500))},stopBlinkingFavicon:function(){this._blink_interval&&(clearInterval(this._blink_interval),this._blink_interval=null,o("link[rel='shortcut icon']").attr("href",i.FAVICON_DEFAULT))},onChangedAllMessageCounter:function(){this.get("all_msg_counter")?(this.startBlinkingFavicon(),window.document.title="Messages ("+this.get("all_msg_counter")+")"):(this.stopBlinkingFavicon(),window.document.title="Xabber Web")},setAllMessageCounter:function(){let e=0;return t.accounts.each(function(t){t.chats.each(function(t){t.contact.get("muted")||(e+=t.get("unread")+t.get("const_unread"))}.bind(this))}.bind(this)),e},recountAllMessageCounter:function(){this.set("all_msg_counter",this.setAllMessageCounter())},resetMessageCounter:function(){this.set("all_msg_counter",0)},onChangedFocusState:function(){this.get("focused")&&this.resetMessageCounter()},openWindow:function(e){s.openWindow(e,function(){s.dialogs.error("Could not open new tab. Please allow popups")}.bind(this))},popupNotification:function(e){var t=new window.Notification(e.title,{body:e.text,icon:e.icon});return setTimeout(t.close.bind(t),5e3),t},playAudio:function(e,t){t=t||!1;var a=i.SOUNDS[e];if(a){var n=new window.Audio(a);return n.loop=t,n.play(),n}},stopAudio:function(e){e&&(e.pause(),e.remove())},registerDOMEvents:function(){var e=this;o(window).on("blur focus",function(t){e.set("focused","focus"===t.type)}),o(window).on("resize",function(){e.set({width:window.innerWidth,height:window.innerHeight}),e.trigger("update_layout",{size_changed:!0})}),window.document.body.ondragover=function(e){e.preventDefault()},window.document.body.ondrop=function(e){e.preventDefault()}}}),t.once("start",function(){this.set("all_msg_counter",0),this.on("change:all_msg_counter",this.onChangedAllMessageCounter,this),this.on("change:focused",this.onChangedFocusState,this),this.set({focused:window.document.hasFocus(),width:window.innerWidth,height:window.innerHeight}),this.registerDOMEvents(),Materialize.modalSettings=this.modal_settings,this.drag_manager=new this.DragManager,this.body=new this.Body({model:this}),this.login_page=this.body.addChild("login",this.NodeView,{classlist:"login-page-wrap"}),this.toolbar_view=this.body.addChild("toolbar",this.ToolbarView),this.main_panel=this.body.addChild("main",this.NodeView,{classlist:"main-wrap"}),this.left_panel=this.main_panel.addChild("left",this.NodeView,{classlist:"panel-wrap left-panel-wrap"}),this.right_panel=this.main_panel.addChild("right",this.NodeView,{classlist:"panel-wrap right-panel-wrap"}),this.wide_panel=this.main_panel.addChild("wide",this.NodeView,{classlist:"panel-wrap wide-panel-wrap"}),this.settings_view=this.wide_panel.addChild("settings",this.SettingsView,{model:this._settings}),this.about_view=this.wide_panel.addChild("about",this.AboutView,{model:this})},t),t}}),define("xabber-api-service",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.api_service,n=t.utils,s=t.$,o=t._;return e.AccountSettings=Backbone.Model.extend({idAttribute:"jid",defaults:{timestamp:0,to_sync:!1,synced:!1,deleted:!1},update_timestamp:function(){this.save("timestamp",n.now())},update_settings:function(e){this.save(o.extend({timestamp:n.now()},e))},request_data:function(){return{jid:this.get("jid"),timestamp:this.get("timestamp"),settings:o.omit(this.attributes,["jid","timestamp","order","to_sync","synced","deleted"])}}}),e.AccountSettingsList=Backbone.CollectionWithStorage.extend({model:e.AccountSettings,create_from_server:function(e){var t=this.create(o.extend({jid:e.jid,timestamp:e.timestamp,to_sync:!0,synced:!0},e.settings));return this.trigger("add_settings",t),t}}),e.AccountsOrderTimestamp=Backbone.ModelWithStorage.extend({defaults:{timestamp:0}}),e.APIAccount=Backbone.ModelWithStorage.extend({defaults:{token:null,sync_all:!0},_initialize:function(t,a){if(this.list=a.settings_list,this.save({connected:!1,sync_request:"silent"}),this.on("change:connected",function(){this.get("connected")?this.fcm_subscribe():this.fcm_unsubscribe()},this),this.on("change:token",function(){null!==this.get("token")&&this.save({sync_all:!0,sync_request:this.list.length?"window":"silent"})},this),this.list.on("change:to_sync",function(e){this.get("sync_all")&&!e.get("to_sync")&&this.save("sync_all",!1)},this),e.on("push_message",function(e){this.get("connected")&&e.username===this.get("username")&&e.from_token!==this.get("token")&&"settings_updated"===e.action&&(this.synchronize_main_settings(),this.synchronize_order_settings()),this.get("connected")&&e.username===this.get("username")&&e.from_token!==this.get("token")&&"account_updated"===e.action&&this.get_settings()},this),this.ready=new s.Deferred,e.url_params.social_auth){var i=e.url_params.social_auth;delete e.url_params.social_auth;try{var n=JSON.parse(atob(i));return this.save("token",null),void this.social_login(n)}catch(t){}}e.url_params.token&&(this.save("token",e.url_params.token),delete e.url_params.token),this.get("token")?this.login_by_token():this.ready.resolve()},_call_method:function(e,t,i,n,o){var d={type:e,url:a.API_SERVICE_URL+t,headers:{Authorization:"Token "+this.get("token")},context:this,contentType:"application/json",dataType:"json",success:function(e){n&&n(e)},error:function(e){this.onAPIError(e,o)}.bind(this)};i&&(d.data=JSON.stringify(i)),s.ajax(d)},add_source:function(t){return o.extend({source:"Xabber Web "+e.get("version_number")},t)},get_settings:function(){null===this.get("token")?this.trigger("settings_result",null):this._call_method("GET","/accounts/current/",null,function(e){"registered"===e.account_status?(this.onUserData(e),this._call_method("GET","/accounts/current/client-settings/",null,this.onSettings.bind(this),this.onSettingsFailed.bind(this))):(n.dialogs.error("Your Xabber account has not permission to synchronize settings of XMPP accounts!"),this.save({token:null,connected:!1}),this.trigger("settings_result",null))}.bind(this),this.onSettingsFailed.bind(this))},delete_settings:function(e){this.get("connected")?this._call_method("DELETE","/accounts/current/client-settings/",{jid:e},this.onSettings.bind(this),this.onSettingsFailed.bind(this)):this.trigger("settings_result",null)},synchronize_main_settings:function(){if(this.get("connected")){var e=o.map(this.list.where({to_sync:!0}),function(e){return e.request_data()});e.length?this._call_method("PATCH","/accounts/current/client-settings/",{settings_data:e},this.onSettings.bind(this),this.onSettingsFailed.bind(this)):this.get_settings()}else this.trigger("settings_result",null)},synchronize_order_settings:function(){if(this.get("connected")&&this.get("sync_all")){var e=this.list.order_timestamp.get("timestamp"),t=this.list.map(function(e){return{jid:e.get("jid"),order:e.get("order")}});this._call_method("PATCH","/accounts/current/client-settings/",{order_data:{settings:t,timestamp:e}},this.onSettings.bind(this),this.onSettingsFailed.bind(this))}else this.trigger("settings_result",null)},fetch_from_server:function(e){var t=e.deleted,a=e.settings_data,i=e.order_data.timestamp,s=e.order_data.settings,d=this.list,r=this.get("sync_all");if(o.each(t,function(e){var t=d.get(e.jid);t&&t.get("to_sync")&&t.get("timestamp")<=e.timestamp&&t.trigger("delete_account",!0)}),o.each(a,function(e){var t=d.get(e.jid);t&&(t.get("to_sync")?t.save(o.extend({timestamp:e.timestamp,deleted:!1,synced:!0},e.settings)):t.save("synced",e.timestamp>=t.get("timestamp"))),!t&&r&&(t=d.create_from_server(e))}),r){var c={},l=1;o.each(s,function(e){c[e.jid]=e.order,e.order>l&&(l=e.order)}),d.order_timestamp.save("timestamp",i),d.each(function(e){var t=e.get("jid"),a=c[t];a||(l+=1,a=l),e.save("order",a)})}this.trigger("settings_result",e),this.save("last_sync",n.now())},onAPIError:function(e,t){var a=e.status,i=e.responseJSON;403===a&&(this.save({connected:!1,token:null}),"Invalid token"===i.detail&&("not_found"===i.reason||("revoked"===i.reason?o.each(this.list.where({to_sync:!0}),function(e){e.trigger("delete_account",!0)}):"expired"===i.reason&&n.dialogs.common("Error","Token for your Xabber account expired. Do you want relogin?",{ok_button:{text:"yes"},cancel_button:{text:"not now"}}).done(function(e){e&&this.trigger("relogin")}.bind(this))))),t&&t(i,a)},_login:function(e,t,i){var o={type:"POST",url:a.API_SERVICE_URL+"/accounts/login/",contentType:"application/json",dataType:"json",data:JSON.stringify(this.add_source()),success:t,error:function(e){this.onAPIError(e,i)}.bind(this)};if(e.token)o.headers={Authorization:"Token "+e.token};else{var d=e.username,r=e.password;o.headers={Authorization:"Basic "+n.utoa(d+":"+r)}}s.ajax(o)},login:function(e,t){this._login({username:e,password:t},this.onLogin.bind(this),this.onLoginFailed.bind(this))},login_by_token:function(){this._login({token:this.get("token")},this.onLoginByToken.bind(this),this.onLoginByTokenFailed.bind(this))},social_login:function(e){s.ajax({type:"POST",url:a.API_SERVICE_URL+"/accounts/social_auth/",contentType:"application/json",dataType:"json",data:JSON.stringify(this.add_source(e)),success:this.onSocialLogin.bind(this),error:function(e){this.onAPIError(e,this.onSocialLoginFailed.bind(this))}.bind(this)})},revoke_token:function(){var e=this.get("token");null!==e&&this._call_method("delete","/accounts/current/tokens/",{token:e}),this.save({connected:!1,token:null})},onLoginByToken:function(e){this.save({token:e.token,connected:!0,sync_request:"silent"}),this.get_settings(),this.ready.resolve()},onLoginByTokenFailed:function(){this.save("connected",!1),this.ready.resolve()},onLogin:function(e){this.save({token:e.token,connected:!0}),this.get_settings()},onLoginFailed:function(e){this.save("connected",!1),this.trigger("login_failed",e)},onSocialLogin:function(t){this.save({token:t.token,connected:!0}),e.body.setScreen("settings"),this.ready.resolve()},onSocialLoginFailed:function(){this.save("connected",!1),e.body.setScreen("settings"),n.dialogs.error("Authentication failed for Xabber account."),this.ready.resolve()},onUserData:function(e){var t,a;t=e.first_name&&e.last_name?e.first_name+" "+e.last_name:e.username,e.xmpp_binding&&(a=e.xmpp_binding.jid),this.save({username:e.full_id,name:t,linked_email_list:e.email_list,linked_social:e.social_bindings,xmpp_binding:a})},onSettings:function(e){var t=this.get("sync_request");this.save("sync_request",void 0),"window"===t?this.trigger("open_sync_window",e):"silent"===t?this.synchronize_main_settings():this.fetch_from_server(e)},onSettingsFailed:function(){this.trigger("settings_result",null)},logout:function(){n.dialogs.ask("Quit","You will quit from Xabber Account. You will not be able to use enhanced Xabber services, but basic XMPP will work as usual.",[{name:"delete_accounts",checked:!0,text:"Delete synced XMPP accounts"}],{ok_button_text:"quit"}).done(function(t){t&&(0<e.accounts.connected.length&&o.each(e.accounts.connected,function(e){e.set("auto_login_xa",!1),e.save("auto_login_xa",!1)}.bind(this)),this.revoke_token(),t.delete_accounts&&o.each(this.list.where({to_sync:!0}),function(e){e.trigger("delete_account",!0)}))}.bind(this))},start:function(){this.get("connected")||this.fcm_unsubscribe(),this.get_settings()},fcm_subscribe:function(){this._call_method("post","/fcm/subscription/",{endpoint_key:e.cache.endpoint_key})},fcm_unsubscribe:function(){s.ajax({type:"DELETE",url:a.API_SERVICE_URL+"/fcm/subscription/",contentType:"application/json",dataType:"json",data:JSON.stringify({endpoint_key:e.cache.endpoint_key})})}}),e.APIAccountAuthView=e.BasicView.extend({_initialize:function(){return this.$username_input=this.$("input[name=username]"),this.$password_input=this.$("input[name=password]"),this.data.on("change:authentication",this.onChangeAuthenticationState,this),this},onRender:function(){this.authFeedback({}),Materialize.updateTextFields(),this.$username_input.val("").focus(),this.$password_input.val(""),this.updateButtons()},keyUp:function(e){e.keyCode===a.KEY_ENTER&&this.submit()},submit:function(){if(this.data.get("authentication"))return void this.cancel();this.data.set("authentication",!0),this.authFeedback({});var e=this.$username_input.val(),t=this.$password_input.val();return e?t?void(this.authFeedback({password:"Authentication..."}),this.model.login(e,t)):this.errorFeedback({password:"Please input password!"}):this.errorFeedback({username:"Please input username!"})},cancel:function(){this.data.set("authentication",!1),this.onRender()},authFeedback:function(e){this.$username_input.switchClass("invalid",e.username).siblings("span.errors").text(e.username||""),this.$password_input.switchClass("invalid",e.password).siblings("span.errors").text(e.password||"")},errorFeedback:function(e){this.authFeedback(e),this.data.set("authentication",!1)},updateButtons:function(){var e=this.data.get("authentication");this.$(".btn-log-in").switchClass("disabled",e)},onChangeAuthenticationState:function(){this.updateButtons(),this.data.get("authentication")?(this.model.on("change:connected",this.onChangeConnected,this),this.model.on("login_failed",this.onLoginFailed,this)):(this.model.off("change:connected",this.onChangeConnected,this),this.model.off("login_failed",this.onLoginFailed,this))},onChangeConnected:function(){this.model.get("connected")&&this.successFeedback()},onLoginFailed:function(e){this.errorFeedback({password:e&&e.detail||"Authentication failed"})},socialAuth:function(t){var i=window.location.href,n=s(t.target).closest(".btn-social").data("provider");"email"==n?(this.closeModal(),e.email_auth_view.show()):window.location.href=a.XABBER_ACCOUNT_URL+"/social/login/"+n+"/?origin="+i+"&source=Xabber Web"}}),e.XabberLoginByEmailPanel=e.APIAccountAuthView.extend({className:"login-panel add-xabber-account-panel",template:i.xabber_login_by_email,events:{"click .btn-cancel":"close","click .btn-log-in":"submit","keyup input[name=password]":"keyUp"},render:function(){this.$el.openModal({opacity:.9,ready:this.onRender.bind(this),complete:this.close.bind(this)})},successFeedback:function(){this.authFeedback({}),this.data.set("authentication",!1),this.close()},onRender:function(){Materialize.updateTextFields(),this.$username_input.val("").focus(),this.$password_input.val("")},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.XabberLoginPanel=e.APIAccountAuthView.extend({className:"login-panel",template:i.xabber_login,events:{"click .login-type":"changeLoginType","click .btn-log-in":"submit","click .btn-social":"socialAuth","click .btn-escape":"openXmppLoginPanel","keyup input[name=password]":"keyUp"},render:function(){this.onRender()},successFeedback:function(){this.authFeedback({}),this.data.set("authentication",!1),e.body.setScreen("all-chats")},changeLoginType:function(){e.body.setScreen("login",{login_screen:"xmpp"})},openXmppLoginPanel:function(){e.body.setScreen("login",{login_screen:"xmpp"})}}),e.AddAPIAccountView=e.APIAccountAuthView.extend({className:"login-panel add-xabber-account-panel",template:i.add_xabber_account,events:{"click .account-field .dropdown-content":"selectAccount","click .btn-add":"loginXabberAccount","keyup input[name=password]":"keyUp","click .btn-social":"socialAuth","click .btn-cancel":"closeModal"},render:function(t){if(!e.accounts.connected.length)return void n.dialogs.error("No connected accounts found.");t||(t={});var a=e.accounts.connected,i=t.jid||"";return this.$("input[name=\"username\"]").val(i).attr("readonly",!!i).removeClass("invalid"),this.$(".single-acc").showIf(1===a.length),this.$(".multiple-acc").hideIf(1===a.length),this.$(".account-field .dropdown-content").empty(),o.each(a,function(e){this.$(".account-field .dropdown-content").append(this.renderAccountItem(e))}.bind(this)),this.bindAccount(a[0]),this.$("span.errors").text(""),this.$el.openModal({opacity:.9,ready:function(){this.onRender.bind(this),this.$(".account-field .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"})}.bind(this),complete:this.closeModal.bind(this)}),this},bindAccount:function(e){this.$(".account-field .dropdown-button .account-item-wrap").replaceWith(this.renderAccountItem(e))},renderAccountItem:function(e){var a=s(t.templates.contacts.add_contact_account_item({jid:e.get("jid")}));return a.find(".circle-avatar").setAvatar(e.cached_image,this.avatar_size),a},selectAccount:function(t){var a=s(t.target).closest(".account-item-wrap"),i=e.accounts.get(a.data("jid"));this.bindAccount(i),this.loginXabberAccount(i)},loginXabberAccount:function(e){e.set("auto_login_xa",!0),e.authXabberAccount(),this.closeModal()},successFeedback:function(){this.authFeedback({}),this.data.set("authentication",!1),this.closeModal()},onHide:function(){this.$el.detach()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.SyncSettingsView=e.BasicView.extend({className:"modal main-modal sync-settings-modal noselect",template:i.sync_settings,ps_selector:".modal-content",avatar_size:a.AVATAR_SIZES.SYNCHRONIZE_ACCOUNT_ITEM,events:{"click .btn-sync":"syncSettings","click .btn-cancel":"close","change .sync-all":"changeSyncAll","change .sync-one":"changeSyncOne","click .sync-icon":"changeSyncWay"},_initialize:function(){this.settings=null,this.to_sync_map=null,this.model.on("open_sync_window",this.render,this)},render:function(e){this.settings=e,this.sync_all=this.model.get("sync_all"),this.accounts=[],this.$el.openModal({ready:this.onRender.bind(this),complete:this.close.bind(this)})},onRender:function(){this.$(".accounts-wrap").empty();var e=this.model.list,t={},a={},i={},n={};o.each(this.settings.settings_data,function(e){i[e.jid]=e}),this.settings_map=i,o.each(this.settings.order_data.settings,function(e){n[e.jid]=e.order}),o.each(this.settings.deleted,function(e){a[e.jid]=e.timestamp}),o.each(i,function(a,i){e.get(i)||(t[i]=o.extend({jid:i,to_sync:this.sync_all,sync_way:"from_server"},a))}.bind(this)),e.each(function(e){var n=e.get("jid"),s=i[n],d;o.has(a,n)?(d=a[n]>=e.get("timestamp")?"delete":"to_server",t[n]=o.extend({sync_way:d,sync_choose:["delete","to_server"]},o.omit(e.attributes,["order"])),e.save("synced",!1)):s?(d=s.timestamp>e.get("timestamp")?"from_server":s.timestamp<e.get("timestamp")?"to_server":"no",t[n]=o.extend({jid:n,to_sync:e.get("to_sync"),sync_way:d,sync_choose:"no"!==d&&["from_server","to_server"]},s.settings),e.save("synced","no"===d)):(t[n]=o.extend({sync_way:"to_server"},o.omit(e.attributes,["order"])),e.save("synced",!1))}.bind(this));var s=o.max(n)||0;o.each(n,function(e,a){t[a].order=e}),e.each(function(e){var a=e.get("jid");t[a].order||(t[a].order=++s)}),this.accounts_map=t,this.accounts=o.map(t,function(e){return e}),this.accounts.sort(function(e,t){return e.order-t.order}),o.each(this.accounts,this.addAccountHtml.bind(this)),this.updateSyncOptions()},addAccountHtml:function(e){var t=e.jid,a=s(i.sync_settings_account_item({jid:t,view:this}));this.$(".accounts-wrap").append(a)},updateAccountHtml:function(e){var t=s(e),i=t.data("jid"),n=this.accounts_map[i];this.sync_all&&(n.to_sync=!0),t.switchClass("sync",n.to_sync),t.find(".sync-one").prop("checked",n.to_sync);var o=n.to_sync?n.sync_way:this.model.list.get(i)?"off_local":"off_remote";var d=a.SYNC_WAY_DATA[o].icon,r=t.find(".sync-icon");r.removeClass(r.attr("data-mdiclass")).attr("data-mdiclass",d).addClass(d),t.find(".sync-tip").text(a.SYNC_WAY_DATA[o].tip)},updateSyncOptions:function(){var e=this.model.list,t=this.sync_all,a=this.accounts_map;this.$(".sync-all").prop("checked",t?"checked":""),this.$(".sync-one").prop("disabled",t?"disabled":""),this.$(".account-wrap").each(function(e,t){this.updateAccountHtml(t)}.bind(this))},changeSyncAll:function(e){var t=s(e.target),a=t.prop("checked");this.sync_all=a,this.$(".sync-one").prop("disabled",a?"disabled":""),a&&(o.each(this.accounts,function(e){e.to_sync=!0}),this.$(".account-wrap").each(function(e,t){this.updateAccountHtml(t)}.bind(this)))},changeSyncOne:function(e){var t=s(e.target),a=t.prop("checked"),i=t.closest(".account-wrap"),n=i.data("jid");this.accounts_map[n].to_sync=a,this.updateAccountHtml(i)},changeSyncWay:function(e){var t=s(e.target).closest(".account-wrap"),a=t.data("jid"),i=this.accounts_map[a];if(i.to_sync&&i.sync_choose){var n=i.sync_choose,o=n.indexOf(i.sync_way)+1;o===n.length&&(o=0),i.sync_way=n[o],this.updateAccountHtml(t)}},syncSettings:function(){var e=this.model.list,t=this.sync_all;this.model.save("sync_all",this.sync_all),o.each(this.accounts,function(a){var i=a.jid,n=e.get(i);if(n){n.save("to_sync",a.to_sync),t&&n.save("order",a.order);var s=a.sync_way;"to_server"===s?n.update_timestamp():("from_server"===s||"delete"===s)&&n.save("timestamp",0)}!n&&a.to_sync&&(n=e.create_from_server(o.omit(a,["sync_way","sync_choose"])))}),this.model.synchronize_main_settings(),this.do_sync=!0,this.close()},onHide:function(){this.$el.detach(),e.body.isScreen("blank")&&e.body.setScreen("all-chats")},close:function(){this.do_sync||this.model.trigger("settings_result",null),this.do_sync=null,this.settings=null,this.settings_map=null,this.closeModal()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.APIAccountView=e.BasicView.extend({className:"setting xabber-account",template:i.xabber_account,avatar_size:a.AVATAR_SIZES.XABBER_ACCOUNT,events:{"click .account-info-wrap":"openAccount","click .btn-login":"login","click .btn-logout":"logout","click .btn-set-password":"setPassword","click .btn-sync-settings":"synchronize","click .social-linked-header":"changeExpanded","click .btn-unlink":"unlinkSocial","click .btn-link":"linkSocial","click .btn-verify-email":"verifyEmail"},_initialize:function(){this.$el.appendTo(this.parent.$(".settings-block-wrap.xabber-account")),this.$tab=this.parent.$(".xabber-account-tab"),this.updateForConnectedStatus(),this.default_color=n.images.getDefaultColor(this.model.get("username")),this.model.on("change:username",this.updateName,this),this.model.on("change:name",this.updateAvatar,this),this.model.on("change:connected",this.updateForConnectedStatus,this),this.model.on("change:last_sync",this.updateLastSyncInfo,this),this.model.on("change:linked_email_list",this.updateSocialBindings,this),this.model.on("change:linked_social",this.updateSocialBindings,this),this.model.on("relogin",this.login,this),this.data.on("change:sync",this.updateSyncButton,this),this.data.on("change:expanded",this.updateExpanded,this),this.data.set("expanded",!1)},render:function(){this.data.set("sync",!1),this.$("span.errors ").html(""),this.updateLastSyncInfo(),this.updateSocialBindings(),this.$(".btn-more").dropdown({inDuration:100,outDuration:100,hover:!1})},changeExpanded:function(){this.data.set("expanded",!this.data.get("expanded"))},updateExpanded:function(){var e=this.data.get("expanded");this.$(".arrow").switchClass("mdi-chevron-down",e),this.$(".arrow").switchClass("mdi-chevron-right",!e),this.$(".social-linked-wrap").showIf(e)},updateSocialBindings:function(){var e=this.model.get("linked_email_list"),t=this.model.get("linked_social");this.$(".email-linked").remove(),this.$(".social-account").each(function(e,t){var a=s(t);a.addClass("not-linked"),a.find(".synced-info").text("Not linked"),a.find(".btn-link").text("link").removeClass("btn-unlink")}),o.each(e,function(e){var t=e.id,a=e.email,n=e.verified,o=n?"Verified":"Unverified",d=s(i.linked_email_item({email_id:t,email:a,verified:n,verified_status:o,color:this.default_color}));d.insertBefore(this.$("#email.not-linked"))}.bind(this)),o.each(t,function(e){var t=e.provider,a=e.first_name+" "+e.last_name;this.$("."+t+"-linked").removeClass("not-linked"),this.$("."+t+"-linked .btn-link").text("unlink").addClass("btn-unlink"),this.$("."+t+"-linked .synced-info").html(s("<div class=\"name one-line\">"+a+"</div><div class=\"verified-status one-line\">Linked "+t+" account</div>"))}.bind(this))},linkSocial:function(e){if(this.model.get("token")&&!s(e.target).hasClass("btn-unlink")){var t=s(e.target).closest(".social-linked-item-wrap"),a=t.attr("id");"email"===a?n.dialogs.ask_enter_value("Add email",null,{input_placeholder_value:"Enter email address"},{ok_button_text:"link"}).done(function(e){e&&this.model._call_method("POST","/accounts/current/email_list/",{email:e},function(e){var t=this.model.get("linked_email_list");t.push(e),this.model.set("linked_email_list",t),this.updateSocialBindings()}.bind(this),function(e){this.$("span.errors ").text(e.email[0])}.bind(this))}.bind(this)):this.openAccount()}},verifyEmail:function(e){var t=s(e.target),a=t.closest(".social-linked-item-wrap"),i=a.data("email");n.dialogs.ask_enter_value("Confirm email",null,{input_placeholder_value:"Enter verification code"},{ok_button_text:"verify",resend_button_text:"resend code",resend_to:i}).done(function(e){e&&(e===i?this.model._call_method("POST","/accounts/current/email_list/",{email:e}):this.model._call_method("POST","/accounts/email_confirmation/",{code:e},function(e){var t=e.email_list;this.model.set("linked_email_list",t),this.updateSocialBindings()}.bind(this),function(e){this.$("span.errors ").text(e.code[0])}.bind(this)))}.bind(this))},unlinkSocial:function(e){var t=s(e.target);if(!t.hasClass("btn-verify-email")){var a=t.closest(".social-linked-item-wrap"),i=a.attr("id"),o=a.data("email");if(o){var d=a.data("email");n.dialogs.ask("Unlink email","Do you want to unlink email "+d+"?",null,{ok_button_text:"unlink"}).done(function(e){e&&this.model._call_method("DELETE","/accounts/current/email_list/"+a.data("id")+"/",null,function(){var e=this.model.get("linked_email_list"),t=e.indexOf(e.find(e=>e.id===a.data("id")));e.splice(t,1),this.model.set("linked_email_list",e),this.updateSocialBindings()}.bind(this),function(){this.model.get_settings()}.bind(this))}.bind(this))}else"email"!==i&&n.dialogs.ask("Unlink social account","Do you want to unlink "+i+" account?",null,{ok_button_text:"unlink"}).done(function(e){e&&this.model._call_method("POST","/accounts/current/social_unbind/",{provider:i},function(){var e=this.model.get("linked_social"),t=e.indexOf(e.find(e=>e.provider===i));e.splice(t,1),this.model.set("linked_social",e),this.updateSocialBindings()}.bind(this),function(){this.model.get_settings()}.bind(this))}.bind(this))}},updateName:function(){this.$(".account-info-wrap .name").text(this.model.get("username")),this.default_color=n.images.getDefaultColor(this.model.get("username"))},updateAvatar:function(){var e=this.model.get("name"),t=this.model.get("image")||n.images.getDefaultAvatar(e);this.$(".circle-avatar").setAvatar(n.images.getCachedImage(t),this.avatar_size)},updateForConnectedStatus:function(){var e=this.model.get("connected");this.$tab.switchClass("online",e).switchClass("offline",!e),this.$(".linked-social-accounts-and-emails").showIf(e),this.$(".account-info-wrap").showIf(e),this.$(".sync-wrap").showIf(e),e&&(this.updateName(),this.updateAvatar(),this.updateSyncButton(),this.updateLastSyncInfo()),this.$(".btn-login").hideIf(e),this.$(".btn-more").showIf(e)},updateSyncButton:function(){var e=this.data.get("sync");this.$(".btn-sync .button").hideIf(e),this.$(".btn-sync .preloader-wrapper").showIf(e)},updateLastSyncInfo:function(){var e=this.model.get("last_sync");if(e){var t=n.now()-e;this.$(".last-sync-info").text("Synced "+n.pretty_timedelta(t))}else this.$(".last-sync-info").text("Not synced")},synchronize:function(){this.data.get("sync")||(this.data.set("sync",!0),this.model.once("settings_result",function(){this.data.set("sync",!1)},this),this.model.save("sync_request","window"),this.model.get_settings())},login:function(){if(1<e.accounts.connected.length)e.add_api_account_view.show();else{var t=e.accounts.connected[0];t&&(t.set("auto_login_xa",!0),t.authXabberAccount())}},logout:function(){this.model.logout()},onPasswordResetFailed:function(){n.dialogs.error("For reset password need at least one confirmed email")},setPassword:function(){var e=this.model.get("linked_email_list");if(e){var t=e.find(e=>!0===e.verified);-1==e.indexOf(t)?this.onPasswordResetFailed():s.ajax({type:"POST",url:a.API_SERVICE_URL+"/accounts/password_reset_request/",contentType:"application/json",dataType:"json",data:JSON.stringify({email:t.email}),success:function(){n.dialogs.notify("Set password","Request for set password sent on email "+t.email)}.bind(this),error:this.onPasswordResetFailed.bind(this)})}else this.onPasswordResetFailed()},openAccount:function(){n.openWindow(a.XABBER_ACCOUNT_URL+"/?token="+this.model.get("token"))}}),e.once("start",function(){this.account_settings_list=new this.AccountSettingsList(null,{storage_name:this.getStorageName()+"-account-settings"}),this.account_settings_list.fetch(),this.account_settings_list.order_timestamp=new this.AccountsOrderTimestamp({id:"accounts-order-timestamp"},{storage_name:this.getStorageName(),fetch:"after"}),this.api_account=new this.APIAccount({id:"api-account"},{storage_name:this.getStorageName(),fetch:"before",settings_list:this.account_settings_list}),this.xabber_login_panel=e.login_page.addChild("xabber_login",this.XabberLoginPanel,{model:this.api_account}),this.sync_settings_view=new this.SyncSettingsView({model:this.api_account}),this.settings_view.addChild("api-account",this.APIAccountView,{model:this.api_account}),this.add_api_account_view=new this.AddAPIAccountView({model:this.api_account}),this.email_auth_view=new e.XabberLoginByEmailPanel({parent:this.add_api_account_view,model:this.api_account})},e),e}}),define("xabber-strophe",[],function(){var e=String.fromCharCode;return function(t){var a=t.env,i=a.$iq,n=a.Strophe,s=a.constants;n.log=function(e,t){var a=s.LOG_LEVEL===s.LOG_LEVEL_DEBUG||s.LOG_LEVEL>=s.LOG_LEVEL_WARN&&e>=n.LogLevel.WARN||s.LOG_LEVEL>=s.LOG_LEVEL_ERROR&&e>=n.LogLevel.ERROR;a&&(console.info("Strophe log: "),console.info(t))};var o=function(t){var a="",n=t.length,s,o;for(s=0;s<n;s++)o=t.charCodeAt(s),0<=o&&127>=o?a+=t.charAt(s):2047<o?(a+=e(224|15&o>>12),a+=e(128|63&o>>6),a+=e(128|63&o>>0)):(a+=e(192|31&o>>6),a+=e(128|63&o>>0));return a};return n.SASLXTOKEN=function(){},n.SASLXTOKEN.prototype=new n.SASLMechanism("X-TOKEN",!0,100),n.SASLXTOKEN.prototype.test=function(){return!0},n.SASLXTOKEN.prototype.onChallenge=function(t){var a=e(0)+t.authcid+e(0)+t.pass;return o(a)},n.ConnectionManager=function(e){this.connection=new n.Connection(e)},n.ConnectionManager.prototype={connect:function(e,t,a,i){this.connection.mechanisms={},this.auth_type=e||"password","password"===this.auth_type?this.connection.registerSASLMechanisms([n.SASLAnonymous,n.SASLExternal,n.SASLMD5,n.SASLPlain,n.SASLSHA1]):"x-token"===this.auth_type?(this.connection.registerSASLMechanism(n.SASLXTOKEN),delete this.connection._sasl_data["server-signature"]):(this.connection.registerSASLMechanisms([n.SASLXOAuth2]),delete this.connection._sasl_data["server-signature"]),this.connection.connect(t,a,i)},reconnect:function(e){"x-token"!==this.auth_type||this.connection.mechanisms["X-TOKEN"]||(this.connection.registerSASLMechanism(n.SASLXTOKEN),delete this.connection._sasl_data["server-signature"]),this.connection.connect(this.connection.jid,this.connection.pass,e)}},_.extend(n.Connection.prototype,{_sasl_auth1_cb:function(e){this.features=e;var t,s;for(t=0;t<e.childNodes.length;t++)s=e.childNodes[t],"bind"===s.nodeName&&(this.do_bind=!0),"session"===s.nodeName&&(this.do_session=!0),"x-token"===s.nodeName&&s.namespaceURI===n.NS.AUTH_TOKENS&&(this.x_token_auth=!0),"synchronization"===s.nodeName&&s.namespaceURI===n.NS.SYNCHRONIZATION&&(this.do_synchronization=!0);return this.do_bind?(this.x_token_auth&&(!this.x_token||1e3*parseInt(this.x_token.expire)<a.moment.now())?this.getXToken(function(e){let t=$(e).find("token").text(),a=$(e).find("expire").text(),i=$(e).find("token-uid").text();this.x_token={token:t,expire:a,token_uid:i},this.pass=t,this._send_auth_bind()}.bind(this),function(){this._send_auth_bind()}.bind(this)):this._send_auth_bind(),!1):(this._changeConnectStatus(n.Status.AUTHFAIL,null),!1)},_send_auth_bind(){this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var e=n.getResourceFromJid(this.jid);e?this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:n.NS.BIND}).c("resource",{}).t(e).tree()):this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:n.NS.BIND}).tree())},getXToken:function(e,a){let s=uuid(),o=i({type:"set",to:this.domain,id:s}).c("issue",{xmlns:n.NS.AUTH_TOKENS}).c("client").t(t.get("client_name")).up().c("device").t("PC, "+navigator.platform);handler=function(t){var i=t.getAttribute("type");if("result"==i)e&&e(t);else if("error"==i)a&&a(t);else throw{name:"StropheError",message:"Got bad IQ type of "+i}},this._addSysHandler(handler.bind(this),n.NS.AUTH_TOKENS,"iq","result",s),this.send(o.tree())}}),n.xmlunescape=function(e){let t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":"\"","&apos;":"'"};let a="(?:"+_.keys(t).join("|")+")",i=RegExp(a),n=RegExp(a,"g");return e=null==e?"":""+e,i.test(e)?e.replace(n,function(e){return t[e]}):e},n.addNamespace("CARBONS","urn:xmpp:carbons:2"),n.addNamespace("FORWARD","urn:xmpp:forward:0"),n.addNamespace("HINTS","urn:xmpp:hints"),n.addNamespace("RECEIPTS","urn:xmpp:receipts"),n.addNamespace("JINGLE","urn:xmpp:jingle:1"),n.addNamespace("JINGLE_SECURITY_STUB","urn:xmpp:jingle:security:stub:0"),n.addNamespace("JINGLE_MSG","urn:xmpp:jingle-message:0"),n.addNamespace("JINGLE_RTP","urn:xmpp:jingle:apps:rtp:1"),n.addNamespace("JINGLE_TRANSPORTS_ICE","urn:xmpp:jingle:transports:ice-udp:1"),n.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),n.addNamespace("EXTENDED_CHATSTATES","https://xabber.com/protocol/extended-chatstates"),n.addNamespace("HTTP_AUTH","http://jabber.org/protocol/http-auth"),n.addNamespace("AUTH_TOKENS","http://xabber.com/protocol/auth-tokens"),n.addNamespace("SYNCHRONIZATION","http://xabber.com/protocol/synchronization"),n.addNamespace("DELIVERY","http://xabber.com/protocol/delivery"),n.addNamespace("MAM","urn:xmpp:mam:1"),n.addNamespace("RSM","http://jabber.org/protocol/rsm"),n.addNamespace("XDATA","jabber:x:data"),n.addNamespace("CHAT_MARKERS","urn:xmpp:chat-markers:0"),n.addNamespace("VCARD_UPDATE","vcard-temp:x:update"),n.addNamespace("HTTP_UPLOAD","urn:xmpp:http:upload"),n.addNamespace("BLOCKING","urn:xmpp:blocking"),n.addNamespace("SEARCH","jabber:iq:search"),n.addNamespace("PRIVATE_STORAGE","jabber:iq:private"),n.addNamespace("OOB","jabber:x:oob"),n.addNamespace("MEDIA","urn:xmpp:media-element"),n.addNamespace("LAST","jabber:iq:last"),n.addNamespace("GROUP_CHAT","http://xabber.com/protocol/groupchat"),n.addNamespace("INDEX","http://xabber.com/protocol/index"),n.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),n.addNamespace("PUBSUB_AVATAR_DATA","urn:xmpp:avatar:data"),n.addNamespace("PUBSUB_AVATAR_METADATA","urn:xmpp:avatar:metadata"),n.addNamespace("REWRITE","http://xabber.com/protocol/rewrite"),n.addNamespace("REFERENCE","urn:xmpp:reference:0"),t}}),define("xabber-vcard",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.vcard,n=t.$,s=t._,o=t.moment,d=t.Strophe,r=t.$iq,c=t.$build,l=t.utils,p=function(e){var t={nickname:e.find("NICKNAME").text().trim(),fullname:e.find("FN").text().trim(),first_name:e.find("N GIVEN").text().trim(),middle_name:e.find("N MIDDLE").text().trim(),last_name:e.find("N FAMILY").text().trim(),birthday:e.find("BDAY").text().trim(),job_title:e.find("TITLE").text().trim(),role:e.find("ROLE").text().trim(),url:e.find("URL").text().trim(),description:e.find("DESC").text().trim(),jabber_id:e.find("JABBERID").text().trim(),org:{},photo:{},phone:{},address:{},email:{}},a=e.find("ORG");a.length&&(t.org.name=a.find("ORGNAME").text().trim(),t.org.unit=a.find("ORGUNIT").text().trim());var i=e.find("PHOTO");return i.length&&(t.photo.image=i.find("BINVAL").text().trim(),t.photo.type=i.find("TYPE").text().trim()),e.find("TEL").each(function(){var e=n(this),a=e.find("NUMBER").text().trim();a&&(e.find("WORK").length?t.phone.work=a:e.find("HOME").length?t.phone.home=a:e.find("MOBILE").length?t.phone.mobile=a:t.phone.default=a)}),e.find("EMAIL").each(function(){var e=n(this),a=e.find("USERID").text().trim();a&&(e.find("WORK").length?t.email.work=a:e.find("HOME").length?t.email.home=a:t.email.default=a)}),e.find("ADR").each(function(){var e=n(this),a={extadd:e.find("EXTADD").text().trim(),street:e.find("STREET").text().trim(),locality:e.find("LOCALITY").text().trim(),region:e.find("REGION").text().trim(),pcode:e.find("PCODE").text().trim(),country:e.find("CTRY").text().trim()};e.find("WORK").length?t.address.work=a:e.find("HOME").length?t.address.home=a:t.address.default=a}),t},u=function(e){var t=c("vCard",{xmlns:d.NS.VCARD});return e.nickname&&t.c("NICKNAME").t(e.nickname).up(),e.fullname&&t.c("FN").t(e.fullname).up(),(e.first_name||e.last_name||e.middle_name)&&(t.c("N"),e.first_name&&t.c("GIVEN").t(e.first_name).up(),e.last_name&&t.c("FAMILY").t(e.last_name).up(),e.middle_name&&t.c("MIDDLE").t(e.middle_name).up(),t.up()),e.birthday&&t.c("BDAY").t(e.birthday).up(),e.job_title&&t.c("TITLE").t(e.job_title).up(),e.role&&t.c("ROLE").t(e.role).up(),(e.org.name||e.org.unit)&&(t.c("ORG"),e.org.name&&t.c("ORGNAME").t(e.org.name).up(),e.org.unit&&t.c("ORGUNIT").t(e.org.unit).up(),t.up()),e.url&&t.c("URL").t(e.url).up(),e.photo.image&&(t.c("PHOTO").c("BINVAL").t(e.photo.image).up(),t.c("TYPE").t(e.photo.type||"image/jpeg").up(),t.up()),e.description&&t.c("DESC").t(e.description).up(),e.jabber_id&&t.c("JABBERID").t(e.jabber_id).up(),s.each(e.phone,function(e,a){t.c("TEL").c("NUMBER").t(e).up(),"default"!==a&&t.c(a.toUpperCase()).up(),t.up()}),s.each(e.email,function(e,a){t.c("EMAIL").c("USERID").t(e).up(),"default"!==a&&t.c(a.toUpperCase()).up(),t.up()}),s.each(e.address,function(e,a){t.c("ADR"),"default"!==a&&t.c(a.toUpperCase()).up(),e.extadd&&t.c("EXTADD").t(e.extadd).up(),e.street&&t.c("STREET").t(e.street).up(),e.locality&&t.c("LOCALITY").t(e.locality).up(),e.region&&t.c("REGION").t(e.region).up(),e.pcode&&t.c("PCODE").t(e.pcode).up(),e.country&&t.c("CTRY").t(e.country).up(),t.up()}),t.tree()};return d.addConnectionPlugin("vcard",{_connection:null,init:function(e){return this._connection=e,d.addNamespace("VCARD","vcard-temp")},get:function(e,t,a){var i=r({type:"get",to:e}).c("vCard",{xmlns:d.NS.VCARD});this._connection.sendIQ(i,function(a){if(t){var i=p(n(a).find("vCard[xmlns="+d.NS.VCARD+"]"));return i.jabber_id||(i.jabber_id=e),t(i)}},a)},set:function(e,t,a,i){t.jabber_id||(t.jabber_id=e);var n=r({type:"set",to:e}).cnode(u(t));this._connection.sendIQ(n,a,i)}}),l.vcard={getBlank:function(e){var t=p(n("<div/>"));return t.jabber_id=e,t}},e.VCardView=e.BasicView.extend({template:i.vcard,_initialize:function(){this.$el.html(this.template()),this.model.on("change:vcard_updated",this.update,this),this.data.on("change:refresh",this.updateRefreshButton,this)},render:function(){this.$(".block-header .block-name").text(this.model.get("group_chat")?"Group chat details":"Contact details"),this.data.set("refresh",!1),this.update()},update:function(){var e=this.model.get("vcard"),t;t=this.$(".jid-info-wrap"),t.find(".jabber-id").showIf(e.jabber_id).find(".value").text(e.jabber_id),t.showIf(e.jabber_id),t=this.$(".personal-info-wrap"),t.find(".nickname").showIf(e.nickname).find(".value").text(e.nickname),t.find(".fullname").showIf(e.fullname).find(".value").text(e.fullname),t.find(".first-name").showIf(e.first_name).find(".value").text(e.first_name),t.find(".middle-name").showIf(e.middle_name).find(".value").text(e.middle_name),t.find(".last-name").showIf(e.last_name).find(".value").text(e.last_name),t.showIf(e.nickname||e.fullname||e.first_name||e.middle_name||e.last_name),t=this.$(".birthday-info-wrap"),t.find(".birthday").showIf(e.birthday).find(".value").text(e.birthday),t.showIf(e.birthday),t=this.$(".job-info-wrap"),t.find(".job-title").showIf(e.job_title).find(".value").text(e.job_title),t.find(".org-name").showIf(e.org.name).find(".value").text(e.org.name),t.find(".org-unit").showIf(e.org.unit).find(".value").text(e.org.unit),t.showIf(e.job_title||e.org.name||e.org.unit),t=this.$(".site-info-wrap"),t.find(".url").showIf(e.url).find(".value").text(e.url).hyperlinkify(),t.showIf(e.url),t=this.$(".description-info-wrap"),t.find(".description").showIf(e.description).find(".value").text(e.description),t.showIf(e.description);var a=this.$(".address-info-wrap"),i=s.clone(e.address),n=!1;a.find(".info").addClass("hidden"),s.each(i,function(e,i){t=a.find(".address-"+i),t.find(".extadd").showIf(e.extadd).text(e.extadd),t.find(".street").showIf(e.street).text(e.street),t.find(".locality").showIf(e.locality).text(e.locality),t.find(".region").showIf(e.region).text(e.region),t.find(".pcode").showIf(e.pcode).text(e.pcode),t.find(".country").showIf(e.country).text(e.country);var s=e.extadd||e.street||e.locality||e.region||e.pcode||e.country;s&&(n=!0),t.showIf(s)}),a.showIf(n),t=this.$(".phone-info-wrap");var o=e.phone;o&&(t.find(".phone-work").showIf(o.work).find(".value").text(o.work),t.find(".phone-home").showIf(o.home).find(".value").text(o.home),t.find(".phone-mobile").showIf(o.mobile).find(".value").text(o.mobile),t.find(".phone-default").showIf(o.default).find(".value").text(o.default)),t.showIf(o&&(o.work||o.home||o.mobile||o.default)),t=this.$(".email-info-wrap");var d=e.email;d&&(t.find(".email-work").showIf(d.work).find(".value").text(d.work),t.find(".email-home").showIf(d.home).find(".value").text(d.home),t.find(".email-default").showIf(d.default).find(".value").text(d.default)),t.showIf(d&&(d.work||d.home||d.default)),this.parent.updateScrollBar()},onClickIcon:function(e){let t=n(e.target).closest(".info-wrap"),a=t.find(".value"),i="";a.each(function(e,t){let a=n(t),s=a.text();s&&""!=i&&(i+="\n"),s&&(i+=s),i&&l.copyTextToClipboard(i,"Copied in clipboard","ERROR: Not copied in clipboard")}.bind(this))},updateRefreshButton:function(){this.$(".btn-vcard-refresh .button").hideIf(this.data.get("refresh")),this.$(".btn-vcard-refresh .preloader-wrapper").showIf(this.data.get("refresh"))},refresh:function(){this.data.get("refresh")||(this.data.set("refresh",!0),this.model.getVCard(function(){this.data.set("refresh",!1)}.bind(this)))}}),e.VCardEditView=e.BasicView.extend({className:"account-vcard-edit-wrap",template:i.vcard_edit,ps_selector:".panel-content",avatar_size:a.AVATAR_SIZES.ACCOUNT_VCARD_EDIT,events:{"change .circle-avatar input":"changeAvatar","click .btn-vcard-save":"save","click .btn-vcard-back":"back"},_initialize:function(){this.$(".datepicker").pickadate({selectMonths:!0,selectYears:100,min:new Date(o.now()-31536e8),max:new Date(o.now()-864e5),format:"dd.mm.yyyy",today:"",klass:{weekday_display:"picker__weekday-display ground-color-700",date_display:"picker__date-display ground-color-500",navPrev:"picker__nav--prev hover-ground-color-100",navNext:"picker__nav--next hover-ground-color-100",selected:"picker__day--selected ground-color-500",now:"picker__day--today text-color-700",buttonClear:"btn-flat btn-main btn-dark",buttonClose:"btn-flat btn-main text-color-700"}}),this.data.on("change:saving",this.updateSaveButton,this)},render:function(){this.data.set("saving",!1),this.setData(),Materialize.updateTextFields(),this.updateScrollBar()},setData:function(){var e=this.model.get("vcard");this.$(".nickname input").val(e.nickname),this.$(".fullname input").val(e.fullname),this.$(".first-name input").val(e.first_name),this.$(".last-name input").val(e.last_name),this.$(".middle-name input").val(e.middle_name),this.$(".circle-avatar").setAvatar(this.model.cached_image,this.avatar_size),this.$(".birthday input").val(e.birthday),this.$(".job-title input").val(e.job_title),this.$(".org-name input").val(e.org.name),this.$(".org-unit input").val(e.org.unit),this.$(".url input").val(e.url),this.$(".description textarea").val(e.description),this.$(".phone-work input").val(e.phone.work),this.$(".phone-home input").val(e.phone.home),this.$(".phone-mobile input").val(e.phone.mobile),this.$(".email-work input").val(e.email.work),this.$(".email-home input").val(e.email.home);var t=e.address.work||{},a=this.$(".address-work-wrap");a.find(".extadd input").val(t.extadd),a.find(".street input").val(t.street),a.find(".locality input").val(t.locality),a.find(".region input").val(t.region),a.find(".pcode input").val(t.pcode),a.find(".country input").val(t.country),t=e.address.home||{},a=this.$(".address-home-wrap"),a.find(".extadd input").val(t.extadd),a.find(".street input").val(t.street),a.find(".locality input").val(t.locality),a.find(".region input").val(t.region),a.find(".pcode input").val(t.pcode),a.find(".country input").val(t.country)},getData:function(){var e=l.vcard.getBlank(this.model.get("jid"));e.nickname=this.$(".nickname input").val(),e.fullname=this.$(".fullname input").val(),e.first_name=this.$(".first-name input").val(),e.last_name=this.$(".last-name input").val(),e.middle_name=this.$(".middle-name input").val(),e.birthday=this.$(".birthday input").val(),e.job_title=this.$(".job-title input").val(),e.org.name=this.$(".org-name input").val(),e.org.unit=this.$(".org-unit input").val(),e.url=this.$(".url input").val(),e.description=this.$(".description textarea").val(),e.phone.work=this.$(".phone-work input").val(),e.phone.home=this.$(".phone-home input").val(),e.phone.mobile=this.$(".phone-mobile input").val(),e.email.work=this.$(".email-work input").val(),e.email.home=this.$(".email-home input").val(),e.address.work={};var t=e.address.work,a=this.$(".address-work-wrap");return t.extadd=a.find(".extadd input").val(),t.street=a.find(".street input").val(),t.locality=a.find(".locality input").val(),t.region=a.find(".region input").val(),t.pcode=a.find(".pcode input").val(),t.country=a.find(".country input").val(),e.address.home={},t=e.address.home,a=this.$(".address-home-wrap"),t.extadd=a.find(".extadd input").val(),t.street=a.find(".street input").val(),t.locality=a.find(".locality input").val(),t.region=a.find(".region input").val(),t.pcode=a.find(".pcode input").val(),t.country=a.find(".country input").val(),e},changeAvatar:function(e){var t=e.target;if(t.files.length){var i=t.files[0];return(t.value="",i.size>a.MAX_AVATAR_FILE_SIZE)?void l.dialogs.error("File is too large"):i.type.startsWith("image")?void l.images.getAvatarFromFile(i).done(function(e,t,a){e?(this.avatar={base64:e,hash:t,size:a},this.$(".circle-avatar").setAvatar(e,this.avatar_size)):l.dialogs.error("Wrong image")}.bind(this)):void l.dialogs.error("Wrong image")}},updateSaveButton:function(){this.$(".btn-vcard-save").text(this.data.get("saving")?"Saving...":"Save")},save:function(){this.data.get("saving")||(this.data.set("saving",!0),this.avatar&&this.model.pubAvatar(this.avatar),this.model.setVCard(this.getData(),function(){this.model.getVCard(),this.data.set("saving",!1)}.bind(this),function(){l.dialogs.error("Could not save vCard."),this.data.set("saving",!1)}))},back:function(){this.model.showSettings(null,"vcard")}}),e}}),define("xabber-accounts",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.accounts,n=t.utils,s=t.$,o=t.$iq,d=t.$msg,r=t.$pres,c=t.Strophe,l=t._,p=t.moment,u=n.images;return e.Account=Backbone.Model.extend({idAttribute:"jid",defaults:{enabled:!0,auth_type:"password",status:"online",status_message:"",priority:0,auto_login_xa:!0,groupchat_servers_list:[]},initialize:function(t,i){if(i||(i={}),t.is_new&&!i.auth_view)return this.is_invalid=!0,void this.on("destroy",this.onDestroy,this);this.last_msg_timestamp=0,this.settings=e.account_settings_list.get(t.jid),this.settings||(this.settings=e.account_settings_list.create({jid:t.jid,timestamp:n.now(),auto_login_xa:this.get("auto_login_xa"),to_sync:e.api_account.get("sync_all")}));var o=l.clone(this.settings.attributes);o.color||(o.color=this.collection.getDefaultColor()),o.order||(o.order=this.collection.getLastOrder()+1),this.settings.save(o),this.settings.on("delete_account",this.deleteAccount,this);var d=l.clone(t);d.name||(d.name=d.jid),d.image||(d.image=u.getDefaultAvatar(d.name)),this.cached_image=u.getCachedImage(d.image),d.vcard=n.vcard.getBlank(d.jid),d.photo_hash="",this.save(d),this.auth_view=i.auth_view||null,this.session=new Backbone.Model({connected:!1,reconnected:!1,conn_retries:0,conn_feedback:"Disconnected"}),this._waiting_code=!1,this.code_requests=[],this.xabber_auth={},this.session.on("change:connected",this.onChangedConnected,this),this.CONNECTION_URL=t.websocket_connection_url||a.CONNECTION_URL,this.conn_manager=new c.ConnectionManager(this.CONNECTION_URL),this.connection=this.conn_manager.connection,this.get("x_token")&&(this.connection.x_token=this.get("x_token")),this.on("destroy",this.onDestroy,this),this._added_pres_handlers=[],this._pending_stanzas=[],this._pending_messages=[],this.dfd_presence=new s.Deferred,this.resources=new e.AccountResources(null,{account:this}),this.password_view=new e.ChangePasswordView({model:this}),this.settings_left=new e.AccountSettingsLeftView({model:this}),this.settings_right=new e.AccountSettingsRightView({model:this}),this.vcard_edit=new e.VCardEditView({model:this}),this.updateColorScheme(),this.settings.on("change:color",this.updateColorScheme,this),this.on("change:photo_hash",this.getVCard,this),l.each(this._init_plugins,function(e){e.call(this)}.bind(this)),this.connection.xmlInput=function(t){e.info("input"),e.info(t)},this.connection.xmlOutput=function(t){e.info("output"),e.info(t)},this.once("start",this.start,this),e.api_account.on("settings_result",function(e){e&&this.settings.get("token")&&this.save({auth_type:"token",password:""}),this.trigger("start")},this)},start:function(){this.get("enabled")&&this.isOnline()&&this.connect()},_init_plugins:[],getPassword:function(){try{return n.atou(this.get("password"))}catch(t){return""}},isConnected:function(){return this.session&&this.session.get("connected")},isOnline:function(){return"offline"!==this.get("status")},sendMsg:function(e,t){var a=this.connection.authenticated&&"offline"!==this.get("status");return a?(this.connection.send(e),t&&t()):this._pending_stanzas.push({stanza:e,callback:t}),a},pubAvatar:function(e,t,a){var i=e.hash||sha1(e.base64),n=o({from:this.get("jid"),type:"set"}).c("pubsub",{xmlns:c.NS.PUBSUB}).c("publish",{node:c.NS.PUBSUB_AVATAR_DATA}).c("item",{id:i}).c("data",{xmlns:c.NS.PUBSUB_AVATAR_DATA}).t(e.base64),s=o({from:this.get("jid"),type:"set"}).c("pubsub",{xmlns:c.NS.PUBSUB}).c("publish",{node:c.NS.PUBSUB_AVATAR_METADATA}).c("item",{id:i}).c("metadata",{xmlns:c.NS.PUBSUB_AVATAR_METADATA}).c("info",{bytes:e.size,id:i,type:"image/jpeg"});this.sendIQ(n,function(){this.sendIQ(s,function(){t&&t(i)}.bind(this),function(e){a&&a(e)})}.bind(this),function(e){a&&a(e)}.bind(this))},getAvatar:function(e,t,a){var i=o({from:this.get("jid"),type:"get",to:this.get("jid")}).c("pubsub",{xmlns:c.NS.PUBSUB}).c("items",{node:c.NS.PUBSUB_AVATAR_DATA}).c("item",{id:e});this.sendIQ(i,function(e){var i=s(e).find("data").text();""==i?a&&a("Node is empty"):t&&t(i)}.bind(this))},sendIQ:function(){var e=this.connection.authenticated&&"offline"!==this.get("status");return e?this.connection.sendIQ.apply(this.connection,arguments):this._pending_stanzas.push({stanza:arguments}),e},sendPres:function(e){return this.connection.authenticated?this.connection.send(e):this._pending_stanzas.push({stanza:e}),this.connection.authenticated},verifyXabberAccount:function(e,t){var i={type:"POST",url:a.API_SERVICE_URL+"/accounts/xmpp_auth/",contentType:"application/json",dataType:"json",data:JSON.stringify({code:e,jid:this.connection.jid}),success:function(e){t&&t(e.token)}};s.ajax(i)},connect:function(t){t=t||{};var a=this.get("jid"),i=this.get("auth_type"),n;if(a+="/xabber-web-"+e.get("client_id"),this.connection.x_token=this.get("x_token"),n="token"===i?this.settings.get("token"):"x-token"===i?this.get("x_token")&&(1e3*parseInt(this.get("x_token").expire)>p.now()||!this.get("x_token").expire)?this.get("x_token").token:void 0:this.getPassword(),!n){let e={login:!0};return t.token_invalidated&&(e.token_invalidated=!0),void this.password_view.show(e)}this.session.set({connected:!1,reconnected:!1,reconnecting:!1,conn_retries:0,conn_feedback:"Connecting...",auth_failed:!1}),this.restoreStatus(),this.conn_manager.connect(i,a,n,this.connectionCallback.bind(this))},reconnect:function(){var e=this.session.get("conn_retries"),t=3>e?a.RECONNECTION_TIMEOUTS[e]:2e4;this.connection.reset(),this.session.set({connected:!1,reconnected:!1,reconnecting:!0,conn_retries:++e,conn_feedback:"Reconnect after "+t/1e3+" seconds...",auth_failed:!1}),setTimeout(function(){this.connFeedback("Connecting..."),this.restoreStatus(),this.conn_manager.reconnect(this.reconnectionCallback.bind(this))}.bind(this),t)},connectionCallback:function(t,i){if(this.session.get("reconnecting"))return void e.info("ignore connection callback for status: "+a.CONN_STATUSES[t]);if(this.auth_view&&this.loginCallback(t,i),this.session.set({conn_status:t,conn_condition:i}),t!==c.Status.ERROR||"conflict"!==i||this.session.get("delete")||("x-token"===this.get("auth_type")?this.onTokenRevoked():this.onAuthFailed()),t===c.Status.CONNECTED)this.session.set("on_token_revoked",!1),this.connection.x_token&&(this.save({auth_type:"x-token",x_token:this.connection.x_token,password:null}),this.conn_manager.auth_type="x-token"),this.session.set({connected:!0,reconnected:!1}),e.api_account.get("connected")||!this.get("auto_login_xa")||e.api_account.get("token")||this.connectXabberAccount();else if(t===c.Status.AUTHFAIL)"x-token"===this.get("auth_type")||this.connection.x_token?this.onTokenRevoked():this.onAuthFailed();else if(t===c.Status.DISCONNECTED){if(this.session.get("on_token_revoked"))return;this.connection.flush(),this.session.set({connected:!1})}},connectXabberAccount:function(){var e=o({type:"get"}).c("query",{xmlns:c.NS.PRIVATE_STORAGE}).c("storage",{xmlns:"xabber:options"});this.sendIQ(e,function(e){"bind"==s(e).find("option").attr("type")&&1==s(e).find("option").text()&&this.authXabberAccount()}.bind(this))},authXabberAccount:function(t){this.requestPassword(function(a){if(this.xabber_auth={api_jid:a.api_jid,request_id:a.request_id},0<this.code_requests.length){let a=this.code_requests.find(e=>e.jid===this.xabber_auth.api_jid&&e.id===this.xabber_auth.request_id);if(a){let i=this.code_requests.indexOf(a);-1<i&&this.code_requests.splice(i,1),this.verifyXabberAccount(a.code,function(a){this._waiting_code=!1;let i=o({type:"set"}).c("query",{xmlns:c.NS.PRIVATE_STORAGE}).c("storage",{xmlns:"xabber:options"}).c("option",{type:"bind"}).t(1);e.api_account.save("token",a),e.api_account.login_by_token(),this.sendIQ(i),t&&t()}.bind(this))}if(this.code_requests.length){({from_jid:this.code_requests[0].jid,message:"Verification code is "+this.code_requests[0].code,is_archived:!1});this.createMessageFromIQ(msg_attr)}}}.bind(this))},requestPassword:function(e){var t={type:"POST",url:a.API_SERVICE_URL+"/accounts/xmpp_code_request/",contentType:"application/json",dataType:"json",data:JSON.stringify({jid:this.connection.jid,type:"iq"}),success:function(t){e&&e(t)}};this._waiting_code=!0,s.ajax(t)},reconnectionCallback:function(t,i){if(!this.session.get("reconnecting"))return void e.info("ignore reconnection callback for status: "+a.CONN_STATUSES[t]);if(this.session.set({conn_status:t,conn_condition:i}),t===c.Status.CONNECTED)this.session.set("on_token_revoked",!1),this.connection.connect_callback=this.connectionCallback.bind(this),this.session.set({connected:!0,reconnected:!0,reconnecting:!1,conn_retries:0});else if(t===c.Status.AUTHFAIL)"x-token"===this.get("auth_type")||this.connection.x_token?this.onTokenRevoked():this.onAuthFailed();else if(t===c.Status.DISCONNECTED){if(this.session.get("on_token_revoked"))return;this.connection.flush();var n=e.settings.max_connection_retries;-1===n||this.session.get("conn_retries")<n?this.reconnect():this.connFeedback("Connection lost!")}},loginCallback:function(e,t){e===c.Status.CONNECTED?(this.save("is_new",void 0),this.auth_view.successFeedback(this),this.auth_view=null):l.contains(a.BAD_CONN_STATUSES,e)&&(e===c.Status.ERROR?e="Connection error":e===c.Status.CONNFAIL?e="Connection failed":e===c.Status.AUTHFAIL?e="Authentication failed":e===c.Status.DISCONNECTED?e="Disconnected":e===c.Status.CONNTIMEOUT&&(e="Connection timeout expired"),t=t?": "+t:"",this.auth_view.errorFeedback({password:e+t}),this.get("is_new")&&this.destroy())},onAuthFailed:function(){this.auth_view||n.dialogs.error("Authentication failed for account "+this.get("jid")),this.session.set({auth_failed:!0,no_reconnect:!0}),this.trigger("deactivate",this),this.connFeedback("Authentication failed")},getAllXTokens:function(){var e=[],t=o({from:this.get("jid"),type:"get",to:this.connection.domain}).c("query",{xmlns:c.NS.AUTH_TOKENS+"#items"});this.sendIQ(t,function(t){s(t).find("field").each(function(t,a){var i=s(a),n=i.find("client").text(),o=i.find("device").text(),d=i.find("token-uid").text(),r=1e3*parseInt(i.find("expire").text()),c=1e3*parseInt(i.find("last-auth").text()),l=i.find("ip").text();e.push({client:n,device:o,token_uid:d,last_auth:c,expire:r,ip:l})}.bind(this)),this.x_tokens_list=e,this.settings_right.updateXTokens()}.bind(this))},onTokenRevoked:function(){this.auth_view||n.dialogs.error("Token was invalidated for account "+this.get("jid")),this.session.set({on_token_revoked:!0,auth_failed:!0,connected:!1,no_reconnect:!0}),this.set({auth_type:"password",password:null,x_token:null}),this.connection.pass="",this.trigger("deactivate",this),this.connFeedback("Token was invalidated"),this.connect({token_invalidated:!0})},onChangedConnected:function(){this.isConnected()?this.session.get("reconnected")?this.onReconnected():this.onConnected():this.onDisconnected()},onConnected:function(){this.connFeedback("Connected"),this.jid=this.connection.jid,this.resource=c.getResourceFromJid(this.jid),this.domain=c.getDomainFromJid(this.jid),this.trigger("activate",this),this.session.get("no_reconnect")&&this.session.set("no_reconnect",!1),this.afterConnected(),l.each(this._after_connected_plugins,function(e){e.call(this)}.bind(this))},onReconnected:function(){this.connFeedback("Connected"),this.afterConnected(),l.each(this._after_reconnected_plugins,function(e){e.call(this)}.bind(this))},afterConnected:function(){this.registerPresenceHandler(),this.enableCarbons(),this.getVCard(),this.sendPendingStanzas()},activateXabberRewrite:function(){var e=o({from:this.get("jid"),type:"set",to:this.get("jid")}).c("activate",{xmlns:c.NS.XABBER_REWRITE});this.sendIQ(e)},sendPendingStanzas:function(){l.each(this._pending_stanzas,function(e){e.stanza instanceof c.Builder?(this.connection.send(e.stanza),e.callback&&e.callback()):this.connection.sendIQ.apply(this.connection,e.stanza)}.bind(this)),this._pending_stanzas=[]},sendPendingMessages:function(){l.each(this._pending_messages,function(e){let t=this.messages.get(e.msg_id),i;t&&(i=t.get("xml"))&&t.set("state",a.MSG_PENDING),i&&this.sendMsg(i)}.bind(this))},_after_connected_plugins:[],_after_reconnected_plugins:[],onDisconnected:function(){if(this.disconnected_timestamp=this.last_stanza_timestamp,this.session.get("delete"))return void this.destroy();var e=this.session.get("deactivate");e?(this.connFeedback("Disconnected"),this.session.set("deactivate",null),"set_off"===e&&this.trigger("deactivate",this)):this.session.get("no_reconnect")?this.session.set("no_reconnect",!1):this.reconnect()},connFeedback:function(e){this.session.set("conn_feedback",e)},enableCarbons:function(){var e=o({type:"set"}).c("enable",{xmlns:c.NS.CARBONS});this.sendIQ(e)},getVCard:function(e){var t=this.get("jid"),i=l.isFunction(e);this.connection.vcard.get(t,function(n){var s={vcard:n,vcard_updated:p.now()};s.name=n.nickname||n.fullname||(n.first_name+" "+n.last_name).trim()||t,(!this.get("avatar_priority")||this.get("avatar_priority")<=a.AVATAR_PRIORITIES.VCARD_AVATAR)&&(n.photo.image?(s.avatar_priority=a.AVATAR_PRIORITIES.VCARD_AVATAR,s.image=n.photo.image):s.image=u.getDefaultAvatar(s.name),this.cached_image=u.getCachedImage(s.image)),this.save(s),i&&e(n)}.bind(this),function(){i&&e(null)})},setVCard:function(e,t,a){var i=l.extend(l.clone(this.get("vcard")),e);this.connection.vcard.set(this.get("jid"),i,function(){this.vcardPhotoUpdated(i.photo.image),t&&t()}.bind(this),a)},getStatusMessage:function(){return this.get("status_message")||a.STATUSES[this.get("status")]},setStatus:function(e,t){var a={status_updated:p.now()};null!==e&&(a.status=e),null!==t&&(a.status_message=t||""),"offline"===e&&"offline"!==this.get("status")&&(a.status_prev=this.get("status")),this.save(a),this.get("enabled")&&("offline"===e?this.deactivate("set_offline"):this.isConnected()?this.sendPresence():this.activate())},restoreStatus:function(){"offline"===this.get("status")&&this.save({status_updated:p.now(),status:this.get("status_prev")||"online",status_prev:void 0})},getAvatarHash:function(e){var t=e||this.get("vcard").photo.image;if(t){var a=atob(t),i=Uint8Array.from(Array.prototype.map.call(a,function(e){return e.charCodeAt(0)}));return sha1(i)}return""},vcardPhotoUpdated:function(e){let t=r().c("x",{xmlns:c.NS.VCARD_UPDATE}).c("photo").t(this.getAvatarHash(e)).up().up();return this.sendPres(t)},sendPresence:function(e,t){var e=e||this.get("status"),a=t||this.get("status_message"),i=r();return"offline"===e?i.attrs({type:"unavailable"}):("online"!==e&&i.c("show").t(e).up(),i.c("status").t(a).up(),i.c("priority").t(this.get("priority")).up()),i.cnode(this.connection.caps.createCapsNode({node:"https://www.xabber.com/"}).tree()),this.sendPres(i)},showSettings:function(t,a){e.body.setScreen("account_settings",{account:this,right:t,block_name:a}),this.trigger("open_settings")},updateColorScheme:function(){let e=this.settings.get("color");this.settings_left.$el.attr("data-color",e),this.settings_right.$el.attr("data-color",e),this.settings_right.$(".account-color .current-color-name").text(e),this.vcard_edit.$el.attr("data-color",e)},revokeXToken:function(e,t){let a=o({from:this.get("jid"),type:"set",to:this.connection.domain}).c("revoke",{xmlns:c.NS.AUTH_TOKENS});for(var i=0;i<e.length;i++)a.c("token-uid").t(e[i]).up();this.sendIQ(a,function(){t&&t()}.bind(this))},revokeAllXTokens:function(e,t){let a=o({from:this.get("jid"),type:"set",to:this.connection.domain}).c("revoke-all",{xmlns:c.NS.AUTH_TOKENS});this.sendIQ(a,function(t){e&e(t)}.bind(this),function(e){t&&t(e)})},deleteAccount:function(e){this.show_settings_after_delete=e,this.get("x_token")&&this.revokeXToken([this.get("x_token").token_uid]),this.session.set("delete",!0),this.deactivate()},activate:function(){this.isConnected()||this.connect()},deactivate:function(e){e||(e="set_off"),this.session.set("deactivate",e),this.isConnected()?(this.connFeedback("Disconnecting..."),this.sendPresence("offline"),this.connection.disconnect()):this.onDisconnected()},onDestroy:function(){this.connection.connect_callback=null,this.settings.destroy()},registerIQHandler:function(){this.connection.deleteHandler(this._stanza_handler),this._stanza_handler=this.connection.addHandler(function(e){return this.onIQ(e),!0}.bind(this),null,"iq","get")},registerPresenceHandler:function(){this.connection.deleteHandler(this._pres_handler),this._pres_handler=this.connection.addHandler(function(e){return this.onPresence(e),!0}.bind(this),null,"presence",null)},onIQ:function(t){let i=s(t),n=i.find("confirm[xmlns=\""+c.NS.HTTP_AUTH+"\"]"),d=i.find("query[xmlns=\""+c.NS.JINGLE_MSG+"\"]"),r=i.attr("from"),l;if(n.length)if(l=n.attr("id"),this._waiting_code&&n.attr("url")===a.XABBER_ACCOUNT_URL+"/auth/login/")this.xabber_auth.api_jid&&this.xabber_auth.request_id?i.attr("id")===this.xabber_auth.request_id&&r===this.xabber_auth.api_jid&&this.verifyXabberAccount(l,function(t){this._waiting_code=!1,this.get("auto_login_xa")&&(e.api_account.save("token",t),e.api_account.login_by_token())}.bind(this)):this.code_requests.push({jid:r,id:i.attr("id"),code:l});else{this.createMessageFromIQ(msg_attr)}if(d.length){let t=d.children("session").attr("id"),a;t&&e.current_voip_call&&t===e.current_voip_call.get("session_id")&&!e.current_voip_call.get("state")?(a=o({from:this.get("jid"),to:r,type:"result",id:i.attr("id")}).c("query",{xmlns:c.NS.JINGLE_MSG}).c("session",{id:t}),e.current_voip_call.updateStatus("Calling...")):a=o({from:this.get("jid"),to:r,type:"error",id:i.attr("id")}).c("error",{xmlns:c.NS.JINGLE_MSG}),this.sendIQ(a)}},createMessageFromIQ:function(e){let t=this.contacts.mergeContact(e.from_jid),a=this.chats.getChat(t);a.messages.create(e)},onPresence:function(e){var t=s(e),i=e.getAttribute("type");if("error"!==i){var n=e.getAttribute("from"),o=c.getBareJidFromJid(n);if(o!==this.get("jid"))return void l.each(this._added_pres_handlers,function(t){t(e,o)});var d=c.getResourceFromJid(n),r=+t.find("priority").text(),p=t.find("show").text()||"online",u=t.find("status").text();l.isNaN(r)&&(r=0);var m=t.find("x[xmlns=\""+c.NS.VCARD_UPDATE+"\"]");if(m.length&&this.get("avatar_priority")&&this.get("avatar_priority")<=a.AVATAR_PRIORITIES.VCARD_AVATAR&&this.save("photo_hash",m.find("photo").text()),d&&d!==this.resource){var g=this.resources.get(d);if("unavailable"===i)g&&g.destroy();else{var h={resource:d,priority:r,status:p,status_message:u};g?g.set(h):g=this.resources.create(h)}}}}},{addInitPlugin:function(e){this.prototype._init_plugins.push(e)},addConnPlugin:function(e,t,a){t&&this.prototype._after_connected_plugins.push(e),a&&this.prototype._after_reconnected_plugins.push(e)}}),e.Accounts=Backbone.CollectionWithStorage.extend({model:e.Account,comparator:function(e,t){return e.settings.get("order")<t.settings.get("order")?-1:1},_initialize:function(){this.settings_list=e.account_settings_list,this.getEnabledList(),this.getConnectedList(),this.on("add",this.onAdd,this),this.on("destroy",this.onDestroy,this),this.on("change:enabled",this.getEnabledList,this),this.on("update_order",this.onUpdatedOrder,this),this.on("add destroy activate deactivate",this.onListChanged,this),this.on("destroy deactivate",this.onAccountDisconnected,this),e.on("quit",this.onQuit,this),this.settings_list.on("add_settings",this.onSettingsAdded,this),e.api_account.on("settings_result",function(e){e&&this.trigger("update_order")},this)},onQuit:function(){e.api_account.revoke_token(),this.models.length||e.body.setScreen("login"),l.each(l.clone(this.models),function(e){e.deleteAccount()})},getEnabledList:function(){this.enabled=this.filter(function(e){return e.get("enabled")})},getConnectedList:function(){this.connected=this.filter(function(e){return e.isConnected()})},onListChanged:function(){this.getEnabledList(),this.getConnectedList(),this.trigger("list_changed",this)},onAdd:function(e){e.is_invalid&&e.destroy()},onDestroy:function(t){if(!t.get("is_new")){var a=!(this.length||e.api_account.get("connected"));a?e.body.setScreen("login"):t.show_settings_after_delete?e.body.setScreen("settings"):(e.body.setScreen("all-chats"),e.chats_view.showAllChats())}},onAccountDisconnected:function(){e.toolbar_view.recountAllMessageCounter(),e.recountAllMessageCounter()},onSettingsAdded:function(e){var t=e.get("jid");this.get(t)||this.create({jid:t})},onUpdatedOrder:function(){this.sort(),this.getEnabledList(),this.getConnectedList()},getLastOrder:function(){return this.length?this.last().settings.get("order"):0},getDefaultColor:function(){var e={},t=a.ACCOUNT_COLORS;this.each(function(t){e[t.settings.get("color")]=!0});for(var i=0;i<t.length;i++)if(!e[t[i]])return t[i];return"red"},moveBefore:function(e,t){var a=this.indexOf(t),i=0<a?this.at(a-1).settings.get("order"):0;e.settings.save("order",(t.settings.get("order")+i)/2),this._updateOrder()},moveToBottom:function(e){e.settings.save("order",this.getLastOrder()+1),this._updateOrder()},_updateOrder:function(){this.sort(),this.each(function(e,t){e.settings.save({order:t+1})}),this.trigger("update_order"),e.api_account.get("connected")&&(this.settings_list.order_timestamp.save("timestamp",n.now()),e.api_account.synchronize_order_settings())}}),e.AccountToolbarItemView=e.BasicView.extend({className:"toolbar-item account-item",template:i.toolbar_item,avatar_size:a.AVATAR_SIZES.TOOLBAR_ACCOUNT_ITEM,events:{"click .filter-chats":"filterChats",click:"showSettings"},_initialize:function(){this.updateConnected(),this.updateAuthState(),this.updateStatus(),this.updateAvatar(),this.updateColorScheme(),this.$el.attr("data-jid",this.model.get("jid")),this.model.session.on("change:auth_failed",this.updateAuthState,this),this.model.session.on("change:connected",this.updateConnected,this),this.model.on("change:status",this.updateStatus,this),this.model.on("change:image",this.updateAvatar,this),this.model.settings.on("change:color",this.updateColorScheme,this),this.model.on("filter_chats",this.setActive,this),this.model.on("open_settings",this.setActive,this)},updateConnected:function(){this.$el.switchClass("disconnected",!this.model.isConnected())},updateAuthState:function(){var e=this.model.session.get("auth_failed");this.$(".status").hideIf(e),this.$(".auth-failed").showIf(e)},updateStatus:function(){this.$(".status").attr("data-status",this.model.get("status"))},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateColorScheme:function(){this.$el.attr("data-color",this.model.settings.get("color"))},showSettings:function(){this.model.showSettings()},filterChats:function(t){t.stopPropagation(),e.chats_view.showChatsByAccount(this.model),this.model.trigger("filter_chats")},setActive:function(){e.toolbar_view.$(".toolbar-item").removeClass("active"),this.$el.addClass("active")}}),e.ToolbarAccountsBlockView=e.BasicView.extend({_initialize:function(){this.updateList(),this.model.on("add change:enabled",this.updateOneInList,this),this.model.on("update_order",this.updateList,this),this.model.on("destroy",this.onAccountRemoved,this)},updateList:function(){l.each(this.children,function(e){e.detach()}),l.each(this.model.enabled,function(t){var a=t.get("jid"),i=this.child(a);i||(i=this.addChild(a,e.AccountToolbarItemView,{model:t})),this.$el.append(i.$el)}.bind(this)),this.parent.updateScrollBar()},updateOneInList:function(t){var a=t.get("jid");if(t.get("enabled")){var i=this.child(a);i?i.$el.detach():i=this.addChild(a,e.AccountToolbarItemView,{model:t});var n=this.model.enabled.indexOf(t);0===n?this.$el.prepend(i.$el):this.$(".account-item").eq(n-1).after(i.$el)}else t.last_msg_timestamp=0,this.removeChild(a);this.parent.updateScrollBar()},onAccountRemoved:function(e){this.removeChild(e.get("jid")),this.parent.updateScrollBar()}}),e.Resource=Backbone.Model.extend({idAttribute:"resource",defaults:{priority:0}}),e.ResourceView=e.BasicView.extend({className:"resource-wrap",template:i.resource,_initialize:function(){this.update(),this.model.on("change",this.update,this)},update:function(){var e=this.model.attributes;return this.$(".status").attr("data-status",e.status),this.$(".status-message").text(e.status_message||a.STATUSES[e.status]),this.$(".client").text(e.client||"Wait please..."),this.$(".resource").text(e.resource),this.$(".priority").text(e.priority),this}}),e.Resources=Backbone.Collection.extend({model:e.Resource,comparator:function(e,t){var a=e.get("priority"),i=t.get("priority");return a>i?-1:a<i?1:0},requestInfo:function(e){var t=this.jid+"/"+e.get("resource");this.connection.disco.info(t,null,function(t){var a=s(t).find("identity[category=client]");a.length&&e.set("client",a.attr("name")),this.isFeatureSupported(t,c.NS.CHAT_MARKERS)&&(this.chat_markers_support=!0)}.bind(this))},isFeatureSupported:function(e,t){let a=s(e),i=!1;return a.find("feature").each(function(){let e=s(this).attr("var");e===t&&(i=!0)}),i}}),e.ResourcesView=e.BasicView.extend({_initialize:function(){this.model.on("add",this.onResourceAdded,this),this.model.on("remove",this.onResourceRemoved,this),this.model.on("reset",this.onReset,this),this.model.on("change:priority",this.onPriorityChanged,this)},onResourceAdded:function(t){this.model.requestInfo(t),this.addChild(t.get("resource"),e.ResourceView,{model:t}),this.updatePosition(t),this.$el.removeClass("hidden"),this.parent.updateScrollBar()},onPriorityChanged:function(e){this.model.sort(),this.updatePosition(e)}}),e.AccountResources=e.Resources.extend({initialize:function(e,t){this.jid=t.account.get("jid"),this.connection=t.account.connection}}),e.AccountResourcesView=e.ResourcesView.extend({onResourceRemoved:function(e){this.removeChild(e.get("resource")),this.parent.updateScrollBar()},onReset:function(){this.removeChildren(),this.parent.updateScrollBar()},updatePosition:function(e){var t=this.child(e.get("resource"));if(t){t.$el.detach();var a=this.model.indexOf(e);0===a?this.$(".main-resource").after(t.$el):this.$(".resource-wrap").eq(a).after(t.$el),this.updateScrollBar()}}}),e.AccountVCardView=e.VCardView.extend({events:{"click .btn-vcard-refresh":"refresh","click .btn-vcard-edit":"showEditView","click .details-icon":"onClickIcon"},__initialize:function(){this.updateButtons(),this.model.on("activate deactivate",this.updateButtons,this)},updateButtons:function(){var e=this.model.isConnected();this.$(".btn-vcard-edit").showIf(e),this.$(".btn-vcard-refresh").showIf(e)},showEditView:function(){this.model.showSettings("vcard_edit")}}),e.AccountSettingsLeftView=e.BasicView.extend({className:"account-settings-left-wrap",template:i.settings_left,avatar_size:a.AVATAR_SIZES.ACCOUNT_SETTINGS_LEFT,events:{"change .main-info-wrap .circle-avatar input":"changeAvatar","click .main-info-wrap .status":"openChangeStatus","click .settings-tabs-wrap .settings-tab":"jumpToBlock","click .settings-tab.delete-account":"deleteAccount"},_initialize:function(){this.status_field=new e.StatusMessageWidget({el:this.$(".status-wrap")[0],model:this.model}),this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateBlocks(),this.model.on("change:name",this.updateName,this),this.model.on("change:status_updated",this.updateStatus,this),this.model.on("change:image",this.updateAvatar,this),this.model.on("activate deactivate",this.updateBlocks,this),this.model.on("destroy",this.remove,this)},render:function(e){return this.$(".settings-tab[data-block-name=\"tokens\"]").hideIf("x-token"!==this.model.get("auth_type")),this.$(".settings-tab").removeClass("active"),this.$(".settings-tab[data-block-name=\""+e.block_name+"\"]").addClass("active"),this.updateCSS(),this},updateName:function(){this.$(".name").text(this.model.get("name")),this.updateNameCSS()},updateStatus:function(){this.$(".main-info-wrap .status").attr("data-status",this.model.get("status"))},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateBlocks:function(){var e=this.model.isConnected();this.$(".main-info-wrap").switchClass("disconnected",!e),this.$(".settings-tab[data-block-name=\"xmpp-resources\"]").showIf(e),this.$(".settings-tab[data-block-name=\"server-info\"]").showIf(e),this.$(".settings-tab[data-block-name=\"blocklist\"]").showIf(e),this.$(".settings-tab[data-block-name=\"groups-info\"]").showIf(e),this.updateScrollBar()},updateNameCSS:function(){if(this.isVisible()){var e=this.$(".name");e.removeAttr("style");for(var t=this.$(".name-wrap").width(),a=e.width(),i=22;a>t&&12<i;)e.css({"font-size":i}),a=e.width(),i-=2;e.css({"margin-left":(t-a)/2})}},changeAvatar:function(e){this.$(".circle-avatar").find(".preloader-wrap").addClass("visible").find(".preloader-wrapper").addClass("active");var t=e.target;if(t.files.length){var i=t.files[0];return(t.value="",i.size>a.MAX_AVATAR_FILE_SIZE)?void n.dialogs.error("File is too large"):i.type.startsWith("image")?void n.images.getAvatarFromFile(i).done(function(e,t,a){e?this.model.pubAvatar({base64:e,hash:t,size:a},function(){this.$(".circle-avatar").setAvatar(e,this.avatar_size),this.$(".circle-avatar").find(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active")}.bind(this),function(){this.$(".circle-avatar").find(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active"),n.dialogs.error("Wrong image")}.bind(this)):n.dialogs.error("Wrong image")}.bind(this)):void n.dialogs.error("Wrong image")}},updateCSS:function(){this.updateNameCSS()},openChangeStatus:function(){e.change_status_view.open(this.model)},jumpToBlock:function(e){var t=s(e.target).closest(".settings-tab"),a=t.data("block-name");this.model.showSettings(null,a)},deleteAccount:function(){var t=[];e.api_account.get("connected")&&(t=[{name:"delete_settings",checked:this.model.settings.get("to_sync"),text:"Delete synced settings"}]),n.dialogs.ask("Quit account","Do you want to quit this account from Xabber Web? Account will not be deleted from the server.",t,{ok_button_text:"quit"}).done(function(t){t&&(t.delete_settings&&e.api_account.delete_settings(this.model.get("jid")),this.model.deleteAccount())}.bind(this))}}),e.AccountSettingsRightView=e.BasicView.extend({className:"account-settings-right-wrap",template:i.settings_right,ps_selector:".panel-content",events:{"change .enabled-state input":"setEnabled","click .btn-change-password":"showPasswordView","click .btn-reconnect":"reconnect","change .sync-account":"changeSyncSetting","click .btn-delete-settings":"deleteSettings","click .color-values .color-value":"changeColor","click .token-wrap .btn-revoke-token":"revokeXToken","click .tokens .btn-revoke-all-tokens":"revokeAllXTokens"},_initialize:function(){this.resources_view=this.addChild("resources",e.AccountResourcesView,{model:this.model.resources,el:this.$(".xmpp-resources")[0]}),this.vcard_view=this.addChild("vcard",e.AccountVCardView,{model:this.model,el:this.$(".vcard")[0]}),this.$(".account-name .value").text(this.model.get("jid")),this.updateStatus(),this.updateView(),this.showConnectionStatus(),this.updateSynchronizationBlock(),this.model.session.on("change:reconnecting",this.updateReconnectButton,this),this.model.session.on("change:conn_feedback",this.showConnectionStatus,this),this.model.settings.on("change:to_sync",this.updateSyncOption,this),this.model.settings.on("change:deleted",this.updateDelSettingsButton,this),this.model.settings.on("change:to_sync change:synced",this.updateSyncState,this),e.api_account.on("change:connected",this.updateSynchronizationBlock,this),this.model.on("change:enabled",this.updateEnabled,this),this.model.on("change:status_updated",this.updateStatus,this),this.model.on("activate deactivate",this.updateView,this),this.model.on("destroy",this.remove,this)},render:function(t){return this.updateEnabled(),this.updateXTokens(),this.$(".connection-wrap .buttons-wrap").hideIf("x-token"===this.model.get("auth_type")),this.$(".main-resource .client").text(e.get("client_name")),this.$(".main-resource .resource").text(this.model.resource),this.$(".main-resource .priority").text(this.model.get("priority")),this.$(".account-color .dropdown-button").dropdown({inDuration:100,outDuration:100,belowOrigin:!0,hover:!1}),this.$(".account-color .dropdown-content").hide(),this.scrollToChild(this.$(".settings-block-wrap."+t.block_name)),this.$(".panel-content-wrap").removeClass("hidden"),this},updateStatus:function(){var e=this.model,t=e.get("status"),a=e.getStatusMessage();this.$(".main-resource .status").attr("data-status",t),this.$(".main-resource .status-message").text(a)},updateView:function(){var e=this.model.isConnected();this.$(".xmpp-resources").showIf(e),this.$(".server-info").showIf(e),this.$(".blocklist").showIf(e),this.$(".groups-info").showIf(e),this.updateScrollBar()},updateSynchronizationBlock:function(){this.$(".xabber-account-features-wrap").showIf(e.api_account.get("connected")),this.updateSyncState(),this.updateSyncOption(),this.updateDelSettingsButton()},renderAllXTokens:function(){this.$(".panel-content-wrap .tokens .sessions-wrap").html(""),s(l.sortBy(this.model.x_tokens_list),"last_auth").each(function(e,t){let a={client:t.client,device:t.device,token_uid:t.token_uid,ip:t.ip,last_auth:n.pretty_datetime(t.last_auth),expire:n.pretty_datetime(t.expire)};if(this.model.get("x_token")&&this.model.get("x_token").token_uid==t.token_uid){let e=s(i.current_token_item(a));return void this.$(".panel-content-wrap .tokens .current-session").append(e)}let o=s(i.token_item(a));this.$(".panel-content-wrap .tokens .all-sessions").append(o)}.bind(this)),this.$(".panel-content-wrap .tokens .all-sessions").children().length?this.$(".panel-content-wrap .tokens .all-sessions-wrap").removeClass("hidden"):this.$(".panel-content-wrap .tokens .all-sessions-wrap").addClass("hidden")},updateXTokens:function(){if("x-token"!==this.model.get("auth_type"))return this.$(".panel-content-wrap .tokens").addClass("hidden"),void this.$(".panel-content-wrap .tokens .sessions-wrap").children().html("");if(this.$(".panel-content-wrap .tokens .sessions-wrap").html(""),this.model.x_tokens_list&&this.model.x_tokens_list.length)if(this.$(".panel-content-wrap .tokens").removeClass("hidden"),this.model.get("x_token")&&!this.model.get("x_token").token_uid){let e=o({from:this.model.get("jid"),to:this.model.domain,type:"get"}).c("query",{xmlns:c.NS.AUTH_TOKENS+"#items"}).c("token").t(this.model.get("x_token").token);this.model.sendIQ(e,function(e){let t=s(e),a=t.find("token-uid").text(),i=t.find("expire").text();this.model.get("x_token").token_uid=a,this.model.get("x_token").expire=i,this.renderAllXTokens()}.bind(this))}else this.renderAllXTokens()},revokeXToken:function(e){var t=s(e.target).closest(".token-wrap"),a=t.data("token-uid");this.model.revokeXToken([a],function(){this.model.get("x_token")&&this.model.get("x_token").token_uid===a&&this.model.destroy()}.bind(this))},revokeAllXTokens:function(){this.model.x_tokens_list&&this.model.revokeAllXTokens(function(){}.bind(this))},updateSyncState:function(){var e;e=this.model.settings.get("to_sync")?this.model.settings.get("synced")?"yes":"no":"off",this.$(".sync-status").text(a.SYNCED_STATUS_DATA[e].tip);var t=a.SYNCED_STATUS_DATA[e].icon,i=this.$(".sync-status-icon");i.removeClass(i.attr("data-mdiclass")).attr("data-mdiclass",t).addClass(t)},updateSyncOption:function(){this.$(".sync-account").prop("checked",this.model.settings.get("to_sync"))},updateDelSettingsButton:function(){this.$(".btn-delete-settings").hideIf(this.model.settings.get("deleted"))},updateEnabled:function(){var e=this.model.get("enabled");this.$(".enabled-state input[type=checkbox]").prop("checked",e)},updateReconnectButton:function(){this.$(".btn-reconnect").switchClass("disabled",this.model.session.get("reconnecting"))},setEnabled:function(){var e=this.$(".enabled-state input").prop("checked");this.model.save("enabled",e),e?this.model.activate():this.model.deactivate()},showConnectionStatus:function(){this.$(".conn-status").text(this.model.session.get("conn_feedback"))},showPasswordView:function(){this.model.password_view.show()},reconnect:function(){this.model.session.get("reconnecting")||(this.model.save("enabled",!0),this.model.connection.connected?this.model.connection.disconnect():this.model.connect())},changeSyncSetting:function(t){var a=s(t.target).prop("checked"),i=this.model.settings;i.save("to_sync",a),a&&(i.update_timestamp(),e.api_account.synchronize_main_settings())},deleteSettings:function(){n.dialogs.ask("Delete settings","Settings for this XMPP account will be deleted from Xabber account",[{name:"delete_account",checked:this.model.settings.get("to_sync"),text:"Delete synced XMPP account"}],{ok_button_text:"delete"}).done(function(t){t&&(t.delete_account?!this.model.settings.get("to_sync")&&this.model.deleteAccount(!0):this.model.settings.save("to_sync",!1),e.api_account.delete_settings(this.model.get("jid")))}.bind(this))},changeColor:function(t){var a=s(t.target).closest(".color-value");this.model.settings.update_settings({color:a.data("value")}),e.api_account.synchronize_main_settings()}}),e.StatusMessageWidget=e.InputWidget.extend({field_name:"status-message",placeholder:"Set custom status",bindModelEvents:function(){this.model.on("change:status_updated",this.updateValue,this)},getValue:function(){return this.model.getStatusMessage()},setValue:function(e){this.model.setStatus(null,e)}}),e.AccountSettingsItemView=e.BasicView.extend({className:"xmpp-account draggable droppable",template:i.global_settings_item,avatar_size:a.AVATAR_SIZES.SETTINGS_ACCOUNT_ITEM,events:{"click .account-info-wrap":"showSettings","change .enabled-state input":"setEnabled"},_initialize:function(){this.$(".jid").text(this.model.get("jid")),this.updateEnabled(),this.updateAvatar(),this.updateColorScheme(),this.updateSyncState(),this.showConnectionStatus(),this.model.on("change:enabled",this.updateEnabled,this),this.model.on("change:image",this.updateAvatar,this),this.model.settings.on("change:color",this.updateColorScheme,this),this.model.session.on("change:conn_feedback",this.showConnectionStatus,this),this.$el.on("drag_to",this.onDragTo.bind(this)),this.$(".move-account-to-this").on("move_xmpp_account",this.onMoveAccount.bind(this)),this.model.settings.on("change:to_sync",this.updateSyncState,this)},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateColorScheme:function(){this.$el.attr("data-color",this.model.settings.get("color"))},showConnectionStatus:function(){this.$(".conn-status").text(this.model.session.get("conn_feedback"))},updateEnabled:function(){var e=this.model.get("enabled");this.$el.switchClass("disabled",!e),this.$(".enabled-state input[type=checkbox]").prop("checked",e)},setEnabled:function(){var e=this.$(".enabled-state input").prop("checked");this.model.save("enabled",e),e?this.model.activate():this.model.deactivate()},onDragTo:function(e,t){t&&s(t).trigger("move_xmpp_account",this.model)},onMoveAccount:function(e,t){this.model.collection.moveBefore(t,this.model)},updateSyncState:function(){this.$el.find(".sync-marker").showIf(this.model.settings.get("to_sync"))},showSettings:function(){this.model.showSettings()}}),e.SettingsAccountsBlockView=e.BasicView.extend({_initialize:function(){this.updateList(),this.updateSyncState(),this.model.on("add",this.updateOneInList,this),this.model.on("update_order",this.updateList,this),this.model.on("destroy",this.onAccountRemoved,this),e.api_account.on("change:connected",this.updateSyncState,this),this.$(".move-account-to-bottom").on("move_xmpp_account",this.onMoveAccountToBottom.bind(this))},updateList:function(){l.each(this.children,function(e){e.detach()}),this.model.each(function(t){var a=t.get("jid"),i=this.child(a);i||(i=this.addChild(a,e.AccountSettingsItemView,{model:t})),this.$(".no-accounts-tip").before(i.$el)}.bind(this)),this.updateHtml(),this.parent.updateScrollBar()},updateOneInList:function(t){var a=t.get("jid"),i=this.child(a);i?i.$el.detach():i=this.addChild(a,e.AccountSettingsItemView,{model:t});var n=this.model.indexOf(t);0===n?this.$(".accounts-head-wrap").after(i.$el):this.$(".xmpp-account").eq(n-1).after(i.$el),this.updateHtml(),this.parent.updateScrollBar()},onAccountRemoved:function(e){this.removeChild(e.get("jid")),this.updateHtml(),this.parent.updateScrollBar()},render:function(){this.updateHtml(),l.each(this.children,function(e){e.updateEnabled()})},updateHtml:function(){this.$(".no-accounts-tip").hideIf(this.model.length),this.$(".accounts-head-wrap").showIf(this.model.length),this.updateCSS()},updateCSS:function(){var t=0;this.$(".jid").addClass("inline").each(function(){this.offsetWidth>t&&(t=this.offsetWidth)}).removeClass("inline"),t+=150,e.api_account.get("connected")&&(t+=45),this.$(".xmpp-account-list").css("width",t+48),l.each(this.children,function(e){e.$el.css("width",t)})},updateSyncState:function(){var t=e.api_account.get("connected");this.$(".sync-head").showIf(t),this.$(".sync-marker-wrap").showIf(t),this.$(".sync-head").hideIf(!t),this.$(".sync-marker-wrap").hideIf(!t),this.updateCSS()},onMoveAccountToBottom:function(e,t){this.model.moveToBottom(t)}}),e.ChangeStatusView=e.BasicView.extend({className:"modal main-modal change-status-modal",template:i.change_status,events:{"click .status-values li":"changeStatus","click .status-message-wrap .clear-input":"clearStatusMessageInput","keyup .status-message":"keyUp","change .apply-to-all":"changeApplyToAll"},open:function(e){this.account=e,this.highlightStatus(e.get("status")),this.restoreStatusMessageInput(),this.show()},highlightStatus:function(e){this.$(".status-values li[data-value=\""+e+"\"]").addClass("active").siblings().removeClass("active")},changeStatus:function(e){var t=s(e.target).closest("li").data("value");this.highlightStatus(t),this.do_change(),this.closeModal()},restoreStatusMessageInput:function(){var e=this.account.get("status_message");this.$(".status-message").val(e).switchClass("filled",e),e||this.$(".status-message").attr("placeholder",this.account.getStatusMessage())},clearStatusMessageInput:function(){var e=a.STATUSES[this.account.get("status")];this.$(".status-message").val("").attr("placeholder",e).removeClass("filled")},keyUp:function(e){if(e.keyCode===a.KEY_ENTER)this.do_change(),this.closeModal();else{var t=this.$(".status-message").val();this.$(".status-message").switchClass("filled",t)}},do_change:function(){var t=this.$(".status-values li.active").data("value"),a=this.$(".status-message").val();this.apply_to_all?e.accounts.each(function(e){e.setStatus(t,a)}):this.account.setStatus(t,a)},changeApplyToAll:function(e){this.apply_to_all=s(e.target).prop("checked")},render:function(){this.$el.openModal({ready:this.onRender.bind(this),complete:this.close.bind(this)})},onRender:function(){Materialize.updateTextFields()},onHide:function(){this.$el.detach()},close:function(){var e=this.$(".status-message").val();e||this.do_change(),this.closeModal()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.ChangePasswordView=e.BasicView.extend({className:"modal main-modal change-password-modal",template:i.change_password,events:{"click .btn-change":"submit","click .btn-cancel":"close","keyup input[name=password]":"keyUp"},_initialize:function(){return this.$("input[name=jid]").val(this.model.get("jid")),this.$password_input=this.$("input[name=password]"),this.data.on("change:authentication",this.updateButtons,this),this},render:function(e){e||(e={}),this.is_login=e.login,this.token_invalidated=e.token_invalidated,this.$(".modal-header span").text(this.is_login?"Log In":"Set password"),this.$(".btn-cancel").text(this.is_login?"Skip":"Cancel"),this.$(".btn-change").text(this.is_login?"Log In":"Set"),this.$el.openModal({use_queue:!0,ready:this.onRender.bind(this),complete:this.close.bind(this)})},onRender:function(){Materialize.updateTextFields(),this.authFeedback({}),this.$password_input.val("").focus()},getActionName:function(){return this.is_login?"Login":"Set"},keyUp:function(e){e.keyCode===a.KEY_ENTER&&this.submit()},submit:function(){if(this.data.get("authentication"))return void this.cancel();this.data.set("authentication",!0),this.authFeedback({});var e=this.model.get("jid"),t=this.$password_input.val();return t?void(this.authFeedback({password:"Authentication with password..."}),this.model.connection.connected?(this.model.once("deactivate",function(){this.setPassword(t)}.bind(this)),this.model.deactivate()):this.setPassword(t)):this.errorFeedback({password:"Please input password!"})},setPassword:function(e){this.model.last_msg_timestamp=0,this.model.save({auth_type:"password",password:n.utoa(e),enabled:!0}),this.model.auth_view=this,this.model.connect()},cancel:function(){this.data.set("authentication",!1)},updateButtons:function(){var e=this.data.get("authentication");this.$(".btn-change").text(e?"Stop":this.getActionName())},authFeedback:function(e){this.$password_input.switchClass("invalid",e.password).siblings("span.errors").text(e.password||"")},errorFeedback:function(e){this.authFeedback(e),this.data.set("authentication",!1)},successFeedback:function(){this.data.set("authentication",!1),this.closeModal()},onHide:function(){this.$el.detach()},close:function(){this.is_login&&this.model.save("enabled",!1),this.token_invalidated&&this.model.destroy(),this.cancel(),this.closeModal()},closeModal:function(){this.model.auth_view=null,this.$el.closeModal({complete:this.hide.bind(this)})}}),e.AuthView=e.BasicView.extend({_initialize:function(){return this.$jid_input=this.$("input[name=jid]"),this.$password_input=this.$("input[name=password]"),this.data.on("change:authentication",this.updateButtons,this),this},render:function(){this.onRender()},onRender:function(){this.account=null,this.authFeedback({}),Materialize.updateTextFields(),this.$jid_input.val("").focus(),this.$password_input.val(""),this.updateButtons(),this.updateOptions&&this.updateOptions()},keyUp:function(e){e.keyCode===a.KEY_ENTER&&this.submit()},submit:function(){if(this.data.get("authentication"))return void this.cancel();this.data.set("authentication",!0),this.authFeedback({});var t=this.$jid_input.val(),i=this.$password_input.val();if(!t)return this.errorFeedback({jid:"Please input username!"});if(!i)return this.errorFeedback({password:"Please input password!"});var s=t.indexOf("@");if(0>=s||s===t.length-1)return this.errorFeedback({jid:"Wrong username format!"});t=c.getBareJidFromJid(t).toLowerCase();var o=e.accounts.get(t);o?this.errorFeedback({jid:"This account already added to Xabber web"}):(this.authFeedback({password:"Authentication..."}),this.getWebsocketURL(t,function(s){this.account=e.accounts.create({jid:t,websocket_connection_url:s||a.CONNECTION_URL,password:n.utoa(i),is_new:!0},{auth_view:this}),this.account.trigger("start")}.bind(this)))},getWebsocketURL:function(e,t){if(!a.DISABLE_LOOKUP_WS){let a=c.getDomainFromJid(e),i={type:"GET",url:window.location.protocol+"//"+a+"/.well-known/host-meta",dataType:"xml",success:function(e){let a=s(e).find("Link").attr("href");a?t&&t(a):t&&t(null)}.bind(this),error:function(){t&&t(null)}.bind(this)};s.ajax(i)}else t&&t(null)},cancel:function(){this.data.set("authentication",!1),this.onRender(),this.account&&(this.account.destroy(),this.account=null)},authFeedback:function(e){this.$jid_input.switchClass("invalid",e.jid).siblings("span.errors").text(e.jid||""),this.$password_input.switchClass("invalid",e.password).siblings("span.errors").text(e.password||"")},errorFeedback:function(e){this.authFeedback(e),this.data.set("authentication",!1)},socialAuth:function(t){var i=window.location.href,n=s(t.target).closest(".btn-social").data("provider");"email"==n?e.body.setScreen("login",{login_screen:"xabber"}):window.location.href=a.XABBER_ACCOUNT_URL+"/social/login/"+n+"/?origin="+i+"&source=Xabber Web"}}),e.XmppLoginPanel=e.AuthView.extend({className:"login-panel",template:i.xmpp_login,events:{"click .login-type":"changeLoginType","click .btn-log-in":"submit","click .btn-social":"socialAuth","click .btn-cancel":"cancel","keyup input[name=password]":"keyUp"},changeLoginType:function(){e.body.setScreen("login",{login_screen:"xabber"})},updateButtons:function(){var e=this.data.get("authentication");this.$(".btn-log-in").switchClass("disabled",e),this.$(".btn-cancel").showIf(e)},successFeedback:function(t){t.auth_view=null,this.data.set("authentication",!1),e.body.setScreen("all-chats",{right:null})}}),e.AddAccountView=e.AuthView.extend({className:"modal main-modal add-account-modal",template:i.add_account,events:{"click .btn-add":"submit","click .btn-cancel":"close","keyup input[name=password]":"keyUp"},render:function(){this.$el.openModal({ready:this.onRender.bind(this),complete:this.close.bind(this)})},updateOptions:function(){this.$(".sync-option").showIf(e.api_account.get("connected")).find("input").prop("checked",e.api_account.get("sync_all"))},updateButtons:function(){var e=this.data.get("authentication");this.$(".btn-add").text(e?"Stop":"Add")},successFeedback:function(t){this.data.set("authentication",!1),this.$(".sync-option input").prop("checked")?(t.settings.update_timestamp(),e.api_account.synchronize_main_settings()):t.settings.save("to_sync",!1),e.body.setScreen("all-chats",{right:null}),this.closeModal()},onHide:function(){this.$el.detach()},close:function(){this.cancel(),this.closeModal()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.once("start",function(){this.xmpp_login_panel=e.login_page.addChild("xmpp_login",this.XmppLoginPanel),this.account_settings=e.wide_panel.addChild("account_settings",this.NodeView,{classlist:"settings-panel account-settings-panel"}),this.acc_settings_left=e.account_settings.addChild("left",this.Container,{classlist:"account-settings-left-container"}),this.acc_settings_right=e.account_settings.addChild("right",this.Container,{classlist:"account-settings-right-container"}),this.accounts=new this.Accounts(null,{storage_name:this.getStorageName()+"-accounts"}),this.accounts.fetch(),this.toolbar_view.addChild("accounts",this.ToolbarAccountsBlockView,{model:this.accounts,el:this.toolbar_view.$(".accounts")[0]}),this.settings_view.addChild("accounts",this.SettingsAccountsBlockView,{model:this.accounts,el:this.settings_view.$(".xmpp-accounts")[0]}),this.add_account_view=new this.AddAccountView,this.change_status_view=new this.ChangeStatusView,this.on("add_account",function(){this.add_account_view.show()},this),window.onbeforeunload=function(){l.each(this.accounts.connected,function(e){e.sendPresence("offline")})}.bind(this),this.login_page.patchTree=function(e,t){var i=t.login_screen||a.DEFAULT_LOGIN_SCREEN;return"xmpp"===i?{xmpp_login:null}:{xabber_login:null}},this.servers=new e.Servers},e),e}}),define("xabber-discovery",[],function(){return function(e){var t=e.env,a=t.constants,i=t.$,n=t._,s=t.moment,o=t.Strophe,d=t.$iq;return e.ClientFeature=Backbone.Model.extend({idAttribute:"namespace"}),e.FeatureView=e.BasicView.extend({className:"client-feature",template:function(){this.$el.append("<div class=\"feature-name one-line\"/>").append("<div class=\"supports\"/>")},_initialize:function(){this.render(),this.$el.appendTo(this.model.collection.account.settings_right.$(".capabilities")),this.model.on("change",this.render,this),this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.get("verbose_name"),t=this.model.get("supports");this.$(".feature-name").text(e),this.$(".supports").text(t?"Available":"Unavailable")}}),e.ClientFeatures=Backbone.Collection.extend({model:e.ClientFeature,initialize:function(t,a){this.account=a.account,this.connection=this.account.connection,this.connection.disco.addIdentity("client","web",e.get("client_name"),"en"),this.addFeature(o.NS.LAST,"XEP-0012: Last Activity"),this.addFeature(o.NS.VCARD,"XEP-0054: vCard-temp"),this.addFeature(o.NS.RSM,"XEP-0059: Result Set Management"),this.connection.disco.addFeature(o.NS.CHATSTATES),this.addFeature(o.NS.BLOCKING,"XEP-0191: Blocking Command"),this.addFeature(o.NS.PING,"XEP-0199: XMPP Ping"),this.addFeature(o.NS.CARBONS,"XEP-0280: Message carbons"),this.addFeature(o.NS.MAM,"XEP-0313: Message archive management"),this.connection.disco.addFeature(o.NS.CHAT_MARKERS),this.connection.disco.addFeature(o.NS.PUBSUB_AVATAR_METADATA+"+notify"),this.addFeature(o.NS.HTTP_UPLOAD,"XEP-0363: HTTP File Upload")},addFeature:function(t,a){var i=this.create({namespace:t,verbose_name:a});this.connection.disco.addFeature(t);new e.FeatureView({model:i})}}),e.ServerFeature=Backbone.Model.extend({idAttribute:"var"}),e.ServerFeatures=Backbone.Collection.extend({model:e.ServerFeature,initialize:function(e,t){this.account=t.account,this.connection=this.account.connection,this.on("add",this.onFeatureAdded,this)},request:function(){this.connection.disco.info(this.account.domain,null,this.onInfo.bind(this)),this.connection.disco.items(this.account.domain,null,this.onItems.bind(this))},onItems:function(e){let t=[];i(e).find("query item").each(function(e,a){if(i(a).attr("node")===o.NS.GROUP_CHAT){let e=i(a).attr("jid");t.push(e),this.account.set("groupchat_servers_list",t)}this.connection.disco.info(i(a).attr("jid"),null,this.onInfo.bind(this))}.bind(this))},onInfo:function(e){var t=i(e),a=t.attr("from"),n=this;t.find("feature").each(function(){var e=i(this).attr("var");n.create({var:e,from:a}),e===o.NS.AUTH_TOKENS&&n.account.getAllXTokens()})},onFeatureAdded:function(e){var t=e.get("var"),a=this.account.client_features.get(t);a&&a.set("supports",!0);var i=e.get("preferences")||{};t===o.NS.MAM&&"always"!==i.default&&this.account.sendIQ(d({type:"get"}).c("prefs",{xmlns:o.NS.MAM}),n.bind(this.receiveMAMPreferences,this,e))},receiveMAMPreferences:function(e,t){var a=i(t).find("prefs[xmlns=\""+o.NS.MAM+"\"]"),n=a.attr("default");if("always"!==n){var s=d({type:"set"}).c("prefs",{xmlns:o.NS.MAM,default:"always"});a.children().each(function(e,t){s.cnode(t).up()}),this.account.sendIQ(s,function(){e.set("preferences",{default:"always"})})}else e.set("preferences",{default:"always"})}}),e.ServerInfo=Backbone.Collection.extend({model:e.ServerFeature,initialize:function(e){this.domain=e.domain,this.account=e.account,this.connection=this.account.connection},request:function(){this.connection.disco.info(this.domain,null,this.onInfo.bind(this))},onInfo:function(e){var t=i(e),a=t.attr("from"),n=this;t.find("feature").each(function(){var e=i(this).attr("var");n.create({var:e,from:a})})}}),e.Server=Backbone.Model.extend({idAttribute:"domain",initialize:function(t){this.account=t.account,this.set("domain",t.domain||this.account.domain),this.server_features=new e.ServerInfo({account:this.account,domain:this.get("domain")}),this.getServerInfo()},getServerInfo:function(){this.server_features.request()}}),e.Servers=Backbone.Collection.extend({model:e.Server}),e.Account.addInitPlugin(function(){this.client_features=new e.ClientFeatures(null,{account:this}),this.server_features=new e.ServerFeatures(null,{account:this})}),e.Account.addConnPlugin(function(){this.last_stanza_timestamp=s.now(),this.connection.deleteHandler(this._last_stanza_handler),this._last_stanza_handler=this.connection.addHandler(function(){return this.last_stanza_timestamp=s.now(),!0}.bind(this)),this.connection.deleteHandler(this._pong_handler),this._pong_handler=this.connection.ping.addPingHandler(function(e){return this.last_stanza_timestamp=s.now(),this.connection.ping.pong(e),!0}.bind(this)),this.connection.deleteTimedHandler(this._ping_handler),this._ping_handler=this.connection.addTimedHandler(3e4,function(){var t=s.now()-this.last_stanza_timestamp;return t/1e3>(e.settings.reconnect_interval||120)?(this.connection.connected?this.connection.disconnect():this.connect(),!1):(t/1e3>(e.settings.ping_interval||60)&&this.connection.ping.ping(this.get("jid")),!0)}.bind(this)),this.server_features.request()},!0,!0),e.Account.addConnPlugin(function(){var e=this.connection.disco;this.connection.addHandler(e._onDiscoInfo.bind(e),o.NS.DISCO_INFO,"iq","get",null,null),this.connection.addHandler(e._onDiscoItems.bind(e),o.NS.DISCO_ITEMS,"iq","get",null,null)},!1,!0),e}}),define("xabber-contacts",[],function(){var e=Math.trunc;return function(t){var a=t.env,i=a.constants,n=a.templates.contacts,s=a.utils,o=a.$,d=a.$iq,r=a.$msg,c=a.$pres,l=a.Strophe,p=a._,u=a.moment,m=a.uuid,g=s.images,h=s.emoji;return t.Contact=Backbone.Model.extend({idAttribute:"jid",defaults:{status:"offline",status_message:"",subscription:null,groups:[],group_chat:!1},initialize:function(e,i){this.on("change:group_chat",this.onChangedGroupchat,this),this.account=i.account;var n=p.clone(e);this.account&&this.account.connection.domain===n.jid&&(n.is_server=!0),n.name=n.roster_name||n.jid,n.image||(n.photo_hash="",n.image=g.getDefaultAvatar(n.name)),this.account.domain===n.jid&&(n.bot=!0),this.cached_image=g.getCachedImage(n.image),n.vcard=s.vcard.getBlank(n.jid),this.set(n),this.domain=l.getDomainFromJid(this.get("jid")),this.set("group_chat",p.contains(this.account.chat_settings.get("group_chat"),this.get("jid"))),this.hash_id=a.b64_sha1(this.account.get("jid")+"-"+n.jid),this.resources=new t.ContactResources(null,{contact:this}),this.details_view=this.get("group_chat")?new t.GroupChatDetailsView({model:this}):new t.ContactDetailsView({model:this}),this.invitation=new t.ContactInvitationView({model:this}),this.on("change:photo_hash",this.getContactInfo,this),this.on("change:roster_name",this.updateName,this),t.servers.get(this.domain)||t.servers.create({domain:this.domain,account:this.account}),this.account.dfd_presence.done(function(){this.get("blocked")||this.getContactInfo()}.bind(this))},getStatusMessage:function(){return this.get("status_message")||i.STATUSES[this.get("status")]},getContactInfo:function(){t.cached_contacts_info.getContactInfo(this.get("jid"),function(e){return p.isNull(e)?void(!this.get("group_chat")&&this.getVCard()):(e.hash!==this.get("photo_hash")&&this.get("photo_hash")?!this.get("group_chat")&&this.getVCard():(this.cached_image=g.getCachedImage(e.avatar),e.avatar_priority&&this.set("avatar_priority",e.avatar_priority),this.set("photo_hash",e.hash),this.set("image",e.avatar)),void(!this.get("roster_name")&&e.name&&this.set("name",e.name)))}.bind(this))},getVCard:function(e){var a=this.get("jid"),n=p.isFunction(e);this.account.connection.vcard.get(a,function(s){var o={vcard:s,vcard_updated:u.now(),name:this.get("roster_name")};o.name||(this.get("group_chat")?o.name=s.nickname||this.get("name"):o.name=s.nickname||s.fullname||(s.first_name+" "+s.last_name).trim()||a),(!this.get("avatar_priority")||this.get("avatar_priority")<=i.AVATAR_PRIORITIES.VCARD_AVATAR)&&(s.photo.image?(o.avatar_priority=i.AVATAR_PRIORITIES.VCARD_AVATAR,o.image=s.photo.image):o.image=g.getDefaultAvatar(o.name),this.cached_image=g.getCachedImage(o.image)),this.set(o),(this.get("photo_hash")||s.photo.image)&&t.cached_contacts_info.putContactInfo({jid:this.get("jid"),hash:this.get("photo_hash")||this.account.getAvatarHash(s.photo.image),avatar_priority:this.get("avatar_priority"),avatar:this.get("image"),name:this.get("name")}),n&&e(s)}.bind(this),function(){n&&e(null)})},onChangedGroupchat:function(){this.get("group_chat")&&(this.updateCounters(),this.participants=new t.Participants(null,{contact:this}))},updateCounters:function(){t.toolbar_view.recountAllMessageCounter()},getLastSeen:function(){if("offline"==this.get("status")){if(!l.getNodeFromJid(this.get("jid")))return void this.set({status_message:"Server"});var e=d({from:this.account.get("jid"),type:"get",to:this.get("jid")}).c("query",{xmlns:l.NS.LAST});this.account.sendIQ(e,function(e){var t=this.getLastSeenStatus(e);return"offline"==this.get("status")&&this.set({status_message:t}),this}.bind(this))}},membersRequest:function(e,t){let a=e.id,i=e.version||0;var n=d({from:this.account.get("jid"),to:this.get("jid"),type:"get"});null==a?n.c("query",{xmlns:l.NS.GROUP_CHAT+"#members",version:i}):n.c("query",{xmlns:l.NS.GROUP_CHAT+"#members",id:a}),this.account.sendIQ(n,function(e){t&&t(e)})},getMyInfo:function(e){this.membersRequest({id:""},function(t){let a=o(o(t).find("query item")),i=this.account.chat_settings.getAvatarInfoById(a.find("id").text());a.length&&this.participants&&this.participants.createFromStanza(a),i&&i.avatar_hash==this.my_info.get("avatar")&&this.my_info.set("b64_avatar",i.avatar_b64),this.trigger("update_my_info"),e&&e()}.bind(this))},getAvatar:function(e,t,a,i){var n=d({from:this.account.get("jid"),type:"get",to:this.get("jid")}).c("pubsub",{xmlns:l.NS.PUBSUB}).c("items",{node:t}).c("item",{id:e});this.account.sendIQ(n,function(e){var t=o(e).find("data").text();""==t?i&&i("Node is empty"):a&&a(t)}.bind(this))},pubAvatar:function(e,t,a,i){var n=sha1(e.base64),s=d({from:this.account.get("jid"),type:"set",to:this.get("jid")}).c("pubsub",{xmlns:l.NS.PUBSUB}).c("publish",{node:l.NS.PUBSUB_AVATAR_DATA+t}).c("item",{id:n}).c("data",{xmlns:l.NS.PUBSUB_AVATAR_DATA}).t(e.base64),o=d({from:this.account.get("jid"),type:"set",to:this.get("jid")}).c("pubsub",{xmlns:l.NS.PUBSUB}).c("publish",{node:l.NS.PUBSUB_AVATAR_METADATA+t}).c("item",{id:n}).c("metadata",{xmlns:l.NS.PUBSUB_AVATAR_METADATA}).c("info",{bytes:e.size,id:n,type:"image/jpeg"});this.account.sendIQ(s,function(){this.account.sendIQ(o,function(){a&&a(n)}.bind(this),function(e){i&&i(e)})}.bind(this),function(e){i&&i(e)}.bind(this))},getLastSeenStatus:function(e){var t=o(e).children("query").attr("seconds"),a=u.now()-1e3*t;return this.set({last_seen:a}),s.pretty_last_seen(t)},pres:function(e){var t=c({to:this.get("jid"),type:e});return this.account.sendPres(t),this.trigger("presence",this,e+"_from"),this},pushInRoster:function(e,t,a){e||(e={});var i=e.name||this.get("roster_name"),n=e.groups||this.get("groups"),s=d({type:"set"}).c("query",{xmlns:l.NS.ROSTER}).c("item",{jid:this.get("jid"),name:i});return p.each(n,function(e){s.c("group").t(e).up()}),this.account.sendIQ(s,t,a),this.set("known",!0),this},removeFromRoster:function(e,t){var a=d({type:"set"}).c("query",{xmlns:l.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return this.account.cached_roster.removeFromCachedRoster(this.get("jid")),this.account.sendIQ(a,e,t),this.set("known",!1),this},acceptRequest:function(e){this.pres("subscribed"),e&&e()},askRequest:function(e){this.pres("subscribe"),e&&e()},blockRequest:function(e){this.pres("unsubscribed"),this.removeFromRoster().block(e)},declineRequest:function(e){this.pres("unsubscribed"),this.removeFromRoster(e)},declineSubscription:function(){this.pres("unsubscribe")},block:function(e,t){var a=d({type:"set"}).c("block",{xmlns:l.NS.BLOCKING}).c("item",{jid:this.get("jid")});this.account.sendIQ(a,e,t),this.set("known",!1)},unblock:function(e,t){var a=d({type:"set"}).c("unblock",{xmlns:l.NS.BLOCKING}).c("item",{jid:this.get("jid")});this.account.sendIQ(a,e,t)},subGroupPres:function(){var e=c({from:this.account.connection.jid,to:this.get("jid")}).c("x",{xmlns:l.NS.GROUP_CHAT+"#present"});this.account.sendPres(e)},unsubGroupPres:function(){var e=c({from:this.account.connection.jid,to:this.get("jid")}).c("x",{xmlns:l.NS.GROUP_CHAT+"#not-present"});this.account.sendPres(e)},handlePresence:function(e){var a=o(e),n=e.getAttribute("type"),s=a.find("x[xmlns=\""+l.NS.VCARD_UPDATE+"\"]");if(s.length&&this.get("avatar_priority")&&this.get("avatar_priority")<=i.AVATAR_PRIORITIES.VCARD_AVATAR&&this.set("photo_hash",s.find("photo").text()),"subscribe"===n)this.get("in_roster")?this.pres("subscribed"):this.trigger("presence",this,"subscribe");else if("subscribed"===n)"to"===this.get("subscription")&&this.pres("subscribed"),this.trigger("presence",this,"subscribed");else if("unsubscribe"===n)this.get("group_chat")&&this.removeFromRoster();else if("unsubscribed"===n)this.trigger("presence",this,"unsubscribed");else{var d=e.getAttribute("from"),r=l.getResourceFromJid(d),c=+a.find("priority").text(),m=a.find("show").text()||"online",g=a.find("status"),h=g.text();p.isNaN(c)&&(c=0),clearTimeout(this._reset_status_timeout);var v=this.resources.get(r);if("unavailable"===n)this.set({last_seen:u.now()}),v&&v.destroy();else{this.set({last_seen:void 0});var f={resource:r,priority:c,status:m};g.length&&(f.status_message=h),v?v.set(f):v=this.resources.create(f)}}if(0<o(e).find("x[xmlns=\""+l.NS.GROUP_CHAT+"\"]").length&&"unavailable"!=o(e).attr("type")){this.get("group_chat")||(this.set("group_chat",!0),this.account.chat_settings.updateGroupChatsList(this.get("jid"),this.get("group_chat"))),this.details_view.child("participants")||(this.details_view=new t.GroupChatDetailsView({model:this}));let a=this.parseGroupInfo(o(e));this.set("group_info",a),this.get("roster_name")||a.name===this.get("name")||this.set("name",a.name),this.set("status_message",a.members_num+" participants, "+a.online_members_num+" online")}},parseGroupInfo:function(e){var t=e.find("x[xmlns=\""+l.NS.GROUP_CHAT+"\"]"),a=t.find("name").text(),i=t.find("membership").text(),n=t.find("privacy").text(),s=t.find("index").text(),o=t.find("description").text(),d=t.find("pinned-message").text(),r=t.find("parent-chat").text()||!1,c=parseInt(t.find("members").text()),p=parseInt(t.find("present").text()),u={jid:this.get("jid"),name:a,anonymous:n,searchable:s,model:i,description:o,members_num:c,online_members_num:p};r&&this.set("private_chat",r),"incognito"===n&&this.set("incognito_chat",!0);var m=this.account.chats.get(this.hash_id),g;return m&&(g=m.item_view.content.$pinned_message),g&&(d&&""!=d&&this.getMessageByStanzaId(d,function(e){this.parsePinnedMessage(e,g)}.bind(this)),""==d&&(this.set("pinned_message",void 0),this.parsePinnedMessage(void 0,g))),u},getAllRights:function(e){let t=iq=d({from:this.account.get("jid"),type:"get",to:this.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#rights"});this.account.sendIQ(t,function(t){var a=o(t).find("permission"),i=o(t).find("restriction");this.all_rights={permissions:a,restrictions:i},e&&e()}.bind(this))},getMessageByStanzaId:function(e,t){var a=m(),i=d({type:"set",to:this.get("jid")}).c("query",{xmlns:l.NS.MAM,queryid:a}).c("x",{xmlns:l.NS.XDATA,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(l.NS.MAM).up().up().c("field",{var:"{urn:xmpp:sid:0}stanza-id"}).c("value").t(e),n=this.account.connection.addHandler(function(e){var i=o(e);return i.find("result").attr("queryid")===a&&t&&t(i),!0}.bind(this),l.NS.MAM);this.account.sendIQ(i,function(){this.account.connection.deleteHandler(n)}.bind(this),function(){this.account.connection.deleteHandler(n)}.bind(this))},parsePinnedMessage:function(e,t){if(!e)this.renderPinnedMessage(null,t);else{var a=e.find("result message").first();if(this.get("pinned_message")&&this.get("pinned_message").archive_id===a.find("stanza-id").attr("id"))return;var i=this.account.chats.receiveChatMessage(e,{pinned_message:!0});this.set("pinned_message",i),this.renderPinnedMessage(i,t)}},renderPinnedMessage:function(e,t){if(!e)t.html(""),t.siblings(".chat-content").css({height:"100%"});else{var a=e.get("images"),i=e.get("files"),d=e.get("forwarded_message"),r=null,c=e.get("message");if(d){let e=d[0].get("user_info")||{};1<d.length?c=d.length+" forwarded messages":(c=d[0].get("message")||d[0].get("forwarded_message").length+" forwarded messages",r=e.nickname||d[0].get("from_jid")||e.id)}a&&(1==a.length&&(c="<span class=text-color-500>Image: </span>"+a[0].name),1<a.length&&(c="<span class=text-color-500>"+a.length+" images</span>")),i&&(1==i.length&&(c="<span class=text-color-500>File: </span>"+i[0].name+" ("+i[0].size+")"),1<i.length&&(c="<span class=text-color-500>"+i.length+" files</span>"));let p=e.get("user_info")||{},u=this.account.chats.get(this.hash_id).item_view.content,m=u.isScrolledToBottom(),g=p.nickname||e.get("from_jid")||p.id,h={author:g,time:s.pretty_datetime(e.get("time")),message:c,fwd_author:r},v=o(n.group_chats.pinned_message(h));t.html(v).emojify(".chat-msg-content",{emoji_size:18});var l=t.height();t.siblings(".chat-content").css({height:"calc(100% - "+l+"px)"}),m&&u.scrollToBottom(),t.attr("data-msgid",e.msgid)}},resetStatus:function(e){clearTimeout(this._reset_status_timeout),this._reset_status_timeout=setTimeout(function(){this.set({status_updated:u.now(),status:"offline",status_message:""})}.bind(this),e||5e3)},searchByParticipants:function(e,t){let a=[];this.participants.forEach(function(t){let i=t.get("jid");if(e){e=e.toLowerCase();let n=t.get("nickname"),s=t.get("id");(i&&-1<i.toLowerCase().indexOf(e)||n&&-1<n.toLowerCase().indexOf(e))&&a.push(t)}else a.push(t)}.bind(this)),t&&t(a)},updateName:function(){this.get("roster_name")&&this.get("name")!==this.get("roster_name")&&this.set("name",this.get("roster_name"))},showDetails:function(e){e||(e="contacts"),t.body.setScreen(e,{right:"contact_details",contact:this})}}),t.ContactItemView=t.BasicView.extend({className:"roster-contact list-item",_initialize:function(){this.account=this.model.account,this.$el.attr({"data-id":m(),"data-jid":this.model.get("jid")}),this.$(".jid").text(this.model.get("jid")),this.interval_last,this.updateName(),this.updateStatus(),this.updateAvatar(),this.selectView(),this.updateGroupChat(),this.updateBot(),this.updatePrivateChat(),this.updateIncognitoChat(),this.$(".bot-chat-icon").showIf(this.model.get("bot")),this.model.on("change:name",this.updateName,this),this.model.on("change:image",this.updateAvatar,this),this.model.on("change:status_updated",this.updateStatus,this),this.model.on("change:private_chat",this.updatePrivateChat,this),this.model.on("change:incognito_chat",this.updateIncognitoChat,this),this.model.on("change:bot",this.updateBot,this),this.model.on("change:status_message",this.updateStatusMsg,this),this.model.on("change:last_seen",this.lastSeenUpdated,this),this.model.on("change:group_chat",this.updateGroupChat,this)},updateName:function(){this.$(".name").text(this.model.get("name"))},updateAvatar:function(){this.$(".circle-avatar").setAvatar(this.model.cached_image,this.avatar_size)},updateStatus:function(){this.$(".status").attr("data-status",this.model.get("status"));var e="Group chat";if(this.model.get("group_info")&&(e=this.model.get("group_info").members_num,e+=1<this.model.get("group_info").members_num?" participants":" participant"),this.model.get("group_chat")?this.$(".status-message").text(e):this.$(".status-message").text(this.model.getStatusMessage()),"offline"==this.model.get("status")){if(!l.getNodeFromJid(this.model.get("jid")))return void this.model.set({status_message:"Server"});if(this.model.get("last_seen")){var t=(u.now()-this.model.get("last_seen"))/1e3,a=s.pretty_last_seen(t);this.model.set({status_message:a})}}},selectView:function(){this.model.get("group_chat")&&(this.$(".private-chat").addClass("hidden"),this.$(".group_chat").removeClass("hidden"))},lastSeenUpdated:function(){"offline"==this.model.get("status")&&this.model.get("last_seen")&&p.isUndefined(this.interval_last)?this.interval_last=setInterval(function(){var e=(u.now()-this.model.get("last_seen"))/1e3,t=s.pretty_last_seen(e);this.model.set({status_message:t})}.bind(this),6e4):clearInterval(this.interval_last)},updateCSS:function(){if(this.$el.is(":visible")){var e=this.$(".name-wrap").width();this.model.get("muted")&&(e-=24),this.model.get("group_chat")&&(e-=20),this.$(".name").css("max-width",e)}},updateGroupChat:function(){var e=this.model.get("group_chat");this.$(".status").hideIf(e),!e||this.model.get("private_chat")||this.model.get("incognito_chat")||this.$(".chat-icon").showIf(!0).children("img").attr({src:i.CONTACT_ICONS.GROUP_CHAT_ICON}),this.updateCSS()},updateBot:function(){this.model.get("bot")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:i.CONTACT_ICONS.BOT_CHAT_ICON})},updatePrivateChat:function(){this.model.get("private_chat")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:i.CONTACT_ICONS.PRIVATE_CHAT_ICON})},updateIncognitoChat:function(){this.model.get("incognito_chat")&&!this.model.get("private_chat")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:i.CONTACT_ICONS.INCOGNITO_CHAT_ICON})},updateStatusMsg:function(){var e="Group chat";this.model.get("group_info")&&(e=this.model.get("group_info").members_num,e+=1<this.model.get("group_info").members_num?" participants":" participant"),this.model.get("group_chat")?this.$(".status-message").text(e):this.$(".status-message").text(this.model.getStatusMessage())}}),t.ContactItemRightView=t.ContactItemView.extend({template:n.contact_right_item,avatar_size:i.AVATAR_SIZES.CONTACT_RIGHT_ITEM,events:{click:"clickOnItem",mouseover:"showJid",mouseleave:"hideJid"},showJid:function(){this.$(".name").text()!==this.model.get("jid")&&(this.$(".status-message").addClass("hidden"),this.$(".jid").removeClass("hidden"))},hideJid:function(){this.$(".jid").addClass("hidden"),this.$(".status-message").removeClass("hidden")},clickOnItem:function(){this.model.trigger("open_chat",this.model)}}),t.ContactItemLeftView=t.ContactItemView.extend({template:n.contact_left_item,avatar_size:i.AVATAR_SIZES.CONTACT_LEFT_ITEM,events:{click:"clickOnItem"},__initialize:function(){this.updateDisplayStatus(),this.updateBlockedState(),this.updateMutedState(),this.model.on("change:display",this.updateDisplayStatus,this),this.model.on("change:blocked",this.updateBlockedState,this),this.model.on("change:muted",this.updateMutedState,this),this.model.on("change:group_chat",this.updateGroupChat,this)},updateDisplayStatus:function(){this.$el.switchClass("active",this.model.get("display"))},updateBlockedState:function(){this.$el.switchClass("blocked",this.model.get("blocked"))},updateMutedState:function(){this.$(".muted-icon").showIf(this.model.get("muted")),this.updateCSS()},clickOnItem:function(){this.model.showDetails()}}),t.ContactResources=t.Resources.extend({initialize:function(e,t){this.contact=t.contact,this.jid=t.contact.get("jid"),this.connection=t.contact.account.connection,this.on("add change",this.onResourceUpdated,this),this.on("remove",this.onResourceRemoved,this)},onResourceUpdated:function(e){e===this.first()&&this.contact.set({status_updated:u.now(),status:e.get("status"),status_message:e.get("status_message")})},onResourceRemoved:function(){let e={status_updated:u.now()};this.length?(e.status=this.first().get("status"),e.status_message=this.first().get("status_message")):(e.status="offline",e.status_message=""),this.contact.set(e)}}),t.ContactResourcesView=t.ResourcesView.extend({onResourceRemoved:function(e){this.removeChild(e.get("resource")),this.$el.showIf(this.model.length),this.parent.updateScrollBar()},onReset:function(){this.removeChildren(),this.$el.addClass("hidden"),this.parent.updateScrollBar()},updatePosition:function(e){var t=this.child(e.get("resource"));if(t){t.$el.detach();var a=this.model.indexOf(e);0===a?this.$(".resources-wrap").prepend(t.$el):this.$(".resource-wrap").eq(a-1).after(t.$el),this.updateScrollBar()}}}),t.ContactVCardView=t.VCardView.extend({events:{"click .btn-vcard-refresh":"refresh","click .details-icon":"onClickIcon"}}),t.ContactDetailsView=t.BasicView.extend({className:"details-panel contact-details-panel",template:n.contact_details,ps_selector:".panel-content-wrap",avatar_size:i.AVATAR_SIZES.CONTACT_DETAILS,events:{"click .btn-escape":"openChat","click .btn-chat":"openChat","click .btn-voice-call":"voiceCall","click .btn-video-call":"videoCall","click .btn-add":"addContact","click .btn-delete":"deleteContact","click .btn-block":"blockContact","click .btn-unblock":"unblockContact","click .btn-mute":"changeNotifications","click .btn-auth-request":"requestAuthorization"},_initialize:function(){this.account=this.model.account,this.name_field=new t.ContactNameWidget({el:this.$(".name-wrap")[0],model:this.model}),this.resources_view=this.addChild("resources",t.ContactResourcesView,{model:this.model.resources,el:this.$(".resources-block-wrap")[0]}),this.vcard_view=this.addChild("vcard",t.ContactVCardView,{model:this.model,el:this.$(".vcard")[0]}),this.edit_groups_view=this.addChild("groups",t.ContactEditGroupsView,{el:this.$(".groups-block-wrap")[0]}),this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateButtons(),this.model.on("change",this.update,this)},render:function(){this.model.get("vcard_updated")||this.vcard_view.refresh();this.$(".main-info .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"right"}),this.updateName()},onChangedVisibility:function(){this.model.set("display",this.isVisible())},update:function(){var e=this.model.changed;p.has(e,"name")&&this.updateName(),p.has(e,"image")&&this.updateAvatar(),p.has(e,"status_updated")&&this.updateStatus(),p.has(e,"muted")&&this.updateNotifications(),p.has(e,"status_message")&&this.updateStatusMsg(),(p.has(e,"in_roster")||p.has(e,"blocked")||p.has(e,"subscription"))&&this.updateButtons()},updateName:function(){this.$(".main-info .contact-name").text(this.model.get("name")),this.model.get("name")==this.model.get("roster_name")?this.$(".main-info .contact-name").removeClass("name-is-custom"):this.$(".main-info .contact-name").addClass("name-is-custom")},updateStatus:function(){this.$(".status").attr("data-status",this.model.get("status")),this.$(".status-message").text(this.model.getStatusMessage())},updateStatusMsg:function(){this.$(".status-message").text(this.model.getStatusMessage())},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateButtons:function(){var e=this.model.get("in_roster"),t=this.model.get("blocked"),a=this.model.get("is_server"),i=this.model.get("subscription");this.$(".btn-add").hideIf(e),this.$(".btn-delete").showIf(e),this.$(".btn-block").hideIf(t),this.$(".btn-unblock").showIf(t),this.$(".btn-auth-request").showIf(!a&&e&&!t&&"both"!==i&&"to"!==i)},updateNotifications:function(){this.$(".btn-mute").switchClass("mdi-bell-off",this.model.get("muted")),this.$(".btn-mute").switchClass("mdi-bell",!this.model.get("muted"))},openChat:function(){this.model.trigger("open_chat",this.model)},voiceCall:function(){this.initCall()},videoCall:function(){this.initCall({video:!0})},initCall:function(e){this.openChat();let t=this.account.chats.getChat(this.model);t.item_view.content.initJingleMessage(e)},changeNotifications:function(){var e=!this.model.get("muted");this.model.set("muted",e),this.account.chat_settings.updateMutedList(this.model.get("jid"),e)},addContact:function(){t.add_contact_view.show({account:this.account,jid:this.model.get("jid")})},deleteContact:function(){var e=this.model;s.dialogs.ask("Delete contact","Do you want to delete "+e.get("name")+" from contacts?",null,{ok_button_text:"delete"}).done(function(a){a&&(e.removeFromRoster(),e.trigger("archive_chat"),t.trigger("clear_search"))})},blockContact:function(){var e=this.model;s.dialogs.ask("Block contact","Do you want to block "+e.get("name")+"?",null,{ok_button_text:"block"}).done(function(a){a&&(e.blockRequest(),t.trigger("clear_search"))})},unblockContact:function(){var e=this.model;s.dialogs.ask("Unblock contact","Do you want to unblock "+e.get("name")+"?",null,{ok_button_text:"unblock"}).done(function(a){a&&(e.unblock(),t.trigger("clear_search"))})},requestAuthorization:function(){this.model.pres("subscribe"),this.openChat()}}),t.GroupChatDetailsView=t.BasicView.extend({className:"details-panel groupchat-details-panel",template:n.group_chats.group_chat_details,ps_selector:".panel-content-wrap",avatar_size:i.AVATAR_SIZES.CONTACT_DETAILS,member_avatar_size:i.AVATAR_SIZES.GROUPCHAT_MEMBER_ITEM,events:{"click .btn-join":"joinChat","click .btn-delete":"deleteContact","click .btn-block":"blockContact","click .btn-unblock":"unblockContact","click .btn-leave":"leaveGroupChat","click .btn-invite":"inviteUser","click .btn-settings":"editProperties","click .btn-default-restrictions":"editDefaultRestrictions","click .btn-chat":"openChat","click .btn-escape":"openChat","click .btn-clear-history":"retractAllMessages","change .circle-avatar input":"changeAvatar","click .list-variant":"changeList"},_initialize:function(){this.account=this.model.account,this.name_field=new t.ContactNameWidget({el:this.$(".name-wrap")[0],model:this.model}),this.participants=this.addChild("participants",t.ParticipantsView,{model:this.model,el:this.$(".participants-wrap")[0]}),this.edit_groups_view=this.addChild("groups",t.ContactEditGroupsView,{el:this.$(".groups-block-wrap")[0]}),this.group_chat_properties=this.addChild("properties_view",t.GroupChatPropertiesView,{model:this.model,el:this.$(".group-chat-properties-wrap")[0]}),this.group_chat_properties_edit=new t.GroupChatPropertiesEditView({model:this.model}),this.default_restrictions_edit=new t.DefaultRestrictionsView({model:this.model}),this.model.my_rights=this.model.my_rights||{permissions:[],restrictions:[]},this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateColorScheme(),this.account.settings.on("change:color",this.updateColorScheme,this),this.model.on("change",this.update,this),this.model.on("permissions_changed",this.updateButtons,this)},render:function(){this.updateName(),this.updateButtons(),this.$(".btn-delete").showIf("both"===this.model.get("subscription")),this.$(".btn-join").showIf("both"!==this.model.get("subscription"));let e={inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"right"};return this.$(".select-users-list-wrap .dropdown-button").dropdown(e),this.$(".main-info .dropdown-button").dropdown(e),this.updateList("participants"),this},update:function(){var e=this.model.changed;p.has(e,"name")&&this.updateName(),p.has(e,"image")&&this.updateAvatar(),p.has(e,"status_updated")&&this.updateStatus(),p.has(e,"status_message")&&this.updateStatusMsg()},updateColorScheme:function(){this.$el.attr("data-color",this.account.settings.get("color"))},updateButtons:function(){let e=this.model.my_info&&this.model.my_info.get("permissions").find(e=>"owner"==e.name||"administrator"==e.name),t=this.model.get("blocked");this.$(".btn-settings-wrap").switchClass("non-active",!e),this.$(".btn-default-restrictions-wrap").switchClass("non-active",!e),this.$(".btn-invite-wrap").switchClass("non-active",this.model.get("private_chat")),this.$(".btn-block").hideIf(t),this.$(".btn-unblock").showIf(t)},updateName:function(){this.$(".main-info .contact-name").text(this.model.get("name")),this.model.get("name")==this.model.get("roster_name")?this.$(".main-info .contact-name").removeClass("name-is-custom"):this.$(".main-info .contact-name").addClass("name-is-custom")},joinChat:function(){this.model.invitation.joinGroupChat()},editProperties:function(e){o(e.target).closest(".button-wrap").hasClass("non-active")||this.group_chat_properties_edit.open()},editDefaultRestrictions:function(e){o(e.target).closest(".button-wrap").hasClass("non-active")||this.default_restrictions_edit.open()},leaveGroupChat:function(){var e=this.model;s.dialogs.ask("Leave groupchat","Do you want to leave groupchat "+e.get("name")+"?",null,{ok_button_text:"leave"}).done(function(a){a&&(e.declineSubscription(),e.removeFromRoster(),e.set("in_roster",!1),t.trigger("clear_search"),this.openChat())}.bind(this))},inviteUser:function(e){o(e.target).closest(".button-wrap").hasClass("non-active")||t.invite_panel.open(this.account,this.model)},changeList:function(e){let t=o(e.target),a=t.data("value");this.updateList(a)},updateList:function(e){let t=this.child(e);t||(t=this.addList(e)),this.$(".panel-footer").showIf("settings"==e),t&&this.$(".select-users-list-wrap .dropdown-button .list-value").data("value",e).text(s.pretty_name(e))&&t._render()},addList:function(e){let a;return"blocked"===e?a=t.BlockedView:"invitations"===e?a=t.InvitationsView:void 0,a?this.addChild(e,a,{model:this.model,el:this.$(".participants-wrap")[0]}):void 0},deleteContact:function(){var e=this.model;s.dialogs.ask("Delete contact","Do you want to delete "+e.get("name")+" from contacts?",null,{ok_button_text:"delete"}).done(function(a){a&&(e.removeFromRoster(),e.trigger("archive_chat"),t.trigger("clear_search"))})},blockContact:function(){var e=this.model;s.dialogs.ask("Block group chat","Do you want to block "+e.get("name")+"?",null,{ok_button_text:"block"}).done(function(a){a&&(e.blockRequest(),t.trigger("clear_search"))})},unblockContact:function(){var e=this.model;s.dialogs.ask("Unblock contact","Do you want to unblock "+e.get("name")+"?",null,{ok_button_text:"unblock"}).done(function(a){a&&(e.unblock(),t.trigger("clear_search"))})},updateStatus:function(){this.$(".status").attr("data-status",this.model.get("status")),this.$(".status-message").text(this.model.getStatusMessage())},updateStatusMsg:function(){var e="Group chat";this.model.get("group_info")&&(e=this.model.get("group_info").members_num,e+=1<this.model.get("group_info").members_num?" participants":" participant",e+=", "+this.model.get("group_info").online_members_num+" online"),this.$(".status-message").text(e)},updateAvatar:function(){let e=this.model.cached_image;this.$(".main-info .circle-avatar").setAvatar(e,this.avatar_size)},openChat:function(){this.model.trigger("open_chat",this.model)},changeAvatar:function(e){var t=e.target;if(t.files.length){o(t).siblings(".preloader-wrap").addClass("visible").find(".preloader-wrapper").addClass("active");var a=t.files[0];t.value="",a.size>i.MAX_AVATAR_FILE_SIZE?s.dialogs.error("File is too large"):!a.type.startsWith("image")&&s.dialogs.error("Wrong image"),s.images.getAvatarFromFile(a).done(function(e){e&&(a.base64=e,this.model.pubAvatar(a,"",function(){o(t).siblings(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active")},function(e){o(t).siblings(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active");let a=o(e).find("text").text()||"You have no permissions to change avatar";s.dialogs.error(a)}))}.bind(this))}},retractAllMessages:function(){var e=this.account.chats.getChat(this.model);s.dialogs.ask("Clear message archive","Do you want to delete all messages from archive?",null,{ok_button_text:"delete"}).done(function(t){t&&e.retractAllMessages(!0)}.bind(this))}}),t.GroupChatPropertiesView=t.BasicView.extend({template:n.group_chats.group_chat_properties,events:{"click .group-chat-properties .details-icon":"onClickIcon"},_initialize:function(){this.$el.html(this.template()),this.contact=this.model,this.account=this.model.account,this.model.on("change:name",this.updateName,this),this.model.on("change:group_info",this.update,this)},render:function(){this.update()},update:function(){let e=this.model.get("group_info")||{};this.$(".jabber-id .value").text(e.jid),this.$(".name .value").text(e.name),this.$(".description .value").text(e.description),this.$(".model .value").text(s.pretty_name(e.model)),this.$(".anonymous .value").text("incognito"===e.anonymous?"Yes":"No"),this.$(".searchable .value").text("none"===e.searchable?"No":s.pretty_name(e.searchable)),this.$(".name-info-wrap").switchClass("hidden",!e.name),this.$(".description-info-wrap").switchClass("hidden",!e.description),this.$(".model-info-wrap").switchClass("hidden",!e.model),this.$(".anonymous-info-wrap").switchClass("hidden",!e.anonymous),this.$(".searchable-info-wrap").switchClass("hidden",!e.searchable)},onClickIcon:function(e){let t=o(e.target).closest(".info-wrap"),a=t.find(".value"),i="";a.each(function(e,a){let n=o(a),d=n.text();if(t.hasClass("anonymous-info-wrap")||t.hasClass("searchable-info-wrap")){let e=t.find(".label").first().text();"No"===d?d+=" "+e.toLowerCase():"Yes"===d&&(d=e)}d&&""!=i&&(i+="\n"),d&&(i+=d),i&&s.copyTextToClipboard(i,"Copied in clipboard","ERROR: Not copied in clipboard")}.bind(this))}}),t.GroupChatPropertiesEditView=t.BasicView.extend({className:"modal dialog-modal group-chat-properties-edit",template:n.group_chats.group_chat_properties_edit,events:{"click .btn-save":"saveChanges","click .btn-cancel":"close","change input":"updateSaveButton","keyup .property-wrap .text-field":"updateSaveButton"},_initialize:function(){this.account=this.model.account,this.contact=this.model,this.$el.html(this.template()),this.model.on("change:name",this.updateName,this),this.model.on("change:group_info",this.update,this)},open:function(){this.$el.openModal({ready:function(){this.update(),this.$(".modal-content").css("height",this.$el.height()-115).perfectScrollbar({theme:"item-list"}),this.updateScrollBar()}.bind(this),complete:function(){this.update(),this.$el.detach(),this.$(".modal-content").css("height","100%"),this.data.set("visible",!1)}.bind(this)})},close:function(){this.$el.closeModal({complete:function(){this.update(),this.hide.bind(this)}.bind(this)})},updateName:function(){this.$(".name-info-wrap").find(".name").find(".value").text(this.model.get("name"))},update:function(){this.$("button").blur();let e=this.model.get("group_info")||{};this.$(".jid-info-wrap .jabber-id").find(".value").text(e.jid),this.$("p[id=\"anonymous-"+e.anonymous+"\"]").removeClass("hidden"),this.$(".name-field #new_name_value").val(e.name),this.$(".description-field textarea").val(e.description),this.$(".global-field input[id=\"indexation-"+e.searchable+"\"]").prop("checked",!0),this.$(".membership-field input[id=\"membership-"+e.model+"\"]").prop("checked",!0)},saveChanges:function(){if(this.$(".btn-save").hasClass("non-active"))return;let e=this.$("input[name=chat_name]").val(),t=this.$(".global-field input:checked").attr("id").substr(11),a=this.$(".description-field textarea").val(),i=this.$(".membership-field input:checked").attr("id").substr(11),n=this.contact.get("group_info")||{},r=!1,c=d({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("update",{xmlns:l.NS.GROUP_CHAT});n.name!=e&&(r=!0,c.c("name").t(e).up()),n.description!=a&&(r=!0,c.c("description").t(a).up()),n.searchable!=t&&(r=!0,c.c("index").t(t).up()),n.model!=i&&(r=!0,c.c("membership").t(i).up()),r?this.account.sendIQ(c,function(){this.$("button").addClass("non-active")}.bind(this),function(e){this.$("button").addClass("non-active");let t=o(e).find("error text").text()||"You have no permission to change chat properties";this.close(),s.dialogs.error(t)}.bind(this)):this.$("button").removeClass("non-active")},updateSaveButton:function(){let e=this.$("input[name=chat_name]").val(),t=this.$(".global-field input:checked").attr("id").substr(11),a=this.$(".description-field textarea").val(),i=this.$(".membership-field input:checked").attr("id").substr(11),n=this.contact.get("group_info")||{},s=!1;n.name!=e&&(s=!0),n.description!=a&&(s=!0),n.searchable!=t&&(s=!0),n.model!=i&&(s=!0),this.$(".btn-save").switchClass("non-active",!s)}}),t.InvitationsView=t.BasicView.extend({events:{"click .revoke-invitation":"revokeInvitation"},status:"invitations",member_avatar_size:i.AVATAR_SIZES.GROUPCHAT_MEMBER_ITEM,_initialize:function(e){this.contact=e.model,this.account=this.contact.account,this.$error=o("<p class=\"errors\"/>"),this.$current_list=this.$el.prev().find(".dropdown-button .list-value")},_render:function(){this.$el.html(o(n.preloader())),this.getInvitations()},getInvitations:function(){let e=d({from:this.account.get("jid"),type:"get",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#invite"});this.account.sendIQ(e,function(e){this.$current_list.data("value")===this.status&&(this.$el.html(""),o(e).find("query").find("user").each(function(e,t){let a={jid:o(t).attr("jid"),status:this.status},i=o(n.group_chats.invited_member_item(a)),s=g.getDefaultAvatar(a.jid);this.$el.append(i),i.find(".circle-avatar").setAvatar(s,this.member_avatar_size)}.bind(this)),!o(e).find("query").find("user").length&&this.$el.html(this.$error.text("No pending invitations")))}.bind(this),function(e){this.$current_list.data("value")===this.status&&this.$el.html(this.$error.text(o(e).find("text").text()||"You nave no permission to see invitations list"))}.bind(this))},revokeInvitation:function(e){let t=o(e.target).closest(".invitations-user"),a=t.data("jid"),i=d({from:this.account.get("jid"),to:this.contact.get("jid"),type:"set"}).c("revoke",{xmlns:l.NS.GROUP_CHAT+"#invite"}).c("jid").t(a);this.account.sendIQ(i,function(){t.remove(),this.$el.children().length||this.$el.html(this.$error.text("No pending invitations"))}.bind(this))}}),t.BlockedView=t.BasicView.extend({events:{"click .unblock-user":"unblockUser"},status:"blocked",member_avatar_size:i.AVATAR_SIZES.GROUPCHAT_MEMBER_ITEM,_initialize:function(e){this.contact=e.model,this.account=this.contact.account,this.$error=o("<p class=\"errors\"/>"),this.$current_list=this.$el.prev().find(".dropdown-button .list-value")},_render:function(){this.$el.html(o(n.preloader())),this.getBlockedParticipants()},getBlockedParticipants:function(){let e=d({from:this.account.get("jid"),type:"get",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#block"});this.account.sendIQ(e,function(e){this.$current_list.data("value")===this.status&&(o(e).find("query").find("user").each(function(e,t){this.$el.html("");let a={jid:o(t).attr("jid"),status:this.status},i=o(n.group_chats.invited_member_item(a)),s=g.getDefaultAvatar(a.jid);this.$el.append(i),i.find(".circle-avatar").setAvatar(s,this.member_avatar_size)}.bind(this)),!o(e).find("query").find("user").length&&this.$el.html(this.$error.text("Block list is empty")))}.bind(this),function(e){this.$current_list.data("value")===this.status&&this.$el.html(this.$error.text(o(e).find("text").text()||"You nave no permission to see blocked list"))}.bind(this))},unblockUser:function(e){var t=o(e.target).closest(".blocked-user"),a=t.data("jid"),i=d({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("unblock",{xmlns:l.NS.GROUP_CHAT+"#block"}).c("jid").t(a);this.account.sendIQ(i,function(){t.remove(),this.$el.children().length||this.$el.html(this.$error.text("Block list is empty"))}.bind(this))}}),t.ParticipantsView=t.BasicView.extend({className:"overflow-visible",ps_selector:".members-list-wrap",ps_settings:{theme:"item-list"},template:n.group_chats.participants,member_avatar_size:i.AVATAR_SIZES.GROUPCHAT_MEMBER_ITEM,events:{"click .group-chat-participant":"showParticipantProperties","keyup .participants-search-form":"keyUpSearch","click .close-search-icon":"clearSearch","mouseover .group-chat-participant":"showJid","mouseleave .group-chat-participant":"hideJid"},_initialize:function(){this.account=this.model.account,this.participants=this.model.participants,this.model.on("update_participants",this.updateParticipants,this),this.$(this.ps_selector).perfectScrollbar(this.ps_settings)},_render:function(){return this.$el.html(this.template()).addClass("request-waiting"),this.participant_properties_panel=new t.ParticipantPropertiesView({model:this}),this.updateParticipants(),this.$(".members-list-wrap").perfectScrollbar({theme:"item-list"}),this.model.all_rights||this.model.getAllRights(),this},updateParticipants:function(){this.participantsRequest(function(e){return this.model.get("group_info")&&this.participants.length!=this.model.get("group_info").members_num?(this.account.groupchat_settings.resetParticipantsList(this.model.get("jid")),this.participants.resetParticipants(),void this.updateParticipants()):void(e&&this.account.groupchat_settings.setParticipantsListVersion(this.model.get("jid"),e),this.participants.version<e&&this.participants.updateVersion(),this.participants.each(function(e){this.renderMemberItem(e)}.bind(this)),this.$el.removeClass("request-waiting"))}.bind(this))},participantsRequest:function(e){this.model.membersRequest({version:this.participants.version},function(t){let a=o(t),i=a.find("query").attr("version");a.find("query item").each(function(e,t){let a=o(t),i=a.find("subscription").text(),n=a.find("id").text();"none"===i?(this.participants.get(n)&&this.participants.get(n).destroy(),this.account.groupchat_settings.removeParticipantFromList(this.model.get("jid"),n)):this.participants.createFromStanza(a)}.bind(this)),e&&e(i)}.bind(this))},renderMemberItem:function(e){let t=p.clone(e.attributes);t.nickname=p.escape(t.nickname),t.badge=p.escape(t.badge);let a=o(n.group_chats.group_member_item(t)),i=this.$(".members-list-wrap .list-item[data-id=\""+t.id+"\"]");a.emojify(".badge",{emoji_size:14}),i.length?(i.hasClass("active")&&a.addClass("active"),t.jid==this.account.get("jid")&&a.find(".last-seen.one-line").html(a.find(".last-seen.one-line").text()+"<span class=\"myself-participant-item text-color-700\">(this is you)</span>"),a.insertBefore(i),i.detach()):t.jid==this.account.get("jid")?(a.prependTo(this.$(".members-list-wrap .owners")),a.find(".last-seen.one-line").html(a.find(".last-seen.one-line").text()+"<span class=\"myself-participant-item text-color-700\">(this is you)</span>")):a.appendTo(this.$(".members-list-wrap ."+t.role.toLowerCase()+"s")),this.updateMemberAvatar(t)},updateMemberAvatar:function(e){let t=g.getDefaultAvatar(e.nickname||e.jid||e.id);var a=e.id?this.$(".list-item[data-id=\""+e.id+"\"] .circle-avatar"):this.$(".list-item[data-jid=\""+e.jid+"\"] .circle-avatar");if(a.setAvatar(t,this.member_avatar_size),e.avatar){let t=this.account.chat_settings.getB64Avatar(e.id);if(this.account.chat_settings.getHashAvatar(e.id)==e.avatar&&t)a.setAvatar(t,this.member_avatar_size);else{var i=l.NS.PUBSUB_AVATAR_DATA+"#"+e.id;this.model.getAvatar(e.avatar,i,function(t){this.account.chat_settings.updateCachedAvatars(e.id,e.avatar,t),this.$(".list-item[data-id=\""+e.id+"\"] .circle-avatar").setAvatar(t,this.member_avatar_size),this.account.get("jid")===e.jid&&(this.model.my_info.set("b64_avatar",t),this.model.trigger("update_my_info"))}.bind(this))}}},showParticipantProperties:function(e){var t=o(e.target).closest(".group-chat-participant"),a=t.attr("data-id"),i=this.model.participants.get(a);i?this.participant_properties_panel.open(i):this.membersRequest({id:a},function(e){let t=o(o(e).find("query item"));t.length&&this.model.participants&&(i=this.model.participants.createFromStanza(t)),this.participant_properties_panel.open(i)}.bind(this))},showJid:function(e){var t=o(e.target).closest(".group-chat-participant");t.find(".last-seen.one-line").addClass("hidden"),t.find(".jid.one-line").removeClass("hidden"),t.find(".id.one-line").removeClass("hidden")},hideJid:function(e){var t=o(e.target).closest(".group-chat-participant");t.find(".jid.one-line").addClass("hidden"),t.find(".id.one-line").addClass("hidden"),t.find(".last-seen.one-line").removeClass("hidden")},keyUpSearch:function(e){e.keyCode===i.KEY_ESCAPE?this.clearSearch(e):this.searchParticipant()},searchParticipant:function(){let e=this.$(".participants-search-form input").val().toLowerCase();this.$(".members-list-wrap .group-chat-participant").each(function(t,a){let i=o(a),n=i.data("id"),s=this.model.participants.find(e=>e.get("id")===n);if(s){var d=s.get("jid").toLowerCase(),r=s.get("nickname").toLowerCase();i.hideIf(0>r.indexOf(e)&&0>d.indexOf(e))}}.bind(this)),e?this.$(".close-search-icon").show():this.$(".close-search-icon").hide()},clearSearch:function(e){e&&e&&e.preventDefault(),this.$(".search-input").val(""),this.searchParticipant()}}),t.ParticipantPropertiesView=t.BasicView.extend({className:"modal dialog-modal edit-rights",template:n.group_chats.participant_rights,member_details_avatar_size:i.AVATAR_SIZES.PARTICIPANT_DETAILS_ITEM,ps_selector:".modal-content",ps_settings:{theme:"item-list"},events:{"click .btn-cancel-changes":"close","click .clickable-field input":"changeRights","click .btn-save-user-rights":"saveRights","click .nickname":"editNickname","change .circle-avatar input":"changeAvatar","click .btn-block-participant":"blockParticipant","click .btn-set-badge":"editBadge","click .btn-participant-messages":"getParticipantMessages","click .btn-chat":"getPrivateChat","click .property-variant":"changeTimerValue","keydown .rich-textarea":"checkKeydown","keyup .rich-textarea":"checkKeyup"},_initialize:function(){this.account=this.model.account,this.contact=this.model.model},open:function(e){this.participant=e,this.render(),this.$el.openModal({ready:function(){this.$el.css("height",""),.1*o(window).height()+this.$el.height()>o(window).height()&&this.$el.css("height",.9*o(window).height()),this.$(".modal-content").css("max-height","calc(100% - "+(56+this.$(".header").height())+"px)"),this.scrollToTop(),this.updateSaveButton();this.$(".select-timer .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"})}.bind(this),complete:function(){this.render(),this.$el.detach(),this.data.set("visible",!1)}.bind(this)})},close:function(){this.$el.closeModal({complete:function(){this.render(),this.$el.detach(),this.data.set("visible",!1)}.bind(this)})},render:function(){this.new_avatar="";let e=p.clone(this.participant.attributes);e.nickname=p.escape(e.nickname),e.badge=p.escape(e.badge),e.is_myself=e.jid===this.account.get("jid"),e.incognito_chat=!!(this.contact.get("group_info")&&"incognito"===this.contact.get("group_info").anonymous);let t;this.contact.get("private_chat")?(this.$el.addClass("edit-rights-private"),t=o(n.group_chats.private_participant_details(e))):t=o(n.group_chats.participant_details_item(e)),this.$(".header").html(t),this.$(".btn-chat-wrap").switchClass("non-active",this.participant.get("jid")===this.account.get("jid")),this.updateMemberAvatar(this.participant),this.participant_messages=[],this.actual_rights=[],this.contact.get("private_chat")?(this.$(".modal-content").addClass("hidden"),this.$(".modal-footer").switchClass("hidden",this.participant.get("jid")!==this.account.get("jid"))):(this.renderAllRights(),this.setActualRights()),this.updateScrollBar(),this.$(".participant-info #edit-nickname").on("focusout",function(){let e=this.$("#edit-nickname").getTextFromRichTextarea().trim();""===e&&(e=this.participant.get("nickname")),this.$(".participant-info #edit-nickname").hide(),this.$(".participant-info .nickname").show(),this.updateNickname(e)}.bind(this)),this.$(".content").perfectScrollbar({theme:"item-list"})},updateMemberAvatar:function(e){let t=e.get("id"),a=this.$(".participant-details-item[data-id=\""+t+"\"] .circle-avatar");if(e.image=g.getDefaultAvatar(e.get("nickname")||e.get("jid")||t),a.setAvatar(e.image,this.member_details_avatar_size),this.$(".participant-details-item[data-id=\""+e.id+"\"]").emojify(".badge",{emoji_size:18}),!e.get("avatar"))this.account.chat_settings.getHashAvatar(t)&&a.setAvatar(this.account.chat_settings.getB64Avatar(t),this.member_details_avatar_size);else if(this.account.chat_settings.getHashAvatar(t)==e.get("avatar")&&this.account.chat_settings.getB64Avatar(t))a.setAvatar(this.account.chat_settings.getB64Avatar(t),this.member_details_avatar_size);else{let a=l.NS.PUBSUB_AVATAR_DATA+"#"+t;this.contact.getAvatar(e.avatar,a,function(e){this.$(".participant-details-item[data-id=\""+t+"\"] .circle-avatar").setAvatar(e,this.member_details_avatar_size)}.bind(this))}},updateRightsView:function(e){o(e.target).hasClass("non-active")||this.render(this.participant)},getParticipantMessages:function(e){this.contact.messages_view=new t.ParticipantMessagesView({contact:this.contact,model:this.participant.attributes}),this.contact.messages_view.messagesRequest(e,function(){this.close(),t.body.setScreen("all-chats",{right:"participant_messages",contact:this.contact})}.bind(this))},changeAvatar:function(e){var t=e.target;if(t.files.length){var a=t.files[0];t.value="",a.size>i.MAX_AVATAR_FILE_SIZE?s.dialogs.error("File is too large"):!a.type.startsWith("image")&&s.dialogs.error("Wrong image"),s.images.getAvatarFromFile(a).done(function(e){e&&(a.base64=e,this.new_avatar=a,this.$(".circle-avatar").addClass("changed").setAvatar(e,this.member_details_avatar_size),this.updateSaveButton())}.bind(this))}},changeTimerValue:function(e){let t=o(e.target),a=t.closest(".select-timer").find(".property-value"),i=t.closest(".right-item").find("input");t.attr("data-value")!==a.attr("data-value")&&(t.closest(".right-item").addClass("changed-timer changed"),this.updateSaveButton()),a.text(t.text()),a.attr("data-value",t.attr("data-value")),"never"===t.attr("data-value")?a.addClass("default-value").text("set timer"):a.hasClass("default-value")&&a.removeClass("default-value"),i.prop("checked")||i.click()},updateBadge:function(e){this.$(".badge").html(e).switchClass("hidden",!e),this.$(".participant-info").emojify(".badge")},updateButtons:function(e){this.$(".btn-save-user-rights").switchClass("non-active",!e)},updateSaveButton:function(){let e=this.$(".changed").length;this.updateButtons(e)},updateNickname:function(e){let t=this.$(".participant-details-item[data-id=\""+this.participant.get("id")+"\"]"),a=t.find(".nickname");a.html(l.xmlescape(e)),t.emojify(".nickname"),e===this.participant.get("nickname")?a.removeClass("changed"):a.addClass("changed"),this.updateSaveButton()},editNickname:function(){this.contact.get("private_chat")&&this.account.get("jid")!==this.participant.get("jid")||(this.$(".participant-info .nickname").hide(),this.$(".participant-info #edit-nickname").text(this.$(".participant-info .nickname").text()).show().placeCaretAtEnd())},editBadge:function(){this.edit_badge_panel=new t.EditBadgeView({model:this})},checkKeydown:function(e){e.keyCode===i.KEY_ENTER&&(e.preventDefault(),o(document.activeElement).blur())},checkKeyup:function(e){let t=o(e.target),a=t.getTextFromRichTextarea().trim();if("edit-nickname"===e.target.id){let e=a!==this.participant.get("nickname");this.updateButtons(e)}},retractUserMessages:function(){s.dialogs.ask("User messages retraction","Do you want to delete all messages of "+(this.participant.get("nickname")||this.participant.get("jid")||this.participant.get("id"))+" in this groupchat?",null,{ok_button_text:"delete"}).done(function(e){if(e&&this.participant.get("id")){let e=this.account.chats.getChat(this.model.model);e.retractMessagesByUser(this.participant.get("id"))}}.bind(this))},blockParticipant:function(){s.dialogs.ask("Block participant","Do you want to block "+this.participant.get("nickname")+"?",null,{ok_button_text:"block"}).done(function(e){if(e){let e=this.participant.get("id"),t=this.account.resources.connection.jid,a=d({from:t,type:"set",to:this.contact.get("jid")}).c("block",{xmlns:l.NS.GROUP_CHAT+"#block"}).c("id").t(e);this.account.sendIQ(a,function(){this.close(),this.model.$el.find(".members-list-wrap .group-chat-participant[data-id=\""+e+"\"]").remove(),this.model.$el.find(".members-list-wrap").perfectScrollbar("update")}.bind(this),function(e){o(e).find("not-allowed").length&&s.dialogs.error("You have no permission to block participants")})}}.bind(this))},renderAllRights:function(){this.contact.all_rights&&(this.$(".restrictions-wrap").html(""),this.$(".permissions-wrap").html(""),this.contact.all_rights.restrictions.each(function(e,t){var a=o(t).attr("name"),i=o(t).attr("translation"),s=o(n.group_chats.restriction_item({name:a,pretty_name:i})),d=o(n.group_chats.right_expire_variants({right_name:a}));s.append(d),this.$(".restrictions-wrap").append(s),this.$(".right-item #"+a).prop("checked",!1)}.bind(this)),this.contact.all_rights.permissions.each(function(e,t){var a=o(t).attr("name"),i=o(t).attr("translation"),s=o(n.group_chats.permission_item({name:a,pretty_name:i})),d=o(n.group_chats.right_expire_variants({right_name:a}));s.append(d),this.$(".permissions-wrap").append(s),this.$(".right-item #"+a).prop("checked",!1)}.bind(this)))},setActualRights:function(){var e=this.participant.get("permissions"),t=this.participant.get("restrictions");e.forEach(function(e){let t=e.name,a=this.$(".right-item.permission-"+t);this.actual_rights.push(t),a.find("#"+t).prop("checked",!0),a.attr("data-switch",!0);let i=parseInt(u(e.expires_time).format("YYYY")),n=parseInt(u(e.issued_time).format("YYYY"));(isNaN(i)||isNaN(n)||!(1<i-n))&&a.find(".select-timer .property-value").attr("data-value",e.expires_time).removeClass("default-value").text(u(e.expires_time,"YYYY-MM-DD hh:mm:ss").fromNow())}.bind(this)),t.forEach(function(e){let t=e.name,a=this.$(".right-item.restriction-"+t);this.actual_rights.push(t),a.find("#"+t).prop("checked",!0),a.attr("data-switch",!0);let i=parseInt(u(e.expires_time).format("YYYY")),n=parseInt(u(e.issued_time).format("YYYY"));(isNaN(i)||isNaN(n)||!(1<i-n))&&a.find(".select-timer .property-value").attr("data-value",e.expires_time).removeClass("default-value").text(u(e.expires_time,"YYYY-MM-DD hh:mm:ss").fromNow())}.bind(this))},getPrivateChat:function(e){if(o(e.target).closest(".button-wrap").hasClass("non-active"))return;let a=this.participant.get("jid"),i=this.account.contacts.get(a);if(!a){let e=d({from:this.account.get("jid"),to:this.account.domain,type:"set"}).c("create",{xmlns:l.NS.GROUP_CHAT}).c("peer-to-peer",{jid:this.contact.get("jid"),id:this.participant.get("id")});this.account.sendIQ(e,function(e){let t=o(e).find("created jid").text(),a=this.account.contacts.mergeContact(t);a.set("group_chat",!0),a.pres("subscribed"),a.pushInRoster(null,function(){a.pres("subscribe"),a.getMyInfo(),this.close(),a.subGroupPres(),this.account.chats.openChat(a);let e=this.account.chats.getChat(a);e.messages.createSystemMessage({from_jid:t,message:"Initiating private chat with "+this.participant.get("nickname")+" from "+this.contact.get("jid")+". If your invitation is accepted, you won't see each other's real XMPP IDs."})}.bind(this))}.bind(this),function(e){let t=o(e),a=t.find("x[xmlns=\""+l.NS.GROUP_CHAT+"\"] jid").text();if(a){let e=this.account.contacts.mergeContact(a),t=this.account.chats.getChat(e);return this.close(),void(t&&t.trigger("open"))}let i=o(e).find("text[lang=\"en\"]").text()||o(e).find("text").first().text()||"You have already sent an invitation to peer-to-peer chat";this.close(),s.dialogs.error(i)}.bind(this))}else{if(i&&i.get("in_roster"))return this.close(),void i.trigger("open_chat",i);this.close(),t.add_contact_view.show({account:this.account,jid:a})}},changeRights:function(e){let t=o(e.target),a=t.closest(".right-item"),i=t.prop("id");t.prop("checked")?this.actual_rights.find(e=>e===i)?a.hasClass("changed-timer")?a.addClass("changed"):a.removeClass("changed"):a.addClass("changed"):this.actual_rights.find(e=>e===i)?a.addClass("changed"):(a.removeClass("changed"),a.hasClass("changed-timer")&&a.find(".timer-item-wrap .property-value").addClass("default-value").text("set timer").attr("data-value","never")),this.updateSaveButton()},saveRights:function(e){if(o(e.target).hasClass("non-active"))return;let t=o(e.target),a=this.account.get("jid"),i=this.participant.get("id"),n=this.$(".participant-details-item .circle-avatar"),r=this.$(".participant-info .nickname").text(),c=this.new_avatar,p=!1,u=d({from:a,type:"set",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#members"}).c("item",{id:i});this.$(".buttons-wrap button").addClass("non-active"),c&&n.find(".preloader-wrap").addClass("visible").find(".preloader-wrapper").addClass("active"),r!=this.participant.get("nickname")&&(p=!0,u.c("nickname").t(r).up()),this.$(".right-item").each(function(e,t){if(o(t).hasClass("changed")){var a=o(t),i=a.hasClass("restriction")?"restriction":"permission",n=a.find(".field input")[0].id;if(a.find(".field input:checked").val()){let e=a.find(".select-timer .timer-item-wrap .property-value").attr("data-value");u.c(i,{name:n,expires:e}).up(),p=!0}else a.attr("data-switch")&&(u.c(i,{name:n,expires:"now"}).up(),p=!0)}}.bind(this)),c&&this.contact.pubAvatar(c,"#"+i,function(){this.$(".buttons-wrap button").removeClass("non-active"),n.find(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active"),this.model.$(".members-list-wrap .list-item[data-id=\""+i+"\"] .circle-avatar").setAvatar(c.base64,this.member_avatar_size),this.$(".participant-details-item[data-id=\""+i+"\"] .circle-avatar").setAvatar(c.base64,this.member_details_avatar_size),this.close()}.bind(this),function(e){this.$(".buttons-wrap button").removeClass("non-active"),n.find(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active");let t=o(e).find("text").text()||"You have no permissions to change avatar";p||s.dialogs.error(t)}),p&&this.account.sendIQ(u,function(){this.$(".buttons-wrap button").removeClass("non-active"),this.participant.set("nickname",r),this.close()}.bind(this),function(e){this.$(".buttons-wrap button").removeClass("non-active"),this.close(),o(e).find("not-allowed").length&&s.dialogs.error("You have no permission to change participant's info")}.bind(this)),t.blur()}}),t.EditBadgeView=t.BasicView.extend({className:"modal edit-badge",template:n.group_chats.badge_edit_view,events:{"click .btn-cancel":"close","click .btn-save":"saveNewBadge","keydown .badge-text":"checkKey"},_initialize:function(){this.account=this.model.account,this.contact=this.model.contact,this.participant=this.model.participant,this.$el.openModal({ready:function(){this.participant.get("badge")?this.typeEmoticon(this.participant.get("badge")):this.$(".badge-text").focus()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)});var e=this.$(".insert-emoticon"),a=this.$(".emoticons-panel-wrap"),i=this.$(".emoticons-panel"),n;p.each(h.all,function(e){o("<div class=\"emoji-wrap\"/>").html(e.emojify({tag_name:"div",emoji_size:25})).appendTo(i)}),i.perfectScrollbar(p.extend({theme:"item-list"},t.ps_settings)),e.hover(function(e){e&&e.preventDefault&&e.preventDefault(),a.addClass("opened"),n&&clearTimeout(n),i.perfectScrollbar("update")}.bind(this),function(e){e&&e.preventDefault&&e.preventDefault(),n&&clearTimeout(n),n=setTimeout(function(){a.is(":hover")||a.removeClass("opened")},800)}.bind(this)),a.hover(null,function(e){e&&e.preventDefault&&e.preventDefault(),n&&clearTimeout(n),n=setTimeout(function(){a.removeClass("opened")},200)}.bind(this)),a.mousedown(function(e){if(e&&e.preventDefault&&e.preventDefault(),!e.button){var t=o(e.target).closest(".emoji-wrap").find(".emoji");t.length&&this.typeEmoticon(t.data("emoji"))}}.bind(this))},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},saveNewBadge:function(){let e=this.$(".badge-text").getTextFromRichTextarea().trim();if(32<e.length)this.$(".modal-content .error").text("Badge can't be longer than 32 symbols");else if(e!=this.participant.get("badge")){let t=d({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#members"}).c("item",{id:this.participant.get("id")}).c("badge").t(e);this.account.sendIQ(t,function(){this.model.updateBadge(e),this.close()}.bind(this),function(){this.$(".modal-content .error").text("You have no permission")}.bind(this))}},typeEmoticon:function(e){var t=e.emojify({tag_name:"img"}),a=this.$(".badge-text");a.focus(),window.document.execCommand("insertHTML",!1,t)},checkKey:function(e){e.keyCode===i.KEY_ENTER&&(e.preventDefault(),this.saveNewBadge())}}),t.DefaultRestrictionsView=t.BasicView.extend({className:"modal dialog-modal edit-default-restrictions",template:n.group_chats.default_restrictions,events:{"click .btn-default-restrictions-save":"saveChanges","click .btn-default-restrictions-cancel":"close","change #default_restriction_expires":"changeExpiresTime","click .group-info-editor .property-variant":"changePropertyValue","click .select-timer .property-variant":"changeTimerValue","click .clickable-field input":"changeRestriction","keyup .clickable-field input":"keyUpInput","change .clickable-field input":"updateSaveButton"},_initialize:function(){this.contact=this.model,this.account=this.contact.account,this.model.on("change: name",this.updateName,this),this.model.on("change: group_info",this.update,this)},open:function(){this.$el.openModal({ready:function(){this.update(),this.updateScrollBar()}.bind(this),complete:function(){this.showDefaultRestrictions(),this.$el.detach(),this.data.set("visible",!1)}.bind(this)})},close:function(){this.$el.closeModal({complete:function(){this.showDefaultRestrictions(),this.hide.bind(this)}.bind(this)})},update:function(){this.$(".btn-default-restrictions-save").addClass("non-active"),this.actual_default_restrictions=[],this.showDefaultRestrictions();this.$(".property-field .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"})},updateSaveButton:function(){let e=!1;this.$(".default-restrictions-list-wrap .right-item").each(function(t,a){let i=o(a),n=i.find("input").attr("id"),s=i.find(".select-timer .property-value").attr("data-value");n=n.slice(8,n.length),this.actual_default_restrictions.find(e=>e.name==n&&e.expires==s)||(i.find("input").prop("checked")?e=!0:this.actual_default_restrictions.find(e=>e.name==n)&&(e=!0))}.bind(this)),this.$(".btn-default-restrictions-save").switchClass("non-active",!e)},changeRestriction:function(e){let t=o(e.target);t.prop("checked")||t.closest(".right-item").find(".select-timer .property-value").attr("data-value","never").addClass("default-value").text("set timer")},keyUpInput:function(e){e.keyCode===i.KEY_ENTER&&o(e.target).click()},changePropertyValue:function(e){let t=o(e.target),a=t.closest(".property-field").find(".property-value");a.text(t.text()),a.attr("data-value",t.attr("data-value"))},changeTimerValue:function(e){let t=o(e.target),a=t.closest(".select-timer").find(".property-value"),i=t.closest(".right-item").find("input");a.text(t.text()),a.attr("data-value",t.attr("data-value")),"never"===t.attr("data-value")?(a.addClass("default-value"),a.text("set timer")):a.hasClass("default-value")&&a.removeClass("default-value"),i.prop("checked")||i.prop("checked",!0),this.updateSaveButton()},showDefaultRestrictions:function(){this.$("button").blur();let e=d({from:this.account.get("jid"),type:"get",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#rights"});this.account.sendIQ(e,function(e){var t=o(e).find("permission"),a=o(e).find("restriction");this.contact.all_rights={permissions:t,restrictions:a},this.contact.all_rights.restrictions.each(function(e,t){let a=o(t).attr("name"),i=o(t).attr("expires"),s=this.$(".default-restrictions-list-wrap .right-item.restriction-default-"+a),d=o(t).attr("translation"),r=o(n.group_chats.restriction_item({name:"default-"+a,pretty_name:d})),c=o(n.group_chats.right_expire_variants({right_name:"default-"+a}));if(i&&this.actual_default_restrictions.push({name:a,expires:i}),s.length&&s.detach(),r.append(c),this.$(".default-restrictions-list-wrap").append(r),!i)this.$(".right-item #"+a).prop("checked",!1);else if(this.$(".right-item #default-"+a).prop("checked",!0).addClass(i),"never"!==i){let e=this.$(".right-item.restriction-default-"+a);e.find(".select-timer .property-value").attr("data-value",i).removeClass("default-value").text(i)}}.bind(this)),this.$el.removeClass("request-waiting"),this.$(".select-timer .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"})}.bind(this))},saveChanges:function(){if(this.$(".btn-default-restrictions-save").hasClass("non-active"))return;this.$("button").blur();let e=d({from:this.account.get("jid"),to:this.contact.get("jid"),type:"set"}).c("query",{xmlns:l.NS.GROUP_CHAT+"#rights"}),t=!1;this.$(".default-restrictions-list-wrap .right-item").each(function(a,i){let n=o(i),s=n.find("input").attr("id"),d=n.find(".select-timer .property-value").attr("data-value");s=s.slice(8,s.length),this.actual_default_restrictions.find(e=>e.name==s&&e.expires==d)||(n.find("input").prop("checked")?(e.c("restriction",{name:s,expires:d}).up(),t=!0):this.actual_default_restrictions.find(e=>e.name==s)&&(e.c("restriction",{name:s,expires:"now"}).up(),t=!0))}.bind(this)),t&&this.account.sendIQ(e,function(){this.close()}.bind(this),function(){let e=o(error).find("error text").text()||"You have no permission to change default restrictions";s.dialogs.error(e),this.close()}.bind(this))},changeExpiresTime:function(e){var t=o(e.target),a=t.val(),i=t.prev();"never"==t.val()?i.find(".restriction-description").text("Indefinitely"):i.find(".restriction-description").text("For "+a),i.find("input").removeClass().addClass(a),t.remove()}}),t.Participant=Backbone.Model.extend({idAttribute:"id",initialize:function(e,t){let a=p.clone(e);this.contact=t.contact,this.account=this.contact.account,this.on("change:avatar",this.getBase64Avatar,this),this.set(a),this.getBase64Avatar()},getBase64Avatar:function(){if(this.get("avatar")){let e=this.account.chat_settings.getAvatarInfoById(this.get("id"));if(e&&e.avatar_hash==this.get("avatar"))return this.set("b64_avatar",e.avatar_b64),void(this.get("jid")===this.account.get("jid")&&this.contact.trigger("update_my_info"));let t=l.NS.PUBSUB_AVATAR_DATA+"#"+this.get("id");this.contact.getAvatar(this.get("avatar"),t,function(e){this.account.chat_settings.updateCachedAvatars(this.get("id"),this.get("avatar"),e),this.set("b64_avatar",e),this.get("jid")===this.account.get("jid")&&this.contact.trigger("update_my_info")}.bind(this))}}}),t.Participants=Backbone.Collection.extend({model:t.Participant,comparator:"nickname",initialize:function(e,t){this.contact=t.contact,this.account=this.contact.account,this.version=this.account.groupchat_settings.getParticipantsListVersion(this.contact.get("jid")),this.getCachedParticipants(),this.on("change:nickname",this.sort,this)},updateVersion:function(){this.version=this.account.groupchat_settings.getParticipantsListVersion(this.contact.get("jid"))||this.version},getCachedParticipants:function(){this.account.groupchat_settings.getParticipantsList(this.contact.get("jid")).forEach(function(e){this.mergeParticipant(e)}.bind(this))},mergeParticipant:function(e){"object"!=typeof e&&(e={id:e});let t=this.get(e.id);return t?t.set(e):t=this.create(e,{contact:this.contact}),t},resetParticipants:function(){this.version=0,p.each(p.clone(this.models),function(e){e.destroy()})},getRole:function(e){let t=1;return e.length?e.find(e=>"owner"===e.name)&&(t=2):t=0,i.PARTICIPANT_ROLES[t]},getRights:function(e){let t=[];return o(e).each(function(e,a){let i=o(a).attr("name"),n=o(a).attr("translation"),s=o(a).attr("issued-at"),d=o(a).attr("expires");t.push({name:i,pretty_name:n,issued_time:s,expires_time:d})}.bind(this)),t},createFromStanza:function(e){let t=e.find("jid").text(),a=e.find("nickname").text(),i=e.find("id").text(),n=e.find("badge").text(),s=e.find("present").text(),o=e.find("metadata[xmlns=\""+l.NS.PUBSUB_AVATAR_METADATA+"\"]").find("info").attr("id"),d=this.getRights(e.find("permission")),r=this.getRights(e.find("restriction")),c=this.getRole(d);a.trim().length||(a=t||i);let p={jid:t,id:i,avatar:o,nickname:a,badge:n,present:s,role:c,permissions:d,restrictions:r},u=this.mergeParticipant(p);return this.account.get("jid")===u.get("jid")&&(this.contact.my_info=u)&&this.contact.trigger("permissions_changed")&&this.contact.trigger("update_my_info"),this.account.groupchat_settings.updateParticipant(this.contact.get("jid"),p),u}}),t.GroupChatSettings=Backbone.ModelWithStorage.extend({defaults:{participants_lists:[]},getParticipantsListVersion:function(e){let t=p.clone(this.get("participants_lists")),a=t.find(t=>t.jid===e);return a?a.version:0},setParticipantsListVersion:function(e,t){let a=p.clone(this.get("participants_lists")),i=a.find(t=>t.jid===e),n=a.indexOf(i);-1!=n&&a.splice(n,1),i?i.version=t:i={jid:e,participants_list:[],version:0},a.push(i),this.save("participants_lists",a)},getParticipantsList:function(e){let t=p.clone(this.get("participants_lists")),a=t.find(t=>t.jid===e);return a&&a.participants_list?a.participants_list:[]},updateParticipant:function(e,t){let a=p.clone(this.get("participants_lists")),i=a.find(t=>t.jid===e),n=i&&i.version||0,s=i&&i.participants_list||[],o=a.indexOf(i);if(s.length){let e=s.find(e=>e.id===t.id),a=s.indexOf(e);-1==a?s.push(t):s[a]=t}else s.push(t);-1!=o&&a.splice(o,1),a.push({jid:e,participants_list:s,version:n}),this.save("participants_lists",a)},setParticipantsList:function(e,t){let a=p.clone(this.get("participants_lists")),i=a.find(t=>t.jid===e)||[],n=a.indexOf(i);-1!=n&&a.splice(n,1),a.push({jid:e,participants_list:t,version:i.version}),this.save("participants_lists",a)},removeParticipantFromList:function(e,t){let a=this.getParticipantsList(e);if(a.length){var i=a.indexOf(a.find(e=>e.id===t));-1!=i&&a.splice(i,1),this.setParticipantsList(e,a)}},resetParticipantsList:function(e){let t=p.clone(this.get("participants_lists")),a=t.indexOf(t.find(t=>t.jid===e));-1!=a&&t.splice(a,1),t.push({jid:e,participants_list:[],version:0}),this.save("participants_lists",t)}}),t.ContactInvitationView=t.BasicView.extend({className:"details-panel invitation-view",template:n.group_chats.invitation,ps_selector:".panel-content",avatar_size:i.AVATAR_SIZES.CONTACT_DETAILS,events:{"click .btn-chat":"openChat","click .btn-accept":"addContact","click .btn-join":"joinGroupChat","click .btn-decline":"declineContact","click .btn-decline-all":"declineAll","click .btn-block":"blockContact","click .btn-escape":"closeInvitationView"},_initialize:function(){this.account=this.model.account,this.name_field=this.model.get("name"),this.updateName(),this.updateStatus(),this.updateAvatar(),this.$(".invite-msg .invite-msg-text").text("User requests permission to add you to his contact list. If you accept, "+this.model.get("jid")+" will also be added to "+this.account.get("jid")+" contacts"),this.model.on("change",this.update,this)},render:function(){this.$(".btn-escape").showIf(!this.model.get("group_chat")),this.renderButtons()},onChangedVisibility:function(){this.isVisible()?this.model.set({display:!0,active:!0}):this.model.set({display:!1})},update:function(){var e=this.model.changed;p.has(e,"name")&&this.updateName(),p.has(e,"image")&&this.updateAvatar(),p.has(e,"status_updated")&&this.updateStatus(),p.has(e,"group_chat")&&this.updateGroupChat()},updateName:function(){this.$(".main-info  .name-wrap").text(this.model.get("name")),this.model.get("name-wrap")==this.model.get("jid")?(this.$(".main-info .name-wrap").addClass("name-is-jid"),this.$(".main-info  .jid").text("")):(this.$(".main-info .name-wrap").removeClass("name-is-jid"),this.$(".main-info  .jid").text(this.model.get("jid")))},updateStatus:function(){this.$(".status").attr("data-status",this.model.get("status")),this.$(".status-message").text(this.model.getStatusMessage())},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},renderButtons:function(){this.$(".buttons-wrap .btn-accept").hideIf(this.model.get("group_chat")&&!this.private_invite),this.$(".buttons-wrap .btn-block").hideIf(this.model.get("group_chat")&&this.private_invite),this.$(".buttons-wrap .btn-join").showIf(this.model.get("group_chat")&&!this.private_invite),this.$(".buttons-wrap .btn-decline-all").showIf(this.model.get("group_chat")&&this.private_invite)},updateGroupChat:function(){this.renderButtons(),this.model.get("group_chat")&&!this.private_invite&&this.updateInviteMsg("You are invited to group chat. If you accept, "+this.account.get("jid")+" username shall be visible to group chat participants")},updateInviteMsg:function(e){this.$(".invite-msg .invite-msg-text").text(e)},openChat:function(){this.model.set("in_roster",!0),this.model.trigger("open_chat",this.model)},addContact:function(){if(this.private_invite)return void this.joinGroupChat();var e=this.model;e.acceptRequest(),this.changeInviteStatus(),e.trigger("remove_invite",e),e.showDetails("all-chats")},blockInvitation:function(){let e=this.model.get("jid"),t=d({type:"get"}).c("blocklist",{xmlns:l.NS.BLOCKING}),a=d({type:"set"}).c("unblock",{xmlns:l.NS.BLOCKING}),i=d({type:"set"}).c("block",{xmlns:l.NS.BLOCKING}).c("item",{jid:this.model.get("jid")+"/"+u.now()});this.account.sendIQ(t,function(t){let n=o(t).find("item");0<n.length&&n.each(function(t,i){let n=o(i).attr("jid");-1<n.indexOf(e)&&a.c("item",{jid:n}).up()}),o(a.nodeTree).find("item").length?this.account.sendIQ(a,function(){this.account.sendIQ(i)}.bind(this)):this.account.sendIQ(i)}.bind(this))},changeInviteStatus:function(){let e=this.model,t=this.account.chats.getChat(e);t.set("is_accepted",!0),this.message&&t.sendMarker(this.message.get("msgid"),"displayed",this.message.get("archive_id"),this.message.get("contact_archive_id")),t.item_view.content.readMessages();var a=t.item_view.content.$(".auth-request");0<a.length&&a.each(function(e,a){var i=t.messages.get(a.dataset.msgid);i.set("is_accepted",!0)}.bind(this))},joinGroupChat:function(){var e=this.model;this.changeInviteStatus(),e.acceptRequest(),e.askRequest(),e.pushInRoster(),this.blockInvitation(),e.trigger("remove_invite",e),e.subGroupPres(),e.getMyInfo(),this.openChat()},declineContact:function(){var e=this.model;this.changeInviteStatus(),e.declineRequest(),this.blockInvitation(),e.trigger("remove_invite",e);var a=t.chats_view.active_chat;a.model.set("active",!1),a.content.head.closeChat(),t.body.setScreen("all-chats",{right:null})},declineAll:function(){if(this.model.get("private_chat")&&!0!==this.model.get("private_chat")){let e=c({from:this.account.connection.jid,to:this.model.get("private_chat")}).c("peer-to-peer").t(!1);this.account.sendPres(e)}this.model.trigger("remove_invite",this.model);var e=t.chats_view.active_chat;e.model.set("active",!1),e.content.head.closeChat(),t.body.setScreen("all-chats",{right:null})},closeInvitationView:function(){this.changeInviteStatus(),this.openChat()},blockContact:function(){var e=this.model;this.changeInviteStatus(),s.dialogs.ask("Block contact","Do you want to block "+e.get("name")+"?",null,{ok_button_text:"block"}).done(function(a){a&&(e.trigger("remove_invite",e),e.block(),t.trigger("clear_search"))}),e.get("group_chat")&&this.blockInvitation(),this.openChat()}}),t.ContactNameWidget=t.InputWidget.extend({field_name:"contact-name",placeholder:"",model_field:"name",setValue:function(e){if(""===name){this.model.set("roster_name",null);let e=this.getDefaultName();this.model.set("name",e)}this.model.pushInRoster({name:e})},getDefaultName:function(){let e=null;if(this.model.get("group_chat"))e=this.model.get("group_info")?this.model.get("group_info").name:this.model.get("jid");else{let t=this.model.get("vcard");e=t.nickname||t.fullname||(t.first_name+" "+t.last_name).trim()||this.model.get("jid")}return e},keyUp:function(){var e=this.getValue();this.$input.switchClass("changed",this.$input.val()!==e),this.$input.val()||this.$input.prop("placeholder",this.getDefaultName()||"Set contact name")}}),t.ContactEditGroupsView=t.BasicView.extend({template:n.groups,events:{"click .existing-group-field label":"editGroup","change .new-group-name input":"checkNewGroup","keyup .new-group-name input":"checkNewGroup","click .new-group-checkbox":"addNewGroup"},_initialize:function(){this.account=this.parent.account,this.model=this.parent.model,this.model.on("change:in_roster update_groups",this.render,this)},render:function(){if(this.$el.html(this.template()),this.model.get("in_roster")){var e=p.clone(this.model.get("groups")),t=p.map(this.account.groups.notSpecial(),function(t){var a=t.get("name");return{name:a,checked:p.contains(e,a),id:m()}});this.$(".groups").html(n.groups_checkbox_list({groups:t})).appendTo(this.$(".groups-wrap"))}this.$el.showIf(this.model.get("in_roster")),this.parent.updateScrollBar()},editGroup:function(e){var t=o(e.target),a=t.siblings("input"),i=!a.prop("checked"),n=a.attr("data-groupname"),s=p.clone(this.model.get("groups")),d=s.indexOf(n);a.prop("checked",i),i?s.push(n):0<=d&&s.splice(d,1),this.model.pushInRoster({groups:s})},checkNewGroup:function(e){var t=o(e.target).val(),a=this.$(".new-group-checkbox");a.showIf(t&&!this.account.groups.get(t))},addNewGroup:function(){var e=this.$(".new-group-name input"),t=e.val(),a=p.clone(this.model.get("groups")),i=a.indexOf(t);0>i&&a.push(t),this.model.pushInRoster({groups:a})}}),t.ContactsBase=Backbone.Collection.extend({model:t.Contact}),t.GroupContacts=t.ContactsBase.extend({initialize:function(e,t){this.group=t.group,this.on("change",this.onContactChanged,this)},comparator:function(e,a){if("online-first"===t.settings.roster.sorting){var n=e.get("status"),s=a.get("status"),o=i.STATUS_WEIGHTS[n],d=i.STATUS_WEIGHTS[s],r=o>=i.STATUS_WEIGHTS.offline,c=d>=i.STATUS_WEIGHTS.offline;if(r^c)return r?1:-1}var l,p;return l=e.get("name").toLowerCase(),p=a.get("name").toLowerCase(),l<p?-1:l>p?1:0},onContactChanged:function(e){var t=e.changed;(p.has(t,"name")||p.has(t,"status_updated"))&&(this.sort(),this.trigger("update_contact_item",e))}}),t.Group=Backbone.Model.extend({defaults:{counter:{all:0,online:0}},initialize:function(e,a){this.account=a.account,e.name||(e.name=e.id),this.set(e),this._settings=this.account.groups_settings.get(e.name),this._settings||(this._settings=this.account.groups_settings.create({name:e.name})),this.settings=this._settings.attributes,this.contacts=new t.GroupContacts(null,{group:this}),this.settings_view=new t.GroupSettingsView({model:this}),this.contacts.on("add update_contact_item",this.updateCounter,this),this.contacts.on("destroy",this.onContactRemoved,this),t._roster_settings.on("change",this.onChangedRosterSettings,this)},isSpecial:function(){return p.isNumber(this.get("id"))},updateCounter:function(){var e=this.contacts.length,t=e-this.contacts.where({status:"offline"}).length;this.set("counter",{all:e,online:t})},renameGroup:function(e){var t=this.get("name"),a=p.clone(this.settings);a.name=e,this._settings.destroy(),this._settings=this.account.groups_settings.create(a),this.settings=this._settings.attributes,this.set({id:e,name:e}),this.trigger("rename",this,t),p.each(p.clone(this.contacts.models),function(a){var i=p.clone(a.get("groups")),n=i.indexOf(t);0<=n&&i.splice(n,1),n=i.indexOf(e),0>n&&i.push(e),a.pushInRoster({groups:i})})},deleteGroup:function(){var e=this.get("name");this._settings.destroy(),p.each(p.clone(this.contacts.models),function(t){var a=p.clone(t.get("groups")),i=a.indexOf(e);0<=i&&a.splice(i,1),t.pushInRoster({groups:a})})},removeContact:function(e){this.contacts.get(e)&&(this.contacts.remove(e),this.onContactRemoved(e))},onContactRemoved:function(e){this.updateCounter(),this.trigger("remove_contact",e),this.contacts.length||this.destroy()},onChangedRosterSettings:function(){var e=t._roster_settings.changed;p.has(e,"show_offline")&&this._settings.trigger("change:show_offline"),p.has(e,"sorting")&&(this.contacts.sort(),this._settings.trigger("change:sorting"))},showSettings:function(){this.settings_view.show()}}),t.GroupView=t.BasicView.extend({className:"roster-group",events:{"click .group-head":"toggle","click .group-head .group-icon":"showGroupSettings","mouseover .group-head":"showSettingsIcon","mouseleave .group-head":"updateGroupIcon"},_initialize:function(){this.account=this.model.account,this.updateName(),this.updateGroupIcon(),this.updateMembersCounter(),this.model.contacts.on("add",this.onContactAdded,this),this.model.on("remove_contact",this.onContactRemoved,this),this.model.contacts.on("update_contact_item",this.updateContactItem,this),this.model.on("change:name",this.updateName,this),this.model.on("change:counter",this.updateMembersCounter,this),this.model._settings.on("change:show_offline",this.onChangedOfflineSetting,this),this.model._settings.on("change:sorting",this.onChangedSortingSetting,this),this.data.on("change:expanded",this.updateExpanded,this)},updateExpanded:function(){var e=this.data.get("expanded");this.$el.switchClass("shrank",!e),this.$(".arrow").switchClass("mdi-chevron-down",e),this.$(".arrow").switchClass("mdi-chevron-right",!e),this.$(".roster-contact").showIf(e),this.parent.parent.onListChanged()},updateGroupIcon:function(){var e=this.model.settings.show_offline,t;"default"===e?t="settings":"yes"===e?t="group-filled":"no"===e&&(t="group-outline"),this.$(".group-icon").attr("data-mdi",t).hideIf("settings"===t)},updateName:function(){this.$(".group-name").text(this.model.get("name"))},updateMembersCounter:function(){var e=this.model.get("counter");this.$(".participant-counter").text("("+e.online+"/"+e.all+")")},onContactAdded:function(e){this.addChild(e.get("jid"),this.item_view,{model:e});this.updateContactItem(e)},onContactRemoved:function(e){this.removeChild(e.get("jid")),this.parent.parent.onListChanged()},updateContactItem:function(e){var a=this.child(e.get("jid"));if(a){var n=t.settings.roster,s=this.model.settings,o="default"===s.show_offline,d="yes"===s.show_offline||o&&"yes"===n.show_offline,r=6<=i.STATUS_WEIGHTS[e.get("status")];a.$el.switchClass("invisible",r&&!d).detach();var c=this.model.contacts.indexOf(e);return 0===c?this.$(".group-head").after(a.$el):this.$(".roster-contact").eq(c-1).after(a.$el),a.$el.showIf(this.data.get("expanded")),this.parent.parent.onListChanged(),a}},showSettingsIcon:function(){this.$(".group-icon").attr("data-mdi","settings").removeClass("hidden")},showGroupSettings:function(e){e.stopPropagation(),this.model.showSettings()},onChangedOfflineSetting:function(){this.updateGroupIcon();var e=t.settings.roster,a=this.model.settings,n="default"===a.show_offline,s="yes"===a.show_offline||n&&"yes"===e.show_offline;p.each(this.children,function(e){var t=6<=i.STATUS_WEIGHTS[e.model.get("status")];e.$el.switchClass("invisible",t&&!s)}),this.parent.parent.onListChanged()},onChangedSortingSetting:function(){p.each(this.children,function(e){e.$el.detach()}),this.model.contacts.each(function(e){this.updateContactItem(e)}.bind(this)),this.parent.parent.onListChanged()}}),t.GroupRightView=t.GroupView.extend({template:n.group_right,item_view:t.ContactItemRightView,__initialize:function(){this.data.set("expanded",this.model.settings.expanded)},toggle:function(){var e=!this.data.get("expanded");this.data.set("expanded",e),this.model._settings.save("expanded",e)}}),t.GroupLeftView=t.GroupView.extend({template:n.group_left,item_view:t.ContactItemLeftView,__initialize:function(){this.data.set("expanded",!0)},toggle:function(e){e.stopPropagation(),this.data.set("expanded",!this.data.get("expanded"))}}),t.GroupSettingsView=t.BasicView.extend({className:"modal main-modal group-settings",template:n.group_settings,ps_selector:".modal-content",avatar_size:i.AVATAR_SIZES.GROUP_SETTINGS,events:{"change .offline input[type=radio][name=offline]":"setOffline","click .btn-apply":"applySettings","click .btn-delete":"deleteGroup","click .btn-cancel":"close"},_initialize:function(){this._settings=this.model._settings;this.model.get("name");this.model.isSpecial()&&(this.$(".group-name input").attr("readonly",!0),this.$(".btn-delete").addClass("hidden")),this.model.on("destroy",this.onDestroy,this)},render:function(){this.$(".group-name input").val(this.model.get("name")),this.$(".group-name .errors").addClass("hidden"),this.$(".offline input[type=radio][name=offline][value="+this.model.settings.show_offline+"]").prop("checked",!0),this.$el.openModal({ready:function(){Materialize.updateTextFields()},complete:this.hide.bind(this)})},setOffline:function(e){this.model._settings.save("show_offline",e.target.value)},validateName:function(e){return e?this.model.collection.get(e)?"Wrong name":void 0:"Please input name!"},applySettings:function(){var e=this.$(".group-name input").val();if(e!==this.model.get("name")){var t=this.validateName(e);if(t)return void this.$(".group-name .errors").text(t).removeClass("hidden");this.model.renameGroup(e)}this.close()},deleteGroup:function(){var e=this.model.get("name");s.dialogs.ask("Remove group","Do you want to remove group "+e+"?",null,{ok_button_text:"remove"}).done(function(e){e&&this.model.deleteGroup()}.bind(this))},onHide:function(){this.$el.detach()},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},onDestroy:function(){this.$el.closeModal({complete:this.remove.bind(this)})}}),t.Groups=Backbone.Collection.extend({model:t.Group,initialize:function(e,t){this.account=t.account,this.on("add",this.onGroupAdded,this),this.on("change:id",this.sort,this)},comparator:function(e,t){return e.isSpecial()===t.isSpecial()?e.get("id")<t.get("id")?-1:1:e.isSpecial()?1:-1},notSpecial:function(){return this.filter(function(e){return!e.isSpecial()})},onGroupAdded:function(e){e.acc_view=new t.AccountGroupView({model:e})}}),t.Contacts=t.ContactsBase.extend({initialize:function(e,t){this.account=t.account,this.account.on("deactivate destroy",this.removeAllContacts,this),this.collections=[],this.on("add",p.bind(this.updateInCollections,this,"add")),this.on("change",p.bind(this.updateInCollections,this,"change"))},addCollection:function(e){this.collections.push(e)},updateInCollections:function(e,t){p.each(this.collections,function(a){a.update(t,e)})},mergeContact:function(e){"object"!=typeof e&&(e={jid:e});var t=this.get(e.jid);return t?t.set(e):t=this.create(e,{account:this.account}),t},removeAllContacts:function(){p.each(p.clone(this.models),function(e){e.destroy()})},handlePresence:function(e,t){var a=this.mergeContact(t);a.handlePresence(e)}}),t.BlockList=t.ContactsBase.extend({initialize:function(e,t){this.account=t.account,this.contacts=this.account.contacts,this.contacts.on("remove_from_blocklist",this.onContactRemoved,this)},update:function(e){var t=e.get("blocked");t?!this.get(e)&&(this.add(e),e.trigger("add_to_blocklist",e)):this.get(e)&&(this.remove(e),e.trigger("remove_from_blocklist",e))},onContactRemoved:function(e){e.getVCard()},registerHandler:function(){this.account.connection.deleteHandler(this._stanza_handler),this._stanza_handler=this.account.connection.addHandler(this.onBlockingIQ.bind(this),l.NS.BLOCKING,"iq","set",null,this.account.get("jid"))},getFromServer:function(){var e=d({type:"get"}).c("blocklist",{xmlns:l.NS.BLOCKING});this.account.sendIQ(e,this.onBlockingIQ.bind(this))},onBlockingIQ:function(e){var t=o(e).find("[xmlns=\""+l.NS.BLOCKING+"\"]"),a=t[0].tagName.toLowerCase(),i=a.startsWith("block");return t.find("item").each(function(e,t){var a=t.getAttribute("jid");this.account.contacts.mergeContact({jid:a,blocked:i})}.bind(this)),!0}}),t.Roster=t.ContactsBase.extend({initialize:function(e,t){this.account=t.account,this.roster_version=this.account.get("roster_version")||0,this.groups=this.account.groups,this.contacts=this.account.contacts,this.contacts.on("add_to_roster",this.onContactAdded,this),this.contacts.on("change_in_roster",this.onContactChanged,this),this.contacts.on("remove_from_roster",this.onContactRemoved,this)},update:function(e,t){var a=e.get("in_roster")||e.get("known");a?this.get(e)?"change"===t&&e.trigger("change_in_roster",e):(this.add(e),e.trigger("add_to_roster",e)):this.get(e)&&(this.remove(e),e.trigger("remove_from_roster",e))},onContactAdded:function(e){if(!e.get("in_roster"))return void this.addContactToGroup(e,i.NON_ROSTER_GROUP_ID);var t=e.get("groups");t.length?p.each(t,p.bind(this.addContactToGroup,this,e)):this.addContactToGroup(e,i.GENERAL_GROUP_ID)},onContactChanged:function(e){var t=e.changed,a=p.has(t,"known"),n=p.has(t,"in_roster"),s=p.has(t,"groups");if(n||a||s){var o;e.get("in_roster")?(o=p.clone(e.get("groups")),!o.length&&o.push(i.GENERAL_GROUP_ID)):e.get("known")?o=[i.NON_ROSTER_GROUP_ID]:o=[];var d=this.groups.filter(function(e){return!p.contains(o,e.get("id"))});p.each(d,function(t){t.removeContact(e)}),p.each(o,p.bind(this.addContactToGroup,this,e)),e.trigger("update_groups")}},onContactRemoved:function(e){p.each(this.groups.filter(),function(t){t.removeContact(e)})},getGroup:function(e){var a=this.groups.get(e);if(a)return a;var n={id:e};return e===i.GENERAL_GROUP_ID?n.name=t.settings.roster.general_group_name:e===i.NON_ROSTER_GROUP_ID&&(n.name=t.settings.roster.non_roster_group_name),this.groups.create(n,{account:this.account})},addContactToGroup:function(e,t){var a=this.getGroup(t);a.contacts.add(e)},registerHandler:function(){this.account.connection.deleteHandler(this._stanza_handler),this._stanza_handler=this.account.connection.addHandler(this.onRosterIQ.bind(this),l.NS.ROSTER,"iq","set",null,this.account.get("jid"))},syncFromServer:function(e){e=e||{};let t={xmlns:l.NS.SYNCHRONIZATION};!e.after&&this.account.last_msg_timestamp&&(t.stamp=1e3*this.account.last_msg_timestamp);let a=d({type:"get"}).c("query",t).cnode(new l.RSM(e).toXML());this.account.sendIQ(a,function(e){this.onSyncIQ(e,t.stamp)}.bind(this))},onSyncIQ:function(a,i){this.account.last_msg_timestamp=u.now();let n=o(a).find("set last");return(n.length?this.last_chat_msg_id=n.text():this.conversations_loaded=!0,!o(a).find("conversation").length&&!t.accounts.connected.find(e=>!e.roster.conversations_loaded))?void t.chats_view.$(".load-chats-feedback").text("All chats loaded"):(o(a).find("conversation").each(function(a,n){let s=o(n),d=s.attr("jid");if(d===this.account.get("jid"))return;let r=this.contacts.mergeContact(d),c="groupchat"===s.attr("type"),l=this.account.chats.getChat(r),p=s.children("last-message").children("message"),u=s.children("call"),m=s.children("unread"),g=s.children("delivered").attr("id"),h=s.children("displayed").attr("id"),v=parseInt(m.attr("count")),f=s.children("retract").attr("version"),b={synced_msg:!0},x;if(r.set("group_chat",c),u.length){let e=u.children("message"),t=e.attr("from"),a=e.children("propose").attr("id");l.initIncomingCall(t,a)}p.length||(l.set("timestamp",e(+s.attr("stamp"))/1e3),l.item_view.updateEmptyChat()),l.message_retraction_version!=f&&(l.message_retraction_version=f,i&&l.trigger("get_retractions_list")),l.set("last_delivered_id",g),l.set("last_displayed_id",h),v&&(b.is_unread=!0),b.delay=p.children("time"),v&&v--,p.length&&(x=this.account.chats.receiveChatMessage(p,b)),l.set("const_unread",v),x&&(!x.isSenderMe()&&(m.attr("after")<x.get("archive_id")||m.attr("after")<x.get("contact_archive_id"))&&x.set("is_unread",!0),l.set("first_archive_id",x.get("archive_id"))),t.toolbar_view.recountAllMessageCounter()}.bind(this)),t.chats_view.hideChatsFeedback(),!0)},getFromServer:function(){let e=this.roster_version,t=d({type:"get"}).c("query",{xmlns:l.NS.ROSTER,ver:e});this.account.sendIQ(t,function(t){this.onRosterIQ(t),this.account.sendPresence(),o(t).children("query").find("item").length||this.account.cached_roster.getAllFromRoster(function(t){o(t).each(function(e,t){this.contacts.mergeContact(t)}.bind(this)),t.length||0==e||(this.roster_version=0,this.getFromServer())}.bind(this)),this.account.dfd_presence.resolve()}.bind(this))},onRosterIQ:function(e){let t=o(e).children("query").attr("ver");return"set"===e.getAttribute("type")?this.account.sendIQ(d({type:"result",id:e.getAttribute("id"),from:this.account.jid})):t&&this.roster_version!=t&&this.account.cached_roster.clearDataBase(),t&&(this.roster_version=t),this.account.save("roster_version",this.roster_version),o(e).children("query").find("item").each(function(e,t){this.onRosterItem(t)}.bind(this)),!0},onRosterItem:function(e){var t=e.getAttribute("jid");if(t!==this.account.get("jid")){var a=this.contacts.mergeContact(t),i=e.getAttribute("subscription");if("remove"===i)return a.set({in_roster:!1,known:!1,subscription:null}),void this.account.cached_roster.removeFromCachedRoster(t);var n=[];o(e).find("group").each(function(){var e=o(this).text();0>n.indexOf(e)&&n.push(e)});var s={subscription:i,in_roster:!0,roster_name:e.getAttribute("name"),groups:n};this.account.cached_roster.putInroster(p.extend(p.clone(s),{jid:t})),s.roster_name&&(s.name=s.roster_name),a.set(s)}}}),t.AccountRosterView=t.BasicView.extend({className:"account-roster-wrap",events:{"click .roster-account-info-wrap .status-button":"openChangeStatus","click .roster-account-info":"toggle"},_initialize:function(e){this.account=e.account,this.groups=this.account.groups,this.roster=this.account.roster,this.contacts=this.account.contacts,this.$el.attr("data-jid",this.account.get("jid")),this.$el.appendTo(this.parent.$(".contact-list")),this.$info=this.$(".roster-account-info-wrap"),this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateColorScheme(),this.account.on("change:name",this.updateName,this),this.account.on("change:image",this.updateAvatar,this),this.account.on("change:status_updated",this.updateStatus,this),this.account.settings.on("change:color",this.updateColorScheme,this),this.groups.on("add",this.onGroupAdded,this),this.groups.on("rename",this.onGroupRenamed,this),this.groups.on("destroy",this.onGroupRemoved,this),this.data.on("change:expanded",this.updateExpanded,this),this.data.set("expanded",!0)},updateName:function(){this.$info.find(".name").text(this.account.get("name"))},updateStatus:function(){this.$info.find(".status").attr("data-status",this.account.get("status")),this.$info.find(".status-message").text(this.account.getStatusMessage())},updateAvatar:function(){var e=this.account.cached_image;this.$info.find(".circle-avatar").setAvatar(e,this.avatar_size)},updateColorScheme:function(){this.$el.attr("data-color",this.account.settings.get("color"))},updateExpanded:function(){var e=this.data.get("expanded");this.$el.switchClass("shrank",!e),this.parent.updateScrollBar()},updateGroupPosition:function(e){e.$el.detach();var t=this.groups.indexOf(e.model);0===t?this.$info.after(e.$el):this.$(".roster-group").eq(t-1).after(e.$el),this.parent.updateScrollBar()},onGroupAdded:function(e){var t=this.addChild(e.get("id"),this.group_view,{model:e});this.updateGroupPosition(t)},onGroupRenamed:function(e,t){var a=this.child(t);delete this.children[t],this.children[e.get("name")]=a,a&&this.updateGroupPosition(a)},onGroupRemoved:function(e){this.removeChild(e.get("id"))},toggle:function(){this.data.set("expanded",!this.data.get("expanded"))},openChangeStatus:function(){t.change_status_view.open(this.account)}}),t.AccountRosterRightView=t.AccountRosterView.extend({template:n.account_roster_right,group_view:t.GroupRightView,avatar_size:i.AVATAR_SIZES.ROSTER_RIGHT_ACCOUNT_ITEM,__initialize:function(){this.contacts.on("add_to_roster change_in_roster remove_from_roster",this.updateCounter,this),this.contacts.on("add_to_roster remove_from_roster",this.updateGlobalCounter,this)},updateCounter:function(){var e=this.roster.length,t=e-this.roster.where({status:"offline"}).length;this.$info.find(".counter").text(t+"/"+e)},updateGlobalCounter:function(){this.parent.updateCounter()}}),t.AccountRosterLeftView=t.AccountRosterView.extend({template:n.account_roster_left,group_view:t.GroupLeftView,avatar_size:i.AVATAR_SIZES.ROSTER_LEFT_ACCOUNT_ITEM,__initialize:function(){this.$info.find(".jid").text(this.account.get("jid"))},search:function(e){this.$el.removeClass("shrank"),this.$(".group-head").addClass("hidden");var t=0,a={};this.$(".roster-contact").each(function(i,n){var s=o(n),d=s.data("jid"),r=this.roster.get(d);if(r){if(a[r.hash_id])return void s.addClass("hidden");a[r.hash_id]=!0;var c=r.get("name").toLowerCase(),l=0>c.indexOf(e)&&0>d.indexOf(e);s.hideIf(l),l||t++}}.bind(this)),this.$(".roster-account-info-wrap").showIf(t)},searchAll:function(){this.$el.switchClass("shrank",!this.data.get("expanded")),this.$(".roster-account-info-wrap").removeClass("hidden"),this.$(".group-head").removeClass("hidden"),this.$(".list-item").removeClass("hidden")}}),t.BlockedItemView=t.BasicView.extend({className:"blocked-contact",template:n.contact_blocked_item,avatar_size:i.AVATAR_SIZES.CONTACT_BLOCKED_ITEM,events:{"click .btn-unblock":"unblockContact",click:"showDetails"},_initialize:function(){this.$el.appendTo(this.parent.$(".blocked-contacts")),this.$el.attr({"data-jid":this.model.get("jid")}),this.$(".jid").text(this.model.get("jid")),this.$(".circle-avatar").setAvatar(this.model.cached_image,this.avatar_size)},unblockContact:function(e){e.stopPropagation(),this.model.unblock()},showDetails:function(){this.model.showDetails()}}),t.BlockListView=t.BasicView.extend({_initialize:function(e){this.account=e.account,this.account.contacts.on("add_to_blocklist",this.onContactAdded,this),this.account.contacts.on("remove_from_blocklist",this.onContactRemoved,this)},onContactAdded:function(e){e.get("group_chat")||(this.addChild(e.get("jid"),t.BlockedItemView,{model:e}),this.$(".placeholder").addClass("hidden"),this.parent.updateScrollBar())},onContactRemoved:function(e){this.removeChild(e.get("jid")),this.$(".placeholder").hideIf(this.account.blocklist.length),this.parent.updateScrollBar()}}),t.RosterView=t.SearchPanelView.extend({ps_selector:".contact-list-wrap",_initialize:function(){this._settings=t._roster_settings,this.model.on("activate",this.updateOneRosterView,this),this.model.on("update_order",this.updateRosterViews,this),this.model.on("deactivate destroy",this.removeRosterView,this),this.on("before_hide",this.saveScrollBarOffset,this)},updateOneRosterView:function(e){var t=e.get("jid"),a=this.child(t);if(a)a.$el.detach();else if(e.isConnected())a=this.addChild(t,this.account_roster_view,{account:e});else return;var i=this.model.connected.indexOf(e);0===i?this.$(".contact-list").prepend(a.$el):this.$(".contact-list").children().eq(i-1).after(a.$el),this.updateScrollBar()},updateRosterViews:function(){p.each(this.children,function(e){e.detach()}),this.model.each(function(e){var t=e.get("jid"),a=this.child(t);a&&this.$(".contact-list").append(a.$el)}.bind(this)),this.updateScrollBar()},removeRosterView:function(e){this.removeChild(e.get("jid")),this.updateScrollBar()}}),t.RosterRightView=t.RosterView.extend({className:"roster-right-container container",template:n.roster_right,ps_settings:{theme:"roster-right"},account_roster_view:t.AccountRosterRightView,events:{"mouseover .collapsed-wrap":"expand","mouseleave .expanded-wrap":"collaps","click .btn-pin":"pinUnpin"},__initialize:function(){this.updateCounter(),this.model.on("activate deactivate destroy",this.updateCounter,this),this.data.on("change",this.updateLayout,this);var e=this._settings.get("pinned");this.data.set({expanded:e,pinned:e})},expand:function(){this.data.set("expanded",!0)},collaps:function(){this.data.get("pinned")||this.data.set("expanded",!1)},pinUnpin:function(){var e=!this.data.get("pinned");this._settings.save("pinned",e),this.data.set("pinned",e)},updateLayout:function(){var e=this.data.changed;(p.has(e,"expanded")||p.has(e,"pinned"))&&t.trigger("update_layout",{roster_state_changed:!0})},updateCounter:function(){this.$(".all-contacts-counter").text(p.reduce(this.children,function(e,t){return e+t.roster.length},0))},onListChanged:function(){this.updateScrollBar()}}),t.RosterLeftView=t.RosterView.extend({className:"roster-left-container container",template:n.roster_left,ps_settings:{theme:"item-list"},main_container:".contact-list",account_roster_view:t.AccountRosterLeftView,__initialize:function(){this.model.on("list_changed",this.updateLeftIndicator,this),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this))},updateLeftIndicator:function(){this.$el.attr("data-indicator",1<this.model.connected.length)},getContactForItem:function(e){var t=o(e),a=t.parent().parent().data("jid"),i=t.data("jid"),n=this.child(a);return n&&n.roster.get(i)},render:function(e){("chat"!==e.right&&"contact_details"!==e.right&&"message_context"!==e.right&&"participant_messages"!==e.right||e.clear_search&&"chat"===e.right)&&this.clearSearch()},searchAll:function(){p.each(this.children,function(e){e.searchAll()})},selectItem:function(e,t){if(!e)return void("up"===t&&(this.ps_container[0].scrollTop=0));this.clearSearchSelection();var a=this.$(".list-item[data-id=\""+e+"\"]");a.length?this.selection_id=e:(this.ps_container[0].scrollTop=0,a=this.$(".list-item:visible").first(),this.selection_id=a.data("id")),a.length&&"down"===t&&(a[0].clientHeight+a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop>=this.ps_container[0].clientHeight+this.ps_container[0].scrollTop||a[0].clientHeight+a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop<this.ps_container[0].scrollTop)&&(this.ps_container[0].scrollTop=a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop),a.length&&"up"===t&&(a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop<=this.ps_container[0].scrollTop||a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop>this.ps_container[0].scrollTop+this.ps_container[0].clientHeight)&&(this.ps_container[0].scrollTop=a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop),a.addClass("selected")},onEnterPressed:function(e){let a;if(e.closest(".searched-lists-wrap").length)this.clearSearch(),this.$(".list-item.active").removeClass("active"),e.hasClass("chat-item")&&(a=t.chats_view.child(e.data("id")),a&&a.open({screen:t.body.screen.get("name"),clear_search:!1}),e.addClass("active")),e.hasClass("roster-contact")&&(a=t.accounts.get(e.data("account")).chats.get(t.accounts.get(e.data("account")).contacts.get(e.data("jid")).hash_id),a&&(a=a.item_view),a&&t.chats_view.openChat(a,{clear_search:!1,screen:t.body.screen.get("name")}),e.addClass("active")),e.hasClass("message-item")&&e.click();else{var i=this.getContactForItem(e);i&&i.showDetails()}},onListChanged:function(){this.updateSearch()}}),t.RosterSettingsView=t.BasicView.extend({className:"roster-settings-wrap",template:n.roster_settings,events:{"change .offline-contacts input":"setOfflineSetting","change .sorting-contacts input":"setSortingSetting"},_initialize:function(){this.$el.appendTo(this.parent.$(".settings-block-wrap.contact-list"))},render:function(){this.$(".offline-contacts input[type=radio][name=offline-contacts][value="+this.model.get("show_offline")+"]").prop("checked",!0),this.$(".sorting-contacts input[type=radio][name=sorting-contacts][value="+this.model.get("sorting")+"]").prop("checked",!0)},setOfflineSetting:function(){this.model.save("show_offline",this.$(".offline-contacts input[type=radio][name=offline-contacts]:checked").val())},setSortingSetting:function(){this.model.save("sorting",this.$(".sorting-contacts input[type=radio][name=sorting-contacts]:checked").val())}}),t.AccountGroupView=t.BasicView.extend({className:"group",template:function(){this.$el.append("<span class=\"group-name\"/>")},events:{"click .group-name":"showGroupSettings"},_initialize:function(){this.$(".group-name").text(this.model.get("name"));var e=this.model.collection.indexOf(this.model),t=this.model.account.settings_right.$(".groups");0===e?t.prepend(this.$el):t.children().eq(e-1).after(this.$el),this.model.on("destroy",this.remove,this)},showGroupSettings:function(){this.model.showSettings()}}),t.ContactPlaceholderView=t.BasicView.extend({className:"placeholder-wrap contact-placeholder-wrap noselect",template:n.contact_placeholder}),t.AddContactView=t.BasicView.extend({className:"modal main-modal add-contact-modal",template:n.add_contact,ps_selector:".modal-content",avatar_size:i.AVATAR_SIZES.SYNCHRONIZE_ACCOUNT_ITEM,events:{"click .account-field .dropdown-content":"selectAccount","click .existing-group-field label":"editGroup","change .new-group-name input":"checkNewGroup","keyup .new-group-name input":"checkNewGroup","keyup .name-field #new_contact_username":"checkJid","focusout .name-field #new_contact_username":"focusoutInputField","click .new-group-checkbox":"addNewGroup","click .btn-add":"addContact","click .btn-cancel":"close"},_initialize:function(){this.group_data=new Backbone.Model,this.group_data.on("change",this.updateGroups,this)},render:function(e){if(!t.accounts.connected.length)return void s.dialogs.error("No connected accounts found.");e||(e={});var a=e.account?[e.account]:t.accounts.connected,i=e.jid||"";return this.$("input[name=\"username\"]").val(i).attr("readonly",!!i).removeClass("invalid"),this.$(".single-acc").showIf(1===a.length),this.$(".multiple-acc").hideIf(1===a.length),this.$(".account-field .dropdown-content").empty(),p.each(a,function(e){this.$(".account-field .dropdown-content").append(this.renderAccountItem(e))}.bind(this)),this.bindAccount(a[0]),this.$("span.errors").text(""),this.$el.openModal({ready:function(){Materialize.updateTextFields(),this.$(".account-field .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"})}.bind(this),complete:this.hide.bind(this)}),this},bindAccount:function(e){this.account=e,this.$(".account-field .dropdown-button .account-item-wrap").replaceWith(this.renderAccountItem(e)),this.renderGroupsForAccount(e)},renderAccountItem:function(e){var t=o(n.add_contact_account_item({jid:e.get("jid")}));return t.find(".circle-avatar").setAvatar(e.cached_image,this.avatar_size),t},renderGroupsForAccount:function(e){this.group_data.set({selected:[],groups:p.map(e.groups.notSpecial(),function(e){return e.get("name")})},{silent:!0}),this.updateGroups()},updateGroups:function(){var e=this.group_data.get("selected");this.$(".groups").html(n.groups_checkbox_list({groups:p.map(this.group_data.get("groups"),function(t){return{name:t,id:m(),checked:p.contains(e,t)}})})),this.updateScrollBar()},selectAccount:function(e){var a=o(e.target).closest(".account-item-wrap"),i=t.accounts.get(a.data("jid"));this.bindAccount(i)},editGroup:function(e){e.preventDefault();var t=o(e.target),a=t.siblings("input"),i=!a.prop("checked"),n=a.attr("data-groupname"),s=p.clone(this.group_data.get("selected")),d=s.indexOf(n);a.prop("checked",i),i?0>d&&s.push(n):0<=d&&s.splice(d,1),this.group_data.set("selected",s)},checkNewGroup:function(e){var t=o(e.target).val(),a=this.$(".new-group-checkbox");a.showIf(t&&!p.contains(this.group_data.get("groups"),t))},addNewGroup:function(e){e.preventDefault();var t=this.$(".new-group-name input"),a=t.val(),i=p.clone(this.group_data.get("groups")),n=i.indexOf(a);if(0>n){var s=p.clone(this.group_data.get("selected"));s.push(a),i.push(a),this.group_data.set({groups:i,selected:s})}this.scrollToBottom()},focusoutInputField:function(){this.$("input[name=username]").val().trim()||(this.$("input[name=username]").removeClass("invalid"),this.$("span.errors").text("").addClass("hidden"))},checkJid:function(){let e=this.$("input[name=username]").val().trim(),t=/^(([^<>()[\]\\.,;:\s%@\"]+(\.[^<>()[\]\\.,;:\s%@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([^<>()[\]\\.,;:\s%@\"]+(\.[^<>()[\]\\.,;:\s%@\"]+)*)|(\".+\"))|(([0-9]{1,3}\.){3}[0-9]{1,3})|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,a;!t.test(e)&&e&&(a="Invalid jid"),a?this.$("input[name=username]").addClass("invalid").siblings(".errors").text(a):(this.$("input[name=username]").removeClass("invalid"),this.$("span.errors").text("").addClass("hidden"))},addContact:function(){this.$("span.errors").text("").addClass("hidden");var e=this.$("input[name=username]").removeClass("invalid").val().trim(),t=this.$("input[name=contact_name]").removeClass("invalid").val(),a=this.group_data.get("selected"),i=/^(([^<>()[\]\\.,;:\s%@\"]+(\.[^<>()[\]\\.,;:\s%@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,n,s;e=l.getBareJidFromJid(e),e?e===this.account.get("jid")?s="Can not add yourself to contacts!":i.test(e)?(n=this.account.contacts.mergeContact(e),n.get("in_roster")&&(s="Contact is already in your roster!")):s="Invalid jid":s="Input username!",s?this.$("input[name=username]").addClass("invalid").siblings(".errors").text(s):(n.pres("subscribed"),n.pushInRoster({name:t,groups:a},function(){n.pres("subscribe"),n.trigger("open_chat",n)}.bind(this),function(){n.destroy()}),this.close())},onHide:function(){this.$el.detach()},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),t.GroupSettings=Backbone.Model.extend({idAttribute:"name",defaults:{expanded:!0,show_offline:"default",sorting:"default",custom_notifications:!1,notifications:!1,message_preview:!1}}),t.GroupsSettings=Backbone.CollectionWithStorage.extend({model:t.GroupSettings,_initialize:function(e,t){this.account=t.account,this.account.on("destroy",this.clearStorage,this),this.fetch()}}),t.RosterSettings=Backbone.ModelWithStorage.extend({defaults:{pinned:!0,show_offline:"yes",sorting:"online-first",general_group_name:"General",non_roster_group_name:"Not in roster"}}),t.CachedContactsInfo=Backbone.ModelWithDataBase.extend({defaults:{contacts:[]},putContactInfo:function(e,t){this.database.put("contacts",e,function(e){t&&t(e)})},getContactInfo:function(e,t){this.database.get("contacts",e,function(e){t&&t(e)})}}),t.CachedRoster=Backbone.ModelWithDataBase.extend({putInroster:function(e,t){this.database.put("roster_items",e,function(e){t&&t(e)})},getItemFromRoster:function(e,t){this.database.get("roster_items",e,function(e){t&&t(e)})},getAllFromRoster:function(e){this.database.get_all("roster_items",null,function(t){e&&e(t||[])})},removeFromCachedRoster:function(e,t){this.database.remove("roster_items",e,function(e){t&&t(e)})},clearDataBase:function(){this.database.clear_database("roster_items")}}),t.Account.addInitPlugin(function(){this.groups_settings=new t.GroupsSettings(null,{account:this,storage_name:t.getStorageName()+"-groups-settings-"+this.get("jid")}),this.cached_roster=new t.CachedRoster(null,{name:"cached-roster-list-"+this.get("jid"),objStoreName:"roster_items",primKey:"jid"}),this.groupchat_settings=new t.GroupChatSettings({id:"group-chat-settings"},{account:this,storage_name:t.getStorageName()+"-group-chat-settings-"+this.get("jid"),fetch:"after"}),this.groups=new t.Groups(null,{account:this}),this.contacts=new t.Contacts(null,{account:this}),this.contacts.addCollection(this.roster=new t.Roster(null,{account:this})),this.contacts.addCollection(this.blocklist=new t.BlockList(null,{account:this})),this.settings_right.addChild("blocklist",t.BlockListView,{account:this,el:this.settings_right.$(".blocklist-info")[0]}),this._added_pres_handlers.push(this.contacts.handlePresence.bind(this.contacts)),this.on("ready_to_get_roster",function(){if(this.resources.reset(),this.contacts.each(function(e){e.resources.reset(),e.resetStatus()}),this.connection&&this.connection.do_synchronization){let e={};this.roster.last_chat_msg_id||(e.max=20),this.roster.syncFromServer(e)}this.roster.getFromServer(),this.blocklist.getFromServer()},this)}),t.Account.addConnPlugin(function(){this.registerIQHandler(),this.roster.registerHandler(),this.blocklist.registerHandler()},!0,!0),t.once("start",function(){this._roster_settings=new this.RosterSettings({id:"roster-settings"},{storage_name:this.getStorageName(),fetch:"after"}),this.settings.roster=this._roster_settings.attributes,this.roster_settings_view=t.settings_view.addChild("roster_settings",this.RosterSettingsView,{model:this._roster_settings}),this.cached_contacts_info=new t.CachedContactsInfo(null,{name:"cached-contacts-list",objStoreName:"contacts",primKey:"jid"}),this.contacts_view=this.left_panel.addChild("contacts",this.RosterLeftView,{model:this.accounts}),this.roster_view=this.body.addChild("roster",this.RosterRightView,{model:this.accounts}),this.details_container=this.right_panel.addChild("details",this.Container),this.contact_placeholder=this.right_panel.addChild("contact_placeholder",this.ContactPlaceholderView),this.add_contact_view=new this.AddContactView,this.on("add_contact",function(){this.add_contact_view.show()},this)},t),t}}),define("xabber-chats",[],function(){var e=Math.round,t=Math.max;return function(a){var i=a.env,n=i.constants,s=i.templates.chats,o=i.utils,d=i.$,r=i.$iq,c=i.$msg,l=i.$pres,p=i.Strophe,u=i._,m=i.moment,g=i.uuid,h=o.images,v=o.emoji;return a.Message=Backbone.Model.extend({idAttribute:"msgid",defaults:function(){return{msgid:g(),type:"main",state:n.MSG_PENDING}},initialize:function(){var e=this.get("time"),t={};e?t.timestamp=+m(e):(t.timestamp=m.now(),t.time=m(t.timestamp).format()),this.set(t)},getText:function(){var e=this.get("forwarded_message");return e?e.get("message"):this.get("message")},getState:function(){return n.MSG_STATE[this.get("state")]},getVerboseState:function(){var e=n.MSG_VERBOSE_STATE[this.get("state")];return this.account?!this.account.isOnline()&&(e="Message will be sent when you get online."):!this.collection.account.isOnline()&&(e="Message will be sent when you get online."),e},isSenderMe:function(){return this.account?this.account.get("jid")===this.get("from_jid"):this.collection.account.get("jid")===this.get("from_jid")}}),a.MessagesBase=Backbone.Collection.extend({model:a.Message}),a.SearchedMessages=a.MessagesBase.extend({comparator:"timestamp",initialize:function(){this.collections=[],this.on("add",u.bind(this.updateInCollections,this,"add")),this.on("change",u.bind(this.updateInCollections,this,"change"))},addCollection:function(e){this.collections.push(e)},updateInCollections:function(e,t){u.each(this.collections,function(a){a.update(t,e)})}}),a.Messages=Backbone.Collection.extend({model:a.Message,comparator:"timestamp",initialize:function(e,t){this.account=t.account},createInvitationFromStanza:function(e,t){t=t||{};let a=e.find("invite"),i=a.attr("jid")||e.attr("from"),n=t.delay||e.children("delay"),s=p.getBareJidFromJid(i),o=e.children("body").text(),d=0<e.find("markable").length,r=e.attr("id"),c=r&&this.get(r),l=e.children("x[xmlns=\""+p.NS.GROUP_CHAT+"\"]"),m=l.children("privacy").length,g={};if(c)return c;if(s){let a={xml:t.xml||e[0],carbon_copied:t.carbon_copied&&!t.is_archived,markable:d,msgid:r,is_forwarded:t.is_forwarded,forwarded_message:t.forwarded_message||null,from_jid:s,archive_id:t.archive_id,contact_archive_id:t.contact_archive_id,is_archived:t.is_archived};n.length&&(a.time=n.attr("stamp")),o&&(a.message=o);let i=this.account.contacts.mergeContact(p.getBareJidFromJid(s)),c=this.account.chats.getChat(i);if(m&&(i.invitation.private_invite=!0),m&&i.set("private_chat",!0),i.set("group_chat",!0),i.set("in_roster",!1),i.getVCard(),l.length){let e=l.find("name").text(),t=l.find("membership").text(),a=l.find("privacy").text(),n=l.find("index").text(),s=l.find("parent-chat").text(),o=l.find("description").text();e&&(g.name=e),t&&(g.model=e),a&&(g.anonymous=a),n&&(g.searchable=n),o&&(g.description=o),s&&i.set("private_chat",s),i.set("group_info",g)}let h=e.find("reason").text();i.invitation.updateInviteMsg(h);let v=c.messages.createSystemMessage(u.extend(a,{from_jid:s,auth_request:!0,invite:!m,private_invite:m||!1,is_accepted:!1,silent:!1,message:h}));i.invitation.message?i.invitation.message.get("timestamp")<v.get("timestamp")&&(i.invitation.message=v):i.invitation.message=v}},parseGroupchat:function(e){let t=e.children("reference[type=\"groupchat\"]").first(),a=e.children("x"),i=t.children("user"),n=p.getBareJidFromJid(e.attr("from")),s=i.children("metadata[xmlns=\""+p.NS.PUBSUB_AVATAR_METADATA+"\"]"),o=i.children("role").text(),d=i.children("nickname").text(),r=i.children("jid").text(),c=i.children("badge").text(),l=i.attr("id");d.trim().length||(d=r||id);let u={from_jid:r||l,groupchat_jid:n,user_info:{id:l,jid:r,nickname:d,role:o[0].toUpperCase()+o.substr(1,o.length-1),avatar:s.find("info").attr("id"),badge:c}};return a.attr("version")&&(u.participants_version=a.attr("version")),a.attr("xmlns")&&-1<a.attr("xmlns").indexOf(p.NS.GROUP_CHAT)&&(u.type="system",u.from_jid=n),u},parseMentions:function(e){let t=[];return e.children("reference[type=\"mention\"][xmlns=\""+p.NS.REFERENCE+"\"]").each(function(e,a){let i=d(a),n=parseInt(i.attr("begin")),s=parseInt(i.attr("end")),o=(i.children("uri").text()||"").replace(/^(xmpp:)/,"");t.push({start:n,end:s,uri:o})}.bind(this)),t},parseMarkup:function(e){let t=[];return e.children("reference[type=\"markup\"][xmlns=\""+p.NS.REFERENCE+"\"]").each(function(e,a){let i=d(a),n=parseInt(i.attr("begin")),s=parseInt(i.attr("end")),o=[],r,c;i.children().each(function(e,t){"uri"===t.tagName?r=d(t).text():(o.push(t.tagName),r="")}.bind(this)),c={start:n,end:s,markups:o},r&&(c.uri=r,c.type="uri"),t.push(c)}.bind(this)),t},createFromStanza:function(e,t){t||(t={});let i=t.delay||e.children("delay"),s=e.attr("from")||t.from_jid,r=p.getBareJidFromJid(s),c=e.children("body").text(),l=0<e.find("markable").length,g=e.attr("id"),h=g&&this.get(g);if(h&&!t.context_message&&!t.searched_message&&!t.pinned_message&&!t.participant_message&&!t.echo_msg&&!t.is_searched)return h;let v={xml:t.xml||e[0],original_message:c,carbon_copied:t.carbon_copied&&!t.is_archived,markable:l,msgid:g,is_forwarded:t.is_forwarded,forwarded_message:t.forwarded_message||null,from_jid:r,archive_id:t.archive_id,contact_archive_id:t.contact_archive_id,is_archived:t.is_archived},f=e.children("reference[type=\"media\"][xmlns=\""+p.NS.REFERENCE+"\"]"),b=e.children("reference[type=\"voice\"][xmlns=\""+p.NS.REFERENCE+"\"]"),x=e.children("reference[type=\"quote\"][xmlns=\""+p.NS.REFERENCE+"\"]"),w=e.children("reference[type=\"forward\"][xmlns=\""+p.NS.REFERENCE+"\"]"),C=e.children("reference[type=\"groupchat\"]"),S=this.parseMentions(e),k=this.parseMarkup(e),A=[];if(S.length&&(v.mentions=S),k.length&&(v.markups=k),C.length){let t=this.parseGroupchat(e);u.extend(v,t),A.push({start:parseInt(C.attr("begin")),end:parseInt(C.attr("end")),type:"groupchat"}),c=""}if(w.length&&w.each(function(e,t){let a=d(t);A.push({start:parseInt(a.attr("begin")),end:parseInt(a.attr("end"))})}.bind(this)),f.length||b.length){let e=[],t=[];f.each(function(a,i){let n=d(i),s=n.children("media");A.push({start:parseInt(n.attr("begin")),end:parseInt(n.attr("end"))}),s.each(function(a,i){let n=d(i),s=n.children("uri").text(),r=n.children("file"),c={},l=r.find("name").text(),p=o.pretty_size(r.find("size").text()),u=r.find("media-type").text(),m=r.find("duration").text(),g=r.find("description").text(),h=r.find("height").text(),v=r.find("width").text();s&&(c.url=s),c.name=l?l:this.getFilename(s),p&&(c.size=p),u&&(c.type=u),g&&(c.description=g),m&&(c.duration=o.pretty_duration(m)),v&&(c.width=v),h&&(c.height=h),"image"===this.getFileType(u)?t.push(c):e.push(c)}.bind(this))}.bind(this)),b.each(function(t,a){let i=d(a),n=i.children("media");A.push({start:parseInt(i.attr("begin")),end:parseInt(i.attr("end"))}),n.each(function(t,a){let i=d(a),n=i.children("uri").text(),s=i.children("file"),r={},c=s.find("name").text(),l=o.pretty_size(s.find("size").text()),p=s.find("media-type").text(),u=s.find("duration").text(),m=s.find("description").text();n&&(r.url=n),r.name=c?c:this.getFilename(n),l&&(r.size=l),p&&(r.type=p),m&&(r.description=m),u&&(r.duration=o.pretty_duration(u)),r.voice=!0,e.push(r)}.bind(this))}.bind(this)),t.length&&(v.images=t),e.length&&(v.files=e)}if(x.length){let e=[];x.each(function(t,a){let i=d(a),n=i.children("marker").text();n&&(n=p.xmlescape(n)),e.push({start:parseInt(i.attr("begin")),end:parseInt(i.attr("end")),marker:n})}.bind(this)),e.length&&(v.blockquotes=e)}if(A.length&&(v.legacy_content=A),A.length&&(c=o.slice_pretty_body(v.original_message,A)),v.forwarded_message&&(c=e.children("comment").text()||c),c&&(v.message=c),t.echo_msg&&(i=e.children("time")),i.length&&(v.time=i.attr("stamp")),(v.carbon_copied||r==this.account.get("jid")&&(t.is_archived||t.synced_msg))&&(v.state=n.MSG_SENT),t.synced_msg&&(v.synced_from_server=!0),t.missed_history&&(v.missed_msg=!0),t.echo_msg&&(v.state=n.MSG_DELIVERED,v.timestamp=+m(v.time),v.from_jid=this.account.get("jid")),(t.context_message||t.participant_message||t.searched_message||t.is_searched)&&(v.state=n.MSG_ARCHIVED),t.pinned_message)return this.account.pinned_messages.create(v);if(t.participant_message)return this.account.participant_messages.create(v);if(t.searched_message)return this.account.searched_messages.create(v);if(t.context_message)return this.account.context_messages.create(v);if(t.echo_msg&&h&&h.set(v),t.is_searched){let t=p.getBareJidFromJid(e.attr("from"));return t===this.account.get("jid")&&(t=p.getBareJidFromJid(e.attr("to"))),h=a.all_searched_messages.create(v),h.contact=this.account.contacts.mergeContact(t),h.account=this.account,h}return h=this.create(v),h},getFilename:function(e){let t=e.lastIndexOf("/");return e.substr(t+1,e.length-1)},getFileType:function(e){let t=-1<e.indexOf("/")?e.indexOf("/"):e.length,a=e.slice(0,t);return a},createSystemMessage:function(e){return this.create(u.extend({type:"system",silent:!0,state:n.MSG_DISPLAYED},e))}}),a.JingleMessage=Backbone.Model.extend({defaults:{duration:0,contact_full_jid:"",session_id:0,audio:!0,volume_on:!0,video_in:!1,video_screen:!1,state:0},initialize:function(e,t){e=e||{},e.video_live=e.video_live||!1,e.video=e.video_live,this.contact=t.contact,this.account=this.contact.account,this.registerIqHandler(),this.audio_notifiation=a.playAudio("call",!0),this.modal_view=new a.JingleMessageView({model:this}),this.conn=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],sdpSemantics:"unified-plan"}),this.$remote_video_el=d("<video autoplay class=\"webrtc-remote-video\"/>"),this.$remote_audio_el=d("<audio autoplay class=\"webrtc-remote-audio hidden\"/>"),this.$local_video=this.modal_view.$el.find(".webrtc-local-video"),this.current_timer=0,this.conn.onconnectionstatechange=this.onChangeConnectionState.bind(this),this.set(e),this.get("in")&&this.updateStatus("Calling..."),this.onChangedMediaType(),this.conn.ontrack=function(e){this.remote_stream=e.streams[0],this.modal_view.$el.find(".webrtc-remote-audio")[0].srcObject=e.streams[0]}.bind(this),this.conn.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&this.sendCandidate(e.candidate)}.bind(this),this.on("change:audio",this.setEnabledAudioTrack,this),this.on("change:video",this.onChangedVideoValue,this),this.on("change:state",this.modal_view.updateCallingStatus,this.modal_view),this.on("change:video_live",this.setEnabledVideoTrack,this),this.on("change:video_screen",this.setEnabledScreenShareVideoTrack,this),this.on("change:video_in",this.onChangedRemoteVideo,this),this.on("change:volume_on",this.onChangedVolume,this),this.on("destroy",this.onDestroy,this)},registerIqHandler:function(){this.account.connection.deleteHandler(this.iq_handler),this.iq_handler=this.account.connection.addHandler(function(e){return this.onIQ(e),!0}.bind(this),null,"iq","set")},updateStatus:function(e){this.modal_view.updateStatusText(e)},updateTimer:function(){this.updateStatus(o.pretty_duration(++this.current_timer))},startTimer:function(){this.updateTimer(),setInterval(function(){this.updateTimer()}.bind(this),1e3)},onConnected:function(){this.get("video_live")&&this.onChangedVideoValue(),a.stopAudio(this.audio_notifiation),setTimeout(function(){this.updateStatus(),this.startTimer()}.bind(this),1e3)},onChangeConnectionState:function(e){let t=e.target.connectionState;"connected"===t?this.onConnected():(this.updateStatus(o.pretty_name(t)+"..."),"disconnected"===t&&(this.destroy(),a.current_voip_call=null))},onChangedMediaType:function(){this.$local_video.switchClass("hidden",!this.get("video"))},onChangedRemoteVideo:function(){let e=this.get("video_in");e?(this.$remote_video_el[0].srcObject=this.remote_stream,this.modal_view.$el.find(".webrtc-remote-audio").replaceWith(this.$remote_video_el)):(this.$remote_audio_el[0].srcObject=this.remote_stream,this.modal_view.$el.find(".webrtc-remote-video").replaceWith(this.$remote_audio_el)),this.modal_view.$el.find(".default-screen").switchClass("hidden",e),this.onChangedVolume()},onChangedVolume:function(){this.get("volume_on")?(this.modal_view.$el.find(".webrtc-remote-audio")[0]&&(this.modal_view.$el.find(".webrtc-remote-audio")[0].muted=!1),this.modal_view.$el.find(".webrtc-remote-video")[0]&&(this.modal_view.$el.find(".webrtc-remote-video")[0].muted=!1)):(this.modal_view.$el.find(".webrtc-remote-audio")[0]&&(this.modal_view.$el.find(".webrtc-remote-audio")[0].muted=!0),this.modal_view.$el.find(".webrtc-remote-video")[0]&&(this.modal_view.$el.find(".webrtc-remote-video")[0].muted=!0))},setEnabledAudioTrack:function(){this.local_stream.getAudioTracks()[0].enabled=this.get("audio")},setEnabledVideoTrack:function(){let e=this.get("video_live"),t=this.conn.getSenders().find(e=>e.track&&(e.track.default||e.track.screen));e&&this.set("video_screen",!1),t&&e&&this.createVideoStream(),!t&&this.local_stream&&(this.local_stream.getVideoTracks()[0].enabled=e),this.set("video",e||this.get("video_screen"))},onDestroy:function(){a.stopAudio(this.audio_notifiation),this.account.connection.deleteHandler(this.iq_handler),this.stopTracks(),this.conn.close()},setEnabledScreenShareVideoTrack:function(){let e=this.get("video_screen"),t=this.conn.getSenders().find(e=>e.track&&!e.track.screen);e&&this.set("video_live",!1),t&&e&&this.createScreenShareVideoStream(),!t&&this.local_stream&&(this.local_stream.getVideoTracks()[0].enabled=e),this.set("video",e||this.get("video_live"))},onChangedVideoValue:function(){let e=this.get("video")?"enable":"disable";this.sendVideoStreamState(e),this.onChangedMediaType()},createScreenShareVideoStream:function(){navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(e){this.$local_video[0].srcObject=e,e.getVideoTracks().forEach(function(e){u.extend(e,{screen:!0}),this.local_stream.addTrack(e),this.conn.addTrack(e,this.local_stream),this.conn.getSenders().find(e=>!e.track||e.track&&"video"===e.track.kind).replaceTrack(e)}.bind(this))}.bind(this))},sendVideoStreamState:function(e){let t=r({from:this.account.get("jid"),to:this.get("contact_full_jid"),type:"set"}).c("query",{xmlns:p.NS.JINGLE_MSG}).c("video",{state:e,id:this.get("session_id")});this.account.sendIQ(t)},onIQ:function(e){let t=d(e),a=t.find("jingle[action=\"session-initiate\"]"),i=t.find("jingle[action=\"session-accept\"]"),n=t.find("jingle[action=\"session-info\"]"),s=t.find("query[xmlns=\""+p.NS.JINGLE_MSG+"\"] video"),o=t.attr("from"),c=r({from:this.account.get("jid"),to:o,type:"result",id:t.attr("id")});if(a.length){if(a.attr("sid")!==this.get("session_id"))return;let e=a.find("description[xmlns=\""+p.NS.JINGLE_RTP+"\"]").text();e&&this.conn.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:e})),this.acceptSession(e),this.account.sendIQ(c)}if(i.length){if(i.attr("sid")!==this.get("session_id"))return;let e=i.find("description[xmlns=\""+p.NS.JINGLE_RTP+"\"]").text();e&&this.conn.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e})),this.account.sendIQ(c),this.conn.connectionState||this.onConnected()}if(n.length){if(n.attr("sid")!==this.get("session_id"))return;let e=n.find("candidate");e.length&&this.conn.addIceCandidate(new RTCIceCandidate({candidate:e.text(),sdpMLineIndex:e.attr("sdpMLineIndex"),sdpMid:e.attr("sdpMid")})),this.account.sendIQ(c)}if(s.length){let e=s.attr("id");if(e===this.get("session_id")){let e=s.attr("state");"enable"===e&&this.set("video_in",!0),"disable"===e&&this.set("video_in",!1)}this.account.sendIQ(c)}},startCall:function(){this.set("call_initiator",this.account.get("jid")),this.createAudioStream(),this.get("video_live")&&this.createVideoStream(),this.propose()},createAudioStream:function(){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){this.local_stream=e,this.$local_video[0].srcObject=e;let t=this.initVideoTrack();this.local_stream.addTrack(t),this.conn.addTrack(t,this.local_stream),e.getAudioTracks().forEach(e=>this.conn.addTrack(e,this.local_stream))}.bind(this))},createVideoStream:function(){navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){this.$local_video[0].srcObject=e,e.getVideoTracks().forEach(function(e){this.local_stream.addTrack(e),this.conn.addTrack(e,this.local_stream),this.conn.getSenders().find(e=>!e.track||e.track&&"video"===e.track.kind).replaceTrack(e)}.bind(this))}.bind(this))},stopTracks:function(){this.local_stream&&this.local_stream.getTracks().forEach(function(e){e.stop(),this.local_stream.removeTrack(e)}.bind(this))},propose:function(){this.updateStatus("Search...");let e=c({from:this.account.get("jid"),type:"chat",to:this.contact.get("jid")}).c("propose",{xmlns:p.NS.JINGLE_MSG,id:this.get("session_id")}).c("description",{xmlns:p.NS.JINGLE_RTP,media:"audio"}).up().up().c("store",{xmlns:p.NS.HINTS}).up().c("markable").attrs({xmlns:p.NS.CHAT_MARKERS}).up().c("origin-id",{id:g(),xmlns:"urn:xmpp:sid:0"});this.account.sendMsg(e)},accept:function(){let e=c({from:this.account.get("jid"),type:"chat",to:this.get("contact_full_jid")||this.contact.get("jid")}).c("accept",{xmlns:p.NS.JINGLE_MSG,id:this.get("session_id")}).up().c("store",{xmlns:p.NS.HINTS}).up().c("markable").attrs({xmlns:p.NS.CHAT_MARKERS}).up().c("origin-id",{id:g(),xmlns:"urn:xmpp:sid:0"});this.set("jingle_start",m.now()),this.account.sendMsg(e),a.stopAudio(this.audio_notifiation),this.updateStatus("Connecting..."),this.audio_notifiation=a.playAudio("connecting",!0)},reject:function(){let t=c({from:this.account.get("jid"),type:"chat",to:this.contact.get("jid")}).c("reject",{xmlns:p.NS.JINGLE_MSG,id:this.get("session_id")});if(this.get("jingle_start")){let a=m.now(),i=e((a-this.get("jingle_start"))/1e3);t.c("call",{initiator:this.get("call_initiator"),start:m(this.get("jingle_start")).format(),end:m(a).format(),duration:i}).up()}t.up().c("store",{xmlns:p.NS.HINTS}).up().c("markable").attrs({xmlns:p.NS.CHAT_MARKERS}).up().c("origin-id",{id:g(),xmlns:"urn:xmpp:sid:0"}),this.account.sendMsg(t),this.createSystemMessage(t),this.destroy(),a.current_voip_call=null},createSystemMessage:function(e){let t=d(e.nodeTree),a=this.account.chats.getChat(this.contact),i=t.find("call").attr("end");if(i){let e=t.find("call").attr("duration"),i=t.find("call").attr("initiator");a.messages.createSystemMessage({from_jid:this.account.get("jid"),message:(i&&i===this.account.get("jid")?"Outgoing":"Incoming")+" call ("+o.pretty_duration(e)+")"})}else a.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Cancelled call"})},initVideoTrack:function(){let e=Object.assign(document.createElement("canvas"),{width:320,height:240}),t=e.getContext("2d");t.fillRect(0,0,e.width,e.height);let a=t.getImageData(0,0,e.width,e.height);return requestAnimationFrame(function e(){for(var n=0;n<a.data.length;n++)a.data[n++]=a.data[n++]=a.data[n++]=1;t.putImageData(a,0,0),requestAnimationFrame(e)}),u.extend(e.captureStream(60).getTracks()[0],{default:!0})},initSession:function(){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){this.local_stream=e,this.$local_video[0].srcObject=e;let t=this.initVideoTrack();return this.local_stream.addTrack(t),this.conn.addTrack(t,this.local_stream),e.getAudioTracks().forEach(e=>this.conn.addTrack(e,this.local_stream)),this.conn.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})}.bind(this)).then(function(e){this.set("session_initiator",this.account.get("jid")),this.conn.setLocalDescription(e).then(function(){let t=e.sdp,a=r({from:this.account.get("jid"),to:this.get("contact_full_jid"),type:"set"}).c("jingle",{xmlns:p.NS.JINGLE,action:"session-initiate",initiator:this.account.get("jid"),sid:this.get("session_id")}).c("content",{creator:"initiator",name:"voice"}).c("description",{xmlns:p.NS.JINGLE_RTP,media:"audio"}).c("sdp").t(t).up().up().c("security",{xmlns:p.NS.JINGLE_SECURITY_STUB});this.account.sendIQ(a)}.bind(this))}.bind(this))},sendCandidate:function(e){let t=r({from:this.account.get("jid"),to:this.get("contact_full_jid"),type:"set"}).c("jingle",{xmlns:p.NS.JINGLE,action:"session-info",initiator:this.get("session_initiator"),sid:this.get("session_id")}).c("content",{creator:"initiator",name:"voice"}).c("description",{xmlns:p.NS.JINGLE_RTP,media:"audio"}).up().c("transport",{xmlns:p.NS.JINGLE_TRANSPORTS_ICE}).c("candidate",{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid}).t(e.candidate);this.account.sendIQ(t)},acceptSession:async function(){this.set("session_initiator",this.contact.get("jid")),this.conn.createAnswer().then(function(e){this.conn.setLocalDescription(e).then(function(){let t=e.sdp,a=r({from:this.account.get("jid"),to:this.get("contact_full_jid"),type:"set"}).c("jingle",{xmlns:p.NS.JINGLE,action:"session-accept",initiator:this.contact.get("jid"),sid:this.get("session_id")}).c("content",{creator:"initiator",name:"voice"}).c("description",{xmlns:p.NS.JINGLE_RTP,media:"audio"}).c("sdp").t(t).up().up().c("security",{xmlns:p.NS.JINGLE_SECURITY_STUB});this.account.sendIQ(a),this.conn.connectionState||this.onConnected()}.bind(this))}.bind(this))}}),a.Chat=Backbone.Model.extend({defaults:{opened:!0,active:!1,display:!1,displayed_sent:!1,last_displayed_id:0,last_delivered_id:0,unread:0,timestamp:0,const_unread:0},initialize:function(e,t){this.contact=t.contact,this.account=this.contact.account;var i=this.contact.get("jid");this.set({id:this.contact.hash_id,jid:i}),this.message_retraction_version=0,this.contact.set("muted",u.contains(this.account.chat_settings.get("muted"),i)),this.contact.set("archived",u.contains(this.account.chat_settings.get("archived"),i)),this.messages=new a.Messages(null,{account:this.account}),this.messages_unread=new a.Messages(null,{account:this.account}),this.item_view=new a.ChatItemView({model:this}),this.contact.on("destroy",this.destroy,this),this.on("get_retractions_list",this.getAllMessageRetractions,this)},recountUnread:function(){this.set("unread",this.messages_unread.length),this.contact.get("archived")&&this.contact.get("muted")||a.toolbar_view.recountAllMessageCounter()},resetUnread:function(){var e=this.get("unread");0<e&&(this.set("unread",0),a.recountAllMessageCounter(e),a.toolbar_view.recountAllMessageCounter(e))},searchMessages:function(e){this.contact.messages_view=new a.SearchedMessagesView({contact:this.contact,query_text:e,model:this}),this.contact.messages_view.messagesRequest({},function(){a.body.setScreen("all-chats",{right:"searched_messages",contact:this.contact})}.bind(this))},getCallingAvailability:function(e,t,a){let i=r({from:this.account.get("jid"),to:e,type:"get"}).c("query",{xmlns:p.NS.JINGLE_MSG}).c("session",{id:t});this.account.sendIQ(i,a)},initIncomingCall:function(e,t){a.current_voip_call=new a.JingleMessage({contact_full_jid:e,session_id:t},{contact:this.contact}),a.current_voip_call.modal_view.show({status:"in"}),a.current_voip_call.set("call_initiator",this.contact.get("jid"))},receiveMessage:function(e,t){var i=p.getBareJidFromJid(e.attr("from")),s=t.carbon_copied,l=e.children("[xmlns=\""+p.NS.CHAT_MARKERS+"\"]"),u=e.children("request[xmlns=\""+p.NS.RECEIPTS+"\"]"),h=e.children("received[xmlns=\""+p.NS.RECEIPTS+"\"]"),v=e.children("propose[xmlns=\""+p.NS.JINGLE_MSG+"\"]"),f=e.children("accept[xmlns=\""+p.NS.JINGLE_MSG+"\"]"),b=e.children("reject[xmlns=\""+p.NS.JINGLE_MSG+"\"]");if(v.length)if(t.is_archived||t.synced_msg)return;else{let t=v.attr("id"),i=e.attr("from");this.getCallingAvailability(i,t,function(){if(a.current_voip_call){let e=c({from:this.account.get("jid"),type:"chat",to:this.contact.get("jid")}).c("reject",{xmlns:p.NS.JINGLE_MSG,id:t}).up().c("store",{xmlns:p.NS.HINTS}).up().c("markable").attrs({xmlns:p.NS.CHAT_MARKERS}).up().c("origin-id",{id:g(),xmlns:"urn:xmpp:sid:0"});return this.account.sendMsg(e),void this.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Cancelled call"})}this.initIncomingCall(i,t)}.bind(this))}if(f.length){if(t.is_archived||t.synced_msg)return;if(a.current_voip_call&&a.current_voip_call.get("session_id")===f.attr("id")){a.current_voip_call.get("state")||a.current_voip_call.set("state",n.JINGLE_MSG_ACCEPT);let t=f.find("time").attr("stamp");t=t?+m(t):m.now(),a.current_voip_call.set("jingle_start",t),a.current_voip_call.get("contact_full_jid")||a.current_voip_call.set("contact_full_jid",e.attr("from")),a.stopAudio(a.current_voip_call.audio_notifiation),a.current_voip_call.updateStatus("Connecting..."),a.current_voip_call.audio_notifiation=a.playAudio("connecting")}}if(b.length){let i=t.delay&&t.delay.attr("stamp")||e.find("delay").attr("stamp")||e.find("time").attr("stamp");if(b.children("call").length){let e=b.children("call").attr("duration"),t=b.children("call").attr("initiator");this.messages.createSystemMessage({from_jid:this.account.get("jid"),time:i,message:(t&&t===this.account.get("jid")?"Outgoing":"Incoming")+" call ("+o.pretty_duration(e)+")"})}else this.messages.createSystemMessage({from_jid:this.account.get("jid"),time:i,message:"Cancelled call"});if(t.is_archived||t.synced_msg)return;if(a.current_voip_call&&a.current_voip_call.get("session_id")===b.attr("id")){a.stopAudio(a.current_voip_call.audio_notifiation);let e=a.playAudio("busy");setTimeout(function(){a.stopAudio(e)}.bind(this),1500),a.current_voip_call.destroy(),a.current_voip_call=null}return}if(!t.is_archived){var x=e.find("archived"),w,C;e.children("stanza-id").each(function(t,a){a=d(a),e.children("reference[type=\"groupchat\"]").length?a.attr("by")===i&&(w=a,C=a):a.attr("by")===i?C=a:w=a}.bind(this)),C&&(t.contact_archive_id=C.attr("id")),w?t.archive_id=w.attr("id"):x.length&&(t.archive_id=x.attr("id"))}if(l.length){var S=l[0].tagName.toLowerCase();if("markable"!==S||t.is_mam||t.is_archived||s||t.synced_msg&&(!t.synced_msg||!t.is_unread)||this.sendMarker(e.attr("id"),"received",t.archive_id,t.contact_archive_id),"markable"!==S&&!s)return void this.receiveMarker(e,S,s);"displayed"===S&&s&&this.receiveCarbonsMarker(l)}if(!u.length||t.is_mam||t.is_archived||s||t.synced_msg&&(!t.synced_msg||!t.is_unread)||this.sendDeliveryReceipt(e),h.length&&this.receiveDeliveryReceipt(e),!e.find("body").length){var k=a.chats_view.child(this.contact.hash_id);return void(k&&k.content&&k.content.receiveNoTextMessage(e,s))}if(e.find("invite").length){if(i===this.account.get("jid"))return;let a=e.find("invite").attr("jid")||e.find("message").attr("from"),n=this.account.contacts.get(a);if(n&&"both"==n.get("subscription"))return;var A=r({type:"get"}).c("blocklist",{xmlns:p.NS.BLOCKING});this.account.sendIQ(A,function(i){var n=d(i).find("item"),s=+m(e.find("delay").attr("stamp")||e.find("time").attr("stamp")||t.delay&&+m(t.delay.attr("stamp"))||m.now()),o=!1;return 0<n.length?void n.each(function(i,r){var c=d(r),l=c.attr("jid"),p;return-1<l.indexOf(a)&&(o=!0,p=l.substr(l.lastIndexOf("/")+1,l.length-a.length),p&&s>p)?this.messages.createInvitationFromStanza(e,t):i!=n.length-1||o?void 0:this.messages.createInvitationFromStanza(e,t)}.bind(this)):this.messages.createInvitationFromStanza(e,t)}.bind(this),function(){return this.messages.createInvitationFromStanza(e,t)}.bind(this))}else return this.messages.createFromStanza(e,t)},getMessageContext:function(e,t){t=t||{};let i=t.mention&&this.account.messages||t.seached_messages&&this.account.searched_messages||t.message&&a.all_searched_messages||this.account.messages,n=i.get(e);if(n){let e=n.get("archive_id");this.contact.messages_view=new a.MessageContextView({contact:this.contact,mention_context:t.mention,model:this,stanza_id_context:e}),this.account.context_messages.add(n),this.contact.messages_view.messagesRequest({after:e},function(){t.mention?a.body.setScreen("mentions",{right:"message_context",contact:this.contact}):t.message?a.body.setScreen(a.body.screen.get("name"),{right:"message_context",contact:this.contact}):a.body.setScreen("all-chats",{right:"message_context",contact:this.contact})}.bind(this))}},sendDeliveryReceipt:function(e){var t=c({from:this.account.get("jid"),to:this.contact.get("jid"),type:"chat",id:g()}).c("received",{xmlns:p.NS.RECEIPTS,id:e.attr("id")});this.account.sendMsg(t)},sendMarker:function(e,t,a,i){t||(t="displayed");var n=c({from:this.account.jid,to:this.get("jid"),type:"chat",id:g()}).c(t).attrs({xmlns:p.NS.CHAT_MARKERS,id:e});a&&n.c("stanza-id",{xmlns:"urn:xmpp:sid:0",id:a,by:this.account.get("jid")}).up(),i&&n.c("stanza-id",{xmlns:"urn:xmpp:sid:0",id:i,by:this.contact.get("jid")}).up(),this.account.sendMsg(n)},receiveMarker:function(e){var t=e.find("displayed"),a=e.find("received"),i="error"===e.attr("type");if(!i&&(t.length||a.length)){var s=t.attr("id")||a.attr("id"),d=this.account.messages.get(s);if(d)if(!d.isSenderMe())d.set("is_unread",!1);else if(a.length){let e=d.get("state");if(e!==n.MSG_DISPLAYED){let e=a.children("time").attr("stamp");e&&(d.set("time",o.pretty_datetime(e)),d.set("timestamp",+m(e)))}this.setMessagesDelivered(d.get("timestamp"))}else this.setMessagesDisplayed(d.get("timestamp"))}},setMessagesDelivered:function(e){e||(e=m.now());let t=this.messages.filter(t=>t.isSenderMe()&&t.get("timestamp")<=e&&t.get("state")!=n.MSG_ERROR&&t.get("state")<n.MSG_DELIVERED);t.forEach(e=>e.set("state",n.MSG_DELIVERED))},setMessagesDisplayed:function(e){e||(e=m.now());let t=this.messages.filter(t=>t.isSenderMe()&&t.get("timestamp")<=e&&t.get("state")!=n.MSG_ERROR&&t.get("state")<n.MSG_DISPLAYED);t.forEach(e=>e.set("state",n.MSG_DISPLAYED))},receiveCarbonsMarker:function(e){let t=e.attr("id"),a=e.children("stanza-id[by=\""+this.account.get("jid")+"\"]").attr("id"),n=this.messages.get(t),s;if(n||(n=this.messages.find(e=>e.get("archive_id")==a)),n&&(s=this.messages.indexOf(n)),-1<s){this.set("const_unread",0);for(var o=s;0<=o;o--){let e=this.messages.models[o];if(e.get("is_unread"))e.set("is_unread",!1);else return}}},receiveDeliveryReceipt:function(e){var t=e.find("received"),a=t.attr("id"),i=this.account.messages.get(a);!i||i.isSenderMe()&&i.set("state",n.MSG_DELIVERED)},onPresence:function(e){var t=this.get("jid");this.contact.get("group_chat")||("subscribe_from"===e?this.messages.createSystemMessage({from_jid:this.account.get("jid"),silent:!1,message:"Authorization request sent"}):"subscribe"===e?this.messages.createSystemMessage({from_jid:t,auth_request:!0,is_accepted:!1,silent:!1,message:"User "+t+" wants to be in your contact list"}):"subscribed"===e?this.messages.createSystemMessage({from_jid:t,system_last_message:"Authorization granted",message:"User "+t+" was authorized for chat"}):"unsubscribed"==e&&this.messages.createSystemMessage({from_jid:t,system_last_message:"Authorization denied",message:"User "+t+" was not authorized for chat"}))},retractMessages:function(e,t,a){let i=0,n=e.length,s=new d.Deferred;s.done(function(t){0===t?o.dialogs.error("You have no permission to delete messages"):t!==e.length&&o.dialogs.error("You have no permission to delete some messages")}.bind(this)),d(e).each(function(o,c){let l=c.get("archive_id");if(l){let o=r({type:"set",from:this.account.get("jid"),to:t?this.contact.get("jid"):this.account.get("jid")}).c("retract-message",{id:l,xmlns:p.NS.REWRITE,symmetric:a,by:this.account.get("jid")});this.account.sendIQ(o,function(){this.item_view.content.removeMessage(c),i++,i===e.length&&s.resolve(n)}.bind(this),function(t){i++,d(t).find("not-allowed").length&&n--,i===e.length&&s.resolve(n)}.bind(this))}}.bind(this))},retractMessagesByUser:function(e){var t=r({type:"set",to:this.contact.get("jid")}).c("retract-user",{id:e,xmlns:p.NS.REWRITE,symmetric:!0});this.account.sendIQ(t,function(){var t=this.messages.filter(t=>t.get("user_info")&&t.get("user_info").id==e);d(t).each(function(e,t){this.item_view.content.removeMessage(t)}.bind(this))}.bind(this),function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to delete user messages")}.bind(this))},retractAllMessages:function(e,t,a){let i=this.contact.get("group_chat"),n=r({type:"set",from:this.account.get("jid"),to:i?this.contact.get("jid"):this.account.get("jid")}),s={xmlns:p.NS.REWRITE,symmetric:e};i||(s.conversation=this.contact.get("jid")),n.c("retract-all",s),this.account.sendIQ(n,function(){var e=this.messages.models;d(e).each(function(e,t){this.item_view.content.removeMessage(t)}.bind(this)),t&&t()}.bind(this),function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to clear message archive"),a&&a()}.bind(this))},getAllMessageRetractions:function(){var e=r({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("activate",{xmlns:p.NS.REWRITE,version:this.message_retraction_version,less_than:4});this.account.sendIQ(e)},showAcceptedRequestMessage:function(){this.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Authorization accepted"})},showDeclinedRequestMessage:function(){this.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Authorization denied"})},showBlockedRequestMessage:function(){this.messages.createSystemMessage({from_jid:this.account.get("jid"),system_last_message:"Authorization denied",message:this.get("jid")+" was blocked"})},deleteChatFromSynchronization:function(e,t){let a=r({from:this.account.get("jid"),type:"set",to:this.account.get("jid")}).c("delete",{xmlns:p.NS.SYNCHRONIZATION}).c("conversation",{jid:this.get("jid")});this.account.sendIQ(a,function(t){e&&e(t)}.bind(this),function(e){t&&t(e)})}}),a.ChatItemView=a.BasicView.extend({className:"chat-item list-item",template:s.chat_item,avatar_size:n.AVATAR_SIZES.CHAT_ITEM,events:{click:"openByClick"},_initialize:function(){this.account=this.model.account,this.contact=this.model.contact,this.$el.attr("data-id",this.model.id),this.content=new a.ChatContentView({chat_item:this}),this.updateName(),this.updateStatus(),this.updateCounter(),this.updateAvatar(),this.updateBlockedState(),this.updateMutedState(),this.updateArchivedState(),this.updateColorScheme(),this.updateGroupChats(),this.updateBot(),this.model.on("change:active",this.updateActiveStatus,this),this.model.on("change:unread",this.updateCounter,this),this.model.on("open",this.open,this),this.model.on("remove_opened_chat",this.onClosed,this),this.model.messages.on("destroy",this.onMessageRemoved,this),this.contact.on("remove_invite",this.removeInvite,this),this.contact.on("change:name",this.updateName,this),this.contact.on("change:status",this.updateStatus,this),this.contact.on("change:private_chat",this.updatePrivateChat,this),this.contact.on("change:incognito_chat",this.updateIncognitoChat,this),this.contact.on("change:image",this.updateAvatar,this),this.contact.on("change:blocked",this.updateBlockedState,this),this.contact.on("change:muted",this.updateMutedState,this),this.contact.on("change:archived",this.updateArchivedState,this),this.contact.on("change:group_chat",this.updateGroupChats,this),this.contact.on("change:in_roster",this.updateAcceptedStatus,this),this.account.settings.on("change:color",this.updateColorScheme,this)},updateName:function(){this.$(".chat-title").text(this.contact.get("name"))},updateStatus:function(){var e=this.contact.get("status");this.$(".status").attr("data-status",e)},updateActiveStatus:function(){this.$el.switchClass("active",this.model.get("active"))},updateAcceptedStatus:function(){this.contact.get("in_roster")&&this.model.set("is_accepted",!0)},updateCounter:function(){var e=this.model.get("unread")+this.model.get("const_unread");this.$(".msg-counter").showIf(e).text(e||"")},updateAvatar:function(){var e=this.contact.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateBlockedState:function(){this.$el.switchClass("blocked",this.contact.get("blocked"))},updateMutedState:function(){let e=this.contact.get("muted");this.$(".msg-counter").switchClass("muted-chat-counter",e),this.$(".muted-icon").showIf(e),this.updateCSS()},updateArchivedState:function(){let e=this.contact.get("archived");(e||!e&&a.toolbar_view.$(".active").hasClass("archive-chats"))&&this.$el.detach(),(e&&a.toolbar_view.$(".active").hasClass("archive-chats")||!e&&!a.toolbar_view.$(".active").hasClass("archive-chats"))&&a.chats_view.updateChatPosition(this.model)},updateGroupChats:function(){var e=this.contact.get("group_chat");this.$(".status").hideIf(e),!e||this.contact.get("private_chat")||this.contact.get("incognito_chat")||this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.GROUP_CHAT_ICON}),e&&(this.$el.addClass("group-chat"),this.$(".chat-title").css("color","#424242"),this.model.set("group_chat",!0))},updateBot:function(){this.contact.get("bot")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.BOT_CHAT_ICON})},updatePrivateChat:function(){this.contact.get("private_chat")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.PRIVATE_CHAT_ICON})},updateIncognitoChat:function(){this.contact.get("incognito_chat")&&!this.contact.get("private_chat")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.INCOGNITO_CHAT_ICON})},updateColorScheme:function(){var e=this.account.settings.get("color");this.$el.attr("data-color",e),this.content.$el.attr("data-color",e),this.content.head.$el.attr("data-color",e),this.content.bottom.$el.attr("data-color",e)},onMessageRemoved:function(e){if(this.model.last_message===e){for(var t=this.model.messages.length-1,a;0<=t&&(a=this.model.messages.at(t),!!a.get("silent"));t--);this.model.last_message=a,this.updateLastMessage()}},updateEmptyChat:function(){let e=this.model.get("timestamp");this.$(".last-msg").html("No messages".italics()),this.$(".last-msg-date").text(o.pretty_short_datetime(e)).attr("title",o.pretty_datetime(e)),this.updateCSS()},updateLastMessage:function(e){if(e||(e=this.model.last_message),!e)return void(this.model.messages.length||this.$(".last-msg").html("No messages".italics()));let t=e.get("time"),a=e.get("timestamp"),i=e.get("forwarded_message"),s=e.get("files"),r=e.get("images"),c=i?e.get("message")||(1<i.length?i.length+" forwarded messages":"Forwarded message").italics():e.getText(),l=e.get("user_info")||{};if(this.model.set({timestamp:a}),s||r){let t=d("<span class=\"text-color-500\"/>");if(s&&r&&(s=0<s.length?s:void 0,r=0<r.length?r:void 0),s&&r?c=t.text(s.length+r.length+" files"):(s&&(1<s.length&&(c=t.text(s.length+" files")),1==s.length&&(c=t.text(s[0].name))),r&&(1<r.length&&(c=t.text(r.length+" images")),1==r.length&&(c=t.text(r[0].name)))),this.contact.get("group_chat")){let t=l.nickname||(e.isSenderMe()?this.contact.get("my_info")&&this.contact.get("my_info").nickname||this.account.get("name"):e.get("from_jid"));this.$(".last-msg").text("").append(d("<span class=text-color-700/>").text(t+": ")).append(c)}else this.$(".last-msg").html(c)}else{var p="";"system"==e.get("type")?(e.get("auth_request")?e.get("invite")?c="Invitation to group chat":e.get("private_invite")?c="Invitation to private chat":c="Authorization request":e.get("system_last_message")&&(c=e.get("system_last_message")),c=this.contact.get("group_chat")?d("<i/>").text(c):d("<span class=text-color-700/>").text(c),this.$(".last-msg").html(c)):(i?e.get("message")?(c=e.get("message"),this.$(".last-msg").text(c)):(c=d("<i/>").text(1<i.length?i.length+" forwarded messages":"Forwarded message"),this.$(".last-msg").html(c)):(c=e.getText(),this.$(".last-msg").text(c)),this.contact.get("group_chat")&&(p=l.nickname||(e.isSenderMe()?this.account.get("name"):e.get("from_jid")))),p&&this.$(".last-msg").prepend(d("<span class=text-color-700/>").text(p+": "))}this.$el.emojify(".last-msg",{emoji_size:14}),this.$(".last-msg-date").text(o.pretty_short_datetime(t)).attr("title",o.pretty_datetime(t)),this.$(".msg-delivering-state").showIf(e.isSenderMe()&&e.get("state")!==n.MSG_ARCHIVED).attr("data-state",e.getState()),this.updateCSS()},updateCSS:function(){var e=this.$(".last-msg-date").width();this.$(".chat-title-wrap").css("padding-right",e+5);var t=this.$(".chat-title-wrap").width();this.contact.get("muted")&&(t-=24),this.$(".chat-title").css("max-width",t)},openByClick:function(){this.open()},open:function(e){e||(e={clear_search:!1}),a.chats_view.openChat(this,e)},removeInvite:function(e){e||(e={}),a.chats_view.removeInvite(this,e)},onClosed:function(){this.parent.onChatRemoved(this.model,{soft:!0})}}),a.MessagesView=a.BasicView.extend({template:s.chat_content,ps_selector:".chat-content",ps_settings:{wheelPropagation:!0},avatar_size:n.AVATAR_SIZES.CHAT_MESSAGE,_initialize:function(e){this.model=e.model,this.contact=e.contact,this.account=this.contact.account,this.chat=this.account.chats.get(this.contact.hash_id);let t=this.account.settings.get("color");this.$el.attr("data-color",t),this.$search_form=this.$(".search-form-header"),this.loading_history=!1,this.history_loaded=!1,this.first_msg_id=0,this.last_msg_id=0,this._scrolltop=this.getScrollTop(),this.ps_container.on("ps-scroll-up ps-scroll-down",this.onScroll.bind(this)),this.chat_content=e.chat_content||this.account.chats.get(this.contact.hash_id).item_view.content;let a=this.defineMouseWheelEvent();this.$el.on(a,this.onMouseWheel.bind(this)),this.$(".back-to-bottom").click(this.backToBottom.bind(this))},defineMouseWheelEvent:function(){return u.isUndefined(window.onwheel)?u.isUndefined(window.onmousewheel)?"MozMousePixelScroll":"mousewheel":"wheel"},keyupSearch:function(e){if(e.keyCode===n.KEY_ENTER){let e=this.$search_form.find("input").val();this.chat.searchMessages(e,function(){}.bind(this))}e.keyCode===n.KEY_ESCAPE&&this.chat_content.head.renderSearchPanel()},onMouseWheel:function(){this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onClickMessage:function(e){this.chat_content.onClickMessage(e)},onClickLink:function(e){this.chat_content.onClickLink(e)},onScroll:function(){this.$(".back-to-bottom").hideIf(this.isScrolledToBottom()),this._prev_scrolltop=this._scrolltop||0,this._scrolltop=this.getScrollTop(),!this.history_loaded&&!this.loading_history&&this._scrolltop<this._prev_scrolltop&&(100>this._scrolltop||.1>this.getPercentScrolled())&&(this.loading_history=!0,this.messagesRequest({before:this.first_msg_id},function(){this.loading_history=!1}.bind(this)))},backToBottom:function(){this.scrollToBottom(),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},messagesRequest:function(){},emptyChat:function(){this.$(".chat-content").html(d("<span class=\"error\"/>").text("No messages"))},openChat:function(){this.contact.trigger("open_chat",this.contact)},addMessageHTML:function(e,t,a){let i=this.getScrollBottom(),n;0===t?e.prependTo(this.$(".chat-content")):e.insertAfter(this.$(".chat-message").eq(t-1)),t===a&&(n=this.getScrollTop());let s=e.nextAll(".chat-message").first();return this.chat_content.updateMessageInChat(e[0]),s.length&&this.chat_content.updateMessageInChat(s[0]),this.chat_content.initPopup(e),n?this.scrollTo(n):this.scrollTo(this.ps_container[0].scrollHeight-this.ps_container[0].offsetHeight-i),e}}),a.MessageContextView=a.MessagesView.extend({className:"chat-content-wrap messages-context-wrap",events:{"click .chat-message":"onClickMessage","click .mdi-link-variant":"onClickLink","keyup .messages-search-form":"keyupSearch"},__initialize:function(e){e=e||{},this.stanza_id=e.stanza_id_context,this.mention_context=e.mention_context,this.$history_feedback=this.$(".load-history-feedback"),this.account.context_messages=new a.Messages(null,{account:this.account}),this.account.context_messages.on("change:last_replace_time",this.chat_content.updateMessage,this),this.account.context_messages.on("add",this.addMessage,this)},render:function(){this.scrollToTop(),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onMouseWheel:function(e){this.loading_history||(0>e.originalEvent.deltaY?!this.first_history_loaded&&(this.loading_history=!0,this.messagesRequest({before:this.first_msg_id},function(){this.loading_history=!1}.bind(this))):!this.last_history_loaded&&(this.loading_history=!0,this.messagesRequest({after:this.last_msg_id},function(){this.loading_history=!1}.bind(this)))),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onScroll:function(){this.$(".back-to-bottom").hideIf(this.isScrolledToBottom()),this._prev_scrolltop=this._scrolltop||0,this._scrolltop=this.getScrollTop(),this._scrollbottom=this.getScrollBottom(),this.loading_history||(!this.first_history_loaded&&this._scrolltop<this._prev_scrolltop&&(100>this._scrolltop||.1>this.getPercentScrolled())?(this.loading_history=!0,this.showHistoryFeedback(),this.messagesRequest({before:this.first_msg_id},function(){this.loading_history=!1,this.hideHistoryFeedback()}.bind(this))):!this.last_history_loaded&&this._scrolltop>this._prev_scrolltop&&(100>this._scrollbottom||.9<this.getPercentScrolled())&&(this.loading_history=!0,this.showHistoryFeedback(),this.messagesRequest({after:this.last_msg_id},function(){this.loading_history=!1,this.hideHistoryFeedback()}.bind(this))))},showHistoryFeedback:function(){this.$history_feedback.text("Loading history...").removeClass("hidden")},hideHistoryFeedback:function(){this.$history_feedback.addClass("hidden")},messagesRequest:function(e,t){let i=[],n=e||{},s=g();n.max||(n.max=a.settings.mam_messages_limit),n.after||n.before||(n.before="");let o=this.account.connection.addHandler(function(e){let t=d(e);return t.find("result").attr("queryid")===s&&i.push(e),!0}.bind(this),p.NS.MAM);this.chat_content.MAMRequest(n,function(e,a,i){this.account.connection.deleteHandler(o),i&&(this.first_msg_id=i.first)&&(this.last_msg_id=i.last),n.after&&a.length<n.max&&(this.last_history_loaded=!0),n.before&&a.length<n.max&&(this.first_history_loaded=!0),d(a).each(function(e,t){let a=d(t);this.account.chats.receiveChatMessage(a,{context_message:!0})}.bind(this)),t&&t()}.bind(this),function(){this.account.connection.deleteHandler(o)}.bind(this))},addMessage:function(e){if(e.get("auth_request"))return;this.mention_context&&e.get("archive_id")===this.stanza_id||e.set("is_archived",!0);let t=this.chat_content.buildMessageHtml(e).addClass("context-message"),a=this.account.context_messages.indexOf(e);e.get("archive_id")===this.stanza_id&&(t.addClass("message-from-context"),setTimeout(function(){t.removeClass("message-from-context")}.bind(this),3e3)),this.addMessageHTML(t,a,this.account.context_messages.findLastIndex())}}),a.SearchedMessagesView=a.MessagesView.extend({className:"chat-content-wrap searched-messages-wrap",events:{"click .chat-message":"onClickMessage","click .mdi-link-variant":"onClickLink","click .btn-cancel-searching":"openChat","keyup .messages-search-form":"keyupSearch"},__initialize:function(e){return this.query_text=e.query_text,this.account.searched_messages=new a.Messages(null,{account:this.account}),this.account.searched_messages.on("change:last_replace_time",this.chat_content.updateMessage,this),this.account.searched_messages.on("add",this.addMessage,this),this},render:function(){this.$search_form.find("input").val(this.query_text),this.$search_form.slideToggle(10,function(){"none"!==this.$search_form.css("display")&&this.$search_form.find("input").focus(),this.scrollToBottom()}.bind(this)),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},messagesRequest:function(e,t){let i=[],n=e||{},s=g();u.extend(n,{max:a.settings.mam_messages_limit,before:e.before||"",var:[{var:"withtext",value:this.query_text}]});let o=this.account.connection.addHandler(function(e){let t=d(e);return t.find("result").attr("queryid")===s&&i.push(e),!0}.bind(this),p.NS.MAM);this.chat_content.MAMRequest(n,function(e,a,i){this.account.connection.deleteHandler(o),i&&(this.first_msg_id=i.first),a.length||this.account.searched_messages.length||this.emptyChat(),a.length<n.max&&(this.history_loaded=!0),d(a).each(function(e,t){let a=d(t);this.account.chats.receiveChatMessage(a,{searched_message:!0})}.bind(this)),t&&t()}.bind(this),function(){this.account.connection.deleteHandler(o)}.bind(this))},addMessage:function(e){if(!e.get("auth_request")){e.set("is_archived",!0);let t=this.chat_content.buildMessageHtml(e).addClass("searched-message"),a=this.account.searched_messages.indexOf(e);this.addMessageHTML(t,a)}}}),a.ParticipantMessagesView=a.MessagesView.extend({className:"chat-content-wrap participant-messages-wrap",events:{"click .chat-message":"onClickMessage","click .mdi-link-variant":"onClickLink","click .btn-cancel-selection":"openChat","click .btn-retract-messages":"retractMessages","keyup .messages-search-form":"keyupSearch"},__initialize:function(e){return this.participant=e.model,this.member_jid=this.participant.jid,this.member_id=this.participant.id,this.member_nickname=this.participant.nickname,this.account.participant_messages=new a.Messages(null,{account:this.account}),this.account.participant_messages.on("add",this.addMessage,this),this.account.participant_messages.on("change:last_replace_time",this.chat_content.updateMessage,this),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this)),this},render:function(){this.$(".chat-content").css("height","calc(100% - 32px)"),this.$(".participant-messages-header .messages-by-header .participant-nickname").text(this.member_nickname),this.$(".participant-messages-header").removeClass("hidden"),this.scrollToBottom(),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onScrollY:function(){},retractMessages:function(){o.dialogs.ask("Delete user messages","Delete all <span class=\""+this.account.settings.get("color")+"-text\">"+(this.member_nickname||this.member_jid||this.member_id)+"</span> messages in this group chat?",null,{ok_button_text:"delete"}).done(function(e){e&&this.member_id&&this.chat_content.model.retractMessagesByUser(this.member_id,function(){this.emptyChat()}.bind(this))}.bind(this))},messagesRequest:function(e,t){let i=[],n=e||{},s=this.member_id,o=g();u.extend(n,{max:a.settings.mam_messages_limit,before:e.before||"",var:[{var:"with",value:s}]});let r=this.account.connection.addHandler(function(e){let t=d(e);return t.find("result").attr("queryid")===o&&i.push(e),!0}.bind(this),p.NS.MAM);this.chat_content.MAMRequest(n,function(e,a,i){this.account.connection.deleteHandler(r),i&&(this.first_msg_id=i.first),a.length||this.account.participant_messages.length||this.emptyChat(),a.length<n.max&&(this.history_loaded=!0),d(a).each(function(e,t){let a=d(t);this.account.chats.receiveChatMessage(a,{participant_message:!0})}.bind(this)),t&&t()}.bind(this),function(){this.account.connection.deleteHandler(r)}.bind(this))},addMessage:function(e){if(!e.get("auth_request")){e.set("is_archived",!0);let t=this.chat_content.buildMessageHtml(e).addClass("participant-message"),a=this.account.participant_messages.indexOf(e);this.addMessageHTML(t,a)}}}),a.ChatContentView=a.BasicView.extend({className:"chat-content-wrap",template:s.chat_content,ps_selector:".chat-content",ps_settings:{wheelPropagation:!0},avatar_size:n.AVATAR_SIZES.CHAT_MESSAGE,events:{"mousedown .chat-message":"onTouchMessage","click .chat-message":"onClickMessage","click .mdi-link-variant":"onClickLink","click .pinned-message":"showPinnedMessage","keyup .messages-search-form":"keyupSearch","click .btn-cancel-searching":"cancelSearch","click .back-to-bottom":"backToBottom","click .btn-retry-send-message":"retrySendMessage"},_initialize:function(e){this.chat_item=e.chat_item,this.current_day_indicator=null,this.prev_audio_message,this.account=this.chat_item.account,this.model=this.chat_item.model,this.contact=this.model.contact,this.head=new a.ChatHeadView({content:this}),this.bottom=new a.ChatBottomView({content:this}),this.$history_feedback=this.$(".load-history-feedback"),this.$pinned_message=this.$(".pinned-message"),this.$search_form=this.$(".search-form-header"),this.$el.attr("data-id",this.model.id),this._scrolltop=this.getScrollTop();let t=this.defineMouseWheelEvent();return this.$el.on(t,this.onMouseWheel.bind(this)),this.ps_container.on("ps-scroll-up ps-scroll-down",this.onScroll.bind(this)),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this)),this.model.on("change:active",this.onChangedActiveStatus,this),this.model.on("load_last_history",this.loadLastHistory,this),this.model.on("get_missed_history",this.requestMissedMessages,this),this.model.messages.on("add",this.onMessage,this),this.model.messages.on("change:state",this.onChangedMessageState,this),this.model.messages.on("change:is_unread",this.onChangedReadState,this),this.model.messages.on("change:timestamp",this.onChangedMessageTimestamp,this),this.model.messages.on("change:last_replace_time",this.updateMessage,this),this.contact.on("change:blocked",this.updateBlockedState,this),this.contact.on("change:group_chat",this.updateGroupChat,this),this.contact.on("remove_from_blocklist",this.loadLastHistory,this),this.account.contacts.on("change:name",this.updateName,this),this.account.contacts.on("change:image",this.updateAvatar,this),this.account.on("change",this.updateMyInfo,this),this.account.dfd_presence.done(function(){this.account.connection.do_synchronization||this.loadLastHistory()}.bind(this)),this},defineMouseWheelEvent:function(){return u.isUndefined(window.onwheel)?u.isUndefined(window.onmousewheel)?"MozMousePixelScroll":"mousewheel":"wheel"},updateMyInfo:function(){let e=this.account.changed;u.has(e,"name")&&this.updateMyName(),u.has(e,"status")&&this.updateMyStatus(),u.has(e,"image")&&this.updateMyAvatar()},updateGroupChat:function(){this._loading_history=!1,this.model.set("history_loaded",!1)},render:function(){this.cancelSearch(),this.scrollToBottom(),this.onScroll(),this.updateContactStatus(),this.updatePinnedMessage()},cancelSearch:function(){this.$search_form.hide().find("input").val("")},updateContactStatus:function(){if("offline"==this.head.$(".contact-status").attr("data-status")&&this.contact.get("last_seen")){var e=(m.now()-this.contact.get("last_seen"))/1e3,t=o.pretty_last_seen(e);this.contact.set({status_message:t})}},updatePinnedMessage:function(){let e=this.contact.get("pinned_message");this.contact.renderPinnedMessage(e,this.$pinned_message)},onChangedVisibility:function(){this.isVisible()?(this.model.set({display:!0,active:!0}),this.readMessages()):this.model.set({display:!1})},onChangedActiveStatus:function(){this.sendChatState(this.model.get("active")?"active":"inactive"),this.contact.get("group_chat")&&(this.model.get("active")?this.contact.subGroupPres():this.contact.unsubGroupPres())},updateName:function(e){var t=e.get("name"),a=e.get("jid");e===this.contact?this.$(".chat-message.with-author[data-from=\""+a+"\"]").each(function(){d(this).find(".chat-msg-author").text(t)}):this.$(".fwd-message.with-author[data-from=\""+a+"\"]").each(function(){d(this).find(".fwd-msg-author").text(t)})},updateAvatar:function(e){var t=e.cached_image,a=e.get("jid");e===this.contact?this.$(".chat-message.with-author[data-from=\""+a+"\"]").each(function(){d(this).find(".left-side .circle-avatar").setAvatar(t,this.avatar_size)}):this.$(".fwd-message.with-author[data-from=\""+a+"\"]").each(function(){d(this).find(".fwd-left-side .circle-avatar").setAvatar(t,this.avatar_size)})},updateMyStatus:function(){let e;this.account.isOnline()||(e="You are offline"),this.bottom.showChatNotification(e||"",!0)},updateMyName:function(){var e=this.account.get("name"),t=this.account.get("jid");this.$(".chat-message.with-author[data-from=\""+t+"\"]").each(function(){d(this).find(".chat-msg-author").text(e)}),this.$(".fwd-message.with-author[data-from=\""+t+"\"]").each(function(){d(this).find(".fwd-msg-author").text(e)})},updateMyAvatar:function(){var e=this.account.cached_image,t=this.account.get("jid");this.$(".chat-message.with-author[data-from=\""+t+"\"]").each(function(){d(this).find(".left-side .circle-avatar").setAvatar(e,this.avatar_size)}),this.$(".fwd-message.with-author[data-from=\""+t+"\"]").each(function(){d(this).find(".fwd-left-side .circle-avatar").setAvatar(e,this.avatar_size)})},updateBlockedState:function(){this.contact.get("blocked")&&this.model.showBlockedRequestMessage()},readMessages:function(e){var t=u.clone(this.model.messages_unread.models);if(t.length){let e=t[t.length-1];this.model.sendMarker(e.get("msgid"),"displayed",e.get("archive_id"),e.get("contact_archive_id"))}this.model.set("const_unread",0),u.each(t,function(t){(!e||t.get("timestamp")<=e)&&!1!=this.model.get("is_accepted")&&t.set("is_unread",!1)}.bind(this))},onMouseWheel:function(e){0>e.originalEvent.deltaY&&this.loadPreviousHistory(),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},keyupSearch:function(e){if(e.keyCode===n.KEY_ENTER){let e=this.$search_form.find("input").val();this.model.searchMessages(e,function(){}.bind(this))}e.keyCode===n.KEY_ESCAPE&&this.head.renderSearchPanel()},onScrollY:function(){0===this._scrolltop&&(this.$(".fixed-day-indicator-wrap").css("opacity",1),this.current_day_indicator=o.pretty_date(parseInt(this.$(".chat-content").children().first().data("time"))),this.showDayIndicator(this.current_day_indicator)),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onScroll:function(){this.$(".back-to-bottom").hideIf(this.isScrolledToBottom());let e=this.$(".chat-day-indicator"),t=this.$(".chat-message"),a,i;this._prev_scrolltop=this._scrolltop||0,this._scrolltop=this.getScrollTop(),e.each(function(e,t){if(this._scrolltop<this._prev_scrolltop){if(t.offsetTop<=this._scrolltop&&t.offsetTop>=this._scrolltop-30)return a=e,i=0,!1;if(t.offsetTop>=this._scrolltop&&t.offsetTop<=this._scrolltop-30)return a=e&&e-1,i=1,!1}else{if(t.offsetTop<=this._scrolltop+30&&t.offsetTop>=this._scrolltop)return a=e&&e-1,i=0,!1;if(t.offsetTop>=this._scrolltop-30&&t.offsetTop<=this._scrolltop)return a=e,i=1,!1}}.bind(this)),a?(this.$(".fixed-day-indicator-wrap").css("opacity",i),this.current_day_indicator=o.pretty_date(parseInt(d(e[a]).attr("data-time")))):(t.each(function(e,t){if(t.offsetTop+d(t).height()>this._scrolltop&&t.offsetTop<this._scrolltop)return a=e,i=1,!1}.bind(this)),a&&(this.$(".fixed-day-indicator-wrap").css("opacity",i),this.current_day_indicator=o.pretty_date(parseInt(d(t[a]).attr("data-time"))))),null!==this.current_day_indicator&&this.showDayIndicator(this.current_day_indicator),this._scrolltop<this._prev_scrolltop&&(100>this._scrolltop||.1>this.getPercentScrolled())&&this.loadPreviousHistory()},backToBottom:function(){this.scrollToBottom()},MAMRequest:function(e,t,i){var n=this.account,s=this.contact,o=[],c=g(),l=s.get("group_chat"),u=!0,m;m=l?r({type:"set",to:s.get("jid")}):r({type:"set"}),m.c("query",{xmlns:p.NS.MAM,queryid:c}).c("x",{xmlns:p.NS.XDATA,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(p.NS.MAM).up().up(),l||m.c("field",{var:"with"}).c("value").t(this.model.get("jid")).up().up(),e.var&&e.var.forEach(function(e){m.c("field",{var:e.var}).c("value").t(e.value).up().up()}.bind(this)),m.up().cnode(new p.RSM(e).toXML());var h=new d.Deferred;n.chats.onStartedMAMRequest(h),h.done(function(){var e=n.connection.addHandler(function(e){if(l==s.get("group_chat")){var t=d(e);t.find("result").attr("queryid")===c&&o.push(e)}else o=[],u=!1;return!0},p.NS.MAM);n.sendIQ(m,function(a){n.connection.deleteHandler(e),n.chats.onCompletedMAMRequest(h);var i=d(a).find("fin[xmlns=\""+p.NS.MAM+"\"]");if(i.length&&i.attr("queryid")===c){var s=new p.RSM({xml:i.find("set")[0]});s.complete="true"===i.attr("complete"),t&&t(u,o,s)}},function(t){n.connection.deleteHandler(e),a.error("MAM error"),a.error(t),n.chats.onCompletedMAMRequest(h),i&&i(t)})})},getMessageArchive:function(e,t){if(t.previous_history){if(this._loading_history||this.model.get("history_loaded"))return;this._loading_history=!0,clearTimeout(this._load_history_timeout),this._load_history_timeout=setTimeout(function(){this._loading_history=!1}.bind(this),6e4),this.showHistoryFeedback()}var i=this.model.account,n=0;this.MAMRequest(e,function(s,o,d){clearTimeout(this._load_history_timeout),this._loading_history=!1,this.hideHistoryFeedback(),t.missed_history&&!d.complete&&d.count>o.length&&this.getMessageArchive({after:d.last},{missed_history:!0}),this.contact.get("group_chat")?(t.last_history&&this.model.trigger("get_retractions_list"),!this.contact.my_info&&this.contact.getMyInfo()):!this.contact.get("last_seen")&&!this.contact.get("is_server")&&this.contact.getLastSeen(),o.length<e.max&&s&&this.model.set("history_loaded",!0),(t.previous_history||!this.model.get("first_archive_id"))&&d.first&&this.model.set("first_archive_id",d.first),(t.last_history||!this.model.get("last_archive_id"))&&d.last&&this.model.set("last_archive_id",d.last),u.each(o,function(e){var a=i.chats.receiveChatMessage(e,u.extend({is_archived:!0},t));a&&n++}),0===n&&t.last_history&&!this.model.get("history_loaded")&&this.getMessageArchive(u.extend(e,{max:a.settings.mam_messages_limit,before:this.model.get("first_archive_id")||""}),{previous_history:!0})}.bind(this),function(){t.previous_history&&(this._loading_history=!1,this.showHistoryFeedback(!0))}.bind(this))},requestMissedMessages:function(){if(this.account.disconnected_timestamp){let e={},t=m(this.account.disconnected_timestamp).format();e.var=[{var:"start",value:t}],this.getMessageArchive(e,{missed_history:!0})}},loadLastHistory:function(){if(a.settings.load_history){var e=this.model.get("last_archive_id"),t={};e?t.after=e:(t.before="",t.max=a.settings.mam_messages_limit_start),this.getMessageArchive(t,{last_history:!0})}},loadPreviousHistory:function(){a.settings.load_history&&this.getMessageArchive({max:a.settings.mam_messages_limit,before:this.model.get("first_archive_id")||""},{previous_history:!0})},showHistoryFeedback:function(e){this._load_history_feedback_timeout&&(clearTimeout(this._load_history_feedback_timeout),this._load_history_feedback_timeout=null);var t=e?"Error while loading archived messages":"Loading messages...";this.$history_feedback.text(t).removeClass("hidden"),e&&(this._load_history_feedback_timeout=setTimeout(this.hideHistoryFeedback.bind(this),5e3))},showDayIndicator:function(e){this.$(".fixed-day-indicator").text(e),this.$(".fixed-day-indicator-wrap").removeClass("hidden")},showPinnedMessage:function(e){if(d(e.target).hasClass("close"))this.unpinMessage();else{var t=this.contact.get("pinned_message"),i=this.buildMessageHtml(t),n=new a.ExpandedMessagePanel({account:this.account,chat_content:this});n.$el.attr("data-color",this.account.settings.get("color")),this.updateMessageInChat(i),this.initPopup(i),n.open(i)}},imageOnload:function(e){let t=e.find(".img-content"),a=e.find(".mdi-link-variant");t.css("background-image","none"),a.attr({"data-image":"true"})},unpinMessage:function(){var e=r({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("update",{xmlns:p.NS.GROUP_CHAT}).c("pinned-message");this.account.sendIQ(e,function(){},function(e){d(e).find("error not-allowed").length&&o.dialogs.error("You have no permission to pin/unpin message")})},hideHistoryFeedback:function(){this.$history_feedback.addClass("hidden")},receiveNoTextMessage:function(e){var t=p.getBareJidFromJid(e.attr("from")),a=p.getBareJidFromJid(e.attr("to")),i=t===this.account.get("jid"),n=e.find("[xmlns=\""+p.NS.CHATSTATES+"\"]");if(n.length&&!i){let e=n.children("subtype");this.showChatState(n[0].tagName.toLowerCase(),e.attr("type"),e.attr("mime-type"))}},showChatState:function(e,t,a){clearTimeout(this._chatstate_show_timeout);var i=this.contact.get("name"),s;if("composing"===e){if(!t)this._current_composing_msg=void 0,s=i+" is typing...",this._chatstate_show_timeout=setTimeout(function(){this.showChatState("paused")}.bind(this),n.CHATSTATE_TIMEOUT_PAUSED);else if(this._current_composing_msg={type:t},"upload"===t){let e=a?o.pretty_file_type_with_article(a):"file";a&&(this._current_composing_msg.mime_type=a),s="sending "+e}else"audio"==t&&(s="recording a voice message..."),"video"==t&&(s="recording a video message..."),this._chatstate_show_timeout=setTimeout(function(){this.showChatState("paused",t)}.bind(this),n.CHATSTATE_TIMEOUT_PAUSED_AUDIO);}else if("paused"===e){if(s="has stopped ",this._current_composing_msg){if("upload"===this._current_composing_msg.type){let e=this._current_composing_msg.mime_type?o.pretty_file_type_with_article(this._current_composing_msg.mime_type):"file";s="sending "+e}"audio"===this._current_composing_msg.type&&(s+="recording a voice message"),"video"===this._current_composing_msg.type&&(s+="recording a video message"),this._current_composing_msg=void 0}else s=i+" has stopped typing";this._chatstate_show_timeout=setTimeout(function(){this.showChatState()}.bind(this),n.CHATSTATE_TIMEOUT_STOPPED)}else return this.bottom.showChatNotification(""),void this.chat_item.updateLastMessage();this.bottom.showChatNotification(s),this.chat_item.$(".last-msg").text(s),this.chat_item.$(".last-msg-date").text(o.pretty_short_datetime()).attr("title",o.pretty_datetime()),this.chat_item.$(".msg-delivering-state").addClass("hidden")},onMessage:function(e){let t=this.getScrollBottom();this.account.messages.add(e),u.isUndefined(e.get("is_accepted"))||this.model.set("is_accepted",!1),this.model.set("opened",!0),!e.get("is_archived")&&e.get("archive_id")&&this.model.set("last_archive_id",e.get("archive_id")),e.get("participants_version")&&this.contact.participants&&this.contact.participants.version<e.get("participants_version")&&this.contact.trigger("update_participants");var i=this.isScrolledToBottom(),s=this.addMessage(e);"file_upload"===e.get("type")&&this.startUploadFile(e,s),i||e.get("submitted_here")?this.scrollToBottom():(this.updateScrollBar(),this.scrollTo(this.ps_container[0].scrollHeight-this.ps_container[0].offsetHeight-t)),e.get("synced_from_server")||e.get("is_archived")||e.isSenderMe()||e.get("silent")||"system"===e.get("type")&&!e.get("auth_request")||(e.set("is_unread",!(this.model.get("display")&&a.get("focused"))),!e.get("is_unread")&&this.model.sendMarker(e.get("msgid"),"displayed",e.get("archive_id"),e.get("contact_archive_id")),!a.get("focused")&&(this.contact.get("muted")?(e.set("muted",!0),this.contact.get("archived")&&e.set("archived",!0)):(this.contact.get("archived")&&(this.head.archiveChat(),this.contact.set("archived",!1)),this.notifyMessage(e))),this.model.setMessagesDisplayed(e.get("timestamp"))),e.isSenderMe()&&((!e.get("is_archived")||e.get("missed_msg"))&&this.readMessages(e.get("timestamp")),this.model.get("last_displayed_id")>=e.get("archive_id")?e.set("state",n.MSG_DISPLAYED):(this.model.get("last_delivered_id")>=e.get("archive_id")||e.get("is_archived"))&&e.set("state",n.MSG_DELIVERED)),this.model.get("active")&&(e.get("private_invite")||e.get("invite")||e.get("auth_request"))&&this.model.contact.trigger("open_chat",this.model.contact);let o=this.model.last_message;(!o||e.get("timestamp")>o.get("timestamp"))&&(this.model.last_message=e,this.chat_item.updateLastMessage()),e.get("mentions")&&e.get("mentions").forEach(function(t){let a=t.uri&&(-1<t.uri.lastIndexOf("?id=")?t.uri.slice(t.uri.lastIndexOf("?id=")+4):t.uri)||"";this.contact.my_info?a===this.contact.my_info.get("id")&&this.account.mentions.create(null,{message:e,contact:this.contact}):this.contact.get("group_chat")&&this.contact.getMyInfo(function(){a===this.contact.my_info.get("id")&&this.account.mentions.create(null,{message:e,contact:this.contact})}.bind(this)),a===this.account.get("jid")&&this.account.mentions.create(null,{message:e,contact:this.contact})}.bind(this))},addMessage:function(e){if(e.get("auth_request")){var t=this.model.messages.indexOf(e);return void this.model.messages.models.splice(t,1)}var a=this.buildMessageHtml(e),i=this.model.messages.indexOf(e);0===i?a.prependTo(this.$(".chat-content")):a.insertAfter(this.$(".chat-message").eq(i-1));var n=a.nextAll(".chat-message").first();return this.updateMessageInChat(a[0]),n.length&&this.updateMessageInChat(n[0]),this.initPopup(a),a},initPopup:function(e){var t=e.find(".uploaded-img"),a=e.find(".uploaded-img-for-collage");t.length&&t.each(function(e,t){this.initMagnificPopup(d(t))}.bind(this)),a.length&&this.initZoomGallery(e)},initMagnificPopup:function(e){e.magnificPopup({type:"image",closeOnContentClick:!0,fixedContentPos:!0,mainClass:"mfp-no-margins mfp-with-zoom",image:{verticalFit:!0},zoom:{enabled:!0,duration:300}})},initZoomGallery:function(e){var t=this;e.find(".zoom-gallery").magnificPopup({delegate:"img",type:"image",closeOnContentClick:!1,closeBtnInside:!1,mainClass:"mfp-with-zoom mfp-img-mobile",image:{verticalFit:!0,titleSrc:function(e){return"<a class=\"image-source-link\" href=\""+e.el.attr("src")+"\" target=\"_blank\">"+t.model.messages.getFilename(e.el.attr("src"))+"</a>"}},gallery:{enabled:!0},zoom:{enabled:!0,duration:300,opener:function(e){return e}}})},updateMessage:function(e){let t;if(e instanceof a.Message)t=this.$(".chat-message[data-msgid=\""+e.get("msgid")+"\"]");else return;t.children(".msg-wrap").children(".chat-msg-content").html(o.markupBodyMessage(e).emojify({tag_name:"img",emoji_size:18}));let i=o.pretty_short_datetime(e.get("last_replace_time")),n=o.pretty_datetime(e.get("last_replace_time"));t.find(".edited-info").removeClass("hidden").text("Edited at "+i).prop("title",n),t.hyperlinkify({selector:".chat-text-content"})},removeMessage:function(e){var t,i,n;if(e instanceof a.Message)t=e,n=this.$(".chat-message[data-msgid=\""+e.get("msgid")+"\"]"),this.bottom.content_view&&(i=this.bottom.content_view.$(".chat-message[data-msgid=\""+e.get("msgid")+"\"]"));else{if(i=e,!i.length)return;t=this.model.messages.get(i.data("msgid"))}t&&t.destroy(),this.removeMessageFromDOM(n),i&&i!==n&&this.removeMessageFromDOM(i)},removeMessageFromDOM:function(e){if(e.hasClass("with-author")&&!e.next().hasClass("with-author")){var t=e.find(".circle-avatar").html();e.next().addClass("with-author"),e.next().find(".circle-avatar").html(t)}e.prev(".chat-day-indicator").remove(),e.remove(),this._clearing_history||this.updateScrollBar()},clearHistory:function(){let e=[];this._clearing_history=!0,this.account.server_features.get(p.NS.REWRITE)?(!this.contact.get("group_chat")&&a.servers.get(this.contact.domain).server_features.get(p.NS.REWRITE)&&(e=[{name:"symmetric_deletion",checked:!1,text:"Delete for all"}]),o.dialogs.ask("Clear message archive","Are you sure you want to <b>delete all message history</b> for this chat?",e,{ok_button_text:"delete"}).done(function(e){if(!e)return void(this._clearing_history=!1);let t=!!this.contact.get("group_chat")||!!e.symmetric_deletion;this.model.retractAllMessages(t,function(){this._clearing_history=!1,this.chat_item.updateLastMessage(),this.updateScrollBar()}.bind(this),function(){this._clearing_history=!1}.bind(this))}.bind(this))):o.dialogs.ask("Clear message archive","Are you sure you want to <b>delete all message history</b> for this chat?"+("\nWarning! <b>"+this.account.domain+"</b> server does not support message deletion. Only local message history will be deleted.").fontcolor("#E53935"),e,{ok_button_text:"delete locally"}).done(function(e){if(!e)return void(this._clearing_history=!1);let t=this.model.messages;t.forEach(function(e){this.removeMessage(e)}.bind(this))}.bind(this))},renderVoiceMessage:function(t,a){let i=t.innerHTML,n="waveform"+m.now(),r=d(t),c=r.closest(".link-file");r.addClass("voice-message-rendering").html(d(s.messages.audio_file_waveform({waveform_id:n})));let l=this.createAudio(a,n);return l.on("ready",function(){let t=e(l.getDuration());r.find(".voice-msg-total-time").text(o.pretty_duration(t)),l.play()}.bind(this)),l.on("error",function(){r.removeClass("voice-message-rendering"),t.innerHTML=i,l.unAll(),r.find(".voice-message-play").get(0).remove(),o.callback_popup_message("This type of audio isn't supported in Your browser",3e3)}.bind(this)),l.on("play",function(){c.addClass("playing");let t=setInterval(function(){let a=e(l.getCurrentTime());l.isPlaying()?r.find(".voice-msg-total-time").text(o.pretty_duration(a)):clearInterval(t)},100)}.bind(this)),l.on("finish",function(){c.removeClass("playing")}),l.on("pause",function(){c.removeClass("playing")}),this.$(".voice-message-volume")[0].onchange=function(){l.setVolume(this.$(".voice-message-volume").val()/100)}.bind(this),l},createImageGrid:function(e){if(6<e.images.length){var t="template-for-6",a=e.images.length-5,i=d(s.messages[t](e));i.find(".last-image").addClass("hidden-images"),i.find(".image-counter").text("+"+a)}else var t="template-for-"+e.images.length,i=d(s.messages[t](e));return i},buildMessageHtml:function(e){var t=u.clone(e.attributes),i=!!(e instanceof a.Message)&&e.isSenderMe(),n=t.user_info||{},r=p.xmlescape(n.nickname||(t.from_jid===this.contact.get("jid")?this.contact.get("name"):i?this.contact.my_info?this.contact.my_info.get("nickname"):this.account.get("name"):this.account.contacts.get(t.from_jid)?this.account.contacts.get(t.from_jid).get("name"):t.from_jid)),c=t.images,l=t.files,m=!u.isUndefined(c),g=!!l,h=!1,v=n.avatar,f=n.role,b=n.badge,x=n.id,w;if(i&&this.contact.get("group_chat")&&this.contact.my_info&&(f=this.contact.my_info.get("role"),b=this.contact.my_info.get("badge")),u.extend(t,{username:r,state:e instanceof a.Message?e.getState():"sent",verbose_state:e instanceof a.Message?e.getVerboseState():"sent",time:o.pretty_datetime(t.time),short_time:o.pretty_time(t.time),avatar_id:v,is_image:m,is_file:g,files:l,role:f,badge:b,from_id:x}),"file_upload"===t.type)return d(s.messages.file_upload(t));if("system"===t.type){let e=t.auth_request?t.invite?"group_request":"auth_request":"system";return d(s.messages[e](t))}m&&1<c.length&&(w=this.createImageGrid(t));var C=[t.forwarded_message&&"forwarding"];let S=o.markupBodyMessage(e);var k=d(s.messages.main(u.extend(t,{is_sender:i,message:S,classlist:C.join(" ")})));if(m&&(1<c.length&&k.find(".chat-msg-media-content").html(w),1==c.length)){let e=this.createImage(c[0]),t=this.createImageContainer(c[0]);e.onload=function(){this.imageOnload(k)}.bind(this),k.find(".chat-msg-media-content").html(d(t).html(e)),this.updateScrollBar()}if(g&&0<l.length){let e=u.clone(l),t;d(e).each(function(a,i){i.type&&(i.voice?h=!0:h=!1);let n=o.file_type_icon(i.type);u.extend(e[a],{is_audio:h,duration:e[a].duration,mdi_icon:n}),t=h?d(s.messages.audio_file(e[a])):d(s.messages.file(e[a])),k.find(".chat-msg-media-content").append(t)}.bind(this))}return t.forwarded_message?(d(t.forwarded_message).each(function(e,a){i=a.isSenderMe(),t=u.clone(a.attributes);var n=t.images&&t.images.length,c=n?u.clone(t.images):void 0,l=!!t.files,p=t.user_info||{},m=p.avatar,g=p.role,v=p.badge,f=p.id,b=t.from_jid,x,C;r=i?p.nickname||this.account.get("name"):p.nickname||p.id||this.account.contacts.mergeContact({jid:b}).get("name");let S=o.markupBodyMessage(a);var A=d(s.messages.forwarded(u.extend(t,{time:o.pretty_datetime(t.time),short_time:o.pretty_short_month_date(t.time),username:r,avatar_id:m,message:S,is_file:l,is_audio:C,role:g,badge:v,from_id:f})));if(a.get("forwarded_message")){var T=a.get("forwarded_message").length,E=T+" forwarded message"+(1<T?"s":"");A.children(".msg-wrap").children(".fwd-msgs-block").append(d("<a/>",{class:"collapsed-forwarded-message","data-msgid":t.msgid}).text(E))}if(n&&(1<c.length&&(w=this.createImageGrid(t),A.find(".chat-msg-media-content").html(w)),1==c.length)){x=this.createImage(c[0]),x.onload=function(){this.imageOnload(k)}.bind(this);let e=this.createImageContainer(c[0]);A.find(".chat-msg-media-content").html(d(e).html(x))}if(l&&0<t.files.length){var M=u.clone(t.files),I;n||d(M).each(function(e,t){t.type&&(t.voice?h=!0:h=!1);let a=o.file_type_icon(t.type);u.extend(M[e],{is_audio:h,duration:M[e].duration,mdi_icon:a}),I=h?d(s.messages.audio_file(M[e])):d(s.messages.file(M[e])),A.find(".chat-msg-media-content").append(I)}.bind(this))}k.children(".msg-wrap").children(".fwd-msgs-block").append(A)}.bind(this)),this.updateScrollBar()):k.find(".fwd-msgs-block").remove(),k.hyperlinkify({selector:".chat-text-content"}).emojify(".chat-text-content",{tag_name:"img"}).emojify(".chat-msg-author-badge",{emoji_size:14})},getDateIndicator:function(e){var t=m(e).startOf("day");return d("<div class=\"chat-day-indicator one-line noselect\" data-time=\""+t.format("x")+"\">"+o.pretty_date(t)+"</div>")},hideMessageAuthor:function(e){e.removeClass("with-author")},showMessageAuthor:function(e){if(e.hasClass("system"))return;e.addClass("with-author");let t=e.find(".left-side .circle-avatar"),a=e.data("from"),i;if(a===this.account.get("jid"))this.contact.get("group_chat")&&this.contact.my_info&&(i=this.contact.my_info.get("b64_avatar"),i=i?h.getCachedImage(i):h.getDefaultAvatar(this.contact.my_info.get("nickname"))),i||(i=this.account.cached_image);else if(this.contact.get("group_chat")){var n=e.find(".msg-wrap .chat-msg-author").text();i=h.getDefaultAvatar(n)}else{var n=this.account.contacts.get(e.data("from"))||e.find(".msg-wrap .chat-msg-author").text()||e.data("from");i=n.cached_image||h.getDefaultAvatar(n)}if(t.setAvatar(i,this.avatar_size),e.data("avatar")&&e.data("from-id"))if(this.account.chat_settings.getHashAvatar(e.data("from-id"))==e.data("avatar")&&this.account.chat_settings.getB64Avatar(e.data("from-id")))t.setAvatar(this.account.chat_settings.getB64Avatar(e.data("from-id")),this.avatar_size);else{var s=p.NS.PUBSUB_AVATAR_DATA+"#"+e.data("from-id");this.contact.getAvatar(e.data("avatar"),s,function(a){t.setAvatar(a,this.avatar_size),this.account.chat_settings.updateCachedAvatars(e.data("from-id"),e.data("avatar"),a)}.bind(this))}},hideFwdMessageAuthor:function(e){e.removeClass("with-author")},showFwdMessageAuthor:function(e){if(e.length){e.addClass("with-author");var t=e.find(".circle-avatar"),a=e.data("from"),i=a===this.account.get("jid"),n=this.account.contacts.get(a)||a,s;if(i)this.contact.get("group_chat")&&this.contact.my_info&&(s=this.contact.my_info.get("b64_avatar"),s=s?h.getCachedImage(s):h.getDefaultAvatar(this.contact.my_info.get("nickname"))),s||(s=this.account.cached_image);else if(n)if(this.contact.get("group_chat")){var o=e.find(".msg-wrap .fwd-msg-author").text();s=h.getDefaultAvatar(o)}else s=n.cached_image||h.getDefaultAvatar(n);if(t.setAvatar(s,this.avatar_size),t.removeClass("hidden"),e.data("avatar")&&e.data("from-id"))if(this.account.chat_settings.getHashAvatar(e.data("from-id"))==e.data("avatar")&&this.account.chat_settings.getB64Avatar(e.data("from-id")))t.setAvatar(this.account.chat_settings.getB64Avatar(e.data("from-id")),this.avatar_size);else{var d=p.NS.PUBSUB_AVATAR_DATA+"#"+e.data("from-id");this.contact.getAvatar(e.data("avatar"),d,function(a){t.setAvatar(a,this.avatar_size),this.account.chat_settings.updateCachedAvatars(e.data("from-id"),e.data("avatar"),a)}.bind(this))}}},updateMessageInChat:function(e){var t=d(e);t.prev(".chat-day-indicator").remove();var a=t.prevAll(".chat-message").first();if(!a.length)return this.getDateIndicator(t.data("time")).insertBefore(t),this.showMessageAuthor(t),void t.find(".fwd-message").each(function(e,t){this.showFwdMessageAuthor(d(t))}.bind(this));var i=a.hasClass("system"),n=t.data("from")===a.data("from"),s=m(t.data("time")).startOf("day").isSame(m(a.data("time")).startOf("day"));if(s?i||!n?this.showMessageAuthor(t):this.hideMessageAuthor(t):(this.getDateIndicator(t.data("time")).insertBefore(t),this.showMessageAuthor(t)),t.hasClass("forwarding")){var o=t.find(".fwd-message");o.each(function(e,a){var i=d(a),n=0<e?i.prev():[];if(i.switchClass("hide-date",s&&n.length),i.removeClass("hide-time"),n.length){var o=i.data("from")===n.data("from");o?this.hideFwdMessageAuthor(i):this.showFwdMessageAuthor(i)}else this.showMessageAuthor(t),this.showFwdMessageAuthor(i)}.bind(this))}},notifyMessage:function(e){this.model.get("jid");if(a.settings.notifications){var t=a.popupNotification({title:this.contact.get("name"),text:a.settings.message_preview?e.getText():"sent you a message",icon:this.contact.cached_image.url});t.onclick=function(){window.focus(),this.model.trigger("open")}.bind(this)}if(a.settings.sound){var i;i=e.get("auth_request")?a.settings.sound_on_auth_request:a.settings.sound_on_message,a.playAudio(i)}a.recountAllMessageCounter()},sendMessage:function(e){let t=e.get("message"),a="",i=[],s=e.get("forwarded_message"),o=e.get("msgid"),r=c({from:this.account.jid,to:this.model.get("jid"),type:"chat",id:o});if(s&&(a=[],d(s).each(function(e,i){let n=Array.from(u.escape(u.unescape(this.bottom.createTextMessage([i],">")))+(e!==s.length-1||t.length?"\n":"")),o=a.length,d=a.concat(n).length-1;r.c("reference",{xmlns:p.NS.REFERENCE,type:"forward",begin:o,end:d}).c("forwarded",{xmlns:"urn:xmpp:forward:0"}).c("delay",{xmlns:"urn:xmpp:delay",stamp:i.get("time")}).up().cnode(i.get("xml")).up().up().up(),a=a.concat(n)}.bind(this)),t=u.unescape(a.join(""))+t),e.get("mentions")&&e.get("mentions").length&&e.get("mentions").forEach(function(e){r.c("reference",{xmlns:p.NS.REFERENCE,begin:e.start+a.length,end:e.end+a.length,type:"mention"}).c("uri").t(e.uri).up().up()}.bind(this)),e.get("markups")&&e.get("markups").forEach(function(e){for(let t in r.c("reference",{xmlns:p.NS.REFERENCE,begin:e.start+a.length,end:e.end+a.length,type:"markup"}),e.markups)r.c(e.markups[t]).up();r.up()}.bind(this)),e.get("blockquotes")&&e.get("blockquotes").forEach(function(e){r.c("reference",{xmlns:p.NS.REFERENCE,begin:e.start+a.length,end:e.end+a.length,type:"quote"}).c("marker").t(n.QUOTE_MARKER).up().up(),i.push({start:e.start+a.length,end:e.end+a.length,type:"quote",marker:n.QUOTE_MARKER})}.bind(this)),"file_upload"==e.get("type")){t="";let n=e.get("files")||[],s=e.get("images")||[],o=n.concat(s);o.forEach(function(e,n){a=e.url+(n==o.length-1?"":"\n");let s=t.length,d=(t+a).length-1;r.c("reference",{xmlns:p.NS.REFERENCE,type:e.voice?"voice":"media",begin:s,end:d}).c("media").c("file"),e.type&&r.c("media-type").t(e.type).up(),e.name&&r.c("name").t(e.name).up(),e.size&&r.c("size").t(e.size).up(),e.height&&r.c("height").t(e.height).up(),e.width&&r.c("width").t(e.width).up(),e.duration&&r.c("duration").t(e.duration).up(),e.description&&r.c("description").t(e.description).up(),r.up().c("uri").t(e.url).up().up().up(),t+=a,i.push({start:s,end:d})}.bind(this)),e.set({type:"main",legacy_content:i})}this.account._pending_messages.push({chat_hash_id:this.contact.hash_id,msg_id:o}),e.set("original_message",t),t&&r.c("body").t(t).up(),r.c("markable").attrs({xmlns:p.NS.CHAT_MARKERS}).up().c("origin-id",{id:o,xmlns:"urn:xmpp:sid:0"}).up();let l={xmlns:p.NS.DELIVERY};this.contact.get("group_chat")&&(l.to=this.model.get("jid")),e.get("state")===n.MSG_ERROR&&(l.retry=!0)&&e.set("state",n.MSG_PENDING),r.c("request",l).up(),e.set({xml:r.tree()});let g=m.now();this.account.sendMsg(r,function(){if(!this.contact.get("group_chat")&&!this.account.server_features.find(e=>e.get("var")===p.NS.DELIVERY))setTimeout(function(){this.account.last_stanza_timestamp>g&&e.get("state")===n.MSG_PENDING?e.set("state",n.MSG_SENT):(this.account.connection.ping.ping(this.account.get("jid"),function(){e.get("state")===n.MSG_PENDING&&e.set("state",n.MSG_SENT)}.bind(this)),setTimeout(function(){this.account.last_stanza_timestamp<g&&e.get("state")===n.MSG_PENDING&&e.set("state",n.MSG_ERROR)}.bind(this),5e3))}.bind(this),1e3);else{let t=5,a=setInterval(function(){this.account.last_stanza_timestamp<g&&60<t&&e.get("state")===n.MSG_PENDING||60<t?(e.set("state",n.MSG_ERROR),clearInterval(a)):e.get("state")!==n.MSG_PENDING&&clearInterval(a),t+=10}.bind(this),1e4)}}.bind(this))},isImageType:function(e){return-1!=e.indexOf("image")},initJingleMessage:function(e){a.current_voip_call&&a.current_voip_call.destroy(),e=e||{},e=e.video?"video":"audio";let t=g();a.current_voip_call=new a.JingleMessage({session_id:t,video_live:"video"===e},{contact:this.contact}),a.current_voip_call.startCall(),a.current_voip_call.modal_view.show({status:n.JINGLE_MSG_PROPOSE})},saveForwardedMessage:function(e){var t=null;return d(e).get("forwarded_message")&&(t=d(e).get("forwarded_message"),0>this.account.forwarded_messages.indexOf(t)&&(t=this.saveForwardedMessage(t))),e=this.account.forwarded_messages.create(u.extend({is_forwarded:!0,forwarded_message:t},e.attributes)),e},onSubmit:function(e,t,i){if(i=i||{},t.length){var n=[];u.each(t,function(e){0>this.account.forwarded_messages.indexOf(e)&&(e=this.saveForwardedMessage(e)),n.push(e)}.bind(this));var s=this.model.messages.create({from_jid:this.account.get("jid"),message:e,mentions:i.mentions,blockquotes:i.blockquotes,markups:i.markup_references,submitted_here:!0,forwarded_message:n});this.sendMessage(s)}else if(e){var s=this.model.messages.create({from_jid:this.account.get("jid"),message:e,mentions:i.mentions,blockquotes:i.blockquotes,markups:i.markup_references,submitted_here:!0,forwarded_message:null});this.sendMessage(s)}this.contact.get("archived")&&!this.contact.get("muted")&&(s.set("muted",!1),this.head.archiveChat(),this.contact.set("archived",!1),a.chats_view.updateScreenAllChats()),this.contact.get("group_chat")&&a.toolbar_view.$(".active").hasClass("chats")&&!this.contact.get("muted")&&!this.contact.get("archived")&&a.chats_view.updateScreenAllChats(),a.chats_view.scrollToTop(),a.chats_view.clearSearch()},addFileMessage:function(e){if(this.contact.messages_view&&this.contact.messages_view.data.get("visible")&&this.contact.messages_view.openChat(),10<e.length)return void o.dialogs.error("You can`t upload more than 10 files");var t=this.account.server_features.get(p.NS.HTTP_UPLOAD);if(!t)return void o.dialogs.error(this.account.domain+" server does not seem to support file transfer. This may happen because Xabber didn't yet receive server capabilities, or because of some glitch.\n\nRefresh server info in Account settings&nbsp;&rarr;&nbsp;Server info. If that does not help, consider using a server that definitely does support file transfer. One such server is xabber.org");var a=new d.Deferred;a.done(function(e){this.model.messages.create({from_jid:this.account.get("jid"),type:"file_upload",files:e,upload_service:t.get("from"),message:"Uploading file",submitted_here:!0})}.bind(this)),d(e).each(function(t,i){if(this.isImageType(i.type)){var n=new FileReader,s=new d.Deferred;h.compressImage(i).done(function(i){n.readAsDataURL(i),s.done(function(n){i.height=n.height,i.width=n.width,e[t]=i,t===e.length-1&&a.resolve(e)}.bind(this))}.bind(this)),n.onload=function(t){var e=new Image;e.src=t.target.result,e.onload=function(){var e=this.height,t=this.width;s.resolve({height:e,width:t})}}}else t===e.length-1&&a.resolve(e)}.bind(this))},startUploadFile:function(e,t){t.emojify(".chat-msg-author-badge",{emoji_size:14}),t.find(".cancel-upload").show(),t.find(".repeat-upload").hide(),t.find(".status").hide(),t.find(".progress").show();var a=0;d(e.get("files")).each(function(i,s){var c=r({type:"get",to:e.get("upload_service")}).c("request",{xmlns:p.NS.HTTP_UPLOAD}).c("filename").t(s.name).up().c("size").t(s.size).up().c("content-type").t(s.type).up(),l=new d.Deferred,u=this;this.account.sendIQ(c,function(e){var t=d(e).find("slot[xmlns=\""+p.NS.HTTP_UPLOAD+"\"]");l.resolve({get_url:t.find("get").text(),put_url:t.find("put").text()})},function(a){var i=d(a).find("error text").text();u.onFileNotUploaded(e,t,i)});let g=m.now(),h=10,v=setInterval(function(){this.account.last_stanza_timestamp<g&&60<h&&e.get("state")===n.MSG_PENDING||60<h?(e.set("state",n.MSG_ERROR),clearInterval(v)):e.get("state")!==n.MSG_PENDING&&clearInterval(v),h+=10}.bind(this),1e4);l.done(function(n){clearInterval(v);var d=new XMLHttpRequest,r=t.find(".progress");t.find(".cancel-upload").click(function(){d.abort()}.bind(this)),d.onabort=function(){this.removeMessage(t)}.bind(this),d.upload.onprogress=function(e){var a=e.loaded/e.total;r.find(".determinate").attr("style","width: "+100*a+"%"),t.find(".filesize").text(o.pretty_size(e.loaded)+" of "+o.pretty_size(e.total))},d.onload=d.onerror=function(){201===this.status?(e.get("files")[i].url=n.get_url,a++,a==e.get("files").length&&u.onFileUploaded(e,t)):u.onFileNotUploaded(e,t,this.responseText)},t.data("cancel")?d.abort():(d.open("PUT",n.put_url,!0),d.send(s))}.bind(this))}.bind(this))},onFileUploaded:function(e,t){var a=e.get("files"),i=this,n=!1,r=[],c=[],l="";if(d(a).each(function(e,t){var a={name:t.name,type:t.type,size:t.size,url:t.url};t.voice&&(a.voice=!0),l+=a.url+"\n",this.isImageType(t.type)?(u.extend(a,{width:t.width,height:t.height}),r.push(a)):(u.extend(a,{duration:t.duration}),c.push(a))}.bind(this)),e.set("message",l.trim()),0<r.length)if(1<r.length){if(6<r.length){var p="template-for-6",m=r.length-5;g=d(s.messages[p]({images:r})),g.find(".last-image").addClass("hidden-images"),g.find(".image-counter").text("+"+m)}else var p="template-for-"+r.length,g=d(s.messages[p]({images:r}));t.removeClass("file-upload noselect"),t.find(".chat-msg-content").removeClass("chat-file-content").html(g)}else{var h=this.createImage(r[0]),v=i.createImageContainer(r[0]);h.onload=function(){this.imageOnload(t)}.bind(this),t.removeClass("file-upload noselect"),t.find(".chat-msg-content").removeClass("chat-file-content").html(v),t.find(".img-content").html(h)}0<c.length&&(t.removeClass("file-upload noselect"),d(c).each(function(e,a){0==e&&0==r.length&&t.find(".chat-msg-content").removeClass("chat-file-content").html(""),a.type&&(a.voice?n=!0:n=!1);let i={name:a.name,type:a.type,url:a.url},c=o.file_type_icon(a.type),l;u.extend(i,{size:o.pretty_size(a.size),is_audio:n,duration:o.pretty_duration(a.duration),mdi_icon:c}),l=n?d(s.messages.audio_file(i)):d(s.messages.file(i)),t.find(".chat-msg-content").append(l)}.bind(this))),this.initPopup(t),e.set("images",r),e.set("files",c),this.sendMessage(e),this.scrollToBottom()},createAudio:function(e,t){var a=WaveSurfer.create({container:"#"+t,scrollParent:!1,barWidth:3,height:48,barHeight:48,cursorColor:"rgba(211,47,47,0.8)",autoCenter:!1,normalize:!0,hideScrollBar:!0,progressColor:"#757575"});return a.load(e),a.setVolume(.5),a},createImage:function(e){var t=new Image;return e.height&&(t.height=e.height),e.width&&(t.width=e.width),t.src=e.url,d(t).addClass("uploaded-img popup-img"),d(t).attr("data-mfp-src",e.url),t.height&&t.width&&(300<t.width&&(t.height*=300/t.width,t.width=300),256<t.height&&(t.width*=256/t.height,t.height=256)),t},createImageContainer:function(){return d("<div class=\"img-content\"/>")[0]},onFileNotUploaded:function(e,t,a){var i=a?"Error: "+a:"File uploading error";e.set("state",n.MSG_ERROR),t.find(".cancel-upload").hide(),t.find(".repeat-upload").show(),t.find(".status").text(i).show(),t.find(".progress").hide(),t.find(".repeat-upload").click(function(){this.startUploadFile(e,t)}.bind(this))},sendChatState:function(e,t){clearTimeout(this._chatstate_timeout),clearTimeout(this._chatstate_send_timeout),this.chat_state=!1;let a=c({to:this.model.get("jid"),type:"chat"}).c(e,{xmlns:p.NS.CHATSTATES});t&&a.c("subtype",{xmlns:p.NS.EXTENDED_CHATSTATES,type:t}),"composing"===e&&(this.chat_state=!0),this.account.sendMsg(a),"composing"===e&&(this._chatstate_timeout=setTimeout(function(){this.chat_state=!1}.bind(this),n.CHATSTATE_TIMEOUT_PAUSED),this._chatstate_send_timeout=setTimeout(function(){this.chat_state||this.sendChatState("paused")}.bind(this),2*n.CHATSTATE_TIMEOUT_PAUSED))},onChangedMessageState:function(e){e.get("state")===n.MSG_DISPLAYED&&this.model.get("last_displayed_id")<e.get("archive_id")?(this.model.set("last_displayed_id",e.get("archive_id")),this.model.set("last_delivered_id",e.get("archive_id"))):e.get("state")===n.MSG_DELIVERED&&this.model.get("last_delivered_id")<e.get("archive_id")&&this.model.set("last_delivered_id",e.get("archive_id"));var t=this.$(".chat-message[data-msgid=\""+e.get("msgid")+"\"]"),a=t.find(".msg-delivering-state");a.attr({"data-state":e.getState(),title:e.getVerboseState()}),a.attr("data-state")===n.MSG_STATE[n.MSG_ERROR]&&a.dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"}),e===this.model.last_message&&this.chat_item.updateLastMessage()},onChangedMessageTimestamp:function(e){var t=this.$(".chat-message[data-msgid=\""+e.get("msgid")+"\"]"),a=t.next(),i=t.prev();t.attr({"data-time":e.get("timestamp")}),t.detach(),t.children(".right-side").find(".msg-time").attr({title:o.pretty_datetime(e.get("time"))}).text(o.pretty_time(e.get("time"))),this.model.messages.sort();var n=this.model.messages.indexOf(e);if(0===n)i.hasClass("chat-day-indicator")?i.after(t):t.prependTo(this.$(".chat-content"));else{let s=this.$(".chat-message").eq(n-1),o=t.data("from")===s.data("from"),d=m(t.data("time")).startOf("day").isSame(m(s.data("time")).startOf("day"));i.data("from")!==t.data("from")&&a.data("from")===t.data("from")&&("delivered"===a.children(".right-side").find(".msg-delivering-state").attr("data-state")||"displayed"===a.children(".right-side").find(".msg-delivering-state").attr("data-state"))&&this.showMessageAuthor(a),s.next().hasClass("chat-day-indicator")&&m(s.next().data("time")).format("DD.MM.YY")===m(e.get("timestamp")).format("DD.MM.YY")?(t.insertAfter(s.next()),this.showMessageAuthor(t)):t.insertAfter(s),d&&o&&!s.hasClass("system")?this.hideMessageAuthor(t):this.showMessageAuthor(t)}let s=this.model.last_message;(!s||e.get("timestamp")>s.get("timestamp"))&&(this.model.last_message=e,this.chat_item.updateLastMessage())},onChangedReadState:function(e){var t=e.get("is_unread");t?(this.model.messages_unread.add(e),this.model.recountUnread()):(this.model.messages_unread.remove(e),this.model.recountUnread(),!e.get("muted")&&a.recountAllMessageCounter())},onTouchMessage:function(e){if(3!==e.which){var t=d(e.target),a=t.parents(".fwd-message").first(),i=0<a.length,n;n=t.hasClass("chat-message")?t:t.parents(".chat-message"),0!=window.getSelection()&&(o.clearSelection(),n.attr("data-no-select-on-mouseup","1"))}},onClickLink:function(e){let t=d(e.target),a=t.closest(".chat-message"),i=this.model.messages.get(a.data("msgid"));i||(i=this.account.participant_messages.get(a.data("msgid")));let n=i.get("files"),s=i.get("images"),r=[],c="";i.get("forwarded_message")&&i.get("forwarded_message").forEach(function(e){e.get("images")&&r.push(e.get("images"))}.bind(this)),d(n).each(function(e,t){0<e&&(c+="\n"),c+=t.url}),d(s).each(function(e,t){0<e&&(c+="\n"),c+=t.url}),d(r).each(function(e,t){d(t).each(function(e,t){""!=c&&(c+="\n"),c+=t.url})}),o.copyTextToClipboard(c,"Link copied to clipboard","ERROR: Link not copied to clipboard")},showParticipantProperties:function(e){let t=this.contact.participants.get(e);if(this.contact.participants.participant_properties_panel=new a.ParticipantPropertiesView({model:this.contact.details_view.participants}),t)this.contact.participants.participant_properties_panel.open(t);else{let t=r({from:this.account.get("jid"),type:"get",to:this.contact.get("jid")}).c("query",{xmlns:p.NS.GROUP_CHAT+"#members",id:e});this.account.sendIQ(t,function(e){let t=this.contact.participants.createFromStanza(d(e).find("item"));this.contact.participants.participant_properties_panel.open(t)}.bind(this))}},onClickMessage:function(e){let t=d(e.target);if((t.hasClass("file-link-download")&&(e.preventDefault(),a.openWindow(t.attr("href"))),!t.hasClass("msg-delivering-state"))&&!t.hasClass("mdi-link-variant")&&!t.hasClass("btn-retry-send-message")&&!t.hasClass("file-link-download")&&!t.is("canvas")&&!t.hasClass("voice-message-volume")){var i=t.closest(".chat-message"),n=t.parents(".fwd-message").first(),s=0<n.length,o=i.attr("data-no-select-on-mouseup"),r;if(i.attr("data-no-select-on-mouseup",""),0!=window.getSelection())return;if(t.hasClass("collapsed-forwarded-message")){let e=this.buildMessageHtml(this.account.forwarded_messages.get(t.data("msgid"))),i=new a.ExpandedMessagePanel({account:this.account,chat_content:this});return i.$el.attr("data-color",this.account.settings.get("color")),this.updateMessageInChat(e),this.initPopup(e),void i.open(e)}if(t.hasClass("chat-msg-author")||t.hasClass("fwd-msg-author")){let e=s?n.data("from"):i.data("from"),o=s?n.data("fromId"):i.data("fromId");if(this.contact.get("group_chat")){if(this.contact.get("group_info")){let i=this.contact.participants.get(o),n=i&&i.attributes||{jid:e,id:o,nickname:t.text()};this.contact.messages_view=new a.ParticipantMessagesView({contact:this.contact,model:n}),this.contact.messages_view.messagesRequest({},function(){a.body.setScreen("all-chats",{right:"participant_messages",contact:this.contact})}.bind(this))}}else if(e===this.account.get("jid"))this.account.showSettings();else if(e===this.model.get("jid"))this.contact.showDetails("all-chats");else{var c=this.account.contacts.mergeContact(e);c.showDetails()}return}if(t.hasClass("circle-avatar")){let e=s?n.data("from"):i.data("from");if(this.contact.get("group_chat")){let e=s?n.attr("data-from-id"):i.attr("data-from-id");return void(e&&(this.contact.all_rights?this.showParticipantProperties(e):this.contact.getAllRights(function(){this.showParticipantProperties(e)}.bind(this))))}if(e===this.account.get("jid"))this.account.showSettings();else if(e===this.model.get("jid"))this.contact.showDetails("all-chats");else{let t=this.account.contacts.mergeContact(e);t.showDetails()}return}if(t.hasClass("mention")){let e=t.data("id");if(this.contact.get("group_chat"))this.contact.all_rights?this.showParticipantProperties(e):this.contact.getAllRights(function(){this.showParticipantProperties(e)}.bind(this));else if(e===this.account.get("jid"))this.account.showSettings();else if(e===this.model.get("jid"))this.contact.showDetails("all-chats");else{let e=this.account.contacts.mergeContact(from_jid);e.showDetails()}return}if(t.hasClass("voice-message-play")||t.hasClass("no-uploaded")){let e=t.closest(".link-file"),a=e.find(".file-link-download").attr("href");return e.find(".mdi-play").removeClass("no-uploaded"),e[0].voice_message=this.renderVoiceMessage(e.find(".file-container")[0],a),this.prev_audio_message&&this.prev_audio_message.voice_message.pause(),void(this.prev_audio_message=e[0])}if(t.hasClass("mdi-play")){let e=t.closest(".link-file");return this.prev_audio_message.voice_message.pause(),this.prev_audio_message=e[0],void e[0].voice_message.play()}if(t.hasClass("mdi-pause"))return void this.prev_audio_message.voice_message.pause();if(t.hasClass("msg-hyperlink"))return;if(t.hasClass("uploaded-img")||t.hasClass("uploaded-img-for-collage"))return;if(t.hasClass("last-image"))return void t.find("img")[0].click();if(t.hasClass("image-counter"))return void t.closest(".last-image").find("img")[0].click();if(i.hasClass("searched-message"))return void this.model.getMessageContext(i.data("msgid"),{seached_messages:!0});let e=function(){o||(i.switchClass("selected",!i.hasClass("selected")),this.bottom.manageSelectedMessages())}.bind(this);if(i.hasClass("participant-message")||i.hasClass("context-message"))return i.hasClass("system")?void 0:void e();if(r=this.model.messages.get(i.data("msgid")),!r)return;var l=r.get("type");if("file_upload"===l)return;if("system"===l){if(!r.get("auth_request"))return;t.hasClass("accept-request")?this.contact.acceptRequest(function(){this.removeMessage(i),this.contact.showDetails("all-chats")}.bind(this)):t.hasClass("block-request")?this.contact.blockRequest(function(){this.removeMessage(i)}.bind(this)):t.hasClass("decline-request")&&this.contact.declineRequest(function(){this.removeMessage(i),this.model.set("active",!1),this.head.closeChat(),a.body.setScreen("all-chats",{right:null})}.bind(this)),t.hasClass("accept-request-group")?this.contact.acceptGroupRequest(function(){this.removeMessage(i),this.contact.set("in_roster",!0),this.contact.trigger("open_chat",this.model)}.bind(this)):t.hasClass("block-request-group")?this.contact.blockRequest(function(){this.removeMessage(i)}.bind(this)):t.hasClass("decline-request-group")&&this.contact.declineRequest(function(){this.removeMessage(i),this.model.set("active",!1),this.head.closeChat(),a.body.setScreen("all-chats",{right:null})}.bind(this))}else if(s){var p=this.account.forwarded_messages.get(n.data("msgid"));if(!p)return;e()}else e()}},retrySendMessage:function(e){let t=d(e.target).closest(".chat-message"),a=this.model.messages.get(t.data("msgid"));"file_upload"===a.get("type")?(a.set("state",n.MSG_PENDING),this.startUploadFile(a,t)):this.sendMessage(a),e.preventDefault()}}),a.ExpandedMessagePanel=a.BasicView.extend({className:"modal expanded-message",template:s.group_chats.pinned_message_panel,ps_selector:".modal-content",ps_settings:{theme:"item-list"},events:{"click .collapsed-forwarded-message":"expandFwdMessage"},_initialize:function(e){this.account=e.account,this.chat_content=e.chat_content},open:function(e){this.$el.openModal({ready:function(){this.updateScrollBar(),this.$(".modal-content").css("height",this.$el.height()-12)}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)}),e.find(".right-side .msg-delivering-state").remove(),this.$(".modal-content").html(e),this.$(".msg-copy-link").remove()},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},expandFwdMessage:function(e){var t=d(e.target),i=t.data("msgid"),n=this.chat_content.buildMessageHtml(this.account.forwarded_messages.get(i)),s=new a.ExpandedMessagePanel({account:this.account,chat_content:this.chat_content});s.$el.attr("data-color",this.account.settings.get("color")),this.chat_content.updateMessageInChat(n),this.chat_content.initPopup(n),s.open(n)}}),a.ChatsBase=Backbone.Collection.extend({model:a.Chat}),a.Chats=a.ChatsBase.extend({initialize:function(){this.collections=[],this.on("add",u.bind(this.updateInCollections,this,"add")),this.on("change",u.bind(this.updateInCollections,this,"change"))},addCollection:function(e){this.collections.push(e)},updateInCollections:function(e,t){u.each(this.collections,function(a){a.update(t,e)})},registerQuillEmbeddedsTags:function(){let e=Quill.import("blots/inline");class t extends e{static create(e){let t=super.create();return t.innerHTML=e.slice(e.indexOf("&nickname=")+10),t.setAttribute("data-id",e.slice(0,e.indexOf("&nickname="))),t}static value(e){return e.innerHTML}}t.blotName="mention",t.className="ground-color-100",t.tagName="mention",t.prototype.optimize=function(){};let a=Quill.import("formats/image");class i extends a{static create(e){return"string"==typeof e?d(e.emojify({tag_name:"img"}))[0]:e}static value(e){return e}}i.blotName="quill_emoji",i.className="emoji",i.tagName="img",Quill.register(i),Quill.register(t)}}),a.OpenedChats=a.ChatsBase.extend({comparator:function(e,t){var a=e.get("timestamp"),i=t.get("timestamp");return a>i?-1:a<i?1:0},initialize:function(){this.on("change:timestamp",this.sort,this)},update:function(e){var t=e.get("opened");t?!this.get(e)&&(this.add(e),e.trigger("add_opened_chat",e)):this.get(e)&&(this.remove(e),e.trigger("remove_opened_chat",e))}}),a.ClosedChats=a.ChatsBase.extend({update:function(e){var t=!e.get("opened");t?!this.get(e)&&(this.add(e),e.trigger("add_closed_chat",e)):this.get(e)&&(this.remove(e),e.trigger("remove_closed_chat",e))}}),a.AccountChats=a.ChatsBase.extend({initialize:function(e,t){this.account=t.account,this.mam_requests=0,this.deferred_mam_requests=[],this.account.contacts.on("add_to_roster",this.getChat,this),this.account.contacts.on("open_chat",this.openChat,this),this.account.contacts.on("open_mention",this.openMention,this),this.account.contacts.on("presence",this.onPresence,this)},getChat:function(e){var t=this.get(e.hash_id);return t||(t=a.chats.create(null,{contact:e}),this.add(t),e.set("known",!0)),t},openChat:function(e,t){t=t||{},u.isUndefined(t.clear_search)&&(t.clear_search=!0);var a=this.getChat(e);a.trigger("open",{clear_search:t.clear_search})},openMention:function(e,t){var i=this.getChat(e);a.body.setScreen("mentions",{right:"mentions",chat_item:i.item_view}),t&&i.getMessageContext(t,{mention:!0})},registerMessageHandler:function(){this.account.connection.deleteHandler(this._msg_handler),this._msg_handler=this.account.connection.addHandler(function(e){return this.receiveMessage(e),this.account.connection.do_synchronization&&p.getDomainFromJid(d(e).attr("from"))==this.account.domain&&(this.account.last_msg_timestamp=m.now()),!0}.bind(this),null,"message")},onStartedMAMRequest:function(e){this.deferred_mam_requests.push(e),this.runMAMRequests()},onCompletedMAMRequest:function(){this.mam_requests--,this.runMAMRequests()},runMAMRequests:function(){for(;this.mam_requests<a.settings.mam_requests_limit;){var e=this.deferred_mam_requests.shift();if(!e)break;this.mam_requests++,e.resolve()}},setArchiveId:function(e){var t=e.children("origin-id").attr("id"),a=this.account._pending_messages.find(e=>e.msg_id===t);a&&(this.account.chats.get(a.chat_hash_id).messages.get(a.msg_id).set("archive_id",e.children("stanza-id").attr("id")),this.account._pending_messages.splice(this.account._pending_messages.indexOf(a),1))},parsePubSubNode:function(e){if(!e)return null;var t=e.indexOf("#");return-1===t?null:e.slice(t+1,e.length)},receivePubsubMessage:function(e){var t=e.find("info").attr("id"),i=p.getBareJidFromJid(e.attr("from")),s=e.find("items").attr("node"),o=this.parsePubSubNode(s),d=this.account.contacts.get(i);if(!d)i===this.account.get("jid")&&this.account.getAvatar(t,function(e){this.account.cached_image=h.getCachedImage(e);let t={avatar_priority:n.AVATAR_PRIORITIES.PUBSUB_AVATAR,image:e};this.account.set(t),this.account.save(t)}.bind(this));else if(o){if(d.my_info&&o==d.my_info.get("id")&&t==d.my_info.get("avatar"))return void d.trigger("update_my_info");if(t&&this.account.chat_settings.getHashAvatar(o)!=t){let e=p.NS.PUBSUB_AVATAR_DATA+"#"+o;d.getAvatar(t,e,function(e){this.account.chat_settings.updateCachedAvatars(o,t,e),d.my_info&&o==d.my_info.id&&(d.my_info.set({avatar:t,b64_avatar:e}),d.trigger("update_my_info"));let a=d.participants&&d.participants.get(o);a&&(a.set({avatar:t,b64_avatar:e}),this.account.groupchat_settings.updateParticipant(d.get("jid"),a.attributes))}.bind(this))}}else{if(""!==t&&d.get("photo_hash")===t)return;(!this.get("avatar_priority")||this.get("avatar_priority")<=n.AVATAR_PRIORITIES.PUBSUB_AVATAR)&&d.getAvatar(t,p.NS.PUBSUB_AVATAR_DATA,function(e){d.cached_image=h.getCachedImage(e),a.cached_contacts_info.putContactInfo({jid:d.get("jid"),hash:t,avatar:e,name:d.get("name"),avatar_priority:n.AVATAR_PRIORITIES.PUBSUB_AVATAR}),d.set("avatar_priority",n.AVATAR_PRIORITIES.PUBSUB_AVATAR),d.set("photo_hash",t)}.bind(this))}},receiveMessage:function(e){let t=d(e),a=t.attr("type");return"headline"===a?this.receiveHeadlineMessage(e):"chat"===a||"normal"===a?this.receiveChatMessage(e):"error"===a?this.receiveErrorMessage(e):void 0},receiveHeadlineMessage:function(e){var t=d(e),i=p.getBareJidFromJid(t.attr("from")),s=t.find("received[xmlns=\""+p.NS.DELIVERY+"\"]");if(s.length){let e=s.children("forwarded").children("message"),t=s.children("origin-id").first().attr("id")||e.children("origin-id").first().attr("id");if(e.length&&this.receiveChatMessage(e[0],{echo_msg:!0}),t){let a=this.account.messages.get(t),o=s.children("time").attr("stamp");a&&a.set("state",n.MSG_SENT),a&&o&&(a.set("time",o),a.set("timestamp",+m(o)));let d=this.account.contacts.get(i);if(d)if(!d.get("group_chat"))this.setArchiveId(s);else if(e.children("stanza-id").attr("by")==d.get("jid")){let a=e.children("reference[type=\"groupchat\"]").find("user").attr("id");this.setArchiveId(e),this.account.messages.get(t).set({state:n.MSG_DELIVERED,from_id:a});let i=this.account.chats.getChat(d);a&&i.item_view.content.$el.find(".chat-message[data-msgid=\""+t+"\"]").attr("data-from-id",a)}}return}let r=t.children("revoke[xmlns=\""+p.NS.AUTH_TOKENS+"\"]");if(r.length)return r.children("token-uid").each(function(e,t){let a=d(t),i=a.text();if(i&&this.account.x_tokens_list){let e=this.account.x_tokens_list.find(e=>e.token_uid==i),t=e?this.account.x_tokens_list.indexOf(e):-1;-1<t&&this.account.x_tokens_list.splice(t,1)}}.bind(this)),void this.account.settings_right.updateXTokens();if(t.find("event[xmlns=\""+p.NS.PUBSUB+"#event\"]").length)return void this.receivePubsubMessage(t);let c=this.account.contacts.get(i),l;if(c&&(l=this.account.chats.getChat(c)),t.children("x[xmlns=\""+p.NS.GROUP_CHAT+"#user-updated\"]").length){if(!c)return;let e=t.children("x[xmlns=\""+p.NS.GROUP_CHAT+"#user-updated\"]").attr("version");e&&c.participants&&c.participants.version<e&&c.trigger("update_participants")}if(t.find("replace").length){if(!c&&(c=this.account.contacts.get(t.find("replace").attr("conversation")))&&(l=this.account.chats.getChat(c)),!l)return;let e=t.find("replace").attr("id"),i=l.messages.find(t=>t.get("archive_id")==e),n=a.body.screen.get("right"),s="participant_messages"===n&&this.account.participant_messages||"message_context"===n&&this.account.context_messages||"searched_messages"===n&&this.account.searched_messages||[],r=s.find(t=>t.get("archive_id")==e),u=t.find("replace message body").text(),m=t.find("replace message reference[type=\"mention\"][xmlns=\""+p.NS.REFERENCE+"\"]"),g=t.find("replace message reference[type=\"markup\"][xmlns=\""+p.NS.REFERENCE+"\"]"),h=[],v=[];if(m.length&&m.each(function(e,t){let a=d(t),i=parseInt(a.attr("begin")),n=parseInt(a.attr("end")),s=a.children("uri").text()||"";h.push({start:i,end:n,uri:s})}.bind(this)),g.length&&g.each(function(e,t){let a=d(t),i=parseInt(a.attr("begin")),n=parseInt(a.attr("end")),s=[];a.children().each(function(e,t){s.push(t.tagName)}.bind(this)),v.push({start:i,end:n,markups:s})}.bind(this)),r){let e=o.slice_pretty_body(u,r.get("legacy_content"));r.set("mentions",h),r.set("markups",v),r.set("original_message",u),r.set("message",e),r.set("last_replace_time",t.find("replaced").attr("stamp"))}if(i){let e=o.slice_pretty_body(u,i.get("legacy_content"));i.set("mentions",h),i.set("markups",v),i.set("original_message",u),i.set("message",e),i.set("last_replace_time",t.find("replaced").attr("stamp")),c.get("pinned_message")&&c.get("pinned_message").get("msgid")===i.get("msgid")&&(c.get("pinned_message").set("message",u),l.item_view.content.updatePinnedMessage()),l&&l.item_view.updateLastMessage(l.last_message)}}if(t.find("retract-message").length){if(!c&&(c=this.account.contacts.get(t.find("retract-message").attr("conversation")))&&(l=this.account.chats.getChat(c)),!l)return;let e=t.find("retract-message"),a=e.attr("id"),i=l.messages.find(e=>e.get("archive_id")==a);i&&(i.set("is_unread",!1),l.item_view.content.removeMessage(i),l.item_view.updateLastMessage(l.last_message)),e.attr("version")>l.message_retraction_version&&(l.message_retraction_version=e.attr("version"))}if(t.find("retract-user").length){var u=t.find("retract-user"),g=u.attr("id"),h=l.messages.filter(e=>e.get("user_info")&&e.get("user_info").id==g);h&&d(h).each(function(e,t){t.set("is_unread",!1),l.item_view.content.removeMessage(t)}.bind(this)),l.item_view.updateLastMessage(l.last_message)}if(t.find("retract-all").length){if(!c&&(c=this.account.contacts.get(t.find("retract-all").attr("conversation")))&&(l=this.account.chats.getChat(c)),!l)return;var v=l.messages.models;d(v).each(function(e,t){l.item_view.content.removeMessage(t)}.bind(this)),l.item_view.updateLastMessage()}if(t.find("confirm[xmlns=\""+p.NS.HTTP_AUTH+"\"]").length){let i=t.find("confirm").attr("id");if(t.attr("from")==this.account.xabber_auth.api_jid&&t.attr("id")==this.account.xabber_auth.request_id)this.account.verifyXabberAccount(i,function(e){this.account.get("auto_login_xa")&&(a.api_account.save("token",e),a.api_account.login_by_token())}.bind(this));else return this.receiveChatMessage(e)}},receiveChatMessage:function(e,t){t=t||{};var i=d(e),n=i.find("forwarded"),s=t.delay,o=i.attr("to"),r=p.getBareJidFromJid(o),c=p.getResourceFromJid(o),l=i.attr("from")||t.from_jid;if(i.find("invite").length&&t.forwarded)return;if(!l)return a.warn("Message without \"from\" attribute"),void a.warn(e);let m=p.getBareJidFromJid(l),g=m===this.account.get("jid");if(t.forwarded&&(!n.length||t.xml))return this.account.forwarded_messages.createFromStanza(i,{is_forwarded:!0,forwarded_message:t.forwarded_message||null,delay:s,from_jid:l,xml:t.xml});if(n.length&&!t.xml){var h=i.find("result[xmlns=\""+p.NS.MAM+"\"]");if(h.length){n=h.children("forwarded");var v=i.find("archived"),f,b,x,w;return n.length&&(i=n.children("message"),s=n.children("delay")),i.children("stanza-id").each(function(e,t){t=d(t),i.children("reference[type=\"groupchat\"]").length?t.attr("by")===m&&(f=t,b=t):t.attr("by")===m?b=t:f=t}.bind(this)),b&&(w=b.attr("id")),f?x=f.attr("id"):v.length&&(x=v.attr("id")),x=x||h.attr("id"),this.receiveChatMessage(i[0],u.extend(t,{is_mam:!0,delay:s,archive_id:x,contact_archive_id:w}))}let e=i.find("[xmlns=\""+p.NS.CARBONS+"\"]");if(e.length){if(i.find("invite").length)return;let s=e.find("accept[xmlns=\""+p.NS.JINGLE_MSG+"\"]"),o=e.find("reject[xmlns=\""+p.NS.JINGLE_MSG+"\"]");return(s.length||o.length)&&a.current_voip_call&&(a.current_voip_call.destroy(),a.current_voip_call=null),n=e.children("forwarded"),n.length&&(i=n.children("message")),e.find("request[xmlns=\""+p.NS.DELIVERY+"\"][to=\""+r+"\"]").length?void 0:this.receiveChatMessage(i[0],u.extend(t,{carbon_copied:!0}))}let o=[];return n=i.children("reference[type=\"forward\"][xmlns=\""+p.NS.REFERENCE+"\"]").children("forwarded[xmlns=\""+p.NS.FORWARD+"\"]"),n.length||(n=i.children("forwarded")),n.each(function(e,a){var i=d(a),n=i.children("message"),s=i.children("delay"),r=this.receiveChatMessage(n[0],{forwarded:!0,pinned_message:t.pinned_message,participant_message:t.participant_message,searched_message:t.searched_message,is_searched:t.is_searched,context_message:t.context_message,from_jid:l,delay:s});o.push(r)}.bind(this)),this.receiveChatMessage(i[0],u.extend({forwarded_message:o,xml:i[0]},t))}!t.is_mam&&c&&c!==this.account.resource&&(a.warn("Message to another resource"),a.warn(e));var C=g?r:m;if(C===this.account.get("jid"))return a.warn("Message from me to me"),void a.warn(e);var S=this.account.contacts.mergeContact(C),k=this.account.chats.getChat(S);return i.find("x[xmlns=\""+p.NS.AUTH_TOKENS+"\"]").length&&!t.is_archived&&(this.account.getAllXTokens(),!S.get("in_roster")&&S.pushInRoster()),k.receiveMessage(i,u.extend(t,{is_sender:g}))},receiveErrorMessage:function(e){var t=e.getAttribute("id");if(t){var a=d(e).find("error").attr("code"),i=this.account.messages.get(t);i&&"406"===a&&i.set("state",n.MSG_ERROR)}},onPresence:function(e,t){var a=this.getChat(e);a.onPresence(t)}}),a.AddGroupChatView=a.SearchView.extend({className:"modal dialog-modal main-modal add-group-chat-modal add-contact-modal",template:s.group_chats.add_group_chat,avatar_size:n.AVATAR_SIZES.ACCOUNT_ITEM,ps_selector:".rich-textarea",ps_settings:{theme:"item-list"},events:{"click .account-field .dropdown-content":"selectAccount","click .btn-add":"addGroupChat","keyup .input-group-chat-name input":"updateGroupJid","keyup .rich-textarea":"showPlaceholder","keyup .input-group-chat-jid input":"fixJid","click .btn-cancel":"close","click .property-variant":"changePropertyValue"},render:function(e){if(!a.accounts.connected.length)return void o.dialogs.error("No connected accounts found.");e||(e={}),this.setDefaultSettings();var t=e.account?[e.account]:a.accounts.connected;this.$(".single-acc").showIf(1===t.length),this.$(".multiple-acc").hideIf(1===t.length),this.$(".account-field .dropdown-content").empty(),u.each(t,function(e){this.$(".account-field .dropdown-content").append(this.renderAccountItem(e))}.bind(this)),this.bindAccount(t[0]),this.$(".btn-cancel").text(this.is_login?"Skip":"Cancel"),this.$el.openModal({ready:function(){let e={inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"};Materialize.updateTextFields(),this.$(".account-field .dropdown-button").dropdown(e),this.$(".property-field .dropdown-button").dropdown(e),this.$(".property-field .select-xmpp-server .caret").dropdown(e),this.$(".property-field .select-xmpp-server .xmpp-server-item-wrap").dropdown(e)}.bind(this),complete:this.hide.bind(this)})},setDefaultSettings:function(){this.$("input[name=chat_jid]").removeClass("fixed-jid").val(""),this.$("#new_chat_domain").val(""),this.$("input[name=chat_name]").val(""),this.$(".description-field .rich-textarea").text(""),this.$(".btn-add").addClass("non-active"),this.showPlaceholder(),this.$("span.errors").text("").addClass("hidden");let e=this.$(".incognito-dropdown-wrap"),t=e.find(".dropdown-content .default-value");e.find(".incognito-item-wrap .property-value").attr("data-value",t.attr("data-value")).text(t.text());let a=this.$(".global-dropdown-wrap"),i=a.find(".dropdown-content .default-value");a.find(".global-item-wrap .property-value").attr("data-value",i.attr("data-value")).text(i.text());let n=this.$(".membership-dropdown-wrap"),s=n.find(".dropdown-content .default-value");n.find(".membership-item-wrap .property-value").attr("data-value",s.attr("data-value")).text(s.text())},bindAccount:function(e){this.account=e,this.$(".input-group-chat-domain").addClass("hidden"),this.$el.attr("data-color",this.account.settings.get("color")),this.$(".account-field .dropdown-button .account-item-wrap").replaceWith(this.renderAccountItem(e));let t=this.account.get("groupchat_servers_list");t.length?this.$(".xmpp-server-dropdown-wrap .field-jid").text(t[0]):this.setCustomDomain(this.$(".property-field.xmpp-server-dropdown-wrap .property-value")),this.$(".modal-content .jid-field .set-default-domain").remove();for(var a=0;a<t.length;a++)d("<div/>",{class:"field-jid property-variant set-default-domain"}).text(t[a]).insertBefore(this.$(".modal-content .jid-field .set-custom-domain"))},renderAccountItem:function(e){let t=d(s.add_chat_account_item({jid:e.get("jid")}));return t},selectAccount:function(e){let t=d(e.target).closest(".account-item-wrap"),i=a.accounts.get(t.data("jid"));this.bindAccount(i)},setCustomDomain:function(e){this.$("#new_chat_domain").val(""),e.text(""),this.$(".input-group-chat-domain").removeClass("hidden")},changePropertyValue:function(e){let t=d(e.target),a=t.closest(".property-field").find(".property-value");return t.hasClass("set-custom-domain")?void this.setCustomDomain(a):void(t.hasClass("set-default-domain")&&(this.$(".input-group-chat-domain").addClass("hidden"),this.$("#new_chat_domain").val("")),a.text(t.text()),a.attr("data-value",t.attr("data-value")))},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},updateGroupJid:function(){let e=this.$("input[name=chat_jid]");if(!e.hasClass("fixed-jid")){let e=slug(this.$(".input-group-chat-name input").get(0).value,{lower:!0});this.$("label[for=new_chat_jid]").addClass("active"),this.$(".input-field #new_chat_jid").get(0).value=e}this.$(".btn-add").switchClass("non-active",!this.$(".input-group-chat-name input").get(0).value)},showPlaceholder:function(){let e=""===this.$(".rich-textarea ").text();this.$(".rich-textarea-wrap .placeholder").hideIf(!e)},fixJid:function(){let e=this.$("input[name=chat_jid]");e.hasClass("fixed-jid")||e.addClass("fixed-jid"),""==e.get(0).value&&e.removeClass("fixed-jid")},createGroupChat:function(){var e=this.account.resources.connection.jid,t=this.$("input[name=chat_name]").val(),i=this.$("input[name=chat_jid]").val()?this.$("input[name=chat_jid]").val():void 0,n=this.$(".incognito-field .property-value").attr("data-value"),s=this.$("#new_chat_domain").val()||this.$(".xmpp-server-dropdown-wrap .property-value").text(),o=this.$(".global-field .property-value").attr("data-value"),c=this.$(".description-field .rich-textarea").text()||"",l=this.$(".membership-field .property-value").attr("data-value"),u=r({from:e,type:"set",to:s}).c("create",{xmlns:p.NS.GROUP_CHAT}).c("name").t(t).up().c("privacy").t(n).up().c("index").t(o).up().c("description").t(c).up().c("membership").t(l).up();i&&u.c("localpart").t(i),this.account.sendIQ(u,function(e){if("result"===d(e).attr("type")){let t=d(e).find("created jid").text().trim(),i=this.account.contacts.mergeContact(t);i.set("group_chat",!0),i.pres("subscribed"),i.pushInRoster(null,function(){i.pres("subscribe"),i.getMyInfo(),this.close(),a.chats_view.updateScreenAllChats(),i.subGroupPres(),i.trigger("open_chat",i);let e=r({type:"set"}).c("block",{xmlns:p.NS.BLOCKING}).c("item",{jid:t+"/"+m.now()});this.account.sendIQ(e)}.bind(this))}}.bind(this),function(){this.$(".modal-footer .errors").removeClass("hidden").text("Jid is already in use")}.bind(this))},addGroupChat:function(e){if(d(e.target).closest(".button-wrap").hasClass("non-active"))return void d(e.target).blur();var t=this.$("#new_chat_domain").val()||this.$(".xmpp-server-dropdown-wrap .property-value").text(),a=this.$("input[name=chat_jid]").val();if(""==this.$("input[name=chat_name]").val())this.$(".modal-footer .errors").text("Enter group chat name").removeClass("hidden");else if(""==a||-1==a.search(/[А-яЁё]/)&&-1==a.search(/\s/)&&""!=a){this.$(".modal-footer .errors").text("").addClass("hidden");var i=this.account.resources.connection.jid,n=r({from:i,type:"get",to:t}).c("query",{xmlns:p.NS.DISCO_INFO}),s;this.account.sendIQ(n,function(e){d(e).children("query").children("feature").each(function(e,t){d(t).attr("var")==p.NS.GROUP_CHAT&&(s=!0)}.bind(this)),s&&this.createGroupChat()}.bind(this),function(){this.$(".modal-footer .errors").removeClass("hidden").text("Invalid domain")}.bind(this))}else this.$(".modal-footer .errors").removeClass("hidden").text("Invalid jid")}}),a.ChatsView=a.SearchPanelView.extend({className:"recent-chats-container container",ps_selector:".chat-list-wrap",ps_settings:{theme:"item-list"},main_container:".chat-list",template:s.chats_panel,_initialize:function(){this.active_chat=null,this.model.on("add",this.onChatAdded,this),this.model.on("destroy",this.onChatRemoved,this),this.model.on("change:active",this.onChangedActiveStatus,this),this.model.on("change:timestamp",this.updateChatPosition,this),a.accounts.on("list_changed",this.updateLeftIndicator,this);let e=this.defineMouseWheelEvent();this.$el.on(e,this.onMouseWheel.bind(this)),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this)),this.ps_container.on("ps-scroll-down",this.onScroll.bind(this))},render:function(e){("chat"!==e.right&&"contact_details"!==e.right&&"searched_messages"!==e.right&&"message_context"!==e.right&&"participant_messages"!==e.right||e.clear_search)&&(this.clearSearch(),a.toolbar_view.$(".active").hasClass("all-chats")&&this.showAllChats())},defineMouseWheelEvent:function(){return u.isUndefined(window.onwheel)?u.isUndefined(window.onmousewheel)?"MozMousePixelScroll":"mousewheel":"wheel"},onMouseWheel:function(e){0<e.originalEvent.deltaY&&this.onScroll()},hideChatsFeedback:function(){clearTimeout(this._load_chats_timeout),this.$(".load-chats-feedback").addClass("hidden"),this.updateScrollBar(),this._load_chats_timeout=null},onScroll:function(){if(this.isScrolledToBottom()&&!this._load_chats_timeout){this._load_chats_timeout=setTimeout(function(){this.hideChatsFeedback()}.bind(this),5e3);let e=a.accounts.connected.filter(e=>!e.roster.conversations_loaded&&e.connection&&e.connection.do_synchronization);e.length&&(this.$(".load-chats-feedback").text("Loading...").removeClass("hidden"),this.updateScrollBar()),e.forEach(function(e){let t={max:a.settings.mam_messages_limit};e.roster.last_chat_msg_id&&(t.after=e.roster.last_chat_msg_id),e.roster.syncFromServer(t)}.bind(this))}},updateLeftIndicator:function(e){this.$el.attr("data-indicator",1<e.connected.length)},onChatAdded:function(e){this.addChild(e.id,e.item_view),this.updateChatPosition(e)},onChatRemoved:function(e,t){this.active_chat===this.child(e.id)&&(this.active_chat=null,a.body.setScreen(null,{chat_item:null},{silent:!a.body.isScreen("all-chats")})),this.removeChild(e.id,t),this.updateScrollBar()},onChangedActiveStatus:function(e){if(e.get("active")){var t=this.active_chat;this.active_chat=this.child(e.id),t&&t.model.set("active",!1)}},replaceChatItem:function(e,t){let a=this.child(e.id);if(a&&e.get("timestamp")){a.$el.detach();let i=t.indexOf(e);0===i?this.$(".chat-list").prepend(a.$el):this.$(".chat-item").eq(i-1).after(a.$el)}},updateChatPosition:function(e){let t=this.child(e.id),i=a.toolbar_view.$(".active");t&&(i.hasClass("group-chats")&&t.contact.get("group_chat")&&this.replaceChatItem(e,this.model.filter(e=>e.contact.get("group_chat")&&!e.contact.get("archived"))),i.hasClass("chats")&&!t.contact.get("group_chat")&&this.replaceChatItem(e,this.model.filter(e=>!e.contact.get("group_chat")&&!e.contact.get("archived"))),i.hasClass("all-chats")&&!t.contact.get("archived")&&this.replaceChatItem(e,this.model.filter(e=>!e.contact.get("archived"))),i.hasClass("archive-chats")&&t.contact.get("archived")&&this.replaceChatItem(e,this.model.filter(e=>e.contact.get("archived"))),i.hasClass("account-item")&&t.account.get("jid")===i.attr("data-jid")&&this.replaceChatItem(e,this.model.filter(e=>e.account.get("jid")===i.attr("data-jid")&&!e.contact.get("archived"))))},onEnterPressed:function(e){let t;e.closest(".searched-lists-wrap").length?(this.clearSearch(),this.$(".list-item.active").removeClass("active"),e.hasClass("chat-item")&&(t=this.child(e.data("id")),t&&t.open(),e.addClass("active")),e.hasClass("roster-contact")&&(t=a.accounts.get(e.data("account")).chats.get(a.accounts.get(e.data("account")).contacts.get(e.data("jid")).hash_id),t&&(t=t.item_view),t&&a.chats_view.openChat(t,{clear_search:!1,screen:a.body.screen.get("name")}),e.addClass("active")),e.hasClass("message-item")&&e.click()):(t=this.child(e.data("id")),t&&t.open())},openChat:function(e,t){t=t||{},this.$(".list-item.active").removeClass("active"),e.updateActiveStatus();let i=a.chats_view.getScrollTop();if(t.clear_search&&this.clearSearch(),e.contact.private_invitation)e.model.set("display",!0),e.model.set("active",!0),a.body.setScreen("all-chats",{right:"private_invitation",contact:e.contact});else if(!e.contact.get("in_roster")&&!1==e.model.get("is_accepted"))e.model.set("display",!0),e.model.set("active",!0),a.body.setScreen("all-chats",{right:"group_invitation",contact:e.contact}),e.content.readMessages();else{if(a.toolbar_view.$(".active").hasClass("contacts")&&this.updateScreenAllChats(),!e.model.get("history_loaded")&&20>e.model.messages.length&&e.content.loadPreviousHistory(),!e.model.get("displayed_sent")&&e.model.messages.length){let t=e.model.messages.models[e.model.messages.length-1];!t||t.isSenderMe()||t.get("is_unread")||(e.model.sendMarker(t.get("msgid"),"displayed",t.get("archive_id"),t.get("contact_archive_id")),e.model.set("displayed_sent",!0))}a.body.setScreen(t.screen||"all-chats",{right:"chat",clear_search:t.clear_search,chat_item:e})}a.chats_view.scrollTo(i)},removeInvite:function(e){let t=e.content.$(".auth-request");0<t.length&&t.each(function(t,a){e.model.messages.get(d(a).attr("msgid")).destroy(),e.content.removeMessage(d(a))}.bind(this))},showGroupChats:function(){this.$(".chat-item").detach();let e=this.model,t=e.filter(e=>e.contact.get("group_chat")&&e.get("timestamp")&&!e.contact.get("archived"));t.forEach(function(e){this.$(".chat-list").append(e.item_view.$el),e.item_view.updateCSS()})},showChats:function(){this.$(".chat-item").detach();let e=this.model,t=e.filter(e=>!e.contact.get("group_chat")&&e.get("timestamp")&&!e.contact.get("archived"));t.forEach(function(e){this.$(".chat-list").append(e.item_view.$el),e.item_view.updateCSS()})},showChatsByAccount:function(e){a.body.setScreen("all-chats"),this.$(".chat-item").detach();let t=this.model,i=t.filter(t=>t.account.get("jid")===e.get("jid")&&t.get("timestamp")&&!t.contact.get("archived"));i.forEach(function(e){this.$(".chat-list").append(e.item_view.$el),e.item_view.updateCSS()})},showArchiveChats:function(){this.$(".chat-item").detach();let e=this.model,t=e.filter(e=>e.contact.get("archived"));t.forEach(function(e){this.$(".chat-list").append(e.item_view.$el),e.item_view.updateCSS()})},showAllChats:function(){this.$(".chat-item").detach();let e=this.model,t=e.filter(e=>e.get("timestamp")&&!e.contact.get("archived"));t.forEach(function(e){this.$(".chat-list").append(e.item_view.$el),e.item_view.updateCSS()})},updateScreenAllChats:function(){a.toolbar_view.$(".toolbar-item").removeClass("active").filter(".all-chats").addClass("active"),this.showAllChats()}}),a.MessageItemView=a.BasicView.extend({className:"message-item list-item",template:s.message_item,avatar_size:n.AVATAR_SIZES.CHAT_ITEM,events:{click:"openByClick"},_initialize:function(){this.contact=this.model.contact,this.account=this.contact.account,this.$el.attr("data-id",this.model.id+"-"+this.cid),this.$el.attr("data-contact-jid",this.contact.get("jid")),this.updateName(),this.updateLastMessage(),this.updateAvatar(),this.updateColorScheme(),this.updateGroupChats(),this.updateBot(),this.updateIncognitoChat(),this.updatePrivateChat(),this.account.settings.on("change:color",this.updateColorScheme,this),this.contact.on("change:name",this.updateName,this)},updateName:function(){this.$(".chat-title").text(this.contact.get("name"))},updateAvatar:function(){var e=this.contact.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateGroupChats:function(){var e=this.contact.get("group_chat");this.$(".status").hideIf(e),!e||this.contact.get("private_chat")||this.contact.get("incognito_chat")&&!this.contact.get("private_chat")||this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.GROUP_CHAT_ICON}),e&&(this.$el.addClass("group-chat"),this.$(".chat-title").css("color","#424242"),this.model.set("group_chat",!0))},updateBot:function(){this.contact.get("bot")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.BOT_CHAT_ICON})},updatePrivateChat:function(){this.contact.get("private_chat")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.PRIVATE_CHAT_ICON})},updateIncognitoChat:function(){this.contact.get("incognito_chat")&&!this.contact.get("private_chat")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.INCOGNITO_CHAT_ICON})},updateColorScheme:function(){var e=this.account.settings.get("color");this.$el.attr("data-color",e)},updateLastMessage:function(e){if(e||(e=this.model),!e)return;let t=e.get("time"),a=e.get("timestamp"),i=e.get("forwarded_message"),s=e.get("files"),r=e.get("images"),c=i?e.get("message")||(1<i.length?i.length+" forwarded messages":"Forwarded message").italics():e.getText(),l=e.get("user_info")||{};if(this.model.set({timestamp:a}),s||r){let t=d("<span class=\"text-color-500\"/>");if(s&&r&&(s=0<s.length?s:void 0,r=0<r.length?r:void 0),s&&r?c=t.text(s.length+r.length+" files"):(s&&(1<s.length&&(c=t.text(s.length+" files")),1==s.length&&(c=t.text(s[0].name))),r&&(1<r.length&&(c=t.text(r.length+" images")),1==r.length&&(c=t.text(r[0].name)))),this.contact.get("group_chat")){let t=l.nickname||(e.isSenderMe()?this.account.get("name"):e.get("from_jid"));this.$(".last-msg").text("").append(d("<span class=text-color-700>"+t+": </span>")).append(c)}else this.$(".last-msg").text("").append(c)}else{let t="";this.contact.get("group_chat")&&(t=l.nickname||(e.isSenderMe()?this.account.get("name"):e.get("from_jid"))),this.$(".last-msg").text("").append(c),t&&this.$(".last-msg").prepend(d("<span class=text-color-700>"+t+": </span>"))}this.$el.emojify(".last-msg",{emoji_size:14}),this.$(".last-msg-date").text(o.pretty_short_datetime(t)).attr("title",o.pretty_datetime(t)),this.$(".msg-delivering-state").showIf(e.isSenderMe()&&e.get("state")!==n.MSG_ARCHIVED).attr("data-state",e.getState())},openByClick:function(){let e=this.account.chats.getChat(this.contact);this.$el.closest(".left-panel-list-wrap").find(".list-item").removeClass("active"),this.$el.addClass("active"),a.body.setScreen(a.body.screen.get("name"),{right:"message_context",chat_item:e.item_view}),this.model.get("msgid")&&e.getMessageContext(this.model.get("msgid"),{message:!0})}}),a.ForwardPanelView=a.SearchView.extend({className:"modal dialog-modal forward-panel-modal",template:s.forward_panel,ps_selector:".chat-list-wrap",ps_settings:{theme:"item-list"},open:function(e,t){this.messages=e,this.account=t,this.$(".chat-list-wrap").html(""),a.chats_view.$(".chat-list .chat-item").each(function(e,t){let a=this.account.chats.get(d(t).data("id"));a&&this.$(".chat-list-wrap").append(d(t).clone().removeClass("hidden"))}.bind(this)),this.$(".chat-list-wrap").prepend(d("<div/>",{class:"forward-panel-list-title recent-chats-title hidden"}).text("Recent chats")),this.$(".chat-list-wrap").append(d("<div/>",{class:"forward-panel-list-title contacts-title hidden"}).text("Contacts")),this.$(".chat-item").removeClass("active"),this.clearSearch(),this.data.set("visible",!0),this.$el.openModal({ready:function(){this.updateScrollBar(),this.$(".search-input").focus()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)})},close:function(){var e=new d.Deferred;return this.$el.closeModal({complete:function(){this.$el.detach(),this.data.set("visible",!1),e.resolve()}.bind(this)}),e.promise()},onClickItem:function(e){let t=d(e.target).closest(".list-item");this.onEnterPressed(t)},search:function(e){let t=!1,i=!1,n=!1,s,o;e=e.toLowerCase(),this.$(".roster-contact.list-item").remove(),e&&this.account.roster.forEach(function(t){let i=t.get("jid"),s=t.hash_id,o=t.get("name").toLowerCase(),d=!!(0>o.indexOf(e)&&0>i.indexOf(e));if(!d)if(!this.$(".chat-list-wrap .chat-item[data-id=\""+s+"\"]").length){let e=a.contacts_view.$(".account-roster-wrap[data-jid=\""+this.account.get("jid")+"\"] .roster-contact[data-jid=\""+i+"\"]").first().clone();e.find(".blocked-indicator").hide(),e.find(".muted-icon").hide(),this.$(".chat-list-wrap").append(e)}else d=!0;d||(n=!0)}.bind(this)),this.$(".contacts-title").switchClass("hidden",!n),this.$(".chat-item").each(function(a,n){let r=this.account.chats.get(d(n).data("id"));return r?void(s=r.get("jid"),o=r.contact.get("name").toLowerCase(),t=!!(0>o.indexOf(e)&&0>s.indexOf(e)),d(n).hideIf(t),!t&&(i=!0)):void d(n).addClass("hidden")}.bind(this)),this.$(".recent-chats-title").switchClass("hidden",!i),this.$(".modal-content .error").showIf(!n&&!i),this.scrollToTop()},onEmptyQuery:function(){this.$(".roster-contact.list-item").remove(),this.$(".contacts-title").addClass("hidden"),this.$(".recent-chats-title").addClass("hidden")},onEnterPressed:function(e){let t;e.hasClass("roster-contact")&&(t=a.chats_view.child(this.account.contacts.get(e.data("jid")).hash_id)),e.hasClass("chat-item")&&(t=a.chats_view.child(e.data("id"))),t&&this.forwardTo(t)},forwardTo:function(e){e.content.bottom.setForwardedMessages(this.messages),this.messages=[],this.close().done(function(){e.open({clear_search:!0})})}}),a.InvitationPanelView=a.SearchView.extend({className:"modal dialog-modal add-user-group-chat",template:s.group_chats.invitation_panel_view,ps_selector:".contacts-list-wrap",ps_settings:{theme:"item-list"},_initialize:function(){this.registerClickEvents()},open:function(e,t){this.selected_contacts=[],this.account=e,this.contact=t,this.clearPanel(),a.contacts_view.$(".account-roster-wrap[data-jid=\""+this.account.get("jid")+"\"] .roster-group").each(function(e,t){let a=d(t).clone();d(a).find(".list-item").each(function(e,t){let a=this.account.contacts.get(d(t).attr("data-jid"));a.get("group_chat")&&t.remove()}.bind(this)),a.children(".list-item").length&&(this.$(".contacts-list-wrap").append(a),a.find(".arrow").click(function(e){this.toggleContacts(e)}.bind(this)),a.find(".group-head").click(function(e){this.selectAllGroup(e)}.bind(this)))}.bind(this)),this.data.set("visible",!0),this.$el.openModal({ready:function(){this.updateScrollBar(),this.$(".search-input").focus()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1),this.selected_contacts=[]}.bind(this)})},addSelectedUsers:function(){return this.selected_contacts.length?void(d(this.selected_contacts).each(function(e,t){this.sendInvite(t)}.bind(this)),this.close()):void this.$(".modal-footer button").blur()},clearPanel:function(){this.$(".modal-footer .errors").text(""),this.$(".counter").text(""),this.$(".contacts-list-wrap").empty(),this.clearSearch()},registerClickEvents:function(){this.$(".btn-cancel").click(function(){this.close()}.bind(this)),this.$(".btn-add").click(function(){this.addSelectedUsers()}.bind(this))},addUser:function(e){var t=d(e.target).closest(".list-item"),a=t.attr("data-jid");t.toggleClass("click-selected");let i=this.selected_contacts.indexOf(a);-1<i?this.selected_contacts.splice(i,1):this.selected_contacts.push(a),this.updateCounter()},sendInvite:function(e){let t="member-only"===this.contact.get("group_info").model,a=r({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("invite",{xmlns:p.NS.GROUP_CHAT+"#invite"}).c("jid").t(e).up().c("send").t(t).up().c("reason").t("incognito"===this.contact.get("group_info").anonymous?"You are invited to incognito group chat. If you join it, you won't see real XMPP IDs of other participants":"You are invited to group chat. If you accept, "+e+" username shall be visible to group chat participants");this.account.sendIQ(a,function(){t||this.sendInviteMessage(e),this.close()}.bind(this),function(e){this.onInviteError(e)}.bind(this))},onInviteError:function(e){var t;0<d(e).find("not-allowed").length&&(t=d(e).find("text").text()||"You have no permission"),0<d(e).find("conflict").length&&(t=d(e).find("text").text()||d(e).find("invite").find("jid").text()+" already invited in group chat"),this.$(".modal-footer .errors").removeClass("hidden").text(t)},sendInviteMessage:function(e){var t="Add "+this.contact.get("jid")+" to the contacts to join a group chat",a=c({from:this.account.get("jid"),to:e,type:"chat",id:g()}).c("invite",{xmlns:p.NS.GROUP_CHAT+"#invite",jid:this.contact.get("jid")}).c("reason").t("incognito"===this.contact.get("group_info").anonymous?"You are invited to incognito group chat. If you join it, you won't see real XMPP IDs of other participants":"You are invited to group chat. If you accept, "+e+" username shall be visible to group chat participants").up().up().c("body").t(t).up();this.account.sendMsg(a)},search:function(e){e=e.toLowerCase(),e&&this.$(".list-item").each(function(t,a){let i=d(a).attr("data-jid"),n=this.account.contacts.get(i).get("name").toLowerCase(),s=1<this.$(".list-item[data-jid=\""+i+"\"]").length&&!this.$(".list-item[data-jid=\""+i+"\"]").first().is(d(a));d(a).hideIf(0>n.indexOf(e)&&0>i.indexOf(e)||s)}.bind(this)),this.$(".group-head").addClass("hidden"),this.$(".modal-content .error").switchClass("hidden",this.$(".list-item").length!==this.$(".list-item.hidden").length),this.scrollToTop()},onEmptyQuery:function(){this.$(".list-item").removeClass("hidden"),this.$(".group-head").removeClass("hidden")},onClickItem:function(e){this.addUser(e)},onEnterPressed:function(e){let t=e.attr("data-jid"),a=this.selected_contacts.indexOf(t);-1<a&&this.selected_contacts.splice(a,1),this.selected_contacts.push(t),this.updateCounter(),this.addSelectedUsers()},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},toggleContacts:function(e){var t=d(e.target).hasClass("mdi-chevron-down");if(t){var a=d(e.target).closest(".roster-group");a.find(".list-item").each(function(e,t){d(t).addClass("hidden")}.bind(this))}else{var a=d(e.target).closest(".roster-group");a.find(".list-item").each(function(e,t){d(t).removeClass("hidden")}.bind(this))}d(e.target).switchClass("mdi-chevron-right",t),d(e.target).switchClass("mdi-chevron-down",!t),this.updateScrollBar()},selectAllGroup:function(e){if(!d(e.target).hasClass("arrow")){var t=d(e.target).closest(".roster-group");t.hasClass("click-selected")?(t.removeClass("click-selected"),t.find(".list-item").each(function(e,t){var a=d(t).attr("data-jid"),i=this.selected_contacts.indexOf(a);-1<i&&(this.selected_contacts.splice(i,1),d(t).removeClass("click-selected"))}.bind(this))):(t.addClass("click-selected"),t.find(".list-item").each(function(e,t){var a=d(t).attr("data-jid"),i=this.selected_contacts.indexOf(a);-1<i||(this.selected_contacts.push(a),d(t).addClass("click-selected"))}.bind(this))),this.updateCounter()}},updateCounter:function(){var e=this.$(".list-item.click-selected").length;e?this.$(".counter").removeClass("hidden").text(e):this.$(".counter").text("")}}),a.ChatHeadView=a.BasicView.extend({className:"chat-head-wrap",template:s.chat_head,avatar_size:n.AVATAR_SIZES.CHAT_HEAD,events:{"click .contact-name":"showContactDetails","click .circle-avatar":"showContactDetails","click .btn-notifications":"changeNotifications","click .btn-contact-details":"showContactDetails","click .btn-clear-history":"clearHistory","click .btn-invite-users":"inivteUsers","click .btn-retract-own-messages":"retractOwnMessages","click .btn-close-chat":"deleteChat","click .btn-archive-chat":"archiveChat","click .btn-search-messages":"renderSearchPanel","click .btn-jingle-message":"sendJingleMessage"},_initialize:function(e){this.content=e.content,this.contact=this.content.contact,this.model=this.content.model,this.account=this.model.account,this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateMenu(),this.updateNotifications(),this.updateArchiveButton(),this.contact.on("archive_chat",this.archiveChat,this),this.contact.on("change:name",this.updateName,this),this.contact.on("change:status_updated",this.updateStatus,this),this.contact.on("change:status_message",this.updateStatusMsg,this),this.contact.on("change:image",this.updateAvatar,this),this.contact.on("change:blocked",this.updateMenu,this),this.contact.on("change:muted",this.updateNotifications,this),this.contact.on("change:group_chat",this.updateGroupChatHead,this),this.contact.on("change:private_chat",this.updatePrivateChat,this),this.contact.on("change:incognito_chat",this.updateIncognitoChat,this)},render:function(){return this.$(".tooltipped").tooltip("remove"),this.$(".tooltipped").tooltip({delay:50}),this.$(".btn-more").dropdown({inDuration:100,outDuration:100,hover:!1}),this.$(".chat-head-menu").hide(),this.updateMenu(),this.updateGroupChatHead(),this},updateName:function(){this.$(".contact-name").text(this.contact.get("name"))},updateStatus:function(){var e=this.contact.get("status"),t=this.contact.getStatusMessage();this.$(".contact-status").attr("data-status",e),this.$(".contact-status-message").text(t)},updateStatusMsg:function(){var e="Group chat";this.contact.get("group_info")&&(e=this.contact.get("group_info").members_num,e+=1<this.contact.get("group_info").members_num?" participants":" participant",0<this.contact.get("group_info").online_members_num&&(e+=", "+this.contact.get("group_info").online_members_num+" online")),this.contact.get("group_chat")?this.$(".contact-status-message").text(e):this.$(".contact-status-message").text(this.contact.getStatusMessage()),this.$(".contact-status-message").text(this.contact.getStatusMessage())},updateAvatar:function(){var e=this.contact.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateMenu:function(){var e=this.contact.get("group_chat");this.$(".btn-invite-users").showIf(e),this.$(".btn-retract-own-messages").showIf(e)},renderSearchPanel:function(){let e;this.content.isVisible()&&(e=this.content),this.contact.messages_view&&this.contact.messages_view.isVisible()&&(e=this.contact.messages_view),e.$search_form.slideToggle(200,function(){"none"!==e.$search_form.css("display")&&e.$search_form.find("input").focus()}.bind(this))},showContactDetails:function(){this.contact.showDetails("all-chats")},updateNotifications:function(){var e=this.contact.get("muted");this.$(".btn-notifications .muted").showIf(e),this.$(".btn-notifications .no-muted").hideIf(e)},changeNotifications:function(){var e=!this.contact.get("muted");this.contact.set("muted",e),this.account.chat_settings.updateMutedList(this.contact.get("jid"),e)},archiveChat:function(e){if(e&&(d(e.target).hasClass("mdi-package-down")||d(e.target).hasClass("mdi-package-up"))){for(var t=this.model.item_view.$el,a=t,i=null,n;null==i&&0<a.length;)if(a=a.next(),a&&!a.hasClass("hidden")){var s=a.attr("data-id");i=this.account.chats.get(s)}null==i?this.getActiveScreen():(n=i.contact,n.trigger("open_chat",n))}var o=!this.contact.get("archived"),r=!!o;this.contact.set("archived",o),this.model.messages.length||this.model.item_view.updateLastMessage(),this.$(".btn-archive-chat .mdi").switchClass("mdi-package-up",r),this.$(".btn-archive-chat .mdi").switchClass("mdi-package-down",!r),this.account.chat_settings.updateArchiveChatsList(this.contact.get("jid"),o)},sendJingleMessage:function(){this.content.initJingleMessage()},getActiveScreen:function(){var e=a.toolbar_view.$(".active");return e.hasClass("archive-chats")?void a.toolbar_view.showArchive():e.hasClass("all-chats")?void a.toolbar_view.showAllChats():e.hasClass("chats")?void a.toolbar_view.showChats():e.hasClass("group-chats")?void a.toolbar_view.showGroupChats():e.hasClass("account-item")?void a.toolbar_view.showChatsByAccount():void 0},updateArchiveButton:function(){var e=this.contact.get("archived"),t=!!e;this.contact.set("archived",e),this.$(".btn-archive-chat .mdi").switchClass("mdi-package-up",t),this.$(".btn-archive-chat .mdi").switchClass("mdi-package-down",!t)},updateGroupChatHead:function(){var e=this.contact.get("group_chat");!e||this.contact.get("private_chat")||this.contact.get("incognito_chat")||this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.GROUP_CHAT_ICON}),this.$(".btn-jingle-message").showIf(!e),this.$(".contact-status").hideIf(e)},updateBot:function(){this.contact.get("bot")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.BOT_CHAT_ICON})},updatePrivateChat:function(){this.contact.get("private_chat")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.PRIVATE_CHAT_ICON})},updateIncognitoChat:function(){this.contact.get("incognito_chat")&&!this.contact.get("private_chat")&&this.$(".chat-icon").showIf(!0).children("img").attr({src:n.CHAT_ICONS.INCOGNITO_CHAT_ICON})},inivteUsers:function(){a.invite_panel.open(this.account,this.contact)},retractOwnMessages:function(){let e=this.contact.my_info&&this.contact.my_info.get("id");e?this.model.retractMessagesByUser(e):this.contact.getMyInfo(function(){e=this.contact.my_info&&this.contact.my_info.get("id"),this.model.retractMessagesByUser(e)})},clearHistory:function(){this.content.clearHistory(),a.chats_view.clearSearch()},leaveGroupChat:function(){this.contact.declineSubscription(),this.contact.removeFromRoster(),this.contact.set("in_roster",!1)},closeChat:function(){this.model.set("opened",!1),a.chats_view.clearSearch()},deleteChat:function(){if(this.contact.get("group_chat"))o.dialogs.ask("Delete chat","If you delete a group chat, you won't receive messages from it",null,{ok_button_text:"delete"}).done(function(e){e&&(this.account.connection&&this.account.connection.do_synchronization&&this.model.deleteChatFromSynchronization(),this.leaveGroupChat(),this.closeChat())}.bind(this));else{let e=this.account.server_features.get(p.NS.REWRITE);o.dialogs.ask("Delete chat","Are you sure you want to <b>delete all message history</b> for this chat?"+(e?"":("\nWarning! <b>"+this.account.domain+"</b> server does not support message deletion. Only local message history will be deleted.").fontcolor("#E53935")),null,{ok_button_text:e?"delete":"delete locally"}).done(function(t){if(t){if(this.account.connection&&this.account.connection.do_synchronization&&this.model.deleteChatFromSynchronization(),e)this.model.retractAllMessages(!1);else{let e=this.model.messages.models;d(e).each(function(e,t){this.model.item_view.content.removeMessage(t)}.bind(this))}this.closeChat()}}.bind(this))}}}),a.ChatBottomView=a.BasicView.extend({className:"chat-bottom-wrap",template:s.chat_bottom,avatar_size:n.AVATAR_SIZES.CHAT_BOTTOM,mention_avatar_size:n.AVATAR_SIZES.MENTION_ITEM,events:{"click .my-avatar":"showAccountSettings","keyup .input-message .rich-textarea":"keyUp","keydown .input-message .rich-textarea":"keyDown","change .attach-file input":"onFileInputChanged","mouseup .attach-voice-message":"writeVoiceMessage","mouseup .message-input-panel":"stopWritingVoiceMessage","mousedown .attach-voice-message":"writeVoiceMessage","click .close-forward":"unsetForwardedMessages","click .send-message":"submit","click .markup-text":"onShowMarkupPanel","click .reply-message":"replyMessages","click .forward-message":"forwardMessages","click .pin-message":"pinMessage","click .copy-message":"copyMessages","click .edit-message":"showEditPanel","click .btn-save":"submit","click .delete-message":"deleteMessages","click .close-message-panel":"resetSelectedMessages","click .mention-item":"inputMention","click .format-text":"updateMarkupPanel"},_initialize:function(e){let t=this.$(".rich-textarea-wrap"),i={enter:{key:13,handler:function(e){"enter"!==a.settings.hotkeys&&this.quill.insertText(e.index,"\n")}},arrow_up:{key:n.KEY_ARROW_UP,handler:function(){if("none"!==this.$(".mentions-list").css("display")){let e=this.$(".mentions-list").children(".active.mention-item");if(e.length){let t=e.prev(".mention-item");e.removeClass("active"),t.length||(t=this.$(".mentions-list").children(".mention-item").last().addClass("active"),this.$(".mentions-list")[0].scrollTop=this.$(".mentions-list")[0].scrollHeight),t.addClass("active"),t.length&&t[0].offsetTop<=this.$(".mentions-list")[0].scrollTop&&(this.$(".mentions-list")[0].scrollTop=t[0].offsetTop)}else this.$(".mentions-list")[0].scrollTop=this.$(".mentions-list")[0].scrollHeight,this.$(".mentions-list").children(".mention-item").last().addClass("active");return!1}return!0}.bind(this)},arrow_down:{key:n.KEY_ARROW_DOWN,handler:function(){if("none"!==this.$(".mentions-list").css("display")){let e=this.$(".mentions-list").children(".active.mention-item");if(e.length){let t=e.next(".mention-item");e.removeClass("active"),t.length||(t=this.$(".mentions-list").children(".mention-item").first(),this.$(".mentions-list")[0].scrollTop=0),t.addClass("active"),t.length&&t[0].offsetTop+t[0].clientHeight>=this.$(".mentions-list")[0].scrollTop+this.$(".mentions-list")[0].clientHeight&&(this.$(".mentions-list")[0].scrollTop=t[0].offsetTop-this.$(".mentions-list")[0].clientHeight+t[0].clientHeight)}else this.$(".mentions-list")[0].scrollTop=0,this.$(".mentions-list").children(".mention-item").first().addClass("active");return!1}return!0}.bind(this)},arrow_left:{key:n.KEY_ARROW_LEFT,handler:function(){return"none"===this.$(".mentions-list").css("display")}.bind(this)},arrow_right:{key:n.KEY_ARROW_RIGHT,handler:function(){return"none"===this.$(".mentions-list").css("display")}.bind(this)}};this.quill=new Quill(t[0],{modules:{keyboard:{bindings:i},toolbar:[["bold","italic","underline","strike","blockquote"],["clean"]]},placeholder:"Write a message...",scrollingContainer:".rich-textarea",theme:"snow"}),this.quill.container.firstChild.classList.add("rich-textarea"),this.view=e.content,this.model=this.view.model,this.contact=this.view.contact,this.account=this.view.account,this.fwd_messages=[],this.edit_message=null,this.$(".account-jid").text(this.account.get("jid")),this.updateAvatar(),this.account.on("change:image",this.updateAvatar,this),this.contact.on("reply_selected_messages",this.replyMessages,this),this.contact.on("forward_selected_messages",this.forwardMessages,this),this.contact.on("copy_selected_messages",this.copyMessages,this),this.contact.on("delete_selected_messages",this.deleteMessages,this),this.contact.on("edit_selected_message",this.showEditPanel,this),this.contact.on("pin_selected_message",this.pinMessage,this),this.contact.on("update_my_info",this.updateInfoInBottom,this),this.contact.on("reset_selected_messages",this.resetSelectedMessages,this);var s=this.$(".input-message .rich-textarea"),o=s[0],r=s.parent(".rich-textarea-wrap"),c=s.siblings(".placeholder");o.onpaste=this.onPaste.bind(this),o.oncut=this.onCut.bind(this),o.ondragenter=function(e){e.preventDefault(),c.text("Drop files here to send"),r.addClass("file-drop")},o.ondragover=function(e){e.preventDefault()},o.ondragleave=function(e){d(e.relatedTarget).closest(".rich-textarea").length||(e.preventDefault(),c.text("Write a message..."),r.removeClass("file-drop"))},o.ondrop=function(e){e.preventDefault(),e.stopPropagation(),c.text("Write a message..."),r.removeClass("file-drop");var t=e.dataTransfer.files||[];this.view.addFileMessage(t)}.bind(this);var l=this.$(".insert-emoticon"),p=this.$(".emoticons-panel-wrap"),m=this.$(".emoticons-panel"),g;u.each(v.all,function(e){d("<div class=\"emoji-wrap\"/>").html(e.emojify({tag_name:"div",emoji_size:25})).appendTo(m)}),m.perfectScrollbar(u.extend({theme:"item-list"},a.ps_settings)),l.hover(function(e){e&&e.preventDefault&&e.preventDefault(),p.addClass("opened"),g&&clearTimeout(g),m.perfectScrollbar("update")}.bind(this),function(e){e&&e.preventDefault&&e.preventDefault(),g&&clearTimeout(g),g=setTimeout(function(){p.is(":hover")||p.removeClass("opened")},800)}.bind(this)),p.hover(null,function(e){e&&e.preventDefault&&e.preventDefault(),g&&clearTimeout(g),g=setTimeout(function(){p.removeClass("opened")},200)}.bind(this)),p.mousedown(function(e){if(e&&e.preventDefault&&e.preventDefault(),!e.button){var t=d(e.target).closest(".emoji-wrap").find(".emoji");t.length&&this.typeEmoticon(t.data("emoji"))}}.bind(this)),this.renderLastEmoticons()},render:function(){this.updateAvatar();var e=this.account.server_features.get(p.NS.HTTP_UPLOAD);return this.content_view=(this.view.data.get("visible")?this.view:this.contact.messages_view)||this.view,this.messages_arr=this.content_view.$el.hasClass("participant-messages-wrap")&&this.account.participant_messages||this.content_view.$el.hasClass("messages-context-wrap")&&this.account.context_messages||this.model.messages,this.renderLastEmoticons(),this.$(".attach-file").showIf(e),this.contact.get("group_chat")?this.updateInfoInBottom():(this.$(".account-nickname").hide(),this.$(".account-badge").hide(),this.$(".account-role").hide()),this.focusOnInput(),a.chat_body.updateHeight(),this.manageSelectedMessages(),this},updateInfoInBottom:function(){if(this.contact.my_info){var e=this.contact.my_info.get("nickname"),t=this.contact.my_info.get("badge"),a=this.contact.my_info.get("b64_avatar"),i=this.contact.my_info.get("role");e?(this.$(".account-jid").hide(),this.$(".account-nickname").show().text(e)):this.$(".account-nickname").hide(),t?this.$(".account-badge").show().text(t):this.$(".account-badge").hide(),i&&"Member"!=i?this.$(".account-role").show().text(i):this.$(".account-role").hide(),this.$(".input-toolbar").emojify(".account-badge",{emoji_size:14}),a||(a=h.getDefaultAvatar(e)),this.$(".my-avatar.circle-avatar").setAvatar(a,this.avatar_size)}else this.$(".account-jid").show(),this.$(".account-nickname").hide(),this.$(".account-badge").hide(),this.$(".account-role").hide()},updateAvatar:function(){let e;this.contact.get("group_chat")?(this.contact.my_info&&this.contact.my_info.get("b64_avatar")&&(e=this.contact.my_info.get("b64_avatar")),!e&&(e=h.getDefaultAvatar(this.contact.my_info&&this.contact.my_info.nickname||this.account.get("jid")))):e=this.account.cached_image,this.$(".my-avatar.circle-avatar").setAvatar(e,this.avatar_size)},focusOnInput:function(){return this.quill.focus(),this},keyDown:function(e){if(e.keyCode!==n.KEY_ESCAPE&&e.keyCode!==n.KEY_BACKSPACE&&e.keyCode!==n.KEY_DELETE){if(e.keyCode===n.KEY_ENTER||10===e.keyCode){if("none"!==this.$(".mentions-list").css("display")){let t=this.$(".mentions-list").children(".active.mention-item");return t.length&&t.click(),void e.preventDefault()}let t="enter"===a.settings.hotkeys;if(t&&e.keyCode===n.KEY_ENTER&&!e.shiftKey||!t&&e.ctrlKey)return e.preventDefault(),void this.submit()}!this.$(".input-message .rich-textarea").getTextFromRichTextarea().trim()||this.view.chat_state||this.view.edit_message||this.view.sendChatState("composing")}},displayMicrophone:function(){this.$(".mdi-send").addClass("hidden"),this.$(".attach-voice-message").removeClass("hidden"),this.$(".btn-save").addClass("hidden")},displaySend:function(){this.$(".mdi-send").removeClass("hidden"),this.$(".attach-voice-message").addClass("hidden"),this.$(".btn-save").addClass("hidden")},displaySaveButton:function(){this.$(".btn-save").removeClass("hidden"),this.$(".mdi-send").addClass("hidden"),this.$(".attach-voice-message").addClass("hidden")},updateMarkupPanel:function(e){let t=d(e.target).closest(".format-text");t.toggleClass("active"),t.hasClass("active")?(this.$(".ql-toolbar.ql-snow").show(),this.$(".last-emoticons").hide()):(this.$(".ql-toolbar.ql-snow").hide(),this.$(".last-emoticons").show())},updateMentions:function(e){this.contact.searchByParticipants(e,function(t){t.length?(this.$(".mentions-list").html("").show().perfectScrollbar({theme:"item-list"}),this.$(".mentions-list")[0].scrollTop=0,t.forEach(function(t){let a=u.clone(t.attributes);a.nickname=a.nickname?p.xmlescape(a.nickname):a.id;let i=d(s.group_chats.mention_item(a));i.find(".circle-avatar").setAvatar(t.get("b64_avatar")||o.images.getDefaultAvatar(t.get("nickname")||t.get("jid")||t.get("id")),this.mention_avatar_size),i.find(".nickname").text().replace(e,e.bold()),this.$(".mentions-list").append(i)}.bind(this)),this.$(".mentions-list").children(".mention-item").first().addClass("active")):this.$(".mentions-list").html("").hide()})},inputMention:function(e){e.preventDefault();let a=d(e.target).closest(".mention-item"),i=a.data("nickname"),n=a.data("id")||"",s=this.$(".rich-textarea"),o=s.getTextFromRichTextarea(),r=this.quill.selection.lastRange&&this.quill.selection.lastRange.index,c=/(^|\s)@(\w+)?/g,l=/(^|\s)[+](\w+)?/g,u=Array.from(o).slice(0,r).join("").replaceEmoji(),m=u&&Array.from(u.matchAll(c))||[],g=u&&Array.from(u.matchAll(l))||[],h=m.length?m.slice(-1)[0].index:-1,v=g.length?g.slice(-1)[0].index:-1,f=t(h,v),b=Array.from(u).slice(f,r).join("");if(b.length&&b[0].match(/\s/)&&f++,b.replace(/\s?(@|[+])/,""),this.$(".mentions-list").hide(),this.quill.deleteText(f,++b.length),!i.length)if(n.length)i=n;else return;this.quill.insertEmbed(f,"mention","xmpp:"+this.contact.get("jid")+"?id="+n+"&nickname="+p.xmlescape(i)),this.quill.pasteHTML(f+i.length,"<text> </text>"),this.quill.setSelection(f+i.length+1,0),this.focusOnInput()},keyUp:function(e){let i=d(e.target).closest(".rich-textarea"),s=i.getTextFromRichTextarea();if(s&&"\n"!=s||this.edit_message?this.displaySend():this.displayMicrophone(),e.keyCode===n.KEY_ESCAPE)e.preventDefault(),this.displayMicrophone(),i.flushRichTextarea(),this.$(".mentions-list").hide(),this.unsetForwardedMessages(),this.view.sendChatState("active");else{if(e.keyCode===n.KEY_ARROW_UP||e.keyCode===n.KEY_ARROW_DOWN)return;if((e.keyCode===n.KEY_ARROW_LEFT||e.keyCode===n.KEY_ARROW_RIGHT)&&"none"!==this.$(".mentions-list").css("display"))return void this.$(".mentions-list").hide();if(e.keyCode!==n.KEY_BACKSPACE&&e.keyCode!==n.KEY_DELETE||this.edit_message||s&&"\n"!=s||(this.$(".fwd-messages-preview").hasClass("hidden")?this.displayMicrophone():this.displaySend(),i.flushRichTextarea(),this.view.sendChatState("active")),e.keyCode===n.KEY_SPACE){let e=this.quill.selection.lastRange&&this.quill.selection.lastRange.index,t=Array.from(s).slice(0,e).join("").replaceEmoji();if(t[e-2].match(/@|[+]/))return void this.$(".mentions-list").hide()}if(this.contact.get("group_chat")){let e=this.quill.selection.lastRange&&this.quill.selection.lastRange.index,a=/(^|\s)@(\w+)?/g,i=/(^|\s)[+](\w+)?/g,n=Array.from(s).slice(0,e).join("").replaceEmoji(),o=Array.from(n.matchAll(a)),d=Array.from(n.matchAll(i)),r=o.length?o.slice(-1)[0].index:-1,c=d.length?d.slice(-1)[0].index:-1,l=t(r,c);if(this.quill.selection.lastRange&&"mention"===this.quill.getLeaf(this.quill.selection.lastRange.index)[0].parent.domNode.tagName.toLowerCase())return void this.$(".mentions-list").hide();if(!(-1<e)||-1===l)return void this.$(".mentions-list").hide();if(-1<l){let t=Array.from(n).slice(l,e).join("").replace(/\s?(@|[+])/,"");this.contact.participants.length&&0<this.contact.participants.version?this.updateMentions(t):this.contact.details_view.participants.participantsRequest(function(){this.updateMentions(t)}.bind(this))}else this.$(".mentions-list").hide()}}i.updateRichTextarea().focus(),i.updateRichTextarea().focus(),a.chat_body.updateHeight()},onCut:function(){this.$(".fwd-messages-preview").hasClass("hidden")?this.displayMicrophone():this.displaySend()},onPaste:function(e){e.preventDefault();var t=d(e.target),i=e.clipboardData;if(i)if(0<i.files.length){var n=i.files[i.files.length-1],s=window.URL.createObjectURL(new Blob([n]));o.dialogs.ask("Send Image from Clipboard","Do you want to send Image from Clipboard?",{blob_image_from_clipboard:s},{ok_button_text:"send"}).done(function(e){e&&(n.name="clipboard.png",this.view.addFileMessage([n]))}.bind(this))}else if(0<i.items.length){var n=i.items[i.items.length-1];if("file"===n.kind){var r=n.getAsFile(),c=new FileReader,l=new d.Deferred;c.onload=function(e){var t={blob_image_from_clipboard:e.target.result};o.dialogs.ask("Send Image from Clipboard","Do you want to send Image from Clipboard?",t,{ok_button_text:"send"}).done(function(e){e&&l.resolve()}.bind(this))},l.done(function(){r.name="clipboard.png",this.view.addFileMessage([r])}.bind(this)),c.readAsDataURL(r)}else{let e=u.escape(i.getData("text")),t=Array.from(e);t.forEach(function(e,a){"\n"==e&&t.splice(a,1,"<br>")," "==e&&t.splice(a,1,"&nbsp")}.bind(this)),e="<p>"+t.join("").emojify({tag_name:"img"})+"</p>",window.document.execCommand("insertHTML",!1,e)}}else{let e=u.escape(i.getData("text")),t=Array.from(e);t.forEach(function(e,a){"\n"==e&&t.splice(a,1,"<br>")," "==e&&t.splice(a,1,"&nbsp")}.bind(this)),e="<p>"+t.join("").emojify({tag_name:"img"})+"</p>",window.document.execCommand("insertHTML",!1,e)}!t.getTextFromRichTextarea().trim()||this.view.chat_state||this.view.edit_message||this.view.sendChatState("composing"),this.focusOnInput(),a.chat_body.updateHeight()},onFileInputChanged:function(e){for(var t=e.target,a=[],n=0;n<t.files.length;n++)a.push(t.files[n]);a&&(this.view.addFileMessage(a),d(t).val(""))},stopWritingVoiceMessage:function(){let e=this.$(".message-input-panel");if(0<e.find(".recording").length)return void e.find(".recording").removeClass("recording")},writeVoiceMessage:function(e){var t=d(e.target);t.hasClass("recording")?t.removeClass("recording"):(t.addClass("recording ground-color-50"),this.initAudio())},initAudio:function(){if(navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia){let t=[],a=this.$(".send-area .attach-voice-message"),i=function(i){let s=new MediaRecorder(i),d=1,r=!0,c,l;s.start(),s.onstart=function(){this.view.sendChatState("composing","audio"),this._chatstate_send_timeout=setInterval(function(){this.view.sendChatState("composing","audio")}.bind(this),n.CHATSTATE_INTERVAL_COMPOSING_AUDIO),c=m.now();let e=this.$(".message-input-panel"),t=this.$(".input-voice-message .timer"),i=this.$(".input-voice-message .voice-msg-status"),l=this.$(".input-voice-message .voice-visualizer");t.text("0:00"),i.css("color","#9E9E9E").text("Release outside this form to cancel"),e.addClass("voice-message-recording");let p=setInterval(function(){a.hasClass("recording")&&d<n.VOICE_MSG_TIME?(0==d%1&&t.text(o.pretty_duration(d)),d=(10*d+2)/10,r=e.is(":hover"),r?i.css("color","#9E9E9E").text("Release outside this form to cancel"):i.css("color","#D32F2F").text("Release to cancel record")):(r=e.is(":hover"),s.stop(),a.removeClass("recording ground-color-50"),e.removeClass("voice-message-recording"),clearInterval(p))}.bind(this),200),u=!1,g=setInterval(function(){a.hasClass("recording")?(u?l.css("background-color","#FFF"):l.css("background-color","#D32F2F"),u=!u):clearInterval(g)},500)}.bind(this),s.onstop=function(){if(clearInterval(this._chatstate_send_timeout),this.view.sendChatState("paused"),l=m.now(),r&&1.5<=(l-c)/1e3){let a=new Blob(t,{type:"audio/ogg; codecs=opus"}),i=new File([a],"Voice message",{type:"audio/ogg; codecs=opus"});i.voice=!0,i.duration=e((l-c)/1e3),this.view.addFileMessage([i])}t=[]}.bind(this),s.ondataavailable=function(a){t.push(a.data),i.getTracks().forEach(e=>e.stop())}}.bind(this);window.navigator.getUserMedia({audio:!0},i,function(e){console.log("The following error occured: "+e),a.removeClass("recording ground-color-50")})}},typeEmoticon:function(e){this.quill.focus(),this.edit_message||this.displaySend(),this.view.chat_state||this.view.sendChatState("composing"),this.quill.insertEmbed(this.quill.selection.lastRange.index,"quill_emoji",e),this.quill.getFormat(this.quill.selection.lastRange.index,1).mention&&this.quill.formatText(this.quill.selection.lastRange.index,1,"mention",!1),this.quill.setSelection(this.quill.selection.lastRange.index+1,0),a.chat_body.updateHeight()},renderLastEmoticons:function(){var e=this.account.chat_settings.getLastEmoji(),t=this.$(".last-emoticons").empty(),a;if(7>e.length)for(var i=0;7>i;i++)a=v.getByIndex(i),this.account.chat_settings.updateLastEmoji(a);e=this.account.chat_settings.getLastEmoji();for(var i=0;7>i;i++)d("<div class=\"emoji-wrap\"/>").html(e[i].emojify({tag_name:"div",emoji_size:20})).appendTo(t);t.find(".emoji-wrap").mousedown(function(e){if(e&&e.preventDefault&&e.preventDefault(),!e.button){var t=d(e.target).closest(".emoji-wrap").find(".emoji");this.typeEmoticon(t.data("emoji"))}}.bind(this))},submit:function(){var e=this.$(".input-message .rich-textarea"),t=[],i=[],s=[],o=e.getTextFromRichTextarea().trim();e.find(".emoji").each(function(e,t){var a=d(t).data("emoji");this.account.chat_settings.updateLastEmoji(a)}.bind(this));let r=[];return this.quill.getContents().forEach(function(a){if(a.attributes){let c=[],l=r.length,p=l+(a.insert&&a.insert.quill_emoji?1:u.escape(a.insert).length-1);for(let e in a.attributes)"alt"!=e&&"blockquote"!==e&&c.push(e);if(-1<c.indexOf("mention")){let a=c.indexOf("mention");c.splice(a,a+1),t.push({start:l,end:p,uri:d(e.find("mention")[t.length]).attr("data-id")})}if(a.attributes.blockquote){let e=0>r.lastIndexOf("\n")?0:r.lastIndexOf("\n")+1,a=r.length-1;s.push({marker:n.QUOTE_MARKER,start:e,end:a+n.QUOTE_MARKER.length}),o=Array.from(u.escape(o)),o[e]=n.QUOTE_MARKER+o[e],o[a]+="\n",o=u.unescape(o.join("")),r[e]+=n.QUOTE_MARKER,r=Array.from(r.join("")),i.forEach(function(t){t.start>=e&&(t.start+=n.QUOTE_MARKER.length,t.end+=n.QUOTE_MARKER.length)}.bind(this)),t.forEach(function(t){t.start>=e&&(t.start+=n.QUOTE_MARKER.length,t.end+=n.QUOTE_MARKER.length)})}c.length&&i.push({start:l,end:p,markups:c})}r=a.insert&&a.insert.quill_emoji?r.concat(Array.from(d(a.insert.quill_emoji).data("emoji"))):r.concat(Array.from(u.escape(a.insert)))}.bind(this)),e.flushRichTextarea().focus(),this.displayMicrophone(),this.edit_message?void this.editMessage(o,{mentions:t,markup_references:i,blockquotes:s},this.contact.get("group_chat")):void((o||this.fwd_messages.length)&&this.view.onSubmit(o,this.fwd_messages,{mentions:t,markup_references:i,blockquotes:s}),this.unsetForwardedMessages(),this.view.sendChatState("active"),a.chats_view.clearSearch(),this.contact.messages_view&&this.contact.messages_view.data.get("visible")&&a.chats_view.openChat(this.model.item_view,{clear_search:!0,screen:a.body.screen.get("name")}))},setEditedMessage:function(e){let t=e.get("message")||"";this.$(".fwd-messages-preview").showIf(this.edit_message),this.$(".fwd-messages-preview .msg-author").text("Edit message"),this.$(".fwd-messages-preview .msg-text").html(p.xmlescape(t)),this.$(".fwd-messages-preview").emojify(".msg-text",{emoji_size:18}),this.displaySaveButton(),a.chat_body.updateHeight();let i=o.markupBodyMessage(e),n=i.emojify({tag_name:"img"}),s=Array.from(n);s.forEach(function(e,t){"\n"==e&&(s[t]="<br>")}.bind(this)),n=s.join(""),this.quill.setText(""),this.quill.pasteHTML(0,n,"user"),this.focusOnInput()},setForwardedMessages:function(e){if(this.fwd_messages=e||[],this.$(".fwd-messages-preview").showIf(e.length),e.length){var t=e[0],i,n,s,o;if(1<e.length)n=e.length+" messages";else if(t.get("forwarded_message"))n="Forwarded message";else{n=(t.get("message")||t.get("original_message")).emojify();var d=t.get("images"),r=t.get("files");if(d&&r)n=t.get("images").length+t.get("files").length+" files";else if(d&&(1<d.length?n=d.length+" images":(s=u.clone(t.get("images")[0]),o=this.createPreviewImage(s))),r)if(1<t.get("files").length)n=t.get("files").length+" files";else{var c=t.get("files")[0].size;n=c?t.get("files")[0].name+",   "+c:t.get("files")[0].name}}let a=t.get("from_jid");i=t.isSenderMe()?this.account.get("name"):t.get("user_info")&&t.get("user_info").nickname||(this.account.contacts.get(a)?this.account.contacts.get(a).get("name"):a),this.$(".fwd-messages-preview .msg-author").text(i),u.isUndefined(s)?this.$(".fwd-messages-preview .msg-text").html(n):this.$(".fwd-messages-preview .msg-text").html(o)}a.chat_body.updateHeight(),this.displaySend()},onShowMarkupPanel:function(e){let t=d(e.target),a=t.hasClass("opened");this.$(".last-emoticons").showIf(a),this.$(".markup-panel").showIf(!a),t.switchClass("opened",!a)},createPreviewImage:function(e){var t=new Image;return t.src=e.url,d(t).addClass("fwd-img-preview"),t},unsetForwardedMessages:function(e){e&&e.preventDefault&&e.preventDefault(),$rich_textarea=this.$(".input-message .rich-textarea"),this.fwd_messages=[],this.edit_message&&$rich_textarea.flushRichTextarea(),this.edit_message=null,this.$(".fwd-messages-preview").addClass("hidden");let t=$rich_textarea.getTextFromRichTextarea();t&&"\n"!=t?this.displaySend():this.displayMicrophone(),a.chat_body.updateHeight(),this.focusOnInput()},resetSelectedMessages:function(){this.content_view.$(".chat-message.selected").removeClass("selected"),this.manageSelectedMessages()},manageSelectedMessages:function(){var e=this.content_view.$(".chat-message.selected"),t=this.$(".message-input-panel"),a=this.$(".message-actions-panel");if(length=e.length,t.hideIf(length),a.showIf(length),length){var i=!1;1===length&&(e.first().data("from")===this.account.get("jid")&&(i=!0),this.contact.my_info&&e.first().data("from")===this.contact.my_info.get("id")&&(i=!0)),a.find(".pin-message-wrap").showIf(this.contact.get("group_chat")),a.find(".pin-message-wrap").switchClass("non-active",1!==length&&this.contact.get("group_chat")),a.find(".edit-message-wrap").switchClass("non-active",!(1===length&&i)),this.view.$(".chat-notification").removeClass("hidden").addClass("msgs-counter").text(length+" message"+(1<length?"s selected":" selected"))}else this.view.$(".chat-notification").addClass("hidden").removeClass("msgs-counter").text(""),this.focusOnInput()},pinMessage:function(){if(!this.$(".pin-message-wrap").hasClass("non-active")){let e=this.content_view.$(".chat-message.selected").first(),t=this.messages_arr.get(e.data("msgid")),a=t.get("archive_id");this.resetSelectedMessages();let i=r({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("update",{xmlns:p.NS.GROUP_CHAT}).c("pinned-message").t(a);this.account.sendIQ(i,function(){},function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to pin/unpin message")})}},copyMessages:function(){let e=this.content_view.$(".chat-message.selected"),t=[];e.each(function(e,a){var i=this.messages_arr.get(a.dataset.msgid);i&&t.push(i)}.bind(this)),this.resetSelectedMessages(),this.pushMessagesToClipboard(t)},editMessage:function(e,t,a){e=e;let i=this.edit_message.get("message")||"",n=p.xmlescape(this.edit_message.get("original_message")||""),s=this.edit_message.get("legacy_content")&&this.edit_message.get("legacy_content").find(e=>"groupchat"===e.type),o=this.edit_message.get("archive_id"),d=t.markup_references||[],c=t.mentions||[];n.length&&(n=n.slice(0,n.length-p.xmlescape(i).length)),s&&(n=n.slice(0,s.start)+n.slice(s.end+1));let l=r({from:this.account.get("jid"),type:"set",to:a?this.contact.get("jid"):this.account.get("jid")}).c("replace",{xmlns:p.NS.REWRITE,id:o}).c("message").c("body").t(p.xmlunescape(n)+e).up();d.forEach(function(e){for(let t in l.c("reference",{xmlns:p.NS.REFERENCE,begin:e.start+n.length,end:e.end+n.length,type:"markup"}),e.markups)l.c(e.markups[t]).up();l.up()}.bind(this)),c.forEach(function(e){l.c("reference",{xmlns:p.NS.REFERENCE,begin:e.start+n.length,end:e.end+n.length,type:"mention",uri:e.uri}).up()}.bind(this)),this.unsetForwardedMessages(),this.account.sendIQ(l,function(){},function(){})},showEditPanel:function(){if(!this.$(".edit-message-wrap").hasClass("non-active")){let e=this.content_view.$(".chat-message.selected").first(),t=this.messages_arr.get(e.data("msgid"));this.edit_message=t,this.resetSelectedMessages(),this.setEditedMessage(t)}},deleteMessages:function(){let e=this.content_view.$(".chat-message.selected"),t=[],i=0,n=[];e.each(function(e,a){let n=this.messages_arr.get(a.dataset.msgid);n&&t.push(n),n.isSenderMe()&&i++}.bind(this)),this.account.server_features.get(p.NS.REWRITE)||this.contact.get("group_chat")?(!this.contact.get("group_chat")&&a.servers.get(this.contact.domain).server_features.get(p.NS.REWRITE)&&(n=[{name:"symmetric_deletion",checked:!1,text:"Delete for all"}]),o.dialogs.ask("Delete messages","Are you sure you want to <b>delete "+t.length+" message"+(1<t.length?"s":"")+"</b>?",n,{ok_button_text:"delete"}).done(function(e){if(!e)return void(this._clearing_history=!1);let a=!!this.contact.get("group_chat")||!!e.symmetric_deletion;this.resetSelectedMessages(),this.model.retractMessages(t,this.contact.get("group_chat"),a)}.bind(this))):o.dialogs.ask("Delete messages","Are you sure you want to <b>delete "+t.length+" message"+(1<t.length?"s":"")+"</b>?"+("\nWarning! <b>"+this.account.domain+"</b> server does not support message deletion. Message"+(1<t.length)?"s":" will be deleted only locally.").fontcolor("#E53935"),n,{ok_button_text:"delete locally"}).done(function(e){return e?void t.forEach(function(e){this.view.removeMessage(e)}.bind(this)):void(this._clearing_history=!1)}.bind(this))},pushMessagesToClipboard:function(e){let t=this.createTextMessage(e,"");o.copyTextToClipboard(u.unescape(t))},createTextMessage:function(e,t){let a="";for(var n=0;n<e.length;n++){let i=e[n],s=m(i.get("timestamp")).startOf("day"),d=n?m(e[n-1].get("timestamp")).startOf("day"):m(0),r="";d.format("x")!=s.format("x")&&(a+=(t.length?t+" ":"")+o.pretty_date(s)+"\n"),r=i.isSenderMe()?this.account.get("name"):i.get("user_info")&&i.get("user_info").nickname||(this.account.contacts.get(i.get("from_jid"))?this.account.contacts.get(i.get("from_jid")).get("name"):i.get("from_jid")),a+=(t.length?t+" ":"")+"["+o.pretty_time(i.get("timestamp"))+"] "+r+":\n",t.length&&(a+=t);let c=u.unescape(i.get("legacy_content")&&i.get("legacy_content").find(e=>"groupchat"===e.type)?i.get("original_message").slice(i.get("legacy_content").find(e=>"groupchat"===e.type).end+1):i.get("original_message"));t.length&&(c=c.replace(/\n/g,"\n&gt; ")),t.length&&0!==c.indexOf("&gt;")&&(a+=" "),c=u.unescape(c.replace(/\n&gt; &gt;/g,"\n&gt;&gt;")),a+=u.escape(c)+"\n"}return a.trim()},replyMessages:function(){let e=this.content_view.$(".chat-message.selected"),t=[];e.each(function(e,a){let i=this.messages_arr.get(a.dataset.msgid);i&&t.push(i)}.bind(this)),this.resetSelectedMessages(),this.setForwardedMessages(t)},forwardMessages:function(){let e=this.content_view.$(".chat-message.selected"),t=[];e.each(function(e,a){let i=this.messages_arr.get(a.dataset.msgid);i&&t.push(i)}.bind(this)),this.resetSelectedMessages(),a.forward_panel.open(t,this.account)},showChatNotification:function(e,t){this.view.$(".chat-notification").hasClass("msgs-counter")||this.view.$(".chat-notification").switchClass("hidden",!e).text(e).switchClass("text-color-300",t)}}),a.ChatHeadContainer=a.Container.extend({className:"chat-head-container panel-head noselect"}),a.ChatBodyContainer=a.Container.extend({className:"chat-body-container",updateHeight:function(){var e=a.chat_bottom.$el.height();e&&(this.$el.css({bottom:e}),this.view&&this.view.updateScrollBar())}}),a.ChatBottomContainer=a.Container.extend({className:"chat-bottom-container"}),a.ChatPlaceholderView=a.BasicView.extend({className:"placeholder-wrap chat-placeholder-wrap noselect",template:s.chat_placeholder}),a.ChatSettings=Backbone.ModelWithStorage.extend({defaults:{last_emoji:[],muted:[],archived:[],group_chat:[],cached_avatars:[],group_chat_members_lists:[]},getLastEmoji:function(){return u.clone(this.get("last_emoji"))},updateLastEmoji:function(e){var t=u.clone(this.get("last_emoji"));if(0<t.length){var a=t.indexOf(e);for(-1!=a&&t.splice(a,1),t.push(e);7<t.length;)t.shift()}else t.push(e);this.save("last_emoji",t)},updateMutedList:function(e,t){var a=u.clone(this.get("muted")),i=a.indexOf(e);t&&0>i&&a.push(e),!t&&0<=i&&a.splice(i,1),this.save("muted",a)},updateArchiveChatsList:function(e,t){var a=u.clone(this.get("archived")),i=a.indexOf(e);t&&0>i&&a.push(e),!t&&0<=i&&a.splice(i,1),this.save("archived",a)},updateGroupChatsList:function(e,t){var a=u.clone(this.get("group_chat")),i=a.indexOf(e);t&&0>i&&a.push(e),!t&&0<=i&&a.splice(i,1),this.save("group_chat",a)},updateCachedAvatars:function(e,t,a){var i=u.clone(this.get("cached_avatars")),n=i.indexOf(i.find(t=>t.id===e));-1!=n&&i.splice(n,1),i.push({id:e,avatar_hash:t,avatar_b64:a}),this.save("cached_avatars",i)},getAvatarInfoById:function(e){var t=u.clone(this.get("cached_avatars")),a=t.find(t=>t.id===e);return a},getB64Avatar:function(e){var t=this.getAvatarInfoById(e);return t?t.avatar_b64:void 0},getHashAvatar:function(e){var t=this.getAvatarInfoById(e);if(t)return t.avatar_hash}}),a.Account.addInitPlugin(function(){this.chat_settings=new a.ChatSettings({id:"chat-settings"},{account:this,storage_name:a.getStorageName()+"-chat-settings-"+this.get("jid"),fetch:"after"}),this.messages=new a.Messages(null,{account:this}),this.forwarded_messages=new a.Messages(null,{account:this}),this.pinned_messages=new a.Messages(null,{account:this}),this.chats=new a.AccountChats(null,{account:this})}),a.Account.addConnPlugin(function(){this.chats.registerMessageHandler(),this.chats.each(function(e){e.messages.length?e.trigger("get_missed_history"):e.trigger("load_last_history")}),this.trigger("ready_to_get_roster")},!0,!0),a.once("start",function(){this.chats=new this.Chats,this.chats.addCollection(this.opened_chats=new this.OpenedChats),this.chats.addCollection(this.closed_chats=new this.ClosedChats),this.chats.registerQuillEmbeddedsTags(),this.chats_view=this.left_panel.addChild("chats",this.ChatsView,{model:this.opened_chats}),this.chat_head=this.right_panel.addChild("chat_head",this.ChatHeadContainer),this.chat_body=this.right_panel.addChild("chat_body",this.ChatBodyContainer),this.chat_bottom=this.right_panel.addChild("chat_bottom",this.ChatBottomContainer),this.chat_placeholder=this.right_panel.addChild("chat_placeholder",this.ChatPlaceholderView),this.forward_panel=new this.ForwardPanelView({model:this.opened_chats}),this.invite_panel=new this.InvitationPanelView({model:this.opened_chats}),this.add_group_chat_view=new this.AddGroupChatView,this.on("add_group_chat",function(){this.add_group_chat_view.show()},this),this.on("change:focused",function(){if(this.get("focused")){var e=this.chats_view.active_chat;e&&e.model.get("display")&&(e.content.readMessages(),!1!=e.model.get("is_accepted")&&e.content.bottom.focusOnInput())}},this),this.on("show_group_chats",function(){this.chats_view.showGroupChats()},this),this.on("show_chats",function(){this.chats_view.showChats()},this),this.on("show_account_chats",function(e,t){this.chats_view.showChatsByAccount(t)},this),this.on("show_archive_chats",function(){this.chats_view.showArchiveChats()},this),this.on("clear_search",function(){this.contacts_view.clearSearch(),this.chats_view.clearSearch()},this)},a),a}}),define("xabber-searching",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.searching,n=t.utils,s=t.$,o=t.$iq,d=t.$msg,r=t.$pres,c=t.Strophe,l=t._,p=t.moment,u=t.uuid,m=n.images;return e.DiscoveringView=e.BasicView.extend({className:"searching-main noselect",template:i.searching_wide,ps_selector:".chats-list-wrap",ps_settings:{wheelPropagation:!0,theme:"existing-chats-list"},avatar_size:a.AVATAR_SIZES.SYNCHRONIZE_ACCOUNT_ITEM,events:{"click .account-field .dropdown-content":"selectAccount","click .btn-cancel":"close","click .btn-search":"search","click .existing-chat-wrap":"getChatProperties","keyup .search-input":"keyUp"},_initialize:function(){this.data.on("change:color",this.colorUpdated,this),this.$(".searching-properties-field .dropdown-button").on("click",function(){this.toggleProperties()}.bind(this))},render:function(t){this.endDiscovering(),this.data.set("color","#9E9E9E"),t||(t={});var a=e.accounts.connected,i=t.jid||"";return this.$(".single-acc").showIf(1===a.length),this.$(".multiple-acc").hideIf(1===a.length),this.$(".account-field .dropdown-content").empty(),l.each(a,function(e){this.$(".account-field .dropdown-content").append(this.renderAccountItem(e))}.bind(this)),a.length&&this.bindAccount(a[0]),this.$("#select-searching-properties .account-field .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"}),this},toggleProperties:function(){var e=this.isPropertiesVisible();this.$("#select-searching-properties").slideToggle("fast"),this.$(".arrow").switchClass("mdi-chevron-up",!e),this.$(".arrow").switchClass("mdi-chevron-down",e)},isPropertiesVisible:function(){return"none"!==this.$("#select-searching-properties").css("display")},discover:function(){var e=l.escape(this.$(".search-input.simple-input-field").val());if(e){this.isPropertiesVisible()&&this.toggleProperties(),this.$(".searching-more").html("");var t=this.$("#searching_property_title").val(),a=this.$("#searching_property_sort_by").val();this.$(".searching-result-wrap .preloader-wrapper").show(),this.searchExistingGroupChats(e)}},setColor:function(){if(this.account){var e=this.account.settings.get("color");this.data.set("color",e)}},colorUpdated:function(){var e=this.data.get("color");this.$el.attr("data-color",e)},keyUp:function(e){""===this.$(".search-input").val()?this.$(".btn-search").addClass("none-active"):this.$(".btn-search").removeClass("none-active"),e.keyCode===a.KEY_ENTER&&this.discover()},searchExistingGroupChats:function(e){this.account.connection.disco.items(e,null,this.getGroupchatService.bind(this),this.onDiscoveringError.bind(this))},onDiscoveringError:function(e){this.endDiscovering(),this.$(".chats-list").html(""),this.$(".result-string").text("No matches for \""+s(e).attr("from")+"\"")},endDiscovering:function(){this.$(".searching-result-wrap .preloader-wrapper").hide()},getGroupchatService:function(e){s(e).find("query item").each(function(e,t){if(s(t).attr("node")===c.NS.GROUP_CHAT){var a=s(t).attr("jid");this.getGroupchatFeatures(a)}}.bind(this)),this.endDiscovering()},getGroupchatFeatures:function(e){var t=o({type:"get",to:e}).c("query",{xmlns:c.NS.DISCO_INFO,node:c.NS.GROUP_CHAT});this.account.sendIQ(t,this.getServerInfo.bind(this),this.onDiscoveringError.bind(this))},getServerInfo:function(e){s(e).find("query identity").each(function(t,a){var i=s(a);if("conference"===i.attr("category")&&"server"===i.attr("type")){var n=s(e).attr("from");this.getChatsFromSever(n)}}.bind(this))},getChatsFromSever:function(e){var t=o({type:"get",to:e}).c("query",{xmlns:c.NS.DISCO_ITEMS,node:c.NS.GROUP_CHAT});this.account.sendIQ(t,function(e){this.$(".chats-list").html(""),s(e).find("query item").each(function(e,t){var a=s(t),n=a.attr("name"),o=a.attr("jid"),d=s(i.existing_groupchat_item({name:n,jid:o,color:this.account.settings.get("color")})),r=m.getDefaultAvatar(n);d.find(".circle-avatar").setAvatar(r,32),d.appendTo(this.$(".searching-result-wrap .chats-list"))}.bind(this)),this.$(".result-string").text("Discovered "+s(e).find("query item").length+" group chats by "+this.account.get("jid"))}.bind(this))},bindAccount:function(e){this.account=e,this.$(".account-field .dropdown-button .account-item-wrap").replaceWith(this.renderAccountItem(e)),this.setColor()},renderAccountItem:function(e){var t=s(i.searching_account_item({jid:e.get("jid")}));return t},selectAccount:function(t){var a=s(t.target).closest(".account-item-wrap"),i=e.accounts.get(a.data("jid"));this.bindAccount(i)},getChatProperties:function(t){var a=s(t.target).closest(".existing-chat-wrap"),i=a.data("jid"),n=a.data("name"),d=o({type:"get",to:i}).c("query",{xmlns:c.NS.DISCO_INFO});this.account.sendIQ(d,function(t){var a=s(t),o=a.find("field[var=\"description\"] value").text(),d=a.find("field[var=\"anonymous\"] value").text(),r=a.find("field[var=\"model\"] value").text();this.more_info_view=this.addChild("groupchat_properties",e.MoreInfoView,{model:this,chat_properties:{jid:i,name:n,anonymous:d,description:o,membership:r},el:this.$(".searching-more")[0]})}.bind(this))}}),e.MoreInfoView=e.BasicView.extend({className:"searching-main noselect",template:i.existing_groupchat_details_view,events:{"click .btn-join-chat":"joinChat"},_initialize:function(e){this.account=this.model.account,this.chat_properties=e.chat_properties,this.$el.html(this.template(this.chat_properties))},render:function(){},joinChat:function(){let e=this.account.contacts.mergeContact(this.chat_properties.jid);e.set("group_chat",!0),e.invitation.joinGroupChat()}}),e.Searching=Backbone.Model.extend({initialize:function(e){this.account=e.account},getSearchingFields:function(){let e=o({from:this.account.get("jid"),type:"get",to:"index.xabber.com"}).c("query",{xmlns:c.NS.INDEX+"#groupchat"});this.account.sendIQ(e,this.parseSearchingFields)},parseSearchingFields:function(e){let t=s(e),a=t.find("x[xmlns = \""+c.NS.XDATA+"\"] field"),i=[];a.each(function(e,t){let a=s(t);"hidden"!==a.attr("type")&&i.push({var:a.attr("var"),label:a.attr("label")})}.bind(this))}}),e.LocalSearchingView=e.BasicView.extend({className:"",events:{},_initialize:function(e){this.account=e.account},render:function(){},search:function(){}}),e.GlobalSearchingView=e.BasicView.extend({className:"",events:{},_initialize:function(e){this.account=e.account,this.indexed_chats=[]},render:function(){},search:function(e){this.indexed_chats=[];let t=o({to:"index.xabber.com",type:"set",from:this.account.get("jid")}).c("query",{xmlns:c.NS.INDEX+"#groupchat"}).c("x",{xmlns:c.NS.XDATA,type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(c.NS.INDEX+"#groupchat").up().up();e.description&&t.c("field",{var:"description"}).c("value").t(e.description).up().up(),e.name&&t.c("field",{var:"name"}).c("value").t(e.name).up().up(),e.model&&t.c("field",{var:"model"}).c("value").t(e.model).up().up(),e.anywhere&&t.c("field",{var:"anywhere"}).c("value").t(e.anywhere).up().up(),this.account.sendIQ(t,this.onSearched.bind(this))},onSearched:function(e){let t=s(e),a=s(t.find("query item groupchat"));a.each(function(e,t){let a=s(t),i=a.attr("jid"),n={jid:i},o=a.children();o.each(function(e,t){let a=s(t),i=a[0].tagName.replace(/-/g,"_"),o=a.text();l.extend(n,{[i]:o})}.bind(this)),this.indexed_chats.push(n)}.bind(this))}}),e.once("start",function(){this.discovering=this.wide_panel.addChild("discovering_main",this.DiscoveringView)},e),e}}),define("xabber-mentions",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.mentions,n=t.utils,s=t.$,o=t.$iq,d=t.$msg,r=t.$pres,c=t.Strophe,l=t._,p=t.moment,u=t.uuid,m=n.images;return e.Mention=Backbone.Model.extend({defaults:{active:!1,display:!1,timestamp:0},initialize:function(t,a){this.contact=a.contact,this.message=a.message,this.id=this.message.get("msgid"),this.set("timestamp",this.message.get("timestamp")),this.account=this.contact.account,this.item_view=new e.MentionItemView({model:this}),this.contact.on("destroy",this.destroy,this)}}),e.MentionsBase=Backbone.Collection.extend({model:e.Mention}),e.AccountMentions=e.MentionsBase.extend({initialize:function(e,t){this.account=t.account,this.on("add",this.onMentionAdded,this)},onMentionAdded:function(t){e.mentions.add(t)}}),e.Mentions=e.MentionsBase.extend({comparator:"timestamp",initialize:function(){this.collections=[],this.on("add",l.bind(this.updateInCollections,this,"add")),this.on("change",l.bind(this.updateInCollections,this,"change"))},addCollection:function(e){this.collections.push(e)},updateInCollections:function(e,t){l.each(this.collections,function(a){a.update(t,e)})}}),e.MentionsView=e.SearchPanelView.extend({className:"mentions-container container",ps_selector:".mentions-list-wrap",main_container:".mentions-list",ps_settings:{theme:"item-list"},template:i.mentions_panel,_initialize:function(){this.active_mention=null,this.keyup_timeout=null,this.model.on("add",this.onMentionAdded,this),this.model.on("change:active",this.onChangedActiveStatus,this),this.model.on("destroy",this.onMentionRemoved,this),e.accounts.on("list_changed",this.updateLeftIndicator,this),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this))},render:function(e){!e.right&&this.active_mention&&(this.active_mention.model.set("active",!1),this.active_mention=null),("chat"!==e.right&&"contact_details"!==e.right&&"message_context"!==e.right&&"participant_messages"!==e.right||e.clear_search&&"chat"===e.right)&&this.clearSearch()},onMentionAdded:function(e){this.addChild(e.id,e.item_view),this.updateMentionPosition(e)},onMentionRemoved:function(e,t){t=t||{},this.active_mention===this.child(e.id)&&(this.active_mention=null),this.removeChild(e.id,t),this.updateScrollBar()},selectItem:function(e){this.clearSearchSelection();var t=this.$(".list-item[data-id=\""+e+"\"]");t.length?this.selection_id=e:(t=this.$(".list-item:visible").first(),this.selection_id=t.data("id")),t.find(".mention-info-wrap").addClass("selected")},clearSearchSelection:function(){this.selection_id=null,this.$(".list-item.selected").removeClass("selected"),this.$(".list-item .selected").removeClass("selected")},onEnterPressed:function(t){let a;t.closest(".searched-lists-wrap").length?(this.clearSearch(),this.$(".list-item.active").removeClass("active"),t.hasClass("chat-item")&&(a=e.chats_view.child(t.data("id")),a&&a.open({screen:e.body.screen.get("name"),clear_search:!1}),t.addClass("active")),t.hasClass("roster-contact")&&(a=e.accounts.get(t.data("account")).chats.get(e.accounts.get(t.data("account")).contacts.get(t.data("jid")).hash_id),a&&(a=a.item_view),a&&e.chats_view.openChat(a,{clear_search:!1,screen:e.body.screen.get("name")}),t.addClass("active")),t.hasClass("message-item")&&t.click()):t.find(".mention-info-wrap").click()},replaceMentionItem:function(e,t){let a=this.child(e.id);if(a&&e.get("timestamp")){a.$el.detach();let i=t.indexOf(e);0===i?this.$(".mentions-list").append(a.$el):this.$(".mention-item").eq(-i).before(a.$el);let n=a.$el.prev(".mention-item"),s=a.$el.next(".mention-item"),o=a.$el.data("contact-jid");if(n.length){let e=n.data("contact-jid");e!==o&&a.$el.find(".group-chat-title-wrap").removeClass("hidden")}else a.$el.find(".group-chat-title-wrap").removeClass("hidden");if(s.length){let e=s.data("contact-jid");e===o?s.find(".group-chat-title-wrap").addClass("hidden"):s.find(".group-chat-title-wrap").removeClass("hidden")}else a.$el.find(".group-chat-title-wrap").removeClass("hidden")}},readAllMentions:function(){e.accounts.connected.forEach(function(e){let t=l.clone(e.unreaded_mentions.models);l.each(t,function(t){let a=t.message.get("msgid"),i=t.message.get("archive_id"),n=t.message.get("contact_archive_id"),s=e.chats.getChat(t.contact);t.message.set("is_unread",!1),s.sendMarker(a,"displayed",i,n)}.bind(this))}.bind(this))},updateLeftIndicator:function(e){this.$el.attr("data-indicator",1<e.connected.length)},updateMentionPosition:function(e){let t=this.child(e.id);t&&this.replaceMentionItem(e,this.model)},onChangedActiveStatus:function(e){if(e.get("active")){var t=this.active_mention;this.active_mention=this.child(e.id),t&&t.model.set("active",!1)}}}),e.MentionItemView=e.BasicView.extend({className:"mention-item list-item",template:i.mention_item,avatar_size:a.AVATAR_SIZES.CHAT_ITEM,events:{"click .mention-info-wrap":"openByClick"},_initialize:function(){this.account=this.model.account,this.contact=this.model.contact,this.$el.attr("data-id",this.model.id),this.$el.attr("data-contact-jid",this.contact.get("jid")),this.updateContactName(),this.updateGroupChat(),this.updateName(),this.updateLastMessage(),this.updateAvatar(),this.updateColorScheme(),this.updateCounter(),this.updateIcon(),this.model.on("change:active",this.updateActiveStatus,this),this.account.settings.on("change:color",this.updateColorScheme,this),this.contact.on("change:name",this.updateContactName,this),this.contact.on("change:group_chat",this.updateGroupChat,this),this.model.message.on("change:is_unread",this.updateCounter,this)},updateName:function(){let e=this.model.message,t=e.get("user_info")||e.isSenderMe()&&this.contact.my_info&&this.contact.my_info.attributes,a=this.contact.get("name");t&&(a=t.nickname||t.jid||t.id||this.model.message.get("from_jid")),this.$(".chat-title").text(a)},updateIcon:function(){this.$(".contact-icon .group-chat-icon").hideIf(!this.contact.get("group_chat")&&this.contact.get("jid")===this.account.domain),this.$(".contact-icon .server-icon").hideIf(this.contact.get("jid")!==this.account.domain)},updateContactName:function(){let e=this.contact.get("name");if(this.$(".group-chat-name").text(e),!this.contact.get("group_chat")&&(this.updateName(),!this.contact.get("photo_hash"))){let t=m.getDefaultAvatar(e);this.$(".circle-avatar").setAvatar(t,this.avatar_size)}},updateGroupChat:function(){this.updateIcon()},updateCounter:function(){let t=this.model.message.get("is_unread");this.$(".msg-counter").switchClass("hidden",!t),t?this.account.unreaded_mentions.add(this.model):this.account.unreaded_mentions.remove(this.model),e.toolbar_view.recountAllMessageCounter()},updateLastMessage:function(){let e=this.model.message;if(!e)return;let t=e.get("time"),a=e.get("timestamp"),i=e.get("forwarded_message"),o=e.get("files"),d=e.get("images"),r=i?e.get("message")||(1<i.length?i.length+" forwarded messages":"Forwarded message").italics():e.getText();if(this.model.set({timestamp:a}),o||d){let e=s("<span class=\"text-color-500\"/>");o&&d&&(o=0<o.length?o:void 0,d=0<d.length?d:void 0),o&&d?r=e.text(o.length+d.length+" files"):(o&&(1<o.length&&(r=e.text(o.length+" files")),1==o.length&&(r=e.text(o[0].name))),d&&(1<d.length&&(r=e.text(d.length+" images")),1==d.length&&(r=e.text(d[0].name)))),this.$(".last-msg").text("").append(r)}else this.$(".last-msg").text(r);this.$el.emojify(".last-msg",{emoji_size:14}),this.$(".last-msg-date").text(n.pretty_short_datetime(t)).attr("title",n.pretty_datetime(t))},updateActiveStatus:function(){this.$el.find(".mention-info-wrap").switchClass("active",this.model.get("active"))},updateAvatar:function(){let e=this.model.message,t=e.get("user_info")||e.isSenderMe()&&this.contact.my_info&&this.contact.my_info.attributes,a;if(!t)a=this.contact.cached_image,this.$(".circle-avatar").setAvatar(a,this.avatar_size);else if(!t.avatar){let e=m.getDefaultAvatar(t.nickname||t.jid||t.id);this.$(".circle-avatar").setAvatar(e,this.avatar_size)}else if(a=t.b64_avatar||this.account.chat_settings.getB64Avatar(t.avatar),a)this.$(".circle-avatar").setAvatar(a,this.avatar_size);else{var i=c.NS.PUBSUB_AVATAR_DATA+"#"+t.id;this.contact.getAvatar(t.avatar,i,function(e){a=e,this.account.chat_settings.updateCachedAvatars(t.id,t.avatar,e),this.$(".circle-avatar").setAvatar(a,this.avatar_size)}.bind(this),function(){let e=m.getDefaultAvatar(t.nickname||t.jid||t.id);this.$(".circle-avatar").setAvatar(e,this.avatar_size)}.bind(this))}},openByClick:function(){let e=this.model.message.get("msgid"),t=this.model.message.get("archive_id"),a=this.model.message.get("contact_archive_id"),i=this.account.chats.getChat(this.contact);this.model.message.set("is_unread",!1),i.sendMarker(e,"displayed",t,a),this.model.set("active",!0),this.contact.trigger("open_mention",this.contact,e)},updateColorScheme:function(){var e=this.account.settings.get("color");this.$el.attr("data-color",e)}}),e.MentionsPlaceholderView=e.BasicView.extend({className:"placeholder-wrap mentions-placeholder-wrap noselect",template:i.mentions_placeholder}),e.Account.addInitPlugin(function(){this.mentions=new e.AccountMentions(null,{account:this}),this.unreaded_mentions=new e.Mentions(null,{account:this})}),e.once("start",function(){this.mentions=new this.Mentions,this.mentions_view=this.left_panel.addChild("mentions",this.MentionsView,{model:this.mentions}),this.mentions_placeholder=this.right_panel.addChild("mentions_placeholder",this.MentionsPlaceholderView)},e),e}}),define("xabber-ui",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates,n=t.utils,s=t.$,o=t._;return e.once("start",function(){s(window).on("keydown",function(t){let i=e.body.screen.attributes;if(t.keyCode===a.KEY_ESCAPE){if(e.body.$el.siblings("#modals").children().length)return;"all-chats"===i.name&&"contact_details"===i.right&&i.contact.trigger("open_chat",i.contact)}if(i.chat_item&&("mentions"===i.name||"contacts"===i.name||"all-chats"===i.name)&&("chat"===i.right||"participant_messages"===i.right||"message_context"===i.right||"searched_messages"===i.right)&&!window.$(".message-actions-panel").hasClass("hidden")&&!t.ctrlKey&&!t.metaKey){switch(t.keyCode){case 67:i.chat_item.contact.trigger("copy_selected_messages");break;case 68:i.chat_item.contact.trigger("delete_selected_messages");break;case 69:i.chat_item.contact.trigger("edit_selected_message");break;case 70:i.chat_item.contact.trigger("forward_selected_messages");break;case 80:i.chat_item.contact.trigger("pin_selected_message");break;case 82:i.chat_item.contact.trigger("reply_selected_messages");break;case a.KEY_ESCAPE:i.chat_item.contact.trigger("reset_selected_messages");}t.preventDefault()}}.bind(this)),this.updateLayout=function(t){t||(t={}),this.roster_view.isVisible()&&this.updateRosterLayout(t),e.trigger("update_css",t),this.body.$(".ps-container").perfectScrollbar("update")},this.updateRosterLayout=function(){var e=this.body.$el.width(),t=e>=a.WIDTH_MEDIUM,i=e<a.WIDTH_NARROW,n=e<a.WIDTH_TINY,s=this.roster_view.data.get("expanded"),o=this.roster_view.data.get("pinned");if(this.roster_view.$(".collapsed-wrap").hideIf(s),this.roster_view.$(".expanded-wrap").showIf(s),this.roster_view.$(".btn-pin").hideIf(i).text(o?"unpin":"pin"),i&&o)return void this.roster_view.data.set({expanded:!1,pinned:!1});if(!i&&!o&&this.settings.roster.pinned)return void this.roster_view.data.set({expanded:!0,pinned:!0});var d="",r,c;t||!(i||o)?(c=1050,r=300):i?(c=e-50-20-44,1038<c?(c=1038,r=288):(r=250,d=60)):(c=7*(e-50-20)/9,r=2*(e-50-20)/9,d=60),s||(r=t?48:44);var l=(e-c)/2,p=l-50,u=l-r;this.roster_view.$(".expanded-wrap").switchClass("solid",!o&&(!t||0>u)),o&&!d&&3*u<p&&(d=50+.75*(p+u)),this.main_panel.setCustomCss({width:c,"margin-left":d}),this.roster_view.setCustomCss({width:r})},this.on("update_layout",this.updateLayout,this),this.body.addScreen("blank",{}),this.body.addScreen("login",{login:{xmpp_login:null}}),this.body.addScreen("settings",{toolbar:null,main:{wide:{settings:null}},roster:null}),this.body.addScreen("add_account",{toolbar:null,login:null}),this.body.addScreen("about",{toolbar:null,main:{wide:{about:null}},roster:null});var t=new this.ViewPath("account.settings_left"),i=new this.ViewPath("account.settings_right"),n=new this.ViewPath("account.vcard_edit");this.body.addScreen("account_settings",{toolbar:null,main:{wide:{account_settings:{left:t,right:i}}},roster:null}),this.account_settings.patchTree=function(e,a){if("vcard_edit"===a.right)return{left:t,right:n}};var o=new this.ViewPath("chat_item.content.head"),d=new this.ViewPath("chat_item.content"),r=new this.ViewPath("chat_item.content.bottom"),c=new this.ViewPath("contact.details_view"),l=new this.ViewPath("contact.invitation"),p=new this.ViewPath("contact.private_invitation"),u=new this.ViewPath("contact.messages_view"),m=new this.ViewPath("contact.details_view.participants");this.body.addScreen("contacts",{toolbar:null,main:{left:{contacts:null},right:{contact_placeholder:null}},roster:null}),this.body.addScreen("search",{toolbar:null,main:{wide:{discovering_main:null}},roster:null}),this.body.addScreen("mentions",{toolbar:null,main:{left:{mentions:null},right:{mentions_placeholder:null}},roster:null}),this.body.addScreen("all-chats",{toolbar:null,main:{left:{chats:null},right:{chat_placeholder:null}},roster:null}),this.right_panel.patchTree=function(e,t){return"message_context"===t.right||"participant_messages"===t.right||"searched_messages"===t.right?{chat_head:o,chat_body:u,chat_bottom:r}:"private_invitation"===t.right?{details:p}:"group_invitation"===t.right?{details:l}:"contact_details"===t.right?{details:c}:"participants"===t.details_content?{details_content:m}:t.chat_item?{chat_head:o,chat_body:d,chat_bottom:r}:void 0},this.body.setScreen("blank"),this.api_account.once("settings_result",function(e){null!==e||this.accounts.length?this.body.isScreen("blank")&&this.body.setScreen("all-chats"):this.body.setScreen("login")},this),this.api_account.ready.then(this.api_account.start.bind(this.api_account))},e),e}}),define("xabber",["xabber-core","xabber-views","xabber-api-service","xabber-strophe","xabber-vcard","xabber-accounts","xabber-discovery","xabber-contacts","xabber-chats","xabber-searching","xabber-mentions","xabber-ui"],function(e,t,a,i,n,s,o,d,r,c,l,p){return e.extendWith(t,a,i,n,s,o,d,r,c,l,p)});